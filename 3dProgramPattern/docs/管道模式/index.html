<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">ç¬¬4ç«  ç®¡é“æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ç¬¬4ç«  ç®¡é“æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼"><meta data-react-helmet="true" name="description" content="åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘"><meta data-react-helmet="true" property="og:description" content="åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘"><link data-react-helmet="true" rel="canonical" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/" hreflang="x-default"><link rel="stylesheet" href="/3dProgramPattern/assets/css/styles.e233dcee.css">
<link rel="preload" href="/3dProgramPattern/assets/js/runtime~main.c94d0359.js" as="script">
<link rel="preload" href="/3dProgramPattern/assets/js/main.c6dc4a90.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/3dProgramPattern/"><b class="navbar__title">3Dç¼–ç¨‹æ¨¡å¼</b></a><a class="navbar__item navbar__link navbar__link--active" href="/3dProgramPattern/docs/å‰è¨€">å†…å®¹</a><a href="https://github.com/yyc-git/3DProgramPattern" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">å¼€ç¯‡</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å‰è¨€">å‰è¨€</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">ç¬¬ä¸€éƒ¨åˆ† ç¬¬1ç«  å†çœ‹è®¾è®¡åŸåˆ™</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/è®¾è®¡åŸºç¡€/">1.1 è®¾è®¡åŸºç¡€</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å•ä¸€èŒè´£åŸåˆ™/">1.2 å•ä¸€èŒè´£åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/åˆæˆå¤ç”¨åŸåˆ™/">1.3 åˆæˆå¤ç”¨åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æ¥å£éš”ç¦»åŸåˆ™/">1.4 æ¥å£éš”ç¦»åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/ä¾èµ–å€’ç½®åŸåˆ™/">1.5 ä¾èµ–å€’ç½®åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æœ€å°‘çŸ¥è¯†åŸåˆ™/">1.6 æœ€å°‘çŸ¥è¯†åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å¼€é—­åŸåˆ™/">1.7 å¼€é—­åŸåˆ™</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">ç¬¬äºŒéƒ¨åˆ† 7ç§ç¼–ç¨‹æ¨¡å¼</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ä¾èµ–éš”ç¦»æ¨¡å¼/">ç¬¬2ç«  ä¾èµ–éš”ç¦»æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç§¯æœ¨æ¨¡å¼/">ç¬¬3ç«  ç§¯æœ¨æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/">ç¬¬4ç«  ç®¡é“æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ECSæ¨¡å¼/">ç¬¬5ç«  ECSæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/">ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ç¬¬4ç«  ç®¡é“æ¨¡å¼</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘">åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘<a class="hash-link" href="#åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éœ€æ±‚">éœ€æ±‚<a class="hash-link" href="#éœ€æ±‚" title="Direct link to heading">â€‹</a></h3><p>å¼€å‘è€…ç”²è¦å®ç°å¼•æ“çš„æ¸²æŸ“ï¼Œå¹¶ä½¿å…¶èƒ½å¤ŸåŒæ—¶è¿è¡Œåœ¨PCç«¯å’Œç§»åŠ¨ç«¯ã€‚ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„å·®å¼‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>PCç«¯æ”¯æŒWebGL2ï¼Œç§»åŠ¨ç«¯åªæ”¯æŒWebGL1</li><li>PCç«¯å¯ä»¥ä½¿ç”¨å»¶è¿Ÿæ¸²æŸ“çš„ç®—æ³•æ¥æ¸²æŸ“ï¼Œç§»åŠ¨ç«¯å› ä¸ºä¸æ”¯æŒmulti render targetsï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å‰å‘æ¸²æŸ“çš„ç®—æ³•æ¥æ¸²æŸ“</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å®ç°æ€è·¯">å®ç°æ€è·¯<a class="hash-link" href="#å®ç°æ€è·¯" title="Direct link to heading">â€‹</a></h3><p>å¼•æ“éœ€è¦å®ç°åˆå§‹åŒ–ã€æ¸²æŸ“è¿™ä¸¤ä¸ªé€»è¾‘ï¼Œå…¶ä¸­åˆå§‹åŒ–å¯åˆ†è§£ä¸ºåˆå§‹åŒ–WebGLè¿™ä¸€ä¸ªæ­¥éª¤ï¼Œæ¸²æŸ“å¯åˆ†è§£ä¸ºæ¸²æŸ“ã€Tonemapåå¤„ç†è¿™ä¸¤ä¸ªæ­¥éª¤</p><p>å¤„ç†è¿è¡Œç¯å¢ƒçš„å·®å¼‚çš„æ€è·¯æ˜¯åœ¨æ¯ä¸ªæ­¥éª¤ä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œè¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>åœ¨â€œåˆå§‹åŒ–WebGLâ€ä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œå¦‚æœæ˜¯PCç«¯å°±è·å¾—WebGL2çš„ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™å°±è·å¾—WebGL1çš„ä¸Šä¸‹æ–‡</li><li>åœ¨â€œæ¸²æŸ“â€ä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œå¦‚æœæ˜¯PCç«¯å°±ä½¿ç”¨å»¶è¿Ÿæ¸²æŸ“ç®—æ³•ï¼Œå¦åˆ™å°±ä½¿ç”¨å‰å‘æ¸²æŸ“ç®—æ³•</li><li>åœ¨â€œTonemapâ€ä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œå¦‚æœæ˜¯PCç«¯å°±ä½¿ç”¨WebGL2çš„ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™å°±ä½¿ç”¨WebGL1çš„ä¸Šä¸‹æ–‡</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-ac9d5bb45505a60069b212b66d5b3648.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€Engineè¿™ä¸¤ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹Engineè¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Engineæ˜¯å¼•æ“ï¼Œè´Ÿè´£åˆå§‹åŒ–å’Œæ¸²æŸ“ã€‚Engineæœ‰ä¸€ä¸ªEngineStateæ•°æ®ï¼Œç”¨æ¥ä¿å­˜å¼•æ“çš„æ‰€æœ‰æ•°æ®ã€‚Engineçš„createStateå‡½æ•°å®ç°åˆ›å»ºEngineStateï¼ŒEngineçš„initå‡½æ•°å®ç°åˆå§‹åŒ–ï¼ŒEngineçš„renderå‡½æ•°å®ç°æ¸²æŸ“</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç ">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç " title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹æ¯ä¸ªæ¨¡å—çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>Clientçš„ä»£ç ï¼›</li><li>Engineçš„ä»£ç ï¼›</li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç ">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ„é€ å‡canvas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">getContext</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//æ­¤å¤„è®¾ç½®è¿è¡Œç¯å¢ƒä¸ºPCç«¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ä¸ºfalseæ¥è®¾ç½®è¿è¡Œç¯å¢ƒä¸ºç§»åŠ¨ç«¯ </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isPC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clienté¦–å…ˆè°ƒç”¨createStateå‡½æ•°åˆ›å»ºäº†å¼•æ“çš„EngineStateï¼›ç„¶åè°ƒç”¨initå‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼›æœ€åè°ƒç”¨renderå‡½æ•°è¿›è¡Œæ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineçš„ä»£ç ">Engineçš„ä»£ç <a class="hash-link" href="#engineçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>EngineStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> WebGL2RenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>EngineStateTypeå®šä¹‰äº†EngineStateçš„ç±»å‹ï¼Œå…¶ä¸­glå­—æ®µä¿å­˜äº†WebGLä¸Šä¸‹æ–‡ã€‚å› ä¸ºå®ƒå¯èƒ½æ˜¯WebGL1æˆ–è€…WebGL2çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥glçš„ç±»å‹ä¹Ÿæ˜¯è¿™ä¸¤ä¸ªç±»å‹çš„è”åˆç±»å‹</p><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_isPC</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_initWebGL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_render</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> WebGL2RenderingContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å»¶è¿Ÿæ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> WebGLRenderingContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å‰å‘æ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_tonemap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> WebGL2RenderingContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> WebGLRenderingContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tonemap&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isPC </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;is PC&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;is mobile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_initWebGL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">render</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_tonemap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>åˆå§‹åŒ–çš„â€œåˆå§‹åŒ–WebGLâ€æ­¥éª¤åœ¨_initWebGLè¿™ä¸ªå‡½æ•°ä¸­å®ç°ï¼Œæ¸²æŸ“çš„â€œæ¸²æŸ“â€ã€â€œTonemapåå¤„ç†â€è¿™ä¸¤ä¸ªæ­¥éª¤åˆ†åˆ«åœ¨_renderã€_tonemapè¿™ä¸¤ä¸ªå‡½æ•°ä¸­å®ç°ã€‚æ¯ä¸ªæ­¥éª¤éƒ½åˆ¤æ–­äº†è¿è¡Œç¯å¢ƒï¼Œæ‰§è¡Œå¯¹åº”çš„é€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç ">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">is </span><span class="token constant" style="color:#36acaa">PC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–WebGL2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å»¶è¿Ÿæ¸²æŸ“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tonemap </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token maybe-class-name">WebGL2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å› ä¸ºè¿™é‡ŒæŒ‡å®šç¯å¢ƒä¸ºPCç«¯ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ˜¯PCç«¯çš„é€»è¾‘</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†åŠ å¿«å¼€å‘è¿›åº¦ï¼Œç”²æ‰¾åˆ°äº†å¼€å‘è€…ä¹™æ¥ä¸€èµ·å¼€å‘ï¼Œå…¶ä¸­ç”²è´Ÿè´£PCç«¯çš„æ‰€æœ‰æ­¥éª¤å’Œç§»åŠ¨ç«¯çš„â€œåˆå§‹åŒ–WebGLâ€ã€â€œå‰å‘æ¸²æŸ“â€è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œä¹™è´Ÿè´£ç§»åŠ¨ç«¯çš„â€œTonemapåå¤„ç†â€è¿™ä¸ªæ­¥éª¤ã€‚</p><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å¼€å‘æ•ˆç‡ä½<br>ç”±äºä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘æ··æ‚åœ¨åŒä¸€ä¸ªæ¨¡å—çš„åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå¯¼è‡´ä¸¤ä¸ªå¼€å‘è€…åœ¨å¼€å‘æ—¶ç›¸äº’å½±å“ï¼Œå¯¼è‡´å®¹æ˜“å‡ºç°ä»£ç å†²çªï¼Œæœ€ç»ˆä½¿å¾—æ•´ä½“çš„å¼€å‘æ•ˆç‡é€æ¸å˜æ…¢</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ‹†åˆ†æ¨¡å—">æ‹†åˆ†æ¨¡å—<a class="hash-link" href="#æ‹†åˆ†æ¨¡å—" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ul><li><p>åˆ†ç¦»PCç«¯å’Œç§»åŠ¨ç«¯çš„é€»è¾‘ä¸ºä¸åŒçš„æ¨¡å—<br>
<!-- -->ä»Engineä¸­æå‡ºä¸¤ä¸ªæ¨¡å—ï¼šEngineInPCã€EngineInMobileï¼Œåˆ†åˆ«å®ç°PCç«¯å’Œç§»åŠ¨ç«¯çš„é€»è¾‘ï¼›ç„¶ååœ¨Engineä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œè°ƒç”¨å¯¹åº”çš„æ¨¡å—</p></li><li><p>å°†æ¯ä¸ªæ­¥éª¤æå‡ºæˆå•ç‹¬çš„æ¨¡å—ï¼Œè¿™æ ·å¯å‡å°‘æ­¥éª¤ä¹‹é—´çš„è€¦åˆï¼Œä¾¿äºç»´æŠ¤</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-1">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-1" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-63ea9fef9534315d4f82a26e838ec192.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€Engineã€é’ˆå¯¹æ¯ä¸ªè¿è¡Œç¯å¢ƒçš„å¼•æ“å®ç°ã€æ­¥éª¤è¿™å››ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·ã€Engineè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>Engineæ˜¯å¼•æ“é—¨æˆ·ï¼Œè´Ÿè´£åˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œè°ƒç”¨å¯¹åº”çš„æ¨¡å—</p><p>æˆ‘ä»¬çœ‹ä¸‹é’ˆå¯¹æ¯ä¸ªè¿è¡Œç¯å¢ƒçš„å¼•æ“å®ç°è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>EngineInPCè´Ÿè´£PCç«¯çš„å¼•æ“å®ç°</p><p>EngineInMobileè´Ÿè´£ç§»åŠ¨ç«¯çš„å¼•æ“å®ç°</p><p>æˆ‘ä»¬çœ‹ä¸‹æ­¥éª¤è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>EngineInPCçš„æ­¥éª¤æ¨¡å—å¦‚ä¸‹ï¼š</p><ul><li>InitWebGL2è´Ÿè´£åˆå§‹åŒ–WebGL2</li><li>DeferRenderè´Ÿè´£å»¶è¿Ÿæ¸²æŸ“</li><li>TonemapForWebGL2è´Ÿè´£ä½¿ç”¨WebGL2å®ç°Tonemapåå¤„ç†</li></ul><p>EngineInMobileçš„æ­¥éª¤æ¨¡å—å¦‚ä¸‹ï¼š</p><ul><li>InitWebGL1è´Ÿè´£åˆå§‹åŒ–WebGL1</li><li>ForwardRenderè´Ÿè´£å‰å‘æ¸²æŸ“</li><li>TonemapForWebGL1è´Ÿè´£ä½¿ç”¨WebGL1å®ç°Tonemapåå¤„ç†</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li>ç°åœ¨ç”²è´Ÿè´£EngineInPCçš„æ‰€æœ‰æ­¥éª¤æ¨¡å—å’ŒEngineInMobileçš„InitWebGL1ã€ForwardRenderæ­¥éª¤æ¨¡å—ï¼Œä¹™è´Ÿè´£EngineInMobileçš„TonemapForWebGL1æ­¥éª¤æ¨¡å—ï¼Œä¸¤äººç›¸äº’ä¸å½±å“</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -1">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -1" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›</p><p>ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºEngineStateçš„ä»£ç </li><li>Engineçš„initå‡½æ•°çš„ä»£ç </li><li>Engineçš„renderå‡½æ•°çš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºEngineè°ƒç”¨äº†EngineInPCæ¥å®ç°PCç«¯çš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹ç›¸å…³çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>EngineInPCçš„ä»£ç ï¼›</li><li>EngineInPCçš„æ­¥éª¤æ¨¡å—çš„ä»£ç ï¼›</li></ul><p>ç„¶åï¼Œå› ä¸ºEngineè°ƒç”¨äº†EngineInMobileæ¥å®ç°ç§»åŠ¨ç«¯çš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹ç›¸å…³çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>EngineInMobileçš„ä»£ç ï¼›</li><li>EngineInMobileçš„æ­¥éª¤æ¨¡å—çš„ä»£ç ï¼›</li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç -1">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Clientä»£ç è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæ•…çœç•¥</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºenginestateçš„ä»£ç ">åˆ›å»ºEngineStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºenginestateçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>EngineStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">engineInPCState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGL2RenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">engineInMobileState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGL2RenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engineInPC</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> engineInPCState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engineInMobile</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> engineInMobileState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        engineInPC</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        engineInMobile</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†EngineStateï¼Œå®ƒç°åœ¨ä½¿ç”¨ä¸¤ä¸ªå­—æ®µæ¥åˆ†åˆ«ä¿å­˜ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„æ•°æ®ï¼Œäº’ä¸å¹²æ‰°</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineçš„initå‡½æ•°çš„ä»£ç ">Engineçš„initå‡½æ•°çš„ä»£ç <a class="hash-link" href="#engineçš„initå‡½æ•°çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_isPC</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isPC </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;is PC&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;is mobile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EngineInPC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EngineInMobile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initå‡½æ•°å®ç°äº†åˆå§‹åŒ–çš„é€»è¾‘ï¼Œå®ƒæ ¹æ®ä¸åŒçš„è¿è¡Œç¯å¢ƒæ¥è°ƒç”¨å¯¹åº”çš„æ¨¡å—</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineçš„renderå‡½æ•°çš„ä»£ç ">Engineçš„renderå‡½æ•°çš„ä»£ç <a class="hash-link" href="#engineçš„renderå‡½æ•°çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">render</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EngineInPC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EngineInMobile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderå‡½æ•°å®ç°äº†æ¸²æŸ“çš„é€»è¾‘ï¼Œå®ƒæ ¹æ®ä¸åŒçš„è¿è¡Œç¯å¢ƒæ¥è°ƒç”¨å¯¹åº”çš„æ¨¡å—</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineinpcçš„ä»£ç ">EngineInPCçš„ä»£ç <a class="hash-link" href="#engineinpcçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>EngineInPC</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InitWebGL2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initWebGL2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">render</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeferRender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">deferRender</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TonemapForWebGL2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tonemap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒè°ƒç”¨æ­¥éª¤æ¨¡å—æ¥æ‰§è¡ŒPCç«¯è¿è¡Œç¯å¢ƒçš„åˆå§‹åŒ–å’Œæ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineinpcçš„æ­¥éª¤æ¨¡å—çš„ä»£ç ">EngineInPCçš„æ­¥éª¤æ¨¡å—çš„ä»£ç <a class="hash-link" href="#engineinpcçš„æ­¥éª¤æ¨¡å—çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>InitWebGL2</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">initWebGL2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;åˆå§‹åŒ–WebGL2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        engineInPC</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>DeferRender</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">deferRender</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">engineInPC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å»¶è¿Ÿæ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>TonemapForWebGL2</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">tonemap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">engineInPC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tonemap for WebGL2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å„ä¸ªæ­¥éª¤æ¨¡å—çš„é€»è¾‘è·Ÿä¹‹å‰ä¸€æ ·</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineinmobileçš„ä»£ç ">EngineInMobileçš„ä»£ç <a class="hash-link" href="#engineinmobileçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>EngineInMobile</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InitWebGL1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initWebGL1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">render</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ForwardRender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forwardRender</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TonemapForWebGL1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tonemap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒè°ƒç”¨æ­¥éª¤æ¨¡å—æ¥æ‰§è¡Œç§»åŠ¨ç«¯è¿è¡Œç¯å¢ƒçš„åˆå§‹åŒ–å’Œæ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineinmobileçš„æ­¥éª¤æ¨¡å—çš„ä»£ç ">EngineInMobileçš„æ­¥éª¤æ¨¡å—çš„ä»£ç <a class="hash-link" href="#engineinmobileçš„æ­¥éª¤æ¨¡å—çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>InitWebGL1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">initWebGL1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;åˆå§‹åŒ–WebGL1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        engineInMobile</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ForwardRender</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">forwardRender</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">engineInMobile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å‰å‘æ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>TonemapForWebGL1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">tonemap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">engineInMobile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tonemap for WebGL1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å„ä¸ªæ­¥éª¤æ¨¡å—çš„é€»è¾‘è·Ÿä¹‹å‰ä¸€æ ·</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç -1">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">is </span><span class="token constant" style="color:#36acaa">PC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–WebGL2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å»¶è¿Ÿæ¸²æŸ“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tonemap </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token maybe-class-name">WebGL2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ‰“å°ç»“æœè·Ÿä¹‹å‰ä¸€æ ·</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜-1">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜-1" title="Direct link to heading">â€‹</a></h3><ul><li>ä¸èƒ½é€šè¿‡é…ç½®æ¥æŒ‡å®šåˆå§‹åŒ–å’Œæ¸²æŸ“çš„æ­¥éª¤<br>ç°åœ¨æ˜¯é€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ã€‚å¦‚æœä¸æ‡‚ä»£ç çš„ç­–åˆ’äººå‘˜æƒ³è¦è‡ªå®šä¹‰å„ä¸ªæ­¥éª¤çš„æ‰§è¡Œé¡ºåºï¼Œé‚£ä¹ˆä»–ä¸èƒ½ç›´æ¥é€šè¿‡ä¿®æ”¹é…ç½®æ•°æ®æ¥å®ç°ï¼Œè€Œéœ€è¦é€šè¿‡éº»çƒ¦å¼€å‘äººå‘˜ä¿®æ”¹ä»£ç æ¥å®ç°</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨ç®¡é“æ¨¡å¼æ¥æ”¹è¿›">ä½¿ç”¨ç®¡é“æ¨¡å¼æ¥æ”¹è¿›<a class="hash-link" href="#ä½¿ç”¨ç®¡é“æ¨¡å¼æ¥æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1" title="Direct link to heading">â€‹</a></h3><ul><li>å°†EngineInPCå’ŒEngineInMobileæ”¹ä¸ºä¸‰ä¸ªç®¡é“æ¨¡å—<br>å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šEngineInPCPipelineã€JiaEngineInMobilePipelineã€YiEngineInMobilePipelineï¼Œå…¶ä¸­å‰ä¸¤ä¸ªç”±ç”²è´Ÿè´£ï¼Œæœ€åä¸€ä¸ªç”±ä¹™è´Ÿè´£</li><li>å°†æ¯ä¸ªæ­¥éª¤æ¨¡å—æ”¹ä¸ºä¸€ä¸ªJob</li><li>æ¯ä¸ªç®¡é“æ¨¡å—éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç®¡é“ï¼Œæ¯ä¸ªç®¡é“æœ‰å¤šä¸ªJob</li><li>æ¯ä¸ªç®¡é“æ¨¡å—éƒ½å®šä¹‰äº†è‡ªå·±çš„JSONé…ç½®ï¼Œç”¨æ¥æŒ‡å®šJobçš„æ‰§è¡Œé¡ºåº</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-2">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-2" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-897a419bb50ced157310d06d33552ea3.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€Engineã€ç®¡é“ç®¡ç†ã€ä¸‰ä¸ªç®¡é“æ¨¡å—è¿™å››ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·ã€Engineè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>Engineæ˜¯å¼•æ“é—¨æˆ·ï¼Œä¸‹é¢ä»‹ç»å®ƒçš„å‡½æ•°ï¼š<br>
<!-- -->Engineçš„createStateå‡½æ•°åˆ›å»ºäº†EngineStateï¼›Engineçš„registerAllPipelineså‡½æ•°æŒ‰ç…§ä¸åŒçš„è¿è¡Œç¯å¢ƒæ³¨å†Œäº†å¯¹åº”çš„ç®¡é“æ¨¡å—ï¼›Engineçš„initå‡½æ•°è¿è¡Œäº†æ³¨å†Œçš„ç®¡é“æ¨¡å—çš„Init Pipelineç®¡é“ï¼Œä¾æ¬¡æ‰§è¡Œå®ƒæ‰€æœ‰çš„Jobï¼Œå®ç°äº†åˆå§‹åŒ–ï¼›Engineçš„rendeå‡½æ•°è¿è¡Œäº†æ³¨å†Œçš„ç®¡é“æ¨¡å—çš„Render Pipelineç®¡é“ï¼Œä¾æ¬¡æ‰§è¡Œå®ƒæ‰€æœ‰çš„Jobï¼Œå®ç°äº†æ¸²æŸ“</p><p>æˆ‘ä»¬çœ‹ä¸‹ç®¡é“ç®¡ç†è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>PipelineManagerè´Ÿè´£ç®¡ç†ç®¡é“ï¼Œå®ç°äº†æ³¨å†Œç®¡é“ã€åˆå¹¶ç®¡é“ã€è¿è¡Œç®¡é“çš„é€»è¾‘</p><p>æˆ‘ä»¬çœ‹ä¸‹ä¸‰ä¸ªç®¡é“æ¨¡å—è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>è¿™ä¸ªéƒ¨åˆ†åŒ…æ‹¬äº†ä¸‰ä¸ªç®¡é“æ¨¡å—ã€ç®¡é“æ¨¡å—çš„PipelineStateå’Œå…¶ç±»å‹å®šä¹‰ï¼ˆPipelineStateTypeï¼‰ã€ç®¡é“æ¨¡å—çš„ç®¡é“ã€ç®¡é“çš„Jobã€‚ä¸‰ä¸ªç®¡é“æ¨¡å—å…·ä½“æ˜¯ç”²è´Ÿè´£çš„EngineInPCPipelineã€JiaEngineInMobilePipelineå’Œä¹™è´Ÿè´£çš„YiEngineInMobilePipelineã€‚æ¯ä¸ªç®¡é“æ¨¡å—éƒ½æœ‰è‡ªå·±çš„PipelineStateï¼Œç”¨æ¥ä¿å­˜ç®¡é“çš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒä»¬å…·ä½“æ˜¯EngineInPCPipelineStateã€JiaEngineInMobilePipelineStateã€YiEngineInMobilePipelineStateã€‚æ¯ä¸ªPipelineStateå®ç°äº†å®šä¹‰åœ¨å¯¹åº”çš„PipelineStateTypeä¸­çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹å…·ä½“æ˜¯EngineInPCPipelineStateTypeã€JiaEngineInMobilePipelineStateTypeã€YiEngineInMobilePipelineStateType</p><p>æ¯ä¸ªç®¡é“æ¨¡å—æœ‰å¤šä¸ªç®¡é“ï¼Œè¿™äº›ç®¡é“çš„æ•°æ®éƒ½ä¿å­˜åœ¨å®ƒçš„PipelineStateä¸­ã€‚å…·ä½“æ¥è¯´ï¼ŒEngineInPCPipelineæœ‰ä¸€ä¸ªInit Pipelineå’Œä¸€ä¸ªRender Pipelineï¼ŒJiaEngineInMobilePipelineæœ‰ä¸€ä¸ªInit Pipelineå’Œä¸€ä¸ªRender Pipelineï¼ŒYiEngineInMobilePipelineæœ‰ä¸€ä¸ªRender Pipeline</p><p>ä¹‹å‰çš„æ­¥éª¤æ¨¡å—ç°åœ¨éƒ½å¯¹åº”åœ°æ”¹ä¸ºJobï¼Œæ¯ä¸ªç®¡é“å¯ä»¥æœ‰å¤šä¸ªJob</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¾èµ–å…³ç³»ï¼š</p><p>æ¯ä¸ªJobéƒ½èƒ½è¯»å†™<strong>æ‰€æœ‰</strong>ç®¡é“æ¨¡å—çš„PipelineStateï¼Œä½†å®ƒä»¬æ²¡æœ‰ç›´æ¥ä¾èµ–PipelineStateï¼Œè€Œæ˜¯ä¾èµ–å®ƒçš„ç±»å‹ï¼ˆPipelineStateTypeï¼‰ï¼Œå¦‚é¢†åŸŸæ¨¡å‹ä¸­EngineInPCPipelineçš„Render Pipelineç®¡é“çš„ä¸¤ä¸ªJobä¾èµ–äº†EngineInPCPipeineStateTypeï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬éœ€è¦è¯»å†™EngineInPCPipelineStateã€‚å½“ç„¶å®ƒä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¾èµ–å¦å¤–ä¸¤ä¸ªç®¡é“æ¨¡å—çš„PipelineStateTypeæ¥è¯»å†™å¦å¤–ä¸¤ä¸ªç®¡é“æ¨¡å—çš„PipelineStateï¼Œåªæ˜¯ç›®å‰æ²¡æœ‰å¿…è¦<br>
<!-- -->åŒç†ï¼ŒYiEngineInMobilePipelineçš„Render Pipelineç®¡é“çš„TonemapJobä¾èµ–äº†YiEngineInMobilePipelineStateTypeå’ŒJiaEngineInMobilePipelineStateTypeï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬éœ€è¦è¯»å†™YiEngineInMobilePipelineã€JiaEngineInMobilePipelineè¿™ä¸¤ä¸ªç®¡é“æ¨¡å—çš„PipelineState<br>
<!-- -->å¦å¤–ï¼ŒYiEngineInMobilePipelineStateTypeä¾èµ–äº†JiaEngineInMobilePipelineStateTypeï¼Œè¿™æ˜¯å› ä¸ºYiEngineInMobilePipelineStateTypeçš„statesç±»å‹éœ€è¦åŒ…æ‹¬JiaEngineInMobilePipelineStateTypeçš„stateï¼Œä»è€Œè®©YiEngineInMobilePipelineä¸­çš„TonemapJobèƒ½å¤Ÿé€šè¿‡å®ƒæ¥è·å¾—YiEngineInMobilePipelineStateå’ŒJiaEngineInMobilePipelineStateçš„ç±»å‹</p><p><strong>æ•°æ®è§†å›¾</strong></p><p><img alt="æ•°æ®è§†å›¾" src="/3dProgramPattern/assets/images/data_view-224103f95f1ca6fb714a1745cb3a4fdc.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œæ•°æ®åˆ†ä¸ºè¿è¡Œæ—¶æ•°æ®å’Œé…ç½®æ•°æ®ï¼Œå…¶ä¸­å„ä¸ªStateå±äºè¿è¡Œæ—¶æ•°æ®ï¼Œå„ä¸ªJSONå±äºé…ç½®æ•°æ®</p><p>Engineæœ‰è‡ªå·±çš„æ•°æ®-EngineStateï¼Œå®ƒåŒ…æ‹¬äº†å…¶å®ƒæ‰€æœ‰çš„state</p><p>PipelineManageræœ‰è‡ªå·±çš„æ•°æ®-PipelineManagerStateï¼Œå®ƒåŒ…æ‹¬äº†æ‰€æœ‰ç®¡é“æ¨¡å—çš„PipelineState</p><p>ä¸‰ä¸ªç®¡é“æ¨¡å—å„è‡ªæœ‰ä¸€ä¸ªPipelineStateæ•°æ®å’Œä¸€ä¸ªJSONé…ç½®æ•°æ®ï¼Œå…¶ä¸­PipelineStateä¿å­˜äº†ç®¡é“æ¨¡å—ä¸­æ‰€æœ‰ç®¡é“çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒJSONé…ç½®æ•°æ®ç”¨æ¥æŒ‡å®šç®¡é“æ¨¡å—ä¸­æ‰€æœ‰ç®¡é“çš„Jobçš„æ‰§è¡Œé¡ºåº</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1" title="Direct link to heading">â€‹</a></h3><ul><li><p>EngineInPCPipelineã€JiaEngineInMobilePipelineã€YiEngineInMobilePipelineè¿™ä¸‰ä¸ªç®¡é“æ¨¡å—éƒ½æœ‰è‡ªå·±çš„JSONé…ç½®æ•°æ®ï¼Œä¸æ‡‚å¼€å‘çš„ç­–åˆ’äººå‘˜åªéœ€è¦é…ç½®å®ƒä»¬è€Œä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œå³å¯æŒ‡å®šåˆå§‹åŒ–å’Œæ¸²æŸ“çš„æ­¥éª¤</p></li><li><p>ç°åœ¨ç”²ã€ä¹™ä¹‹é—´çš„å¼€å‘æ›´åŠ è§£è€¦äº†ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†ä¸¤äººçš„ç›¸äº’å½±å“<br>
<!-- -->ç”²å’Œä¹™å¼€å‘çš„æ˜¯ä¸åŒçš„ç®¡é“ï¼Œå®ƒä»¬ä¹‹é—´å”¯ä¸€çš„ä¾èµ–æ˜¯ä¹™å¼€å‘çš„ç®¡é“æ¨¡å—ï¼ˆYiEngineInMobilePipelineï¼‰çš„PipelineStateï¼ˆYiEngineInMobilePipelineStateï¼‰å’ŒJobï¼ˆTonemapJobï¼‰ä½¿ç”¨äº†ç”²å¼€å‘çš„ç®¡é“æ¨¡å—çš„PipelineStateï¼ˆJiaEngineInMobilePipelineStateï¼‰ã€‚ä½†æ˜¯å› ä¸ºå®ƒä»¬çš„ä¾èµ–æ˜¯ç±»å‹ï¼ˆPipelineStateTypeï¼‰ä¹‹é—´çš„ä¾èµ–ï¼Œæ‰€ä»¥åªè¦JiaEngineInMobilePipelineStateTypeä¸å˜ï¼ˆç±»å‹æ˜¯æŠ½è±¡çš„ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šæ”¹å˜ï¼‰ï¼Œåˆ™ç”²ã€ä¹™ä¹‹é—´çš„å¼€å‘å°±ä¸ä¼šäº’ç›¸å½±å“</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -2">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -2" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›</p><p>ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºEngineStateçš„ä»£ç </li><li>æ³¨å†Œç®¡é“æ¨¡å—çš„ä»£ç </li><li>Engineçš„initå‡½æ•°çš„ä»£ç </li><li>Engineçš„renderå‡½æ•°çš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ç§»åŠ¨ç«¯æ³¨å†Œçš„ç®¡é“æ¨¡å—çš„ç›¸å…³ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>JiaEngineInMobilePipelineçš„ç›¸å…³ä»£ç </li><li>YiEngineInMobilePipelineçš„ç›¸å…³ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºæ³¨å†Œçš„ç®¡é“æ¨¡å—æœ‰åŒåçš„ç®¡é“ï¼Œéœ€è¦åˆå¹¶å®ƒä»¬ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹ç›¸å…³ä»£ç ï¼š</p><ul><li>ç§»åŠ¨ç«¯åˆå¹¶Render Pipelineçš„ç›¸å…³ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹PCç«¯æ³¨å†Œçš„ç®¡é“æ¨¡å—çš„ç›¸å…³ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>EngineInPCPipelineçš„ç›¸å…³ä»£ç ï¼›</li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç -2">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> engineState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engineState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerAllPipelines</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clientä»£ç è·Ÿä¹‹å‰åŸºæœ¬ä¸Šä¸€æ ·ï¼Œåªæ˜¯å¤šå‡ºäº†è°ƒç”¨registerAllPipelineså‡½æ•°æ¥æ³¨å†Œç®¡é“æ¨¡å—çš„è¿™ä¸€æ­¥ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºenginestateçš„ä»£ç -1">åˆ›å»ºEngineStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºenginestateçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºçš„EngineStateä¿å­˜äº†åˆ›å»ºçš„PipelineManagerStateï¼Œè€ŒPipelineManagerStateä¿å­˜äº†æ‰€æœ‰ç®¡é“çš„æ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ³¨å†Œç®¡é“æ¨¡å—çš„ä»£ç ">æ³¨å†Œç®¡é“æ¨¡å—çš„ä»£ç <a class="hash-link" href="#æ³¨å†Œç®¡é“æ¨¡å—çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">registerAllPipelines</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EngineInPCPipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JiaEngineInMobilePipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            YiEngineInMobilePipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    insertElementName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forward_render_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    insertAction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;after&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>registerAllPipelineså‡½æ•°æ³¨å†Œäº†ç®¡é“æ¨¡å—ï¼Œå®ƒåˆ¤æ–­è¿è¡Œç¯å¢ƒï¼Œæ³¨å†Œå¯¹åº”çš„ç®¡é“æ¨¡å—ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœæ˜¯PCç«¯ï¼Œå°±æ³¨å†ŒEngineInPCPipelineï¼›</li><li>å¦‚æœæ˜¯ç§»åŠ¨ç«¯ï¼Œå°±æ³¨å†ŒJiaEngineInMobilePipelineã€YiEngineInMobilePipeline</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->ç§»åŠ¨ç«¯çš„æ³¨å†Œä¼šåˆå¹¶JiaEngineInMobilePipelineã€YiEngineInMobilePipelineè¿™ä¸¤ä¸ªç®¡é“æ¨¡å—ä¸­åŒåçš„ç®¡é“ï¼Œå…·ä½“å°±æ˜¯å°†å®ƒä»¬çš„Render Pipelineåˆå¹¶ä¸ºä¸€ä¸ªRender Pipeline</p><p>registerAllPipelineså‡½æ•°è°ƒç”¨äº†PipelineManagerçš„registerPipelineå‡½æ•°æ¥æ³¨å†Œç®¡é“æ¨¡å—ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œè¿”å›æ–°çš„PipelineManagerStateã€‚æ¥æ”¶çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºPipelineManagerStateã€ç®¡é“æ¨¡å—çš„æ¨¡å—æ•°æ®ã€JobOrdersï¼Œå…¶ä¸­ï¼ŒJobOrdersç”¨æ¥æŒ‡å®šå¦‚ä½•åˆå¹¶ç®¡é“æ¨¡å—çš„ç®¡é“ï¼Œåé¢å†è®¨è®ºï¼›ç®¡é“æ¨¡å—çš„æ¨¡å—æ•°æ®æ˜¯é€šè¿‡è°ƒç”¨ç®¡é“æ¨¡å—çš„getPipelineå‡½æ•°è·å¾—çš„</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineçš„initå‡½æ•°çš„ä»£ç -1">Engineçš„initå‡½æ•°çš„ä»£ç <a class="hash-link" href="#engineçš„initå‡½æ•°çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–ç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//å°†canvasä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ï¼Œä»è€Œåœ¨Jobä¸­é€šè¿‡å…¨å±€å˜é‡èƒ½å¤Ÿè·å¾—canvas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡ŒInit Pipelineç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initå‡½æ•°å®ç°äº†å¼•æ“çš„åˆå§‹åŒ–</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->initå‡½æ•°å°†ç”¨æˆ·Clientä¼ è¿‡æ¥çš„é…ç½®æ•°æ®ï¼ˆè¿™é‡Œæ˜¯canvasï¼‰ä¿å­˜åˆ°äº†å…¨å±€å˜é‡ä¸­ï¼Œä»è€Œä½¿å¾—Jobèƒ½å¤Ÿé€šè¿‡å…¨å±€å˜é‡è·å¾—è¿™äº›é…ç½®æ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineçš„renderå‡½æ•°çš„ä»£ç -1">Engineçš„renderå‡½æ•°çš„ä»£ç <a class="hash-link" href="#engineçš„renderå‡½æ•°çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡ŒRender Pipelineç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderå‡½æ•°å®ç°äº†å¼•æ“çš„æ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="jiaengineinmobilepipelineçš„ç›¸å…³ä»£ç ">JiaEngineInMobilePipelineçš„ç›¸å…³ä»£ç <a class="hash-link" href="#jiaengineinmobilepipelineçš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>JiaEngineInMobilePipelineStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pipelineName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JiaEngineInMobile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//JiaEngineInMobilePipelineStateçš„ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//stateså®šä¹‰äº†åœ¨JiaEngineInMobilePipelineçš„æ‰€æœ‰çš„Jobä¸­éœ€è¦è°ƒç”¨çš„æ‰€æœ‰çš„PipelineStateçš„ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å› ä¸ºç›®å‰åªéœ€è¦è°ƒç”¨JiaEngineInMobilePipelineStateï¼Œæ‰€ä»¥åªå®šä¹‰äº†å®ƒçš„ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">states</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>JiaEngineInMobilePipelineStateTypeå®šä¹‰äº†JiaEngineInMobilePipelineStateç›¸å…³çš„ç±»å‹</p><p>JiaEngineInMobilePipeline</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//è¿”å›Jobçš„execå‡½æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getExec</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jobName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;init_webgl1_jia_engineInMobile&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> InitWebGL1Job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forward_render_jia_engineInMobile&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ForwardRenderJob</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—ç®¡é“æ¨¡å—çš„æ¨¡å—æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºJiaEngineInMobilePipelineState</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">createState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> engineState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//getExecå…³è”äº†allPipelineDataä¸­çš„typeä¸ºjobçš„elementçš„nameä¸Job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        getExec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> _getExec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//allPipelineDataæ˜¯JSONé…ç½®æ•°æ®ï¼Œç”¨æ¥æŒ‡å®šJobçš„æ‰§è¡Œé¡ºåº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//å®ƒåŒ…æ‹¬æ‰€æœ‰ç®¡é“çš„é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allPipelineData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Init Pipelineç®¡é“é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//ç®¡é“å</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;init&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//groupsåŒ…æ‹¬æ‰€æœ‰çš„groupï¼Œç›®å‰åªæœ‰ä¸€ä¸ªgroup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                groups</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//groupå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//linkæŒ‡å®šäº†è¯¥groupçš„æ‰€æœ‰elementä¹‹é—´çš„é“¾æ¥æ–¹å¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//æœ‰ä¸¤ç§é“¾æ¥æ–¹å¼ï¼šconcatæˆ–è€…merge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//concatæ˜¯æŒ‡æ¯ä¸ªelementä¸²è¡Œæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//mergeæ˜¯æŒ‡æ¯ä¸ªelementå¹¶è¡Œæ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        link</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;concat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//elementçš„ç±»å‹å¯ä»¥ä¸ºjobæˆ–è€…group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">//ç›®å‰åªæœ‰ä¸€ä¸ªç±»å‹ä¸ºjobçš„element</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        elements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;init_webgl1_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string-property property" style="color:#36acaa">&quot;type_&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;job&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//è¿è¡Œè¯¥ç®¡é“æ—¶é¦–å…ˆæ‰§è¡Œçš„groupå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                first_group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_jia_engineInMobile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Render Pipelineç®¡é“é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                groups</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        link</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;concat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        elements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forward_render_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string-property property" style="color:#36acaa">&quot;type_&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;job&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                first_group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_jia_engineInMobile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>JiaEngineInMobilePipelineæœ‰ä¸€ä¸ªInit Pipelineå’Œä¸€ä¸ªRender Pipelineï¼Œå…¶ä¸­Init Pipelineåªæœ‰ä¸€ä¸ªJobï¼šInitWebGL1Jobï¼ŒRender Pipelineåªæœ‰ä¸€ä¸ªJobï¼šForwardRenderJob</p><p>æˆ‘ä»¬çœ‹ä¸‹Jobçš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->InitWebGL1Job</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ä»å…¨å±€å˜é‡ä¸­è·å¾—canvas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> canvas</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> HTMLCanvasElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">canvas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è°ƒç”¨most.jsåº“ï¼Œè¿”å›äº†ä¸€ä¸ªæµ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;åˆå§‹åŒ–WebGL1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å°†glä¿å­˜åˆ°EngineStateçš„JiaEngineInMobilePipelineStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ForwardRenderJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ä»EngineStateä¸­è·å¾—JiaEngineInMobilePipelineStateï¼Œå¹¶è·å¾—å®ƒçš„gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å‰å‘æ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> engineState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è™½ç„¶è¿™ä¸ªJobåªæœ‰åŒæ­¥æ“ä½œï¼Œä½†æ˜¯Jobå…¶å®å¯èƒ½ä¼šè¿›è¡Œå¼‚æ­¥æ“ä½œçš„ï¼ˆå¦‚ä¸GPUçš„æ“ä½œå¯èƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼‰ã€‚å¤„ç†å¼‚æ­¥ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>
<!-- -->1.é€šè¿‡Asyncã€Awaitå…³é”®å­—ï¼Œå°†å¼‚æ­¥è½¬æ¢ä¸ºåŒæ­¥<br>
<!-- -->2.ä½¿ç”¨Promise</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼šåŸºäºFRPï¼ˆå‡½æ•°ååº”å‹ç¼–ç¨‹ï¼‰ï¼Œä½¿ç”¨æµæ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚å…·ä½“æ˜¯è®©æ¯ä¸ªJobéƒ½è¿”å›ä¸€ä¸ªæµï¼Œåœ¨æµçš„å¤„ç†å‡½æ•°ï¼ˆå³callFuncå‡½æ•°ï¼‰ä¸­æ‰§è¡ŒJobçš„é€»è¾‘ã€‚è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯èƒ½å¤Ÿè½»æ˜“å®ç°ä¸²è¡Œæˆ–è€…å¹¶è¡Œçš„Jobï¼ˆå½“JSONé…ç½®æ•°æ®çš„linkå­—æ®µä¸ºconcatæˆ–è€…mergeæ—¶ï¼‰ï¼Œè¿™åªéœ€è¦å°†æ¯ä¸ªJobè¿”å›çš„æµconcatæˆ–è€…mergeå³å¯ã€‚å¦ä¸€ä¸ªå¥½å¤„æ˜¯èƒ½å¤Ÿè½»æ˜“å®ç°åˆå¹¶ç®¡é“ï¼Œå› ä¸ºä¸€ä¸ªç®¡é“å°±æ˜¯ä¸€ä¸ªæµï¼Œåˆå¹¶ç®¡é“å°±æ˜¯åˆå¹¶æµï¼Œå®¹æ˜“å®ç°</p><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†most.jsåº“æ¥å®ç°æµï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„FRPåº“ï¼Œç›¸æ¯”Rxjsåº“æ€§èƒ½è¦æ›´å¥½</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="yiengineinmobilepipelineçš„ç›¸å…³ä»£ç ">YiEngineInMobilePipelineçš„ç›¸å…³ä»£ç <a class="hash-link" href="#yiengineinmobilepipelineçš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>YiEngineInMobilePipelineStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pipelineName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;YiEngineInMobile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">states</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">jiaEngineInMobilePipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> jiaEngineInMobilePipelineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>YiEngineInMobilePipelineStateTypeå®šä¹‰äº†YiEngineInMobilePipelineStateç›¸å…³çš„ç±»å‹ã€‚å› ä¸ºYiEngineInMobilePipelineä¸­çš„Jobéœ€è¦é€šè¿‡è¿™é‡Œçš„statesç±»å‹æ¥è·å¾—YiEngineInMobilePipelineStateå’ŒJiaEngineInMobilePipelineStateçš„ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œçš„stateséœ€è¦å®šä¹‰YiEngineInMobilePipelineStateä»¥åŠJiaEngineInMobilePipelineStateçš„ç±»å‹</p><p>YiEngineInMobilePipeline</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">createState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> engineState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allPipelineData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Render Pipelineç®¡é“é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>YiEngineInMobilePipelineåªæœ‰ä¸€ä¸ªRender Pipelineç®¡é“ï¼Œå®ƒåªæœ‰ä¸€ä¸ªJobï¼šTonemapJob</p><p>Jobçš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->TonemapJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ä»EngineStateä¸­è·å¾—JiaEngineInMobilePipelineStateï¼Œå¹¶è·å¾—å®ƒçš„gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tonemap for WebGL1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> engineState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->è¿™ä¸ªJobéœ€è¦è·å¾—å¦ä¸€ä¸ªç®¡é“æ¨¡å—çš„PipelineStateï¼ˆJiaEngineInMobilePipelineStateï¼‰çš„gl</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç§»åŠ¨ç«¯åˆå¹¶render-pipelineçš„ç›¸å…³ä»£ç ">ç§»åŠ¨ç«¯åˆå¹¶Render Pipelineçš„ç›¸å…³ä»£ç <a class="hash-link" href="#ç§»åŠ¨ç«¯åˆå¹¶render-pipelineçš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ç§»åŠ¨ç«¯æ³¨å†Œçš„ä¸¤ä¸ªç®¡é“æ¨¡å—ä¸­æœ‰åŒåçš„ç®¡é“ï¼šRender Pipelineç®¡é“ï¼Œéœ€è¦åˆå¹¶å®ƒä»¬ã€‚æˆ‘ä»¬å›é¡¾ä¸‹Engineçš„registerAllPipelineså‡½æ•°ä¸­åˆå¹¶è¿™ä¸¤ä¸ªç®¡é“çš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JiaEngineInMobilePipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            YiEngineInMobilePipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    insertElementName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forward_render_jia_engineInMobile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    insertAction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;after&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æˆ‘ä»¬ä¹‹å‰æåˆ°registerPipelineå‡½æ•°æ¥æ”¶çš„ç¬¬ä¸‰ä¸ªå‚æ•°-JobOrdersç”¨æ¥æŒ‡å®šå¦‚ä½•åˆå¹¶ç®¡é“ï¼Œç°åœ¨æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹å®ƒçš„ç±»å‹å®šä¹‰ï¼š<br>
<!-- -->PipelineManager-&gt;RegisterPipelineType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">insertAction</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;before&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;after&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">jobOrder</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//ç®¡é“å</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//å°†è¯¥ç®¡é“çš„æ‰€æœ‰Jobæ’å…¥åˆ°æŸä¸ªelementä¸­ï¼ˆelementå¯ä»¥ä¸ºjobæˆ–è€…groupï¼‰ï¼Œè€Œè¿™é‡Œçš„insertElementNameå°±æ˜¯è¯¥elementçš„åç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  insertElementName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> elementName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//å€¼å¯ä»¥ä¸ºbeforeæˆ–è€…afterï¼Œæ„æ€æ˜¯æ’å…¥åˆ°è¯¥elementä¹‹å‰æˆ–è€…ä¹‹å</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  insertAction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> insertAction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å¯èƒ½è¦åˆå¹¶å¤šç§åŒåç®¡é“ï¼Œæ‰€ä»¥jobOrdersæ˜¯æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”ä¸€ç§åå­—çš„ç®¡é“</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">jobOrders</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">jobOrder</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å› ä¸ºè¿™é‡Œåªéœ€è¦åˆå¹¶ä¸€ç§åŒåç®¡é“ï¼šRender Pipelineï¼Œæ‰€ä»¥jobOrdersåªåŒ…å«ä¸€ä¸ªjobOrder</p><p>Engineçš„registerAllPipelineså‡½æ•°å…·ä½“æ˜¯å°†YiEngineInMobilePipelineçš„Render Pipelineçš„æ‰€æœ‰çš„Jobï¼ˆä¹Ÿå°±æ˜¯TonemapJobï¼‰æ’å…¥åˆ°JiaEngineInMobilePipelineçš„Render Pipelineä¸­åä¸º &quot;forward_render_jia_engineInMobile&quot;çš„Jobï¼ˆä¹Ÿå°±æ˜¯ForwardRenderJobï¼‰ä¹‹åæ‰§è¡Œï¼Œä»è€Œå®ç°äº†åœ¨ç§»åŠ¨ç«¯åªæœ‰ä¸€ä¸ªInit Pipelineå’Œä¸€ä¸ªRender Pipelineç®¡é“ï¼Œå…¶ä¸­å‰è€…æ‰§è¡ŒInitWebGL1Jobï¼Œåè€…ä¾æ¬¡æ‰§è¡ŒForwardRenderJobã€TonemapJobè¿™ä¸¤ä¸ªJob</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->åˆå¹¶åï¼ŒEngineStateä¸­çš„PipelineManagerStateä¸­ä»ç„¶æœ‰è¿™ä¸¤ä¸ªç®¡é“æ¨¡å—çš„PipelineStateï¼ˆå³JiaEngineInMobilePipelineStateã€YiEngineInMobilePipelineStateï¼‰ï¼Œè€Œä¸æ˜¯åªæœ‰JiaEngineInMobilePipelineState</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="engineinpcpipelineçš„ç›¸å…³ä»£ç ">EngineInPCPipelineçš„ç›¸å…³ä»£ç <a class="hash-link" href="#engineinpcpipelineçš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>EngineInPCPipelineStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pipelineName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;EngineInPC&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGL2RenderingContext </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">states</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>EngineInPCPipelineStateTypeå®šä¹‰äº†EngineInPCPipelineStateç›¸å…³çš„ç±»å‹</p><p>EngineInPCPipeline</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">createState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> engineState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allPipelineData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Init Pipelineç®¡é“é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Render Pipelineç®¡é“é…ç½®æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>EngineInPCPipelineæœ‰ä¸€ä¸ªInit Pipelineå’Œä¸€ä¸ªRender Pipelineï¼Œå…¶ä¸­Init Pipelineåªæœ‰ä¸€ä¸ªJobï¼šInitWebGL2Jobï¼ŒRender Pipelineæœ‰ä¸¤ä¸ªJobï¼šDeferRenderJobã€TonemapJob</p><p>æˆ‘ä»¬çœ‹ä¸‹Jobçš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->InitWebGL2Job</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ä»å…¨å±€å˜é‡ä¸­è·å¾—canvas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> canvas</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> HTMLCanvasElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">canvas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è°ƒç”¨most.jsåº“ï¼Œè¿”å›äº†ä¸€ä¸ªæµ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;åˆå§‹åŒ–WebGL2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;webgl2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å°†glä¿å­˜åˆ°EngineStateçš„EngineInPCPipelineStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>DeferRenderJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ä»EngineStateä¸­è·å¾—EngineInPCPipelineStateï¼Œå¹¶è·å¾—å®ƒçš„gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å»¶è¿Ÿæ¸²æŸ“&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> engineState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>TonemapJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ä»EngineStateä¸­è·å¾—EngineInPCPipelineStateï¼Œå¹¶è·å¾—å®ƒçš„gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tonemap for WebGL2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> engineState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç -2">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">is </span><span class="token constant" style="color:#36acaa">PC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–WebGL2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å»¶è¿Ÿæ¸²æŸ“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tonemap </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token maybe-class-name">WebGL2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ‰“å°ç»“æœè·Ÿä¹‹å‰ä¸€æ ·</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®šä¹‰">å®šä¹‰<a class="hash-link" href="#å®šä¹‰" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸€å¥è¯å®šä¹‰">ä¸€å¥è¯å®šä¹‰<a class="hash-link" href="#ä¸€å¥è¯å®šä¹‰" title="Direct link to heading">â€‹</a></h3><p>å°†è¿ç»­çš„ã€æœ‰ä¸€å®šæ‰§è¡Œé¡ºåºçš„é€»è¾‘ç¦»æ•£åŒ–ä¸ºä¸€ä¸ªä¸ªç‹¬ç«‹çš„Jobï¼ŒæŒ‰ç…§é…ç½®æ•°æ®å®šä¹‰çš„é¡ºåºåœ¨ç®¡é“ä¸­ä¾æ¬¡æ‰§è¡Œ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜<a class="hash-link" href="#è¡¥å……è¯´æ˜" title="Direct link to heading">â€‹</a></h3><p>å› ä¸ºè€ƒè™‘åˆ°Jobå¯èƒ½ä¼šè¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”ä¹Ÿå¯èƒ½ä¼šå¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªJobï¼ˆå½“é…ç½®æ•°æ®ä¸­çš„linkå­—æ®µä¸ºmergeæ—¶ï¼‰ï¼Œæ‰€ä»¥åŸºäºFRPï¼ˆå‡½æ•°ååº”å‹ç¼–ç¨‹ï¼‰ï¼Œä½¿ç”¨æµæ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚å…·ä½“å°±æ˜¯è®©æ¯ä¸ªJobè¿”å›ä¸€ä¸ªæµï¼Œå¹¶ä¸”æ•´ä¸ªç®¡é“å°±æ˜¯ä¸€ä¸ªæµ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="é€šç”¨uml">é€šç”¨UML<a class="hash-link" href="#é€šç”¨uml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-8ea1c206e6121859e9f484bd6119cbbd.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€Systemã€ç®¡é“ç®¡ç†ã€ç®¡é“æ¨¡å—å››ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Client<br>è¯¥è§’è‰²æ˜¯ç”¨æˆ·</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Systemè¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>System<br>è¯¥è§’è‰²æ˜¯é—¨æˆ·ï¼Œä¸‹é¢ä»‹ç»å®ƒçš„å‡½æ•°ï¼š<br>Systemçš„createStateå‡½æ•°åˆ›å»ºäº†SystemStateï¼›Systemçš„registerAllPipelineså‡½æ•°æŒ‰ç…§ä¸åŒçš„è¿è¡Œç¯å¢ƒæ³¨å†Œäº†å¯¹åº”çš„ç®¡é“æ¨¡å—ï¼›Systemçš„initå‡½æ•°è¿è¡Œäº†æ³¨å†Œçš„ç®¡é“æ¨¡å—çš„Init Pipelineç®¡é“ï¼Œä¾æ¬¡æ‰§è¡Œå®ƒæ‰€æœ‰çš„Jobï¼Œå®ç°äº†åˆå§‹åŒ–ï¼›Systemå¯èƒ½æœ‰å¤šä¸ªrunPipelineXå‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå‡½æ•°ç”¨æ¥è¿è¡Œæ³¨å†Œçš„ç®¡é“æ¨¡å—çš„å¯¹åº”ç®¡é“ï¼Œå®ç°æŸä¸ªè¿è¡Œæ—¶é€»è¾‘ï¼ˆå¦‚æ¸²æŸ“ï¼‰</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹ç®¡é“ç®¡ç†è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>PipelineManager<br>è¯¥è§’è‰²è´Ÿè´£ç®¡ç†ç®¡é“ï¼Œå®ç°äº†æ³¨å†Œç®¡é“ã€åˆå¹¶ç®¡é“ã€è¿è¡Œç®¡é“çš„å®ç°é€»è¾‘</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹ç®¡é“æ¨¡å—è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>Pipeline<br>
<!-- -->è¯¥è§’è‰²æ˜¯æ³¨å†Œçš„ç®¡é“æ¨¡å—</p></li><li><p>PipelineState<br>
<!-- -->è¯¥è§’è‰²ä¿å­˜äº†ç®¡é“æ¨¡å—ä¸­æ‰€æœ‰ç®¡é“çš„æ•°æ®</p></li><li><p>PipelineStateType<br>
<!-- -->è¯¥è§’è‰²æ˜¯PipelineStateçš„ç±»å‹å®šä¹‰</p></li><li><p>X Pipeline<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€ä¸ªç®¡é“</p></li><li><p>Job<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€æ®µç‹¬ç«‹çš„é€»è¾‘</p></li></ul><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li><p>Systemå¯ä»¥æ³¨å†Œå¤šä¸ªPipelineï¼Œå®ƒä»¬ä¸­åŒåçš„ç®¡é“ä¼šåˆå¹¶</p></li><li><p>ä¸€ä¸ªPipelineæœ‰ä¸€ä¸ªPipelineStateå’Œå¤šä¸ªX Pipeline</p></li><li><p>ä¸€ä¸ªPipelineStateå®ç°äº†å¯¹åº”çš„PipelineStateType</p></li><li><p>ä¸€ä¸ªX Pipelineæœ‰å¤šä¸ªJob</p></li></ul><ul><li><p>æ¯ä¸ªJobéƒ½èƒ½è¯»å†™æ‰€æœ‰çš„PipelineStateï¼Œä½†å®ƒä»¬æ²¡æœ‰ç›´æ¥ä¾èµ–PipelineStateï¼Œè€Œæ˜¯ä¾èµ–å®ƒå®ç°çš„PipelineStateType</p></li><li><p>å¦‚æœä¸€ä¸ªPipeline Aä¸­çš„Jobä¾èµ–äº†å¦ä¸€ä¸ªPipeline Bçš„PipelineStateï¼Œé‚£ä¹ˆPipeline Açš„PipelineStateTypeå°±éœ€è¦åœ¨stateså­—æ®µåŒ…æ‹¬Pipeline Bçš„PipelineStateTypeçš„stateï¼Œè¿™åœ¨é¢†åŸŸæ¨¡å‹ä¸­è¡¨ç°ä¸ºPipelineStateTypeå¯¹è‡ªå·±çš„ä¾èµ–</p></li></ul><p><strong>æ•°æ®è§†å›¾</strong></p><p><img alt="æ•°æ®è§†å›¾" src="/3dProgramPattern/assets/images/data_view-0574de9fef71125370b3b87196568bb0.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œæ•°æ®åˆ†ä¸ºè¿è¡Œæ—¶æ•°æ®å’Œé…ç½®æ•°æ®ï¼Œå…¶ä¸­å„ä¸ªStateæ˜¯è¿è¡Œæ—¶æ•°æ®ï¼Œå„ä¸ªJSONæ˜¯é…ç½®æ•°æ®</p><p>Systemæœ‰è‡ªå·±çš„æ•°æ®-SystemStateï¼Œå®ƒåŒ…æ‹¬äº†æ‰€æœ‰å…¶å®ƒçš„state</p><p>PipelineManageræœ‰è‡ªå·±çš„æ•°æ®-PipeStateManagerStateï¼Œå®ƒåŒ…æ‹¬äº†æ‰€æœ‰ç®¡é“æ¨¡å—çš„PipelineState</p><p>Pipelineæœ‰ä¸€ä¸ªPipelineStateæ•°æ®å’Œä¸€ä¸ªJSONé…ç½®æ•°æ®ï¼Œå…¶ä¸­PipelineStateä¿å­˜äº†ç®¡é“æ¨¡å—ä¸­æ‰€æœ‰ç®¡é“çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒJSONé…ç½®æ•°æ®ç”¨æ¥æŒ‡å®šç®¡é“æ¨¡å—ä¸­æ‰€æœ‰ç®¡é“çš„Jobçš„æ‰§è¡Œé¡ºåº</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è§’è‰²çš„æŠ½è±¡ä»£ç ">è§’è‰²çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#è§’è‰²çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªè§’è‰²çš„æŠ½è±¡ä»£ç ï¼š</p><p>æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹é¢†åŸŸæ¨¡å‹ä¸­ç”¨æˆ·ã€Systemã€ç®¡é“æ¨¡å—è¿™å‡ ä¸ªéƒ¨åˆ†çš„æŠ½è±¡ä»£ç ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Systemçš„æŠ½è±¡ä»£ç <br>
<!-- -->æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹ç®¡é“æ¨¡å—è¿™ä¸ªéƒ¨åˆ†çš„æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>PipelineStateTypeçš„æŠ½è±¡ä»£ç </li><li>Pipelineçš„æŠ½è±¡ä»£ç </li><li>Jobçš„æŠ½è±¡ä»£ç </li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„æŠ½è±¡ä»£ç ">Clientçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#clientçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> systemState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerAllPipelines</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> configForInit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">runPipeline1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipeline1Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è¿è¡Œæ›´å¤šçš„ç®¡é“</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="systemçš„æŠ½è±¡ä»£ç ">Systemçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#systemçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>SystemStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>System</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_isEnvironment1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">registerAllPipelines</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isEnvironment1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Pipeline1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Pipeline2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">éœ€è¦åˆå¹¶Pipeline2å’ŒPipeline1çš„æŸä¸ª</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineç®¡é“</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> æŸä¸ª</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineå</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        insertElementName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> æ’å…¥åˆ°çš„Elementå</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        insertAction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;before&quot;</span><span class="token plain"> or </span><span class="token string" style="color:#e3116c">&quot;after&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    æŒ‡å®šå…¶å®ƒçš„</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineçš„åˆå¹¶</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ³¨å†Œæ›´å¤šçš„Pipeline</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipelineManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ³¨å†Œå…¶å®ƒEnvironmentçš„Pipeline</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–ç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æŠŠé…ç½®ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ï¼Œä»è€Œåœ¨Jobä¸­é€šè¿‡å…¨å±€å˜é‡è·å¾—é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡ŒInit Pipelineç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">runPipeline1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipeline1Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æŠŠé…ç½®ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ï¼Œä»è€Œåœ¨Jobä¸­é€šè¿‡å…¨å±€å˜é‡è·å¾—é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline1Config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pipeline1Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¿è¡ŒæŸä¸ªX Pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_runPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> æŸä¸ª</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineå</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´å¤šçš„runPipelineXå‡½æ•°ï¼Œè¿è¡Œå¯¹åº”çš„</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipeline</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>runPipeline1å‡½æ•°åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå®ƒçš„åå­—å¯èƒ½æ˜¯updateæˆ–è€…renderç­‰åå­—ï¼Œå®ƒé€šè¿‡è¿è¡ŒUpdate Pipelineæˆ–è€…Render Pipelineç­‰æŸä¸ªX Pipelineæ¥å®ç°æ›´æ–°æˆ–è€…æ¸²æŸ“ç­‰é€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="pipelinestatetypeçš„æŠ½è±¡ä»£ç ">PipelineStateTypeçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#pipelinestatetypeçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Pipeline1StateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pipelineName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineå</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// PipelineStateçš„ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//è¯¥Pipelineçš„Jobä½¿ç”¨çš„æ‰€æœ‰PipelineStateçš„ç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">states</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ä¾èµ–çš„å…¶å®ƒPipelineStateçš„åç§°</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ä¾èµ–çš„å…¶å®ƒPipelineStateçš„stateç±»å‹</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªPipelineStateTypeï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªPipelineStateTypeçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="pipelineçš„æŠ½è±¡ä»£ç ">Pipelineçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#pipelineçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Pipeline1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getExec</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jobName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> Job1çš„</span><span class="token constant" style="color:#36acaa">JSON</span><span class="token plain">å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Job1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> æ›´å¤šJobçš„</span><span class="token constant" style="color:#36acaa">JSON</span><span class="token plain">å</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipelineName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">createState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> systemState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> åˆ›å»ºPipelineState</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        getExec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> _getExec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allPipelineData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> æŸä¸ª</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineå</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                groups</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        link</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;concat&quot;</span><span class="token plain"> or </span><span class="token string" style="color:#e3116c">&quot;merge&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        elements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            åŒ…å«çš„groupæˆ–è€…jobçš„é…ç½®æ•°æ®ï¼ˆå°†ä¼šä¾æ¬¡æŒ‰ç…§linkçš„æ–¹å¼æ‰§è¡Œæ¯ä¸ªelementï¼‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    æ›´å¤šçš„group</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                first_group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            æ›´å¤š</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipelineçš„é…ç½®æ•°æ®</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªPipelineï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªPipelineçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="jobçš„æŠ½è±¡ä»£ç ">Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Job1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> getStatesFunc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setStatesFunc </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> states </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">getStatesFunc</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">states</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é€šè¿‡å…¨å±€å˜é‡è·å¾—é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> initConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipeline1Config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline1Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mostService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">callFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> xxx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">è·å¾—ä¾èµ–çš„å…¶å®ƒPipelineStateçš„æ•°æ®</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—è‡ªå·±çš„PipelineState</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">éœ€è¦å†™æ•°æ®åˆ°è‡ªå·±çš„PipelineState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">setStatesFunc</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">systemState</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">,</span><span class="token generic-function generic class-name"> states</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    å†™æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">éœ€è¦å†™æ•°æ®åˆ°å…¶å®ƒçš„PipelineState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">setStatesFunc</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">systemState</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">,</span><span class="token generic-function generic class-name"> states</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">è®¾ç½®ä¾èµ–çš„å…¶å®ƒPipelineState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">Utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">è·å¾—ä¾èµ–çš„å…¶å®ƒPipelineState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    å†™æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> systemState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Utils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Pipeline1StateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">assign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Pipeline1StateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">è·å¾—ä¾èµ–çš„å…¶å®ƒPipelineState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> å…¶å®ƒPipelineStateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ä¾èµ–çš„å…¶å®ƒPipelineStateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">è®¾ç½®ä¾èµ–çš„å…¶å®ƒPipelineState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> å…¶å®ƒPipelineStateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">assign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ä¾èµ–çš„å…¶å®ƒPipelineStateType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipelineName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">è·å¾—ä¾èµ–çš„å…¶å®ƒPipelineStateçš„æ•°æ®</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">è·å¾—ä¾èµ–çš„å…¶å®ƒPipelineState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªJobï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªJobçš„æŠ½è±¡ä»£ç </p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->Jobä¸€èˆ¬éƒ½åªå†™æ•°æ®åˆ°è‡ªå·±çš„PipelineStateï¼Œæœ€å¥½ä¸è¦ä¿®æ”¹å…¶å®ƒçš„PipelineStateï¼Œä»¥å…é€ æˆå†²çª</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°<a class="hash-link" href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" title="Direct link to heading">â€‹</a></h3><p>ç®¡é“æ¨¡å¼ä¸»è¦éµå¾ªä¸‹é¢çš„è®¾è®¡åŸåˆ™ï¼š</p><ul><li>å•ä¸€èŒè´£åŸåˆ™<br>æ¯ä¸ªJobåªåšä¸€ä»¶äº‹æƒ…ï¼›æ¯ä¸ªç®¡é“åªåšä¸€ä»¶äº‹æƒ…ï¼Œå¦‚åˆå§‹åŒ–æˆ–è€…æ¸²æŸ“</li><li>åˆæˆå¤ç”¨åŸåˆ™<br>Pipelineç»„åˆäº†å¤šä¸ªX Pipelineï¼›X Pipelineç»„åˆäº†å¤šä¸ªJob</li><li>ä¾èµ–å€’ç½®åŸåˆ™<br>Jobæ²¡æœ‰ç›´æ¥ä¾èµ–PipelineStateï¼Œè€Œæ˜¯ä¾èµ–æŠ½è±¡çš„PipelineStateType</li><li>æ¥å£éš”ç¦»åŸåˆ™<br>PipelineStateTypeçš„stateså­—æ®µä¸­åªå®šä¹‰éœ€è¦ä½¿ç”¨çš„PipelineStateçš„stateç±»å‹ï¼Œä¿æŒæœ€å°</li><li>æœ€å°‘çŸ¥è¯†åŸåˆ™<br>å„ä¸ªJobç›¸äº’ç‹¬ç«‹ï¼›å„ä¸ªç®¡é“ç›¸äº’ç‹¬ç«‹</li><li>å¼€é—­åŸåˆ™<br>è¦è°ƒæ•´ç®¡é“çš„Jobæ‰§è¡Œé¡ºåºï¼Œåªéœ€è¦è°ƒæ•´é…ç½®æ•°æ®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼›è¦å¢åŠ ä¸€ç§è¿è¡Œç¯å¢ƒï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªç®¡é“æ¨¡å—ï¼Œæ— éœ€ä¿®æ”¹å…¶å®ƒç®¡é“æ¨¡å—</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åº”ç”¨">åº”ç”¨<a class="hash-link" href="#åº”ç”¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¼˜ç‚¹">ä¼˜ç‚¹<a class="hash-link" href="#ä¼˜ç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>ä¸æ‡‚ä»£ç çš„åŒå­¦å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ•°æ®æ¥å®šåˆ¶ç®¡é“</p></li><li><p>å¤šä¸ªå¼€å‘è€…èƒ½å¤ŸåŒæ—¶å¼€å‘ä¸åŒçš„ç®¡é“ï¼Œæˆ–è€…åŒæ—¶å¼€å‘åŒä¸€ä¸ªç®¡é“ä¸­ä¸åŒçš„Jobã€‚å› ä¸ºå®ƒä»¬ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ‰€ä»¥å¤šäººå¼€å‘æ—¶ä¸ä¼šç›¸äº’å½±å“</p></li><li><p>Jobçš„execå‡½æ•°ã€Pipelineçš„getPipelineå‡½æ•°éƒ½å…·æœ‰ç»Ÿä¸€çš„è¾“å…¥å’Œè¾“å‡ºçš„ç±»å‹ï¼Œä»è€Œå¤šäººå¼€å‘Jobå’ŒPipelineæ¨¡å—æ—¶ä¸ä¼šå‡ºç°è¾“å…¥è¾“å‡ºçš„å†²çª</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼ºç‚¹">ç¼ºç‚¹<a class="hash-link" href="#ç¼ºç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li>éœ€è¦è½¬æ¢ä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„æ€ç»´<br>Jobä¸­åŸºäºFRPä½¿ç”¨æµæ¥å¤„ç†å¼‚æ­¥ã€ä¸€ä¸ªJobå…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ã€ç®¡é“ä¾æ¬¡æ‰§è¡Œå„ä¸ªJobã€ä½¿ç”¨stateä¿å­˜æ•°æ®ç­‰è¿™äº›æ€è·¯éƒ½å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ€ç»´æ¨¡å¼</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯<a class="hash-link" href="#ä½¿ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åœºæ™¯æè¿°">åœºæ™¯æè¿°<a class="hash-link" href="#åœºæ™¯æè¿°" title="Direct link to heading">â€‹</a></h4><p>éœ€è¦æŒ‰ä¸²è¡Œæˆ–è€…å¹¶è¡Œçš„é¡ºåºè¿ç»­åœ°æ‰§è¡Œå¤šä¸ªé€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å…·ä½“æ¡ˆä¾‹">å…·ä½“æ¡ˆä¾‹<a class="hash-link" href="#å…·ä½“æ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h4><ul><li><p>ç³»ç»Ÿçš„åˆå§‹åŒ–<br>
<!-- -->åˆå§‹åŒ–æ—¶é€šå¸¸éœ€è¦è¿ç»­åœ°æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œå› æ­¤å¯ä»¥æ³¨å†Œä¸€ä¸ªPipelineï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªInit Pipelineç®¡é“ï¼Œè¯¥ç®¡é“åŒ…æ‹¬åˆå§‹åŒ–ç›¸å…³çš„Job</p></li><li><p>å¼•æ“ä¸»å¾ªç¯ä¸­çš„æ›´æ–°ã€æ¸²æŸ“<br>
<!-- -->æ›´æ–°ã€æ¸²æŸ“æ—¶é€šå¸¸éœ€è¦è¿ç»­åœ°æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œå› æ­¤å¯ä»¥æ³¨å†Œä¸€ä¸ªPipelineï¼Œå®ƒåº”è¯¥åŒ…æ‹¬ä¸€ä¸ªUpdate Pipelineç®¡é“ã€ä¸€ä¸ªRender Pipelineç®¡é“ï¼Œå‰è€…åŒ…æ‹¬æ›´æ–°ç›¸å…³çš„Jobï¼Œåè€…åŒ…æ‹¬æ¸²æŸ“ç›¸å…³çš„Jobã€‚åœ¨æ¯æ¬¡ä¸»å¾ªç¯æ—¶ï¼Œå…ˆè¿è¡ŒUpdate Pipelineï¼Œç„¶ååœ¨è¿”å›çš„Promiseå›è°ƒä¸­è¿è¡ŒRender Pipeline</p></li><li><p>éœ€è¦è¿è¡Œåœ¨å¤šä¸ªè¿è¡Œç¯å¢ƒä¸­<br>
<!-- -->ä¸ºæ¯ä¸ªè¿è¡Œç¯å¢ƒæ³¨å†Œä¸€ä¸ªç®¡é“æ¨¡å—ï¼Œç›¸äº’ä¸å¹²æ‰°</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹<a class="hash-link" href="#æ³¨æ„äº‹é¡¹" title="Direct link to heading">â€‹</a></h3><ul><li>ä¸€èˆ¬æ¥è¯´ï¼ŒJobå¯ä»¥è¯»æ‰€æœ‰çš„PipelineStateï¼Œä½†æœ€å¥½åªå†™è‡ªå·±æ‰€åœ¨ç®¡é“æ¨¡å—çš„PipelineStateï¼Œä»¥å…å†²çª</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ‰©å±•">æ‰©å±•<a class="hash-link" href="#æ‰©å±•" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="é¿å…ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜é…ç½®æ•°æ®æ”¹ä¸ºåœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®">é¿å…ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜é…ç½®æ•°æ®ï¼Œæ”¹ä¸ºåœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®<a class="hash-link" href="#é¿å…ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜é…ç½®æ•°æ®æ”¹ä¸ºåœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬ç°åœ¨æ˜¯åœ¨è¿è¡Œç®¡é“å‰ï¼ŒæŠŠé…ç½®æ•°æ®ä¿å­˜åˆ°å…¨å±€å˜é‡ï¼Œä»è€Œåœ¨è¿è¡Œç®¡é“æ—¶æ‰§è¡Œçš„Jobä¸­ï¼Œé€šè¿‡å…¨å±€å˜é‡è·å¾—é…ç½®æ•°æ®ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->Pipeline1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">runPipeline1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipeline1Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline1Config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pipeline1Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡ŒæŸä¸ª</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Job1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é€šè¿‡å…¨å±€å˜é‡è·å¾—é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipeline1Config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline1Config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å› ä¸ºå…¨å±€å˜é‡æ˜¯å…¨å±€å…±ç”¨çš„ï¼Œå®¹æ˜“ç›¸äº’å½±å“ï¼Œæ‰€ä»¥åº”è¯¥å°†å…¶æ”¹ä¸ºç§æœ‰çš„ï¼Œå…·ä½“å°±æ˜¯åœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®ï¼Œä¿å­˜åœ¨ç®¡é“ä¸­ã€‚ä¿®æ”¹åçš„å‚è€ƒä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->System</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">registerAllPipelines</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_isEnvironment1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipeline1Config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline1Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//æ³¨å†ŒPipeline1æ—¶ä¼ å…¥pipeline1Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipelineManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Pipeline1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pipeline1Config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>åœ¨Pipeline1çš„getPipelineå‡½æ•°è¿”å›çš„createStateå‡½æ•°ä¸­åº”è¯¥å¯ä»¥æ¥æ”¶åˆ°pipeline1Configï¼›ç„¶åå°†å…¶ä¿å­˜åˆ°Pipeline1Stateã€‚è¿™æ ·åœ¨Jobä¸­å¯ä»¥é€šè¿‡Pipeline1Stateè·å¾—pipeline1Configã€‚å‚è€ƒä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->Pipeline1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">createState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipeline1Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                config</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pipeline1Config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Job1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pipeline1State </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">states</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pipeline1State</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å¯ä»¥å¢å¼ºç®¡é“æ¨¡å—çš„jsoné…ç½®æ•°æ®">å¯ä»¥å¢å¼ºç®¡é“æ¨¡å—çš„JSONé…ç½®æ•°æ®<a class="hash-link" href="#å¯ä»¥å¢å¼ºç®¡é“æ¨¡å—çš„jsoné…ç½®æ•°æ®" title="Direct link to heading">â€‹</a></h3><p>ç›®å‰åªæœ‰æŒ‡å®šJobæ‰§è¡Œé¡ºåºçš„é…ç½®æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥å¢åŠ å¯¹Jobè¿›è¡Œä¸€äº›é…ç½®çš„é…ç½®æ•°æ®ï¼Œå¦‚åœ¨Pipelineçš„getPipelineå‡½æ•°è¿”å›çš„æ¨¡å—æ•°æ®ä¸­å¢åŠ allJobDataè¿™ä¸ªJSONé…ç½®æ•°æ®ï¼Œåœ¨å…¶ä¸­å¯¹JobæŒ‡å®šä¸€äº›é…ç½®æ•°æ®ã€‚  </p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¯ä»¥å¯¹è®¾ç½®WebGLçš„clearColorçš„ClearColorJobæŒ‡å®šClearColorçš„å€¼ï¼Œä»¥åŠå¯¹æ¸…ç©ºWebGLçš„ClearJobæŒ‡å®šæ¸…ç©ºå“ªä¸ªBufferã€‚å‚è€ƒä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->Pipeline</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getPipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allJobData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//å¯¹åº”ClearColorJob</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;clear_color&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;flags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">//æŒ‡å®šclearColorå€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;#20B2AA&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//å¯¹åº”ClearJob</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;clear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//æŒ‡å®šæ¸…ç©ºè¿™ä¸‰ä¸ªBuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;flags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;COLOR_BUFFER&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;DEPTH_BUFFER&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;STENCIL_BUFFER&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ClearColorJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//execå‡½æ•°å¢åŠ flagså½¢å‚ï¼Œä¼ å…¥é…ç½®æ•°æ®ä¸­çš„flagsçš„å€¼ã€‚è¿™é‡Œå®ƒçš„å€¼æ˜¯: </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//[&quot;#20B2AA&quot;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> getStatesFunc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setStatesFunc </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flags</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ClearJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//å¢åŠ flagså½¢å‚ï¼Œä¼ å…¥é…ç½®æ•°æ®ä¸­çš„flagsçš„å€¼ã€‚è¿™é‡Œå®ƒçš„å€¼æ˜¯:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// [</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &quot;COLOR_BUFFER&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &quot;DEPTH_BUFFER&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &quot;STENCIL_BUFFER&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> getStatesFunc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setStatesFunc </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flags</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a class="hash-link" href="#æœ€ä½³å®è·µ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼<a class="hash-link" href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœé€»è¾‘ä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„æ‰§è¡Œé¡ºåºï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨ç®¡é“æ¨¡å¼å°†å…¶ç®¡é“åŒ–</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹">ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹<a class="hash-link" href="#ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ”¯æŒå„ç§è¿è¡Œç¯å¢ƒ">æ”¯æŒå„ç§è¿è¡Œç¯å¢ƒ<a class="hash-link" href="#æ”¯æŒå„ç§è¿è¡Œç¯å¢ƒ" title="Direct link to heading">â€‹</a></h4><p>å¼•æ“é€šå¸¸éœ€è¦è¿è¡Œåœ¨å„ç§è¿è¡Œç¯å¢ƒä¸­ï¼Œå¦‚è¿è¡Œåœ¨ç§»åŠ¨ç«¯ã€Nodejsæ¡Œé¢ç«¯ã€æµè§ˆå™¨ç«¯ç­‰è¿è¡Œç¯å¢ƒï¼Œé‚£ä¹ˆå¼•æ“å°±å¯ä»¥ä½¿ç”¨ç®¡é“æ¨¡å¼ï¼Œé’ˆå¯¹æ¯ä¸ªè¿è¡Œç¯å¢ƒæ³¨å†Œä¸€ä¸ªç®¡é“æ¨¡å—ã€‚æ¯ä¸ªç®¡é“æ¨¡å—ç›¸äº’ç‹¬ç«‹äº’ä¸å½±å“ï¼Œå¯ä»¥ç”±ä¸åŒçš„å¼•æ“å¼€å‘è€…åŒæ—¶å¼€å‘ä¸åŒçš„ç®¡é“æ¨¡å—ï¼Œä»¥åŠåŒæ—¶å¼€å‘åŒä¸€ä¸ªç®¡é“çš„ä¸åŒçš„Job</p><p>å¦‚æœè¦åˆ‡æ¢è¿è¡Œç¯å¢ƒï¼Œé‚£ä¹ˆå°±åªæ˜¯åœ¨Systemçš„registerAllPipelineså‡½æ•°ä¸­æ³¨å†Œå¯¹åº”çš„ç®¡é“æ¨¡å—å³å¯</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è‡ªå®šä¹‰ç®¡é“">è‡ªå®šä¹‰ç®¡é“<a class="hash-link" href="#è‡ªå®šä¹‰ç®¡é“" title="Direct link to heading">â€‹</a></h4><p>å¦‚æœå¼•æ“çš„ç”¨æˆ·å¸Œæœ›å¼€å‘è‡ªå®šä¹‰çš„ç®¡é“ï¼Œè€Œä¸æ˜¯åªèƒ½ä½¿ç”¨å¼•æ“æä¾›çš„ç®¡é“ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥å¼€å‘è‡ªå·±çš„Pipelineã€X Pipelineå’Œå¯¹åº”çš„Jobï¼›ç„¶ååœ¨Clientè°ƒç”¨äº†Systemçš„registerAllPipelineså‡½æ•°åï¼Œè°ƒç”¨PipelineManagerçš„registerPipelineå‡½æ•°æ¥æ³¨å†ŒPipelineï¼Œå¹¶åœ¨æ³¨å†Œçš„æ—¶é€šè¿‡æŒ‡å®šregisterPipelineå‡½æ•°çš„JobOrderså‚æ•°æ¥å°†å…¶åˆå¹¶åˆ°ä¸å¼•æ“æ³¨å†Œçš„åŒåç®¡é“ä¸­</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ›´å¤šèµ„æ–™æ¨è">æ›´å¤šèµ„æ–™æ¨è<a class="hash-link" href="#æ›´å¤šèµ„æ–™æ¨è" title="Direct link to heading">â€‹</a></h2><p>most.jsæ˜¯ä¸€ä¸ªå¼€æºçš„FRPåº“ï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæœç´¢â€œcujojs/mostâ€æ¥æ‰¾åˆ°å®ƒçš„Github Repo</p><p>stingrayæ¸¸æˆå¼•æ“ï¼ˆå‰èº«æ˜¯bitsquidï¼‰ä½¿ç”¨äº†ç®¡é“æ¨¡å¼</p><p>Frostbiteçš„FrameGraphå’ŒUnityçš„RenderGraphå¯ä»¥çœ‹æˆæ˜¯å¯¹ç®¡é“æ¨¡å¼çš„æ‰©å±•</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ç®¡é“æ¨¡å¼/ç®¡é“æ¨¡å¼.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/3dProgramPattern/docs/ç§¯æœ¨æ¨¡å¼/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ç¬¬3ç«  ç§¯æœ¨æ¨¡å¼</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/3dProgramPattern/docs/ECSæ¨¡å¼/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ç¬¬5ç«  ECSæ¨¡å¼</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘" class="table-of-contents__link toc-highlight">åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®ç°ä¸¤ä¸ªè¿è¡Œç¯å¢ƒçš„é€»è¾‘</a><ul><li><a href="#éœ€æ±‚" class="table-of-contents__link toc-highlight">éœ€æ±‚</a></li><li><a href="#å®ç°æ€è·¯" class="table-of-contents__link toc-highlight">å®ç°æ€è·¯</a></li><li><a href="#ç»™å‡ºuml" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»™å‡ºä»£ç " class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#æ‹†åˆ†æ¨¡å—" class="table-of-contents__link toc-highlight">æ‹†åˆ†æ¨¡å—</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-1" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -1" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜-1" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#ä½¿ç”¨ç®¡é“æ¨¡å¼æ¥æ”¹è¿›" class="table-of-contents__link toc-highlight">ä½¿ç”¨ç®¡é“æ¨¡å¼æ¥æ”¹è¿›</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-2" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -2" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li></ul></li><li><a href="#å®šä¹‰" class="table-of-contents__link toc-highlight">å®šä¹‰</a><ul><li><a href="#ä¸€å¥è¯å®šä¹‰" class="table-of-contents__link toc-highlight">ä¸€å¥è¯å®šä¹‰</a></li><li><a href="#è¡¥å……è¯´æ˜" class="table-of-contents__link toc-highlight">è¡¥å……è¯´æ˜</a></li><li><a href="#é€šç”¨uml" class="table-of-contents__link toc-highlight">é€šç”¨UML</a></li><li><a href="#è§’è‰²çš„æŠ½è±¡ä»£ç " class="table-of-contents__link toc-highlight">è§’è‰²çš„æŠ½è±¡ä»£ç </a></li><li><a href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" class="table-of-contents__link toc-highlight">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°</a></li></ul></li><li><a href="#åº”ç”¨" class="table-of-contents__link toc-highlight">åº”ç”¨</a><ul><li><a href="#ä¼˜ç‚¹" class="table-of-contents__link toc-highlight">ä¼˜ç‚¹</a></li><li><a href="#ç¼ºç‚¹" class="table-of-contents__link toc-highlight">ç¼ºç‚¹</a></li><li><a href="#ä½¿ç”¨åœºæ™¯" class="table-of-contents__link toc-highlight">ä½¿ç”¨åœºæ™¯</a></li><li><a href="#æ³¨æ„äº‹é¡¹" class="table-of-contents__link toc-highlight">æ³¨æ„äº‹é¡¹</a></li></ul></li><li><a href="#æ‰©å±•" class="table-of-contents__link toc-highlight">æ‰©å±•</a><ul><li><a href="#é¿å…ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜é…ç½®æ•°æ®æ”¹ä¸ºåœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®" class="table-of-contents__link toc-highlight">é¿å…ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜é…ç½®æ•°æ®ï¼Œæ”¹ä¸ºåœ¨æ³¨å†Œç®¡é“æ—¶ä¼ å…¥ç®¡é“çš„é…ç½®æ•°æ®</a></li><li><a href="#å¯ä»¥å¢å¼ºç®¡é“æ¨¡å—çš„jsoné…ç½®æ•°æ®" class="table-of-contents__link toc-highlight">å¯ä»¥å¢å¼ºç®¡é“æ¨¡å—çš„JSONé…ç½®æ•°æ®</a></li></ul></li><li><a href="#æœ€ä½³å®è·µ" class="table-of-contents__link toc-highlight">æœ€ä½³å®è·µ</a><ul><li><a href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" class="table-of-contents__link toc-highlight">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼</a></li><li><a href="#ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹" class="table-of-contents__link toc-highlight">ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹</a></li></ul></li><li><a href="#æ›´å¤šèµ„æ–™æ¨è" class="table-of-contents__link toc-highlight">æ›´å¤šèµ„æ–™æ¨è</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items"><li class="footer__item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=SaSgwsyiccUjc3Mx3Jqliv9HJnHxL-WI&amp;jump_from=webapi&amp;authKey=+EQRAdLQ80spfX++pA3UB4erf6cxC+Mo4jH6bfovhdE7MOvI5WBUljCZ6roGaNZh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä¸ä½œè€…äº¤æµåŠ QQç¾¤<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/dreamforest-yyc" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cnblogs.com/chaogex/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/3dProgramPattern/assets/js/runtime~main.c94d0359.js"></script>
<script src="/3dProgramPattern/assets/js/main.c6dc4a90.js"></script>
</body>
</html>