<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">ç¬¬5ç«  ECSæ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ECSæ¨¡å¼/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ç¬¬5ç«  ECSæ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼"><meta data-react-helmet="true" name="description" content="æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„"><meta data-react-helmet="true" property="og:description" content="æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„"><link data-react-helmet="true" rel="canonical" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ECSæ¨¡å¼/"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ECSæ¨¡å¼/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/ECSæ¨¡å¼/" hreflang="x-default"><link rel="stylesheet" href="/3dProgramPattern/assets/css/styles.e233dcee.css">
<link rel="preload" href="/3dProgramPattern/assets/js/runtime~main.3eacf1e8.js" as="script">
<link rel="preload" href="/3dProgramPattern/assets/js/main.c6dc4a90.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/3dProgramPattern/"><b class="navbar__title">3Dç¼–ç¨‹æ¨¡å¼</b></a><a class="navbar__item navbar__link navbar__link--active" href="/3dProgramPattern/docs/å‰è¨€">å†…å®¹</a><a href="https://github.com/yyc-git/3DProgramPattern" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">å¼€ç¯‡</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å‰è¨€">å‰è¨€</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">ç¬¬ä¸€éƒ¨åˆ† ç¬¬1ç«  å†çœ‹è®¾è®¡åŸåˆ™</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/è®¾è®¡åŸºç¡€/">1.1 è®¾è®¡åŸºç¡€</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å•ä¸€èŒè´£åŸåˆ™/">1.2 å•ä¸€èŒè´£åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/åˆæˆå¤ç”¨åŸåˆ™/">1.3 åˆæˆå¤ç”¨åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æ¥å£éš”ç¦»åŸåˆ™/">1.4 æ¥å£éš”ç¦»åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/ä¾èµ–å€’ç½®åŸåˆ™/">1.5 ä¾èµ–å€’ç½®åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æœ€å°‘çŸ¥è¯†åŸåˆ™/">1.6 æœ€å°‘çŸ¥è¯†åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å¼€é—­åŸåˆ™/">1.7 å¼€é—­åŸåˆ™</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">ç¬¬äºŒéƒ¨åˆ† 7ç§ç¼–ç¨‹æ¨¡å¼</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ä¾èµ–éš”ç¦»æ¨¡å¼/">ç¬¬2ç«  ä¾èµ–éš”ç¦»æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç§¯æœ¨æ¨¡å¼/">ç¬¬3ç«  ç§¯æœ¨æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/">ç¬¬4ç«  ç®¡é“æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/3dProgramPattern/docs/ECSæ¨¡å¼/">ç¬¬5ç«  ECSæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/">ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ç¬¬5ç«  ECSæ¨¡å¼</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„">æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„<a class="hash-link" href="#æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éœ€æ±‚">éœ€æ±‚<a class="hash-link" href="#éœ€æ±‚" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ªæ¸¸æˆï¼Œæ¸¸æˆä¸­æœ‰ä¸¤ç§äººç‰©ï¼šæ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„ï¼Œä»–ä»¬å…·æœ‰ä¸‹é¢çš„è¡Œä¸ºï¼š</p><ul><li>æ™®é€šè‹±é›„åªèƒ½ç§»åŠ¨</li><li>è¶…çº§è‹±é›„ä¸ä»…èƒ½å¤Ÿç§»åŠ¨ï¼Œè¿˜èƒ½é£è¡Œ</li></ul><p>æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥æ¸²æŸ“ï¼š</p><ul><li>ä½¿ç”¨InstanceæŠ€æœ¯æ¥ä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“æ‰€æœ‰çš„æ™®é€šè‹±é›„</li><li>ä¸€ä¸ªä¸€ä¸ªåœ°æ¸²æŸ“æ¯ä¸ªè¶…çº§è‹±é›„</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å®ç°æ€è·¯">å®ç°æ€è·¯<a class="hash-link" href="#å®ç°æ€è·¯" title="Direct link to heading">â€‹</a></h3><p>åº”è¯¥æœ‰ä¸€ä¸ªæ¸¸æˆä¸–ç•Œï¼Œå®ƒç”±å¤šä¸ªæ™®é€šè‹±é›„å’Œå¤šä¸ªè¶…çº§è‹±é›„ç»„æˆ</p><p>ä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªæ™®é€šè‹±é›„ï¼Œä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªè¶…çº§è‹±é›„ã€‚æ¨¡å—åº”è¯¥ç»´æŠ¤è¯¥è‹±é›„çš„æ•°æ®å’Œå®ç°è¯¥è‹±é›„çš„è¡Œä¸º</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-7c2327a067e85b5ec7e61c78967bcd15.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€æ¸¸æˆä¸–ç•Œã€è‹±é›„è¿™ä¸‰ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·ã€æ¸¸æˆä¸–ç•Œè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>Worldæ˜¯æ¸¸æˆä¸–ç•Œï¼Œç”±å¤šä¸ªæ™®é€šè‹±é›„å’Œå¤šä¸ªè¶…çº§è‹±é›„ç»„æˆã€‚Worldè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„è‹±é›„ï¼Œå¹¶ä¸”å®ç°äº†åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘</p><p>æˆ‘ä»¬çœ‹ä¸‹è‹±é›„è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>ä¸€ä¸ªNormalHeroå¯¹åº”ä¸€ä¸ªæ™®é€šè‹±é›„ï¼Œç»´æŠ¤äº†è¯¥è‹±é›„çš„æ•°æ®ï¼Œå®ç°äº†ç§»åŠ¨çš„è¡Œä¸º</p><p>ä¸€ä¸ªSuperHeroå¯¹åº”ä¸€ä¸ªè¶…çº§è‹±é›„ï¼Œ ç»´æŠ¤äº†è¯¥è‹±é›„çš„æ•°æ®ï¼Œå®ç°äº†ç§»åŠ¨ã€é£è¡Œçš„è¡Œä¸º</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç ">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç " title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºWorldStateçš„ä»£ç </li><li>åˆ›å»ºåœºæ™¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºåˆ›å»ºåœºæ™¯æ—¶æ“ä½œäº†æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹å®ƒä»¬çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>æ™®é€šè‹±é›„ç§»åŠ¨çš„ä»£ç </li><li>è¶…çº§è‹±é›„ç§»åŠ¨å’Œé£è¡Œçš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰©ä½™çš„ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–çš„ä»£ç </li><li>ä¸»å¾ªç¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»å¾ªç¯çš„ä¸€å¸§ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç </li><li>ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç ">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderOneByOne</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderInstances</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clienté¦–å…ˆåˆ›å»ºäº†WorldStateï¼Œç”¨æ¥ä¿å­˜æ¸¸æˆä¸–ç•Œä¸­æ‰€æœ‰çš„æ•°æ®ï¼›ç„¶ååˆ›å»ºäº†åœºæ™¯ï¼›ç„¶åè¿›è¡Œäº†åˆå§‹åŒ–ï¼›æœ€åå¼€å§‹äº†ä¸»å¾ªç¯</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºworldstateçš„ä»£ç ">åˆ›å»ºWorldStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºworldstateçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        normalHeroes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        superHeroes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†WorldStateï¼Œå®ƒåŒ…æ‹¬ä¸¤ä¸ªåˆ†åˆ«ç”¨æ¥ä¿å­˜æ‰€æœ‰çš„æ™®é€šè‹±é›„å’Œæ‰€æœ‰çš„è¶…çº§è‹±é›„çš„å®¹å™¨</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºåœºæ™¯çš„ä»£ç ">åˆ›å»ºåœºæ™¯çš„ä»£ç <a class="hash-link" href="#åˆ›å»ºåœºæ™¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _createScene </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥normalHero1åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normalHeroes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥normalHero2åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normalHeroes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    normalHero1ç§»åŠ¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥superHero1åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">superHeroes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥superHero2åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">superHeroes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1ç§»åŠ¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1é£è¡Œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_createSceneå‡½æ•°åˆ›å»ºäº†åœºæ™¯ï¼Œåˆ›å»ºå’ŒåŠ å…¥äº†ä¸¤ä¸ªæ™®é€šè‹±é›„å’Œä¸¤ä¸ªè¶…çº§è‹±é›„åˆ°æ¸¸æˆä¸–ç•Œä¸­ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªæ™®é€šè‹±é›„è¿›è¡Œäº†ç§»åŠ¨ï¼Œç¬¬ä¸€ä¸ªè¶…çº§è‹±é›„è¿›è¡Œäº†ç§»åŠ¨å’Œé£è¡Œ</p><p>NormalHero</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªæ™®é€šè‹±é›„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">normalHeroState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> normalHero</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionè®¾ç½®ä¸º</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        velocityè®¾ç½®ä¸º</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼špositionä¸ºä½ç½®ï¼Œvelocityä¸ºé€Ÿåº¦</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥è‹±é›„</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>NormalHeroçš„createå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ™®é€šè‹±é›„ï¼Œåˆå§‹åŒ–äº†å®ƒçš„æ•°æ®</p><p>SuperHero</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªè¶…çº§è‹±é›„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">superHeroState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> superHero</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionè®¾ç½®ä¸º</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        velocityè®¾ç½®ä¸º</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxVelocityè®¾ç½®ä¸º</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼špositionä¸ºä½ç½®ï¼Œvelocityä¸ºé€Ÿåº¦ï¼ŒmaxVelocityä¸ºæœ€å¤§é€Ÿåº¦</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥è‹±é›„</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SuperHeroçš„createå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªè¶…çº§è‹±é›„ï¼Œåˆå§‹åŒ–äº†å®ƒçš„æ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ™®é€šè‹±é›„ç§»åŠ¨çš„ä»£ç ">æ™®é€šè‹±é›„ç§»åŠ¨çš„ä»£ç <a class="hash-link" href="#æ™®é€šè‹±é›„ç§»åŠ¨çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>NormalHero</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªæ™®é€šè‹±é›„çš„ç§»åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> move </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> normalHero</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> normalHero</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateä¸­è·å¾—è¯¥è‹±é›„çš„positionå’Œvelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ ¹æ®velocityï¼Œæ›´æ–°position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°worldStateä¸­è¯¥è‹±é›„çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>moveå‡½æ•°å®ç°äº†ç§»åŠ¨çš„è¡Œä¸ºé€»è¾‘ï¼Œæ›´æ–°äº†ä½ç½®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¶…çº§è‹±é›„ç§»åŠ¨å’Œé£è¡Œçš„ä»£ç ">è¶…çº§è‹±é›„ç§»åŠ¨å’Œé£è¡Œçš„ä»£ç <a class="hash-link" href="#è¶…çº§è‹±é›„ç§»åŠ¨å’Œé£è¡Œçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>SuperHero</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªè¶…çº§è‹±é›„çš„ç§»åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> move </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> superHero</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> superHero</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateä¸­è·å¾—è¯¥è‹±é›„çš„positionå’Œvelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ ¹æ®velocityï¼Œæ›´æ–°position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°worldStateä¸­è¯¥è‹±é›„çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªè¶…çº§è‹±é›„çš„é£è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fly </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> superHero</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> superHero</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateä¸­è·å¾—è¯¥è‹±é›„çš„positionå’Œvelocityã€maxVelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ ¹æ®maxVelocityã€velocityï¼Œæ›´æ–°position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°worldStateä¸­è¯¥è‹±é›„çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SuperHeroçš„moveå‡½æ•°çš„é€»è¾‘è·ŸNormalHeroçš„moveå‡½æ•°çš„é€»è¾‘æ˜¯ä¸€æ ·çš„</p><p>flyå‡½æ•°å®ç°äº†é£è¡Œçš„è¡Œä¸ºé€»è¾‘ã€‚å®ƒè·Ÿmoveå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯æ›´æ–°è‹±é›„çš„positionã€‚åªæ˜¯å› ä¸ºä¸¤è€…åœ¨è®¡ç®—æ—¶ä½¿ç”¨çš„é€Ÿåº¦çš„ç®—æ³•ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ›´æ–°positionçš„å¹…åº¦ä¸åŒ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–çš„ä»£ç ">åˆå§‹åŒ–çš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>WorldUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;åˆå§‹åŒ–...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initå‡½æ•°å®ç°äº†åˆå§‹åŒ–ã€‚è¿™é‡Œæ²¡æœ‰ä»»ä½•é€»è¾‘ï¼Œåªæ˜¯è¿›è¡Œäº†æ‰“å°</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯çš„ä»£ç ">ä¸»å¾ªç¯çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>WorldUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">loop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> renderOneByOne</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> renderInstances</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">renderOneByOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">renderInstances</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> renderOneByOne</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> renderInstances</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>loopå‡½æ•°å®ç°äº†ä¸»å¾ªç¯ã€‚åœ¨ä¸»å¾ªç¯çš„ä¸€å¸§ä¸­ï¼Œé¦–å…ˆè¿›è¡Œäº†æ›´æ–°ï¼›ç„¶åä¸€ä¸ªä¸€ä¸ªåœ°æ¸²æŸ“äº†æ‰€æœ‰çš„è¶…çº§è‹±é›„ï¼›ç„¶åä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“äº†æ‰€æœ‰çš„æ™®é€šè‹±é›„ï¼›æœ€åæ‰§è¡Œä¸‹ä¸€å¸§</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç ">ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    éå†worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normalHeroesï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ›´æ–°æ¯ä¸ªnormalHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    éå†worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">superHeroesï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ›´æ–°æ¯ä¸ªsuperHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>updateå‡½æ•°å®ç°äº†æ›´æ–°ï¼Œå®ƒä¼šéå†æ‰€æœ‰çš„normalHeroå’ŒsuperHeroï¼Œè°ƒç”¨å®ƒä»¬çš„updateå‡½æ•°æ¥æ›´æ–°è‡ªå·±</p><p>æˆ‘ä»¬çœ‹ä¸‹NormalHeroçš„updateå‡½æ•°çš„ä»£ç ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ›´æ–°ä¸€ä¸ªæ™®é€šè‹±é›„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">normalHeroState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> normalHeroState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> normalHeroState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°è¯¥è‹±é›„çš„position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒæ›´æ–°äº†è‡ªå·±çš„position</p><p>æˆ‘ä»¬çœ‹ä¸‹SuperHeroçš„updateå‡½æ•°çš„ä»£ç ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ›´æ–°ä¸€ä¸ªè¶…çº§è‹±é›„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">superHeroState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> superHeroState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> superHeroState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°è¯¥è‹±é›„çš„position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒçš„é€»è¾‘è·ŸNormalHeroçš„updateæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯å› ä¸ºä¸¤è€…éƒ½ä½¿ç”¨åŒæ ·çš„ç®—æ³•æ¥æ›´æ–°è‡ªå·±çš„position</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç ">ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderOneByOne </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">superHeroes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">superHeroState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OneByOneæ¸²æŸ“ SuperHero...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderInstances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> normalHeroStates </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normalHeroes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ‰¹é‡Instanceæ¸²æŸ“ NormalHeroes...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderOneByOneå‡½æ•°å®ç°äº†è¶…çº§è‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒéå†æ¯ä¸ªè¶…çº§è‹±é›„ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°æ¸²æŸ“<br>
<!-- -->renderInstanceså‡½æ•°å®ç°äº†æ™®é€šè‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒä¸€æ¬¡æ€§è·å¾—æ‰€æœ‰çš„æ™®é€šè‹±é›„ï¼Œæ‰¹é‡æ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç ">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°NormalHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°NormalHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°SuperHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°SuperHero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ‰¹é‡Instanceæ¸²æŸ“ </span><span class="token maybe-class-name">NormalHeroes</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;normalHeroes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;144891&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;648575&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;superHeroes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;497069&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;maxFlyVelocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;783438&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;maxFlyVelocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡æ‰“å°çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ­¥éª¤å¦‚ä¸‹ï¼š<br>
<!-- -->1.è¿›è¡Œäº†åˆå§‹åŒ–<br>
<!-- -->2.æ›´æ–°äº†æ‰€æœ‰çš„äººç‰©ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªæ™®é€šè‹±é›„å’Œä¸¤ä¸ªè¶…çº§è‹±é›„<br>
<!-- -->3.æ¸²æŸ“äº†2ä¸ªè¶…çº§è‹±é›„<br>
<!-- -->4.ä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“äº†æ‰€æœ‰çš„æ™®é€šè‹±é›„<br>
<!-- -->5.æ‰“å°äº†WorldState</p><p>æˆ‘ä»¬çœ‹ä¸‹æ‰“å°çš„WorldStateï¼š</p><ul><li>WorldStateçš„normalHeroesä¸­ä¸€å…±æœ‰ä¸¤ä¸ªæ™®é€šè‹±é›„çš„æ•°æ®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ™®é€šè‹±é›„æ•°æ®çš„positionä¸º<!-- -->[2,2,2]<!-- -->è€Œä¸æ˜¯åˆå§‹çš„<!-- -->[0,0,0]<!-- -->ï¼Œè¯´æ˜è¯¥æ™®é€šè‹±é›„è¿›è¡Œäº†ç§»åŠ¨æ“ä½œï¼›</li><li>WorldStateçš„superHeroesä¸­ä¸€å…±æœ‰ä¸¤ä¸ªè¶…çº§è‹±é›„çš„æ•°æ®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªè¶…çº§è‹±é›„æ•°æ®çš„positionä¸º<!-- -->[6,6,6]<!-- -->ï¼Œè¯´æ˜è¯¥è¶…çº§è‹±é›„è¿›è¡Œäº†ç§»åŠ¨å’Œé£è¡Œæ“ä½œ</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->å› ä¸ºWorldStateçš„normalHeroeså’ŒsuperHeroesä¸­çš„Keyæ˜¯éšæœºç”Ÿæˆçš„idå€¼ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰“å°æ—¶Keyéƒ½ä¸ä¸€æ ·</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li><p>NormalHeroå’ŒSuperHeroä¸­çš„updateã€moveå‡½æ•°çš„é€»è¾‘æ˜¯é‡å¤çš„</p></li><li><p>å¦‚æœè‹±é›„å¢åŠ æ›´å¤šçš„è¡Œä¸ºï¼ŒNormalHeroå’ŒSuperHeroæ¨¡å—ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œä¸å®¹æ˜“ç»´æŠ¤</p></li></ul><p>è™½ç„¶è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥è§£å†³ï¼Œå³æœ€ä¸Šé¢æ˜¯HeroåŸºç±»ï¼Œç„¶åä¸åŒç§ç±»çš„Heroå±‚å±‚ç»§æ‰¿ï¼Œä½†æ˜¯ç»§æ‰¿çš„æ–¹å¼å¾ˆæ­»æ¿ï¼Œä¸å¤Ÿçµæ´»</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³æ”¹è¿›">åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³æ”¹è¿›<a class="hash-link" href="#åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ul><li><p>åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³ï¼Œç”¨ç»„åˆä»£æ›¿ç»§æ‰¿ã€‚å…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼š</p><ul><li>å°†äººç‰©æŠ½è±¡ä¸ºGameObjectï¼›</li><li>å°†äººç‰©çš„è¡Œä¸ºæŠ½è±¡ä¸ºç»„ä»¶ï¼Œå¹¶æŠŠäººç‰©çš„ç›¸å…³æ•°æ®ä¹Ÿç§»åˆ°ç»„ä»¶ä¸­ï¼›</li><li>GameObjecté€šè¿‡æŒ‚è½½ä¸åŒçš„ç»„ä»¶ï¼Œæ¥å®ç°ä¸åŒçš„è¡Œä¸º</li></ul></li></ul><p>è¿™æ ·å°±é€šè¿‡GameObjectç»„åˆä¸åŒçš„ç»„ä»¶æ¥ä»£æ›¿äººç‰©å±‚å±‚ç»§æ‰¿ï¼Œä»è€Œæ›´åŠ çµæ´»</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-1">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-1" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-8b12c06b2aac8e029277d45875163cf1.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€æ¸¸æˆä¸–ç•Œã€GameObjectã€ç»„ä»¶è¿™å››ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·ã€æ¸¸æˆä¸–ç•Œè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>Worldæ˜¯æ¸¸æˆä¸–ç•Œï¼Œç”±å¤šä¸ªGameObjectç»„æˆã€‚Worldè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„GameObjectï¼Œå¹¶ä¸”å®ç°äº†åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘</p><p>æˆ‘ä»¬çœ‹ä¸‹GameObjectè¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>ä¸€ä¸ªGameObjectå¯¹åº”ä¸€ä¸ªäººç‰©ã€‚GameObjectè´Ÿè´£ç®¡ç†æŒ‚è½½çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥æŒ‚è½½PositionComponentã€VelocityComponentã€FlyComponentã€InstanceComponentè¿™å››ç§ç»„ä»¶ï¼Œæ¯ç§ç»„ä»¶æœ€å¤šæŒ‚è½½ä¸€ä¸ª</p><p>æˆ‘ä»¬çœ‹ä¸‹ç»„ä»¶è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>ç»„ä»¶è´Ÿè´£ç»´æŠ¤è‡ªå·±çš„æ•°æ®ï¼Œå®ç°è‡ªå·±çš„è¡Œä¸ºé€»è¾‘ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯å°†NormalHeroã€SuperHeroçš„positionæ•°æ®å’Œmoveå‡½æ•°ã€updateå‡½æ•°ç§»åˆ°äº†PositionComponentä¸­ï¼›å°†NormalHeroã€SuperHeroçš„velocityæ•°æ®ç§»åˆ°äº†VelocityComponentä¸­ï¼›å°†SuperHeroçš„maxVelocityæ•°æ®å’Œflyå‡½æ•°ç§»åˆ°äº†FlyComponentä¸­</p><p>InstanceComponentæ²¡æœ‰æ•°æ®å’Œé€»è¾‘ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œç”¨æ¥è¡¨ç¤ºæŒ‚è½½è¯¥ç»„ä»¶çš„GameObjectä½¿ç”¨ä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“çš„ç®—æ³•æ¥æ¸²æŸ“</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li>ç°åœ¨åªéœ€è¦å®ç°ä¸€æ¬¡Positionç»„ä»¶ä¸­çš„updateã€moveå‡½æ•°ï¼Œç„¶åå°†å®ƒæŒ‚è½½åˆ°ä¸åŒçš„GameObjectä¸­ï¼Œå°±å¯ä»¥å®ç°æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„çš„æ›´æ–°ã€ç§»åŠ¨çš„é€»è¾‘ï¼Œä»è€Œæ¶ˆé™¤äº†ä¹‹å‰åœ¨NormalHeroã€SuperHeroä¸­å› å…±å®ç°äº†ä¸¤æ¬¡çš„updateã€moveå‡½æ•°è€Œé€ æˆçš„é‡å¤ä»£ç </li></ul><ul><li>å› ä¸ºNormalHeroã€SuperHeroéƒ½æ˜¯GameObjectï¼Œè€ŒGameObjectæœ¬èº«åªè´Ÿè´£ç®¡ç†ç»„ä»¶ï¼Œæ²¡æœ‰è¡Œä¸ºé€»è¾‘ï¼Œæ‰€ä»¥éšç€äººç‰©çš„è¡Œä¸ºçš„å¢åŠ ï¼ŒGameObjectå¹¶ä¸ä¼šå¢åŠ é€»è¾‘ï¼Œè€Œåªéœ€è¦å¢åŠ å¯¹åº”è¡Œä¸ºçš„ç»„ä»¶ï¼Œè®©GameObjectæŒ‚è½½è¯¥ç»„ä»¶å³å¯<br>é€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œå°†è¡Œä¸ºçš„é€»è¾‘å’Œæ•°æ®ä»äººç‰©ç§»åˆ°äº†ç»„ä»¶ä¸­ï¼Œä»è€Œå¯ä»¥é€šè¿‡ç»„åˆçš„æ–¹å¼ä½¿äººç‰©å…·æœ‰å¤šä¸ªè¡Œä¸ºï¼Œé¿å…äº†åºå¤§çš„äººç‰©æ¨¡å—çš„å‡ºç°</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -1">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -1" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºWorldStateçš„ä»£ç </li><li>åˆ›å»ºåœºæ™¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºåˆ›å»ºåœºæ™¯æ—¶æ“ä½œäº†æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹å®ƒä»¬çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ç§»åŠ¨çš„ç›¸å…³ä»£ç </li><li>é£è¡Œçš„ç›¸å…³ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰©ä½™çš„ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»å¾ªç¯çš„ä¸€å¸§ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç </li><li>ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç -1">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Clientçš„ä»£ç è·Ÿä¹‹å‰çš„Clientçš„ä»£ç åŸºæœ¬ä¸Šä¸€æ ·ï¼Œæ•…çœç•¥ã€‚ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯_createSceneå‡½æ•°ä¸­åˆ›å»ºåœºæ™¯çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œè¿™ä¸ªç­‰ä¼šå†è®¨è®º</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºworldstateçš„ä»£ç -1">åˆ›å»ºWorldStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºworldstateçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjects</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†WorldStateï¼Œå®ƒä¿å­˜äº†ä¸€ä¸ªç”¨æ¥ä¿å­˜æ‰€æœ‰çš„gameObjectçš„å®¹å™¨</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºåœºæ™¯çš„ä»£ç -1">åˆ›å»ºåœºæ™¯çš„ä»£ç <a class="hash-link" href="#åˆ›å»ºåœºæ™¯çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _createScene </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥normalHero1åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectsï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºgameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºpositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºvelocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºinstanceComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æŒ‚è½½positionComponentã€velocityComponentã€instanceComponentåˆ°gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åŠ å…¥gameObjectåˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥normalHero2åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    normalHero1ç§»åŠ¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨normalHero1æŒ‚è½½çš„positionComponentçš„moveå‡½æ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥superHero1åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectsï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºgameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºpositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºvelocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºflyComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æŒ‚è½½positionComponentã€velocityComponentã€flyComponentåˆ°gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åŠ å…¥gameObjectåˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå’ŒåŠ å…¥superHero2åˆ°worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1ç§»åŠ¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨superHero1æŒ‚è½½çš„positionComponentçš„moveå‡½æ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1é£è¡Œï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨superHero1æŒ‚è½½çš„flyComponentçš„flyå‡½æ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_createSceneå‡½æ•°åˆ›å»ºäº†åœºæ™¯ï¼Œåœºæ™¯çš„å†…å®¹è·Ÿä¹‹å‰ä¸€æ ·ï¼Œéƒ½åŒ…æ‹¬äº†2ä¸ªæ™®é€šè‹±é›„å’Œ2ä¸ªè¶…çº§è‹±é›„ï¼Œåªæ˜¯ç°åœ¨åˆ›å»ºä¸€ä¸ªè‹±é›„çš„æ–¹å¼æ”¹å˜äº†ï¼Œå…·ä½“å˜ä¸ºï¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªGameObjectå’Œç›¸å…³çš„ç»„ä»¶ï¼›ç„¶åæŒ‚è½½ç»„ä»¶åˆ°GameObjectï¼›æœ€ååŠ å…¥è¯¥GameObjectåˆ°Worldä¸­</p><p>æ™®é€šè‹±é›„å¯¹åº”çš„GameObjectæŒ‚è½½çš„ç»„ä»¶è·Ÿè¶…çº§è‹±é›„å¯¹åº”çš„GameObjectæŒ‚è½½çš„ç»„ä»¶ä¹Ÿä¸ä¸€æ ·ï¼Œå…¶ä¸­å‰è€…æŒ‚è½½äº†InstanceComponentï¼ˆå› ä¸ºæ™®é€šè‹±é›„éœ€è¦ä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“ï¼‰ï¼Œåè€…åˆ™æŒ‚è½½äº†FlyComponentï¼ˆå› ä¸ºè¶…çº§è‹±é›„å¤šå‡ºäº†é£è¡Œçš„è¡Œä¸ºï¼‰</p><p>å¦å¤–ï¼Œç°åœ¨æ”¹ä¸ºé€šè¿‡è°ƒç”¨å¯¹åº”ç»„ä»¶çš„å‡½æ•°è€Œä¸æ˜¯ç›´æ¥æ“ä½œè‹±é›„æ¨¡å—ï¼Œä»è€Œå®ç°è‹±é›„çš„â€œç§»åŠ¨â€ã€â€œé£è¡Œâ€</p><p>GameObject</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªgameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ²¡æœ‰æŒ‚è½½ä»»ä½•çš„ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GameObjectçš„createå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªgameObjectï¼Œåˆå§‹åŒ–äº†å®ƒçš„æ•°æ®</p><p>PositionComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªpositionComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectè®¾ç½®ä¸º</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionè®¾ç½®ä¸º</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼špositionä¸ºä½ç½®ï¼ŒgameObjectä¸ºæŒ‚è½½åˆ°çš„gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>PositionComponentçš„createå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªpositionComponentï¼Œåˆå§‹åŒ–äº†å®ƒçš„æ•°æ®</p><p>VelocityComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªvelocityComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> velocityComponentState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectè®¾ç½®ä¸º</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        velocityè®¾ç½®ä¸º</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼švelocityä¸ºé€Ÿåº¦ï¼ŒgameObjectä¸ºæŒ‚è½½åˆ°çš„gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>FlyComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªflyComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> flyComponentState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectè®¾ç½®ä¸º</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxVelocityè®¾ç½®ä¸º</span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼šmaxVelocityä¸ºæœ€å¤§é€Ÿåº¦ï¼ŒgameObjectä¸ºæŒ‚è½½åˆ°çš„gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InstanceComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªinstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> create </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> instanceComponentState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„stateæ•°æ®ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectè®¾ç½®ä¸º</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å…¶ä¸­ï¼šgameObjectä¸ºæŒ‚è½½åˆ°çš„gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›è¯¥ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™ä¸‰ç§ç»„ä»¶çš„createå‡½æ•°çš„èŒè´£è·ŸPositionComponentçš„createå‡½æ•°çš„èŒè´£ä¸€æ ·ï¼Œä¸ä¸€æ ·çš„æ˜¯InstanceComponentçš„stateæ•°æ®ä¸­åªæœ‰æŒ‚è½½åˆ°çš„gameObjectï¼Œæ²¡æœ‰è‡ªå·±çš„æ•°æ®</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»„ä»¶çš„stateæ•°æ®ä¸­éƒ½ä¿å­˜äº†æŒ‚è½½åˆ°çš„gameObjectï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å¯ä»¥é€šè¿‡å®ƒæ¥è·å¾—æŒ‚è½½åˆ°å®ƒä¸Šçš„å…¶å®ƒç»„ä»¶ï¼Œä»è€Œä¸€ä¸ªç»„ä»¶å¯ä»¥æ“ä½œå…¶å®ƒæŒ‚è½½çš„ç»„ä»¶</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç§»åŠ¨çš„ç›¸å…³ä»£ç ">ç§»åŠ¨çš„ç›¸å…³ä»£ç <a class="hash-link" href="#ç§»åŠ¨çš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>PositionComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—ä¸€ä¸ªç»„ä»¶çš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> positionComponentState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//è®¾ç½®ä¸€ä¸ªç»„ä»¶çš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">positionComponentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        position</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªgameObjectçš„ç§»åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> move </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—è¯¥ç»„ä»¶çš„positionã€gameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é€šè¿‡è¯¥ç»„ä»¶çš„gameObjectï¼Œè·å¾—æŒ‚è½½åˆ°è¯¥gameObjectçš„velocityComponentç»„ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—å®ƒçš„velocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gameObject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> VelocityComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocityComponentExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getGameObjectStateExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æ ¹æ®velocityï¼Œæ›´æ–°è¯¥ç»„ä»¶çš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    positionComponentState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°worldStateä¸­è¯¥ç»„ä»¶æŒ‚è½½çš„gameObjectä¸­çš„è¯¥ç»„ä»¶çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>VelocityComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—ä¸€ä¸ªç»„ä»¶çš„velocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getVelocity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">velocityComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> velocityComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> velocityComponentState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">velocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>PositionComponentç»´æŠ¤äº†positionæ•°æ®ï¼Œæä¾›äº†å®ƒçš„getã€setå‡½æ•°ã€‚VelocityComponentç»´æŠ¤äº†velocityæ•°æ®ï¼Œï¼Œæä¾›äº†å®ƒçš„getå‡½æ•°</p><p>å¦å¤–ï¼ŒPositionComponentçš„moveå‡½æ•°å®ç°äº†ç§»åŠ¨çš„è¡Œä¸ºé€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="é£è¡Œçš„ç›¸å…³ä»£ç ">é£è¡Œçš„ç›¸å…³ä»£ç <a class="hash-link" href="#é£è¡Œçš„ç›¸å…³ä»£ç " title="Direct link to heading">â€‹</a></h4><p>FlyComponent</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—ä¸€ä¸ªç»„ä»¶çš„maxVelocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getMaxVelocity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flyComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> flyComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> flyComponentState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxVelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//è®¾ç½®ä¸€ä¸ªç»„ä»¶çš„maxVelocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setMaxVelocity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flyComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> flyComponentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxVelocity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">flyComponentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxVelocity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> maxVelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªgameObjectçš„é£è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fly </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flyComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> flyComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—è¯¥ç»„ä»¶çš„maxVelocityã€gameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> maxVelocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getMaxVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flyComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gameObject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flyComponentState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é€šè¿‡è¯¥ç»„ä»¶çš„gameObjectï¼Œè·å¾—æŒ‚è½½åˆ°è¯¥gameObjectçš„positionComponentç»„ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—å®ƒçš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionComponentExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getGameObjectStateExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é€šè¿‡è¯¥ç»„ä»¶çš„gameObjectï¼Œè·å¾—æŒ‚è½½åˆ°è¯¥gameObjectçš„velocityComponentç»„ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è·å¾—å®ƒçš„velocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> VelocityComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocityComponentExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getGameObjectStateExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æ ¹æ®maxVelocityã€velocityï¼Œæ›´æ–°positionComponentç»„ä»¶çš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxVelocity </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">velocity </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> maxVelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> positionComponentState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionComponentExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getGameObjectStateExn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°worldStateä¸­è¯¥ç»„ä»¶æŒ‚è½½çš„gameObjectä¸­çš„è¯¥ç»„ä»¶çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>FlyComponentç»´æŠ¤äº†maxVelocityæ•°æ®ï¼Œï¼Œæä¾›äº†å®ƒçš„getã€setå‡½æ•°ã€‚å¦å¤–ï¼ŒFlyComponentçš„flyå‡½æ•°å®ç°äº†é£è¡Œçš„è¡Œä¸ºé€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç ">åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæ•…çœç•¥ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç -1">ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    éå†worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectsï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectæŒ‚è½½äº†positionComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            æ›´æ–°positionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>updateå‡½æ•°å®ç°äº†æ›´æ–°ï¼Œå®ƒä¼šéå†æ‰€æœ‰çš„gameObjectï¼Œè°ƒç”¨å®ƒæŒ‚è½½çš„PositionComponentç»„ä»¶çš„updateå‡½æ•°æ¥æ›´æ–°è¯¥ç»„ä»¶ã€‚æˆ‘ä»¬çœ‹ä¸‹PositionComponentçš„updateå‡½æ•°çš„ä»£ç ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ›´æ–°ä¸€ä¸ªç»„ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°è¯¥ç»„ä»¶çš„position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒçš„é€»è¾‘è·Ÿä¹‹å‰çš„NormalHeroå’ŒSuperHeroä¸­çš„updateå‡½æ•°çš„é€»è¾‘æ˜¯ä¸€æ ·çš„</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç -1">ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderOneByOne </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> superHeroGameObjects </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ¤æ–­gameObjectæ˜¯ä¸æ˜¯æ²¡æœ‰æŒ‚è½½InstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasInstanceComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHeroGameObjects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OneByOneæ¸²æŸ“ SuperHero...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderInstances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> normalHeroGameObejcts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ¤æ–­gameObjectæ˜¯ä¸æ˜¯æŒ‚è½½äº†InstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> GameObject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasInstanceComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ‰¹é‡Instanceæ¸²æŸ“ NormalHeroes...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderOneByOneå‡½æ•°å®ç°äº†è¶…çº§è‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒé¦–å…ˆå¾—åˆ°äº†æ‰€æœ‰æ²¡æœ‰æŒ‚è½½InstanceComponentç»„ä»¶çš„gameObjectï¼›æœ€åéå†å®ƒä»¬ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°æ¸²æŸ“</p><p>renderInstanceså‡½æ•°å®ç°äº†æ™®é€šè‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒé¦–å…ˆå¾—åˆ°äº†æ‰€æœ‰æŒ‚è½½äº†InstanceComponentç»„ä»¶çš„gameObjectï¼›æœ€åæ‰¹é‡æ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç -1">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°PositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°PositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°PositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ›´æ–°PositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ‰¹é‡Instanceæ¸²æŸ“ </span><span class="token maybe-class-name">NormalHeroes</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjects&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;304480&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;positionComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">304480</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocityComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">304480</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;flyComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">304480</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;maxVelocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;instanceComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;666533&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;positionComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">666533</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocityComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">666533</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;flyComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;instanceComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">666533</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;838392&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;positionComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">838392</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocityComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">838392</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;flyComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;instanceComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">838392</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;936933&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;positionComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">936933</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;position&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocityComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">936933</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;flyComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObject&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">936933</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;maxVelocity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;instanceComponent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡æ‰“å°çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ­¥éª¤ä¸ä¹‹å‰ä¸€æ ·
ä¸åŒä¹‹å¤„åœ¨äºï¼š</p><ul><li>æ›´æ–°4ä¸ªè‹±é›„ç°åœ¨å˜ä¸ºæ›´æ–°4ä¸ªpositionComponent</li><li>æ‰“å°çš„WorldStateä¸ä¸€æ ·</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹æ‰“å°çš„WorldStateï¼š</p><ul><li>WorldStateçš„gameObjectsåŒ…æ‹¬äº†4ä¸ªgameObjectçš„æ•°æ®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªgameObjectæ•°æ®çš„positionComponentçš„positionä¸º<!-- -->[2,2,2]<!-- -->ï¼Œè¯´æ˜å®ƒè¿›è¡Œäº†ç§»åŠ¨æ“ä½œï¼›</li><li>æœ‰ä¸€ä¸ªgameObjectæ•°æ®çš„positionComponentçš„positionä¸º<!-- -->[6,6,6]<!-- -->ï¼Œè¯´æ˜å®ƒè¿›è¡Œäº†ç§»åŠ¨å’Œé£è¡Œæ“ä½œ</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->å› ä¸ºWorldStateçš„gameObjectsä¸­çš„Keyæ˜¯éšæœºç”Ÿæˆçš„idå€¼ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰“å°æ—¶Keyéƒ½ä¸ä¸€æ ·</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜-1">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜-1" title="Direct link to heading">â€‹</a></h3><ul><li>ç»„ä»¶çš„æ•°æ®åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œæ€§èƒ½ä¸å¥½<br>å¦‚positionæ•°æ®ç°åœ¨æ˜¯ä¸€å¯¹ä¸€åœ°åˆ†æ•£ä¿å­˜åœ¨å„ä¸ªpositionComponentç»„ä»¶ä¸­ï¼ˆå³ä¸€ä¸ªpositionComponentç»„ä»¶ä¿å­˜è‡ªå·±çš„positionï¼‰ï¼Œé‚£ä¹ˆå¦‚æœéœ€è¦éå†æ‰€æœ‰ç»„ä»¶çš„positionæ•°æ®ï¼Œåˆ™éœ€è¦éå†æ‰€æœ‰çš„positionComponentç»„ä»¶ï¼Œåˆ†åˆ«è·å¾—å®ƒä»¬çš„positionã€‚å› ä¸ºæ¯ä¸ªpositionComponentç»„ä»¶çš„æ•°æ®å¹¶æ²¡æœ‰è¿ç»­åœ°ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¼šé€ æˆç¼“å­˜å‘½ä¸­ä¸¢å¤±ï¼Œå¸¦æ¥æ€§èƒ½æŸå¤±</li></ul><ul><li>æ¶‰åŠå¤šç§ç»„ä»¶çš„è¡Œä¸ºä¸çŸ¥é“æ”¾åœ¨å“ªé‡Œ<br>å¦‚æœè¶…çº§è‹±é›„å¢åŠ ä¸€ä¸ªâ€œè·³â€çš„è¡Œä¸ºï¼Œè¯¥è¡Œä¸ºä¸ä»…éœ€è¦ä¿®æ”¹positionæ•°æ®ï¼Œè¿˜éœ€è¦ä¿®æ”¹velocityæ•°æ®ï¼Œé‚£ä¹ˆå®ç°è¯¥è¡Œä¸ºçš„jumpå‡½æ•°åº”è¯¥æ”¾åœ¨å“ªä¸ªç»„ä»¶ä¸­å‘¢ï¼Ÿ<br>å› ä¸ºjumpå‡½æ•°éœ€è¦åŒæ—¶ä¿®æ”¹PositionComponentç»„ä»¶çš„positionæ•°æ®å’ŒVelocityComponentç»„ä»¶çš„velocityæ•°æ®ï¼Œæ‰€ä»¥å°†å®ƒæ”¾åœ¨ä¸¤è€…ä¸­ä»»ä½•ä¸€ç§ç»„ä»¶ä¸­éƒ½ä¸åˆé€‚ã€‚å› æ­¤éœ€è¦å¢åŠ ä¸€ç§æ–°çš„ç»„ä»¶-JumpComponentï¼Œå¯¹åº”â€œè·³â€è¿™ä¸ªè¡Œä¸ºï¼Œå¹¶å®ç°jumpå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šé€šè¿‡JumpComponentæŒ‚è½½åˆ°çš„gameObjectæ¥è·å¾—æŒ‚è½½åˆ°å®ƒä¸Šçš„PositionComponentå’ŒVelocityComponentç»„ä»¶ï¼Œä»è€Œä¿®æ”¹å®ƒä»¬çš„æ•°æ®ã€‚<br>å¦‚æœå¢åŠ æ›´å¤šçš„è¿™ç§æ¶‰åŠå¤šç§ç»„ä»¶çš„è¡Œä¸ºï¼Œå°±éœ€è¦ä¸ºæ¯ä¸ªè¿™æ ·çš„è¡Œä¸ºå¢åŠ ä¸€ç§ç»„ä»¶ã€‚å› ä¸ºç»„ä»¶æ¯”è¾ƒé‡ï¼Œæ—¢æœ‰æ•°æ®åˆæœ‰é€»è¾‘ï¼Œæ‰€ä»¥å¢åŠ ç»„ä»¶çš„æˆæœ¬è¾ƒé«˜ï¼›å¦å¤–ï¼Œå› ä¸ºç»„ä»¶ä¸GameObjectæ˜¯èšåˆå…³ç³»ï¼Œè€ŒGameObjectå’ŒWorldä¹Ÿæ˜¯èšåˆå…³ç³»ï¼Œå®ƒä»¬éƒ½å±äºå¼ºå…³è”å…³ç³»ï¼Œæ‰€ä»¥å¢åŠ ç»„ä»¶ä¼šè¾ƒå¼ºåœ°å½±å“GameObjectå’ŒWorldï¼Œè¿™ä¹Ÿå¢åŠ äº†æˆæœ¬</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨ecsæ¨¡å¼æ¥æ”¹è¿›">ä½¿ç”¨ECSæ¨¡å¼æ¥æ”¹è¿›<a class="hash-link" href="#ä½¿ç”¨ecsæ¨¡å¼æ¥æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1" title="Direct link to heading">â€‹</a></h3><ul><li><p>åŸºäºData Orientedçš„æ€æƒ³è¿›è¡Œæ”¹è¿›<br>
<!-- -->ç»„ä»¶å¯ä»¥æŒ‰è§’è‰²åˆ†ä¸ºData Orientedç»„ä»¶å’Œå…¶å®ƒç»„ä»¶ï¼Œå…¶ä¸­å‰è€…çš„ç‰¹ç‚¹æ˜¯å±äºè¯¥è§’è‰²çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ•°æ®ï¼Œä¸”ç»„ä»¶çš„æ•°é‡è¾ƒå¤šï¼›åè€…çš„ç‰¹ç‚¹æ˜¯å±äºè¯¥è§’è‰²çš„æ¯ä¸ªç»„ä»¶éƒ½æ²¡æœ‰æ•°æ®ï¼Œæˆ–è€…ç»„ä»¶çš„æ•°é‡å¾ˆå°‘ã€‚è¿™é‡Œå…·ä½“è¯´æ˜ä¸€ä¸‹å„ç§ç»„ä»¶çš„è§’è‰²ï¼šç›®å‰ä¸€å…±æœ‰å››ç§ç»„ä»¶ï¼Œå®ƒä»¬æ˜¯PositionComponentã€VelocityComponentã€FlyComponentã€InstanceComponentã€‚å…¶ä¸­ï¼ŒInstanceComponentç»„ä»¶å› ä¸ºæ²¡æœ‰ç»„ä»¶æ•°æ®ï¼Œæ‰€ä»¥å±äºâ€œå…¶å®ƒç»„ä»¶â€ï¼›å¦å¤–ä¸‰ç§ç»„ä»¶åˆ™éƒ½å±äºâ€œData Orientedç»„ä»¶â€ã€‚<br>
<!-- -->å±äºData Orientedç»„ä»¶çš„ä¸‰ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®å°†ä¼šåˆ†åˆ«é›†ä¸­èµ·æ¥ï¼Œä¿å­˜åœ¨å„è‡ªçš„ä¸€å—è¿ç»­çš„åœ°å€ç©ºé—´ä¸­ï¼Œå…·ä½“å°±æ˜¯åˆ†åˆ«ä¿å­˜åœ¨ä¸‰ä¸ªArrayBufferä¸­</p></li><li><p>å°†GameObjectå’Œå„ä¸ªç»„ä»¶æ‰å¹³åŒ–<br>
<!-- -->GameObjectä¸å†æœ‰æ•°æ®å’Œé€»è¾‘äº†ï¼Œè€Œåªæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„idã€‚ç»„ä»¶ä¹Ÿä¸å†æœ‰æ•°æ®å’Œé€»è¾‘äº†ï¼Œå…¶ä¸­å±äºâ€œData Orientedç»„ä»¶â€çš„ç»„ä»¶åªæ˜¯ä¸€ä¸ªArrayBufferä¸Šçš„ç´¢å¼•ï¼›å±äºâ€œå…¶å®ƒç»„ä»¶â€çš„ç»„ä»¶åªæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</p></li><li><p>å¢åŠ Component+GameObjectè¿™ä¸€å±‚ï¼Œå°†æ‰å¹³çš„GameObjectå’Œç»„ä»¶æ”¾åœ¨è¯¥å±‚ä¸­</p></li></ul><ul><li>å¢åŠ Managerè¿™ä¸€å±‚ï¼Œæ¥ç®¡ç†GameObjectå’Œç»„ä»¶çš„æ•°æ®<br>è¿™ä¸€å±‚æœ‰GameObjectManagerå’Œå››ç§ç»„ä»¶çš„Managerï¼Œå…¶ä¸­GameObjectManagerè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„gameObjectï¼›å››ç§ç»„ä»¶çš„Managerè´Ÿè´£ç®¡ç†è‡ªå·±çš„ArrayBufferï¼Œæ“ä½œå±äºè¯¥ç§ç±»çš„æ‰€æœ‰ç»„ä»¶</li></ul><ul><li>å¢åŠ Systemè¿™ä¸€å±‚ï¼Œæ¥å®ç°è¡Œä¸ºçš„é€»è¾‘<br>ä¸€ä¸ªSystemå®ç°ä¸€ä¸ªè¡Œä¸ºï¼Œæ¯”å¦‚è¿™ä¸€å±‚ä¸­çš„MoveSystemã€FlySystemåˆ†åˆ«å®ç°äº†ç§»åŠ¨å’Œé£è¡Œçš„è¡Œä¸ºé€»è¾‘</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š  </p><ul><li>GameObjectå’Œç»„ä»¶çš„æ•°æ®è¢«ç§»åˆ°äº†Managerä¸­ï¼Œé€»è¾‘åˆ™è¢«ç§»åˆ°äº†Managerå’ŒSystemä¸­ã€‚å…¶ä¸­åªæ“ä½œè‡ªå·±æ•°æ®çš„é€»è¾‘ï¼ˆå¦‚getPositionã€setPositionï¼‰è¢«ç§»åˆ°äº†Managerä¸­ï¼Œå…¶å®ƒé€»è¾‘ï¼ˆé€šå¸¸ä¸ºè¡Œä¸ºé€»è¾‘ï¼Œéœ€è¦æ“ä½œå¤šç§ç»„ä»¶ï¼‰è¢«ç§»åˆ°äº†Systemä¸­</li><li>ä¸€ç§ç»„ä»¶çš„Manageråªå¯¹è¯¥ç§ç»„ä»¶è¿›è¡Œæ“ä½œï¼Œè€Œä¸€ä¸ªSystemå¯ä»¥å¯¹å¤šç§ç»„ä»¶è¿›è¡Œæ“ä½œ</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-2">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-2" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-5a6ee8e6945a319638e7b48948c3fe62.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼šç”¨æˆ·ã€Worldã€Systemå±‚ã€Managerå±‚ã€Component+GameObjectå±‚ï¼Œå®ƒä»¬çš„ä¾èµ–å…³ç³»æ˜¯å‰è€…ä¾èµ–åè€…</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·ã€Worldè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š
Clientæ˜¯ç”¨æˆ·</p><p>Worldæ˜¯æ¸¸æˆä¸–ç•Œï¼Œè™½ç„¶ä»ç„¶å®ç°äº†åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘ï¼Œä¸è¿‡ä¸å†ç®¡ç†æ‰€æœ‰çš„GameObjectäº†</p><p>æˆ‘ä»¬çœ‹ä¸‹Systemè¿™ä¸€å±‚ï¼š</p><p>æœ‰å¤šä¸ªSystemï¼Œæ¯ä¸ªSystemå®ç°ä¸€ä¸ªè¡Œä¸ºé€»è¾‘ã€‚æ¯ä¸ªSystemçš„èŒè´£å¦‚ä¸‹ï¼š</p><ul><li>CreateStateSystemå®ç°åˆ›å»ºWorldStateçš„é€»è¾‘ï¼Œåˆ›å»ºçš„WorldStateåŒ…æ‹¬äº†æ‰€æœ‰çš„Managerçš„stateæ•°æ®ï¼›</li><li>UpdateSystemå®ç°æ›´æ–°æ‰€æœ‰äººç‰©çš„positionçš„é€»è¾‘ï¼Œå…·ä½“æ˜¯æ›´æ–°æ‰€æœ‰PositionComponentçš„positionï¼›</li><li>MoveSystemå®ç°ä¸€ä¸ªäººç‰©çš„ç§»åŠ¨çš„é€»è¾‘ï¼Œå…·ä½“æ˜¯æ ¹æ®æŒ‚è½½åˆ°è¯¥äººç‰©gameObjectä¸Šçš„ä¸€ä¸ªpositionComponentå’Œä¸€ä¸ªvelocityComponentï¼Œæ›´æ–°è¯¥positionComponentçš„positionï¼›</li><li>FlySystemå®ç°ä¸€ä¸ªäººç‰©çš„é£è¡Œçš„é€»è¾‘ï¼Œå…·ä½“æ˜¯æ ¹æ®æŒ‚è½½åˆ°è¯¥äººç‰©gameObjectä¸Šçš„ä¸€ä¸ªpositionComponentã€ä¸€ä¸ªvelocityComponentã€ä¸€ä¸ªflyComponentï¼Œæ›´æ–°è¯¥positionComponentçš„positionï¼›</li><li>RenderOneByOneSystemå®ç°æ¸²æŸ“æ‰€æœ‰è¶…çº§è‹±é›„çš„é€»è¾‘ï¼›</li><li>RenderInstancesSystemå®ç°æ¸²æŸ“æ‰€æœ‰æ™®é€šè‹±é›„çš„é€»è¾‘</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Managerè¿™ä¸€å±‚ï¼š</p><p>æ¯ä¸ªManageréƒ½æœ‰ä¸€ä¸ªstateæ•°æ®</p><p>GameObjectManagerè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„gameObject</p><p>PositionComponentManagerã€VelocityComponentManagerã€FlyComponentManagerã€InstanceComponentManagerè´Ÿè´£ç®¡ç†å±äºå„è‡ªç§ç±»çš„æ‰€æœ‰çš„ç»„ä»¶</p><p>PositionComponentManagerçš„stateæ•°æ®åŒ…æ‹¬ä¸€ä¸ªbufferå­—æ®µå’Œä¸€ä¸ªpositionså­—æ®µï¼Œå…¶ä¸­å‰è€…æ˜¯ä¸€ä¸ªArrayBufferï¼Œä¿å­˜äº†è¯¥ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®ï¼›åè€…æ˜¯bufferçš„è§†å›¾ï¼Œç”¨äºè¯»å†™bufferä¸­çš„positionæ•°æ®</p><p>PositionComponentManagerçš„batchUpdateå‡½æ•°è´Ÿè´£æ‰¹é‡æ›´æ–°æ‰€æœ‰çš„positionComponentç»„ä»¶çš„position</p><p>å› ä¸ºVelocityComponentManagerã€FlyComponentManagerä¸PositionComponentManagerä¸€æ ·ï¼Œéƒ½å±äºData Orientedç»„ä»¶çš„Managerï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•°æ®å’Œå‡½æ•°ç±»ä¼¼ï¼ˆåªæ˜¯æ²¡æœ‰batchUpdateå‡½æ•°ï¼‰ï¼Œæ•…åœ¨å›¾ä¸­çœç•¥å®ƒä»¬çš„æ•°æ®å’Œå‡½æ•°</p><p>æˆ‘ä»¬çœ‹ä¸‹Component+GameObjectè¿™ä¸€å±‚ï¼š</p><p>å› ä¸ºPositionComponentã€VelocityComponentã€FlyComponentå±äºData Orientedç»„ä»¶ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¸€ä¸ªindexï¼Œä¹Ÿå°±æ˜¯å„è‡ªManagerçš„stateçš„bufferä¸­çš„ç´¢å¼•å€¼</p><p>å› ä¸ºInstanceComponentå±äºå…¶å®ƒç»„ä»¶ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</p><p>GameObjectæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¾èµ–å…³ç³»ï¼š</p><p>Systemå±‚ï¼š</p><p>å› ä¸ºCreateSysteméœ€è¦è°ƒç”¨å„ä¸ªManagerçš„createStateå‡½æ•°æ¥åˆ›å»ºå®ƒä»¬çš„stateï¼Œæ‰€ä»¥ä¾èµ–äº†æ•´ä¸ªManagerå±‚</p><p>å› ä¸ºUpdateSysteméœ€è¦è°ƒç”¨PositionComponentManagerçš„batchUpdateå‡½æ•°æ¥æ›´æ–°ï¼Œæ‰€ä»¥ä¾èµ–äº†PositionComponentManager</p><p>å› ä¸ºMoveSysteméœ€è¦è°ƒç”¨PositionComponentManageræ¥è·å¾—å’Œè®¾ç½®positionï¼Œå¹¶ä¸”è°ƒç”¨VelocityComponentManageræ¥è·å¾—velocityï¼Œæ‰€ä»¥ä¾èµ–äº†PositionComponentManagerã€VelocityComponentManager</p><p>å› ä¸ºFlySysteméœ€è¦è°ƒç”¨PositionComponentManageræ¥è·å¾—å’Œè®¾ç½®positionï¼Œå¹¶ä¸”è°ƒç”¨VelocityComponentManagerã€FlyComponentManageræ¥åˆ†åˆ«è·å¾—velocityå’ŒmaxVelocityï¼Œæ‰€ä»¥ä¾èµ–äº†PositionComponentManagerã€VelocityComponentManagerã€FlyComponentManager</p><p>å› ä¸ºRenderOneByOneSystemå’ŒRenderInstancesSysteméœ€è¦è°ƒç”¨GameObjectManageræ¥è·å¾—æ‰€æœ‰çš„gameObjectï¼Œå¹¶è°ƒç”¨å„ç§ç»„ä»¶çš„Manageræ¥è·å¾—ç»„ä»¶æ•°æ®ï¼Œæ‰€ä»¥ä¾èµ–äº†æ•´ä¸ªManagerå±‚</p><p>Managerå±‚ï¼š</p><p>å› ä¸ºGameObjectManageréœ€è¦æ“ä½œGameObjectï¼Œæ‰€ä»¥ä¾èµ–äº†GameObject</p><p>å› ä¸ºå„ç§ç»„ä»¶çš„Manageréœ€è¦æ“ä½œæ‰€æœ‰çš„è¯¥ç§ç»„ä»¶ï¼Œæ‰€ä»¥ä¾èµ–äº†å¯¹åº”çš„ç»„ä»¶</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1" title="Direct link to heading">â€‹</a></h3><ul><li><p>ç°åœ¨å„ç§ç»„ä»¶çš„æ•°æ®éƒ½é›†ä¸­ä¿å­˜åœ¨å„è‡ªManagerçš„stateçš„bufferï¼ˆArrayBufferï¼‰ä¸­ï¼Œéå†åŒä¸€ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®å³æ˜¯éå†ä¸€ä¸ªArrayBufferã€‚å› ä¸ºArrayBufferçš„æ•°æ®æ˜¯è¿ç»­åœ°ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥ç¼“å­˜å‘½ä¸­ä¸ä¼šä¸¢å¤±ï¼Œä»è€Œæé«˜äº†æ€§èƒ½</p></li><li><p>ç°åœ¨å°†æ¶‰åŠå¤šç§ç»„ä»¶çš„è¡Œä¸ºæ”¾åœ¨å¯¹åº”çš„Systemä¸­ã€‚å› ä¸ºSystemå¾ˆè½»ï¼Œæ²¡æœ‰æ•°æ®ï¼Œåªæœ‰é€»è¾‘ï¼Œæ‰€ä»¥å¢åŠ å’Œç»´æŠ¤Systemçš„æˆæœ¬è¾ƒä½ï¼›å¦å¤–ï¼Œå› ä¸ºSystemä½äºæœ€ä¸Šå±‚ï¼Œæ‰€ä»¥ä¿®æ”¹Systemä¹Ÿä¸ä¼šå½±å“Managerå±‚å’ŒComponent+GameObjectå±‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -2">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -2" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientä»£ç ä¸­ç¬¬ä¸€æ­¥çš„ä»£ç ï¼š</p><ul><li>åˆ›å»ºWorldStateçš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºåˆ›å»ºWorldStateæ—¶ä¼šåˆ›å»ºData Orientedç»„ä»¶çš„Managerçš„stateï¼Œå…¶ä¸­çš„å…³å¥æ˜¯åˆ›å»ºå„è‡ªçš„ArrayBufferï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹åˆ›å»ºå®ƒçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientä»£ç ä¸­ç¬¬äºŒæ­¥çš„ä»£ç ï¼š</p><ul><li>åˆ›å»ºåœºæ™¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºåˆ›å»ºåœºæ™¯æ—¶æ“ä½œäº†æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹å®ƒä»¬çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ç§»åŠ¨çš„ç›¸å…³ä»£ç </li><li>é£è¡Œçš„ç›¸å…³ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰©ä½™çš„ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»å¾ªç¯çš„ä¸€å¸§ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç </li><li>ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç -2">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> positionComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flyComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clientçš„ä»£ç è·Ÿä¹‹å‰çš„Clientçš„ä»£ç åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†createStateå‡½æ•°çš„å‚æ•°å’Œ_createSceneå‡½æ•°ä¸­åˆ›å»ºåœºæ™¯çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œè¿™ä¸ªç­‰ä¼šå†è®¨è®º</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºworldstateçš„ä»£ç -2">åˆ›å»ºWorldStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºworldstateçš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CreateStateSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">createState</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>CreateStateSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> positionComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flyComponentCount </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GameObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        velocityComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> VelocityComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">velocityComponentCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flyComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> FlyComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flyComponentCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instanceComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> InstanceComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>CreateStateSystemçš„createStateå‡½æ•°åˆ›å»ºäº†WorldStateï¼Œå®ƒä¿å­˜äº†å„ä¸ªManagerçš„state</p><p>å› ä¸ºData Orientedç»„ä»¶çš„Managerçš„stateåœ¨åˆ›å»ºæ—¶è¦åˆ›å»ºåŒ…æ‹¬è¯¥ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®çš„ArrayBufferï¼Œéœ€è¦çŸ¥é“è¯¥ç§ç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ï¼Œæ‰€ä»¥è¿™é‡Œçš„createStateå‡½æ•°æ¥æ”¶äº†ä¸‰ç§Data Orientedç»„ä»¶çš„æœ€å¤§ä¸ªæ•°</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºarraybufferçš„ä»£ç ">åˆ›å»ºArrayBufferçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºarraybufferçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>æˆ‘ä»¬ä»¥PositionComponentManagerä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹å®ƒçš„createStateå‡½æ•°çš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->position_component/ManagerStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ArrayBuffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    positions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Float32Array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™æ˜¯PositionComponentManagerçš„stateçš„ç±»å‹å®šä¹‰ï¼Œå®ƒçš„å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>bufferå­—æ®µä¿å­˜äº†ä¸€ä¸ªArrayBufferï¼Œå®ƒç”¨æ¥ä¿å­˜æ‰€æœ‰çš„positionComponentçš„æ•°æ®ã€‚ç›®å‰æ¯ä¸ªpositionComponentçš„æ•°æ®åªæœ‰positionï¼Œå®ƒçš„ç±»å‹æ˜¯ä¸‰ä¸ªfloat</li><li>positionså­—æ®µä¿å­˜äº†ArrayBufferçš„ä¸€ä¸ªè§†å›¾ï¼Œé€šè¿‡å®ƒå¯ä»¥è¯»å†™æ‰€æœ‰çš„positionComponentçš„position</li><li>maxIndexå­—æ®µæ˜¯ArrayBufferä¸Šæœ€å¤§çš„ç´¢å¼•å€¼ï¼Œç”¨äºåœ¨åˆ›å»ºä¸€ä¸ªpositionComponentæ—¶ç”Ÿæˆå®ƒçš„indexå€¼</li></ul><p>position_component/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_setAllTypeArrDataToDefault</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">positions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Float32Array</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">defaultPosition</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultPosition</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">positions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _initBufferData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultDataTuple</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ArrayBuffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Float32Array</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> typeArrData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_setAllTypeArrDataToDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CreateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createTypeArrays</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultDataTuple</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArrData</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> defaultPosition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">positions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_initBufferData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">positionComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">defaultPosition</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™æ˜¯PositionComponentManagerçš„createStateå‡½æ•°çš„ä»£ç ï¼Œå…¶ä¸­è°ƒç”¨çš„_initBufferDataå‡½æ•°åˆ›å»ºäº†bufferå’Œpositionsï¼Œå®ƒçš„æ­¥éª¤å¦‚ä¸‹ï¼š<br>
<!-- -->1.è°ƒç”¨BufferUtilsçš„createBufferå‡½æ•°æ¥åˆ›å»ºåŒ…æ‹¬æœ€å¤§ç»„ä»¶ä¸ªæ•°çš„æ•°æ®çš„ArrayBuffer<br>
<!-- -->2.è°ƒç”¨CreateTypeArrayUtilsçš„createTypeArrayså‡½æ•°æ¥åˆ›å»ºæ‰€æœ‰çš„TypeArrayï¼Œå®ƒä»¬æ˜¯æ“ä½œArrayBufferçš„è§†å›¾ã€‚è¿™é‡Œå…·ä½“æ˜¯åªåˆ›å»ºäº†ä¸€ä¸ªè§†å›¾ï¼špositions<br>
<!-- -->3.è°ƒç”¨_setAllTypeArrDataToDefaultå‡½æ•°æ¥å°†positionsçš„æ‰€æœ‰çš„å€¼å†™ä¸ºé»˜è®¤å€¼ï¼š<!-- -->[0,0,0]</p><p>ä¸‹é¢æ˜¯BufferUtilsçš„createBufferå‡½æ•°å’ŒCreateTypeArrayUtilsçš„createTypeArrayså‡½æ•°çš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->position_component/BufferUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getPositionSize</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPositionOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPositionLength</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getPositionSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPositionIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getPositionSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getTotalByteLength</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Float32Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">BYTES_PER_ELEMENT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getPositionSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createBuffer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_getTotalByteLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>position_component/CreateTypeArrayUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createTypeArrays</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Float32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionOffset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¦å¤–ä¸¤ç§Data Orientedç»„ä»¶çš„Managerï¼ˆVelocityComponentManagerã€FlyComponentManagerï¼‰çš„createStateå‡½æ•°çš„é€»è¾‘è·ŸPositionComponentManagerçš„createStateå‡½æ•°çš„é€»è¾‘ä¸€æ ·ï¼Œæ•…çœç•¥ç›¸å…³ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºåœºæ™¯çš„ä»£ç -2">åˆ›å»ºåœºæ™¯çš„ä»£ç <a class="hash-link" href="#åˆ›å»ºåœºæ™¯çš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _createScene </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºnormalHero1ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºgameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºpositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºvelocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºinstanceComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æŒ‚è½½positionComponentã€velocityComponentã€instanceComponentåˆ°gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºnormalHero2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    normalHero1ç§»åŠ¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨MoveSystemçš„moveå‡½æ•°ï¼Œä¼ å…¥normalHero1çš„positionComponentã€velocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºsuperHero1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºgameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºpositionComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºvelocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºflyComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æŒ‚è½½positionComponentã€velocityComponentã€flyComponentåˆ°gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºsuperHero2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1ç§»åŠ¨ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨MoveSystemçš„moveå‡½æ•°ï¼Œä¼ å…¥superHero1çš„positionComponentã€velocityComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHero1é£è¡Œï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨FlySystemçš„flyå‡½æ•°ï¼Œä¼ å…¥superHero1çš„positionComponentã€velocityComponentã€flyComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_createSceneå‡½æ•°åˆ›å»ºäº†åœºæ™¯ï¼Œåœºæ™¯çš„å†…å®¹è·Ÿä¹‹å‰ä¸€æ ·ï¼Œéƒ½åŒ…æ‹¬äº†2ä¸ªæ™®é€šè‹±é›„å’Œ2ä¸ªè¶…çº§è‹±é›„ï¼Œåªæ˜¯ç°åœ¨åˆ›å»ºä¸€ä¸ªè‹±é›„çš„æ–¹å¼åˆæ”¹å˜äº†ï¼Œå…·ä½“å˜ä¸ºï¼šç°åœ¨ä¸éœ€è¦åŠ å…¥GameObjectåˆ°Worldä¸­</p><p>å¦å¤–ï¼Œç°åœ¨æ”¹ä¸ºé€šè¿‡è°ƒç”¨MoveSystemå’ŒFlySystemçš„å‡½æ•°æ¥æ“ä½œå¯¹åº”çš„ç»„ä»¶ï¼Œä»è€Œå®ç°è‹±é›„çš„â€œç§»åŠ¨â€ã€â€œé£è¡Œâ€</p><p>gameObject/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªgameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªgameObjectå°±æ˜¯ä¸€ä¸ªuid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createGameObject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ç”Ÿæˆä¸€ä¸ªuid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//uidçš„æ„æ€æ˜¯unique idï¼Œå³å…¨å±€å”¯ä¸€çš„id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GameObjectManagerçš„createGameObjectå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªgameObjectï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</p><p>position_component/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªpositionComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªpositionComponentå°±æ˜¯ä¸€ä¸ªindex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ç”Ÿæˆä¸€ä¸ªindex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>PositionComponentManagerçš„createComponentå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªpositionComponentï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªPositionComponentManagerçš„stateçš„bufferä¸Šçš„ç´¢å¼•</p><p>VelocityComponentManagerã€FlyComponentManagerçš„ç›¸å…³ä»£ç è·ŸPositionComponentManagerç±»ä¼¼ï¼Œæ•…çœç•¥ç›¸å…³ä»£ç </p><p>instance_component/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºä¸€ä¸ªinstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªinstanceComponentå°±æ˜¯ä¸€ä¸ªuid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ç”Ÿæˆä¸€ä¸ªid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InstanceComponentManagerçš„createComponentå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªinstanceComponentï¼Œå› ä¸ºInstanceComponentç»„ä»¶å±äºâ€œå…¶å®ƒç»„ä»¶â€ï¼Œæ‰€ä»¥å®ƒè·ŸGameObjectä¸€æ ·éƒ½æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„idè€Œä¸æ˜¯ä¸€ä¸ªindex</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç§»åŠ¨çš„ç›¸å…³ä»£ç -1">ç§»åŠ¨çš„ç›¸å…³ä»£ç <a class="hash-link" href="#ç§»åŠ¨çš„ç›¸å…³ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>MoveSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªgameObjectçš„ç§»åŠ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> move </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positionComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> VelocityComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">velocityComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æ ¹æ®velocityï¼Œæ›´æ–°positionComponentçš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> positionComponentManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positionComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>MoveSystemçš„moveå‡½æ•°å®ç°ç§»åŠ¨çš„è¡Œä¸ºé€»è¾‘ã€‚è¿™é‡Œæ¶‰åŠåˆ°è¯»å†™Data Orientedç»„ä»¶çš„ArrayBufferä¸Šçš„æ•°æ®ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è¯»å†™PositionComponentManagerçš„positionsçš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->position_component/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>position_component/OperateTypeArrayUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> TypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFloat3Tuple</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setPosition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setFloat3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPositionIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>TypeArrayUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getFloat3Tuple</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setFloat3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>position_component/BufferUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getPositionSize</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getPositionIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getPositionSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡ä»£ç å¯çŸ¥ï¼Œå®ç°â€œè¯»å†™PositionComponentManagerçš„ArrayBufferä¸Šçš„æ•°æ®â€çš„æ€è·¯æ˜¯ï¼š<br>
<!-- -->å› ä¸ºä¸€ä¸ªpositionComponentçš„å€¼æ˜¯ArrayBufferçš„ç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒæ¥è¯»å†™ArrayBufferçš„è§†å›¾positionsä¸­çš„å¯¹åº”æ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="é£è¡Œçš„ç›¸å…³ä»£ç -1">é£è¡Œçš„ç›¸å…³ä»£ç <a class="hash-link" href="#é£è¡Œçš„ç›¸å…³ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>FlySystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ä¸€ä¸ªgameObjectçš„é£è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fly </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flyComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positionComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> VelocityComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">velocityComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> velocityComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> maxVelocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FlyComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMaxVelocity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flyComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flyComponent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æ ¹æ®maxVelociyã€velocityï¼Œæ›´æ–°positionComponentçš„position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    velocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> velocity </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxVelocity </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">velocity </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> maxVelocity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> positionComponentManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positionComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> positionComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> velocity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>FlySystemçš„flyå‡½æ•°å®ç°äº†é£è¡Œçš„è¡Œä¸ºé€»è¾‘</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç -1">åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæ•…çœç•¥ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç -2">ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ›´æ–°çš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> UpdateSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>UpdateSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> positionComponentManagerState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PositionComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">batchUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positionComponentManagerState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> positionComponentManagerState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>UpdateSystemçš„updateå‡½æ•°å®ç°äº†æ›´æ–°ï¼Œå®ƒè°ƒç”¨äº†PositionComponentManagerçš„batchUpdateå‡½æ•°æ¥æ‰¹é‡æ›´æ–°æ‰€æœ‰çš„positionComponentç»„ä»¶ã€‚æˆ‘ä»¬çœ‹ä¸‹PositionComponentManagerçš„ç›¸å…³ä»£ç ï¼š<br>
<!-- -->position_component/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getAllComponents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">component</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»stateä¸­è·å¾—æ‰€æœ‰çš„positionComponents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">batchUpdate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAllComponents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ›´æ–°position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>batchUpdateå‡½æ•°éå†æ‰€æœ‰çš„positionComponentï¼Œæ›´æ–°å®ƒä»¬çš„positionã€‚æ›´æ–°çš„é€»è¾‘è·Ÿä¹‹å‰ä¸€æ ·</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç -2">ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯ä¸­æ¸²æŸ“çš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderOneByOne </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RenderOneByOneSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">render</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>RenderOneByOneSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> superHeroGameObjects </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GameObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAllGameObjects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectManagerState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObject </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ¤æ–­gameObjectæ˜¯ä¸æ˜¯æ²¡æœ‰æŒ‚è½½InstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">InstanceComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instanceComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    superHeroGameObjects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObjectState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OneByOneæ¸²æŸ“ SuperHero...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>gameObject/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getAllGameObjects </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">gameObject</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> maxUID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¿”å›[0, 1, ...,  maxUID-1]çš„æ•°ç»„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxUID </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>RenderOneByOneSystemçš„renderå‡½æ•°å®ç°äº†è¶…çº§è‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒé¦–å…ˆå¾—åˆ°äº†æ‰€æœ‰æ²¡æœ‰æŒ‚è½½InstanceComponentç»„ä»¶çš„gameObjectï¼›æœ€åä¸€ä¸ªä¸€ä¸ªåœ°æ¸²æŸ“</p><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderInstances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RenderInstancesSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">render</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>RenderInstancesSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> normalHeroGameObejcts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GameObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAllGameObjects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectManagerState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObject </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ¤æ–­gameObjectæ˜¯ä¸æ˜¯æŒ‚è½½äº†InstanceComponent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> InstanceComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instanceComponentManagerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ‰¹é‡Instanceæ¸²æŸ“ NormalHeroes...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>RenderInstancesSystemçš„renderå‡½æ•°å®ç°äº†æ™®é€šè‹±é›„çš„æ¸²æŸ“ï¼Œå®ƒé¦–å…ˆå¾—åˆ°äº†æ‰€æœ‰æŒ‚è½½äº†InstanceComponentç»„ä»¶çš„gameObjectï¼›æœ€åä¸€æ¬¡æ€§æ‰¹é‡æ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç -2">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç -2" title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">åˆå§‹åŒ–</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">æ›´æ–°PositionComponent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">æ›´æ–°PositionComponent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">æ›´æ–°PositionComponent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">æ›´æ–°PositionComponent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">OneByOneæ¸²æŸ“</span><span class="token plain"> </span><span class="token maybe-class-name">SuperHero</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ‰¹é‡Instanceæ¸²æŸ“ </span><span class="token maybe-class-name">NormalHeroes</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectManagerState&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;maxUID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;positionComponentManagerState&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;maxIndex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;buffer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;positions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;4&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;5&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;6&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;7&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;8&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;9&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;10&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;11&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;12&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;13&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;14&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;15&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;16&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;17&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;18&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;19&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;20&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;21&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;22&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;23&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;24&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;25&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;26&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;27&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;28&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;29&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectPositionMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocityComponentManagerState&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;maxIndex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;buffer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;velocitys&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;4&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;5&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;6&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;7&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;8&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;9&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectVelocityMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;flyComponentManagerState&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;maxIndex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;buffer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;maxVelocitys&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;4&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;5&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;6&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;7&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;8&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;9&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectFlyMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;3&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;instanceComponentManagerState&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;maxUID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;gameObjectInstanceMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡æ‰“å°çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ­¥éª¤ä¸ä¹‹å‰ä¸€æ ·
ä¸åŒä¹‹å¤„åœ¨äºï¼š  </p><ul><li>æ‰“å°çš„WorldStateä¸ä¸€æ ·</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹æ‰“å°çš„WorldStateï¼š</p><ul><li>WorldStateçš„gameObjectManagetStateçš„maxUIDä¸º4ï¼Œè¯´æ˜åˆ›å»ºäº†4ä¸ªgameObjectï¼›</li><li>WorldStateçš„positionComponentManagerStateçš„maxIndexä¸º4ï¼Œè¯´æ˜åˆ›å»ºäº†4ä¸ªpositionComponentï¼›</li><li>WorldStateçš„positionComponentManagerStateçš„positionsæœ‰3ä¸ªè¿ç»­çš„å€¼æ˜¯2ã€2ã€2ï¼Œè¯´æ˜æœ‰ä¸€ä¸ªpositionComponentç»„ä»¶è¿›è¡Œäº†ç§»åŠ¨æ“ä½œï¼›æœ‰å¦å¤–3ä¸ªè¿ç»­çš„å€¼æ˜¯6ã€6ã€6ï¼Œè¯´æ˜æœ‰å¦å¤–ä¸€ä¸ªpositionComponentç»„ä»¶è¿›è¡Œäº†ç§»åŠ¨æ“ä½œå’Œé£è¡Œæ“ä½œï¼›</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®šä¹‰">å®šä¹‰<a class="hash-link" href="#å®šä¹‰" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸€å¥è¯å®šä¹‰">ä¸€å¥è¯å®šä¹‰<a class="hash-link" href="#ä¸€å¥è¯å®šä¹‰" title="Direct link to heading">â€‹</a></h3><p>ç»„åˆä»£æ›¿ç»§æ‰¿ï¼›è¿ç»­åœ°ä¿å­˜ç»„ä»¶æ•°æ®ï¼›åˆ†ç¦»é€»è¾‘å’Œæ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜<a class="hash-link" href="#è¡¥å……è¯´æ˜" title="Direct link to heading">â€‹</a></h3><p>â€œç»„åˆä»£æ›¿ç»§æ‰¿â€æ˜¯æŒ‡åŸºäºç»„ä»¶åŒ–æ€æƒ³ï¼Œé€šè¿‡GameObjectç»„åˆä¸åŒçš„ç»„ä»¶ä»£æ›¿GameObjectå±‚å±‚ç»§æ‰¿</p><p>â€œè¿ç»­åœ°ä¿å­˜ç»„ä»¶æ•°æ®â€æ˜¯æŒ‡åŸºäºData Orientedæ€æƒ³ï¼Œå°†Data Orientedç»„ä»¶çš„ç»„ä»¶æ•°æ®é›†ä¸­èµ·æ¥ï¼Œä¿å­˜åœ¨å†…å­˜ä¸­è¿ç»­çš„åœ°å€ç©ºé—´</p><p>â€œåˆ†ç¦»é€»è¾‘å’Œæ•°æ®â€æ˜¯æŒ‡å°†GameObjectå’Œç»„ä»¶æ‰å¹³åŒ–ï¼Œå°†å®ƒä»¬çš„æ•°æ®æ”¾åˆ°Managerå±‚ï¼Œå°†å®ƒä»¬çš„é€»è¾‘æ”¾åˆ°Systemå±‚å’ŒManagerå±‚ã€‚å…¶ä¸­ï¼Œåªæ“ä½œè‡ªå·±æ•°æ®çš„é€»è¾‘ï¼ˆå¦‚getPositionã€setPositionï¼‰è¢«ç§»åˆ°äº†Managerä¸­ï¼Œå…¶å®ƒé€»è¾‘ï¼ˆé€šå¸¸ä¸ºè¡Œä¸ºé€»è¾‘ï¼Œéœ€è¦æ“ä½œå¤šç§ç»„ä»¶ï¼‰è¢«ç§»åˆ°äº†Systemä¸­</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="é€šç”¨uml">é€šç”¨UML<a class="hash-link" href="#é€šç”¨uml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-299c27408b6971beb2802244ae9c645c.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€Worldã€Systemå±‚ã€Managerå±‚ã€Component+GameObjectå±‚äº”ä¸ªéƒ¨åˆ†ï¼Œå®ƒä»¬çš„ä¾èµ–å…³ç³»æ˜¯å‰è€…ä¾èµ–åè€…ã€‚å…¶ä¸­ï¼ŒSystemå±‚è´Ÿè´£å®ç°è¡Œä¸ºçš„é€»è¾‘ï¼›Managerå±‚è´Ÿè´£ç®¡ç†åœºæ™¯æ•°æ®ï¼Œå³ç®¡ç†GameObjectå’Œç»„ä»¶çš„æ•°æ®ï¼›Component+GameObjectå±‚ä¸ºç»„ä»¶å’ŒGameObjectï¼Œå®ƒä»¬ç°åœ¨åªæ˜¯æœ‰ä¸€ä¸ªnumberç±»å‹çš„æ•°æ®çš„å€¼å¯¹è±¡</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Client<br>è¯¥è§’è‰²æ˜¯ç”¨æˆ·</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Worldè¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>World<br>è¯¥è§’è‰²æ˜¯é—¨æˆ·ï¼Œæä¾›äº†APIï¼Œå®ç°äº†åˆå§‹åŒ–å’Œä¸»å¾ªç¯çš„é€»è¾‘</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Systemè¿™ä¸€å±‚ï¼š</p><p>ä¸€ä¸ªSystemå®ç°ä¸€ä¸ªè¡Œä¸ºçš„é€»è¾‘</p><ul><li><p>CreateStateSystem<br>
<!-- -->è¯¥è§’è‰²è´Ÿè´£åˆ›å»ºWorldState</p></li><li><p>OtherSystem<br>
<!-- -->è¯¥è§’è‰²æ˜¯é™¤äº†CreateStateSystemä»¥å¤–çš„æ‰€æœ‰Systemï¼Œå®ƒä»¬å„è‡ªæœ‰ä¸€ä¸ªå‡½æ•°actionï¼Œç”¨äºå®ç°æŸä¸ªè¡Œä¸º</p></li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Managerè¿™ä¸€å±‚ï¼š</p><p>æ¯ä¸ªManageréƒ½æœ‰ä¸€ä¸ªstateæ•°æ®</p><ul><li><p>GameObjectManager<br>
<!-- -->è¯¥è§’è‰²è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„gameObject</p></li><li><p>DataOrientedComponentManager<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€ç§Data Orientedç»„ä»¶çš„Managerï¼Œè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†è¯¥ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®ï¼Œå°†å…¶é›†ä¸­åœ°ä¿å­˜åœ¨å„è‡ªçš„stateçš„bufferä¸­<br>
<!-- -->DataOrientedComponentManagerçš„stateæ•°æ®åŒ…æ‹¬ä¸€ä¸ªbufferå­—æ®µå’Œå¤šä¸ªâ€œtypeArray of bufferâ€å­—æ®µï¼Œå…¶ä¸­å‰è€…æ˜¯ä¸€ä¸ªArrayBufferï¼Œä¿å­˜äº†è¯¥ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®ï¼›åè€…æ˜¯bufferçš„å¤šä¸ªè§†å›¾ï¼Œç”¨äºè¯»å†™bufferä¸­å¯¹åº”çš„æ•°æ®  </p></li><li><p>OtherComponentManager<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€ç§å…¶å®ƒç»„ä»¶çš„Managerï¼Œè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†è¯¥ç§ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶æ•°æ®<br>
<!-- -->OtherComponentManagerçš„stateæ•°æ®åŒ…æ‹¬å¤šä¸ªâ€œvalue mapâ€å­—æ®µï¼Œå®ƒä»¬æ˜¯å¤šä¸ªHash Mapï¼Œæ¯ä¸ªHash Mapä¿å­˜ä¸€ç±»ç»„ä»¶æ•°æ®</p></li></ul><p>æˆ‘ä»¬çœ‹ä¸‹Component+GameObjectè¿™ä¸€å±‚ï¼š</p><ul><li><p>DataOrientedComponent<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€ç§Data Orientedç»„ä»¶ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªArrayBufferä¸Šçš„ç´¢å¼•</p></li><li><p>OtherComponent<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€ç§å…¶å®ƒç»„ä»¶ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</p></li></ul><ul><li>GameObject<br>è¯¥è§’è‰²æ˜¯ä¸€ä¸ªgameObjectï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id</li></ul><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li><p>åªæœ‰ä¸€ä¸ªCreateStateSystem</p></li><li><p>å¯ä»¥æœ‰å¤šä¸ªOtherSystemï¼Œæ¯ä¸ªOtherSystemå®ç°ä¸€ä¸ªè¡Œä¸º</p></li><li><p>åªæœ‰ä¸€ä¸ªGameObjectManager</p></li><li><p>å¯ä»¥æœ‰å¤šä¸ªDataOrientedComponentManagerï¼Œæ¯ä¸ªå¯¹åº”ä¸€ç§Data Orientedç»„ä»¶</p></li></ul><ul><li><p>å¯ä»¥æœ‰å¤šä¸ªDataOrientedComponentï¼Œæ¯ä¸ªå¯¹åº”ä¸€ç§Data Orientedç»„ä»¶</p></li><li><p>å¯ä»¥æœ‰å¤šä¸ªOtherComponentManagerï¼Œæ¯ä¸ªå¯¹åº”ä¸€ç§å…¶å®ƒç»„ä»¶</p></li></ul><ul><li>å¯ä»¥æœ‰å¤šä¸ªOtherComponentï¼Œæ¯ä¸ªå¯¹åº”ä¸€ç§å…¶å®ƒç»„ä»¶</li></ul><p>Systemå±‚ï¼š</p><ul><li>å› ä¸ºCreateSysteméœ€è¦è°ƒç”¨å„ä¸ªManagerçš„createStateå‡½æ•°æ¥åˆ›å»ºå®ƒä»¬çš„stateï¼Œæ‰€ä»¥ä¾èµ–äº†æ•´ä¸ªManagerå±‚</li></ul><ul><li>å› ä¸ºOtherSystemå¯èƒ½éœ€è¦è°ƒç”¨1ä¸ªGameObjectManageræ¥å¤„ç†gameObjectã€è°ƒç”¨å¤šä¸ªDataOrientedComponentManagerå’ŒOtherComponentManageræ¥å¤„ç†å„è‡ªç§ç±»çš„ç»„ä»¶ï¼Œæ‰€ä»¥å®ƒä¸GameObjectManageræ˜¯ä¸€å¯¹ä¸€çš„ä¾èµ–å…³ç³»ï¼Œä¸DataOrientedComponentManagerå’ŒOtherComponentManageréƒ½æ˜¯ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</li></ul><p>Managerå±‚ï¼š</p><ul><li>å› ä¸ºGameObjectManageréœ€è¦æ“ä½œå¤šä¸ªGameObjectï¼Œæ‰€ä»¥å®ƒä¸GameObjectæ˜¯ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</li></ul><ul><li><p>å› ä¸ºDataOrientedComponentManagerå’ŒDataOrientedComponentå¯¹åº”åŒä¸€ç§Data Orientedç»„ä»¶ï¼Œä¸”å‰è€…ç®¡ç†æ‰€æœ‰çš„åè€…ï¼Œæ‰€ä»¥å‰è€…å’Œåè€…æ˜¯ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</p></li><li><p>å› ä¸ºOtherComponentManagerå’ŒOtherComponentå¯¹åº”åŒä¸€ç§å…¶å®ƒç»„ä»¶ï¼Œä¸”å‰è€…ç®¡ç†æ‰€æœ‰çš„åè€…ï¼Œæ‰€ä»¥å‰è€…å’Œåè€…æ˜¯ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</p></li></ul><p>Component+GameObjectå±‚ï¼š</p><ul><li>å› ä¸ºä¸€ä¸ªGameObjectå¯ä»¥æŒ‚è½½å„ç§ç»„ä»¶ï¼Œå…¶ä¸­æ¯ç§ç»„ä»¶åªèƒ½æŒ‚è½½ä¸€ä¸ªï¼Œæ‰€ä»¥GameObjectä¸DataOrientedComponentã€OtherComponentéƒ½æ˜¯ä¸€å¯¹ä¸€çš„ç»„åˆå…³ç³»</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è§’è‰²çš„æŠ½è±¡ä»£ç ">è§’è‰²çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#è§’è‰²çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªè§’è‰²çš„æŠ½è±¡ä»£ç ï¼š</p><p>æˆ‘ä»¬æŒ‰ç…§ä¾èµ–å…³ç³»ï¼Œä»ä¸Šå¾€ä¸‹ä¾æ¬¡çœ‹ä¸‹é¢†åŸŸæ¨¡å‹ä¸­ç”¨æˆ·ã€Worldã€Systemå±‚ã€Managerå±‚ã€Component+GameObjectå±‚è¿™äº”ä¸ªéƒ¨åˆ†çš„æŠ½è±¡ä»£ç ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹å±äºç”¨æˆ·çš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Worldçš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Systemå±‚çš„æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>CreateStateSystemçš„æŠ½è±¡ä»£ç </li><li>OtherSystemçš„æŠ½è±¡ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Managerå±‚çš„æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>GameObjectManagerçš„æŠ½è±¡ä»£ç </li><li>DataOrientedComponentManagerçš„æŠ½è±¡ä»£ç </li><li>OtherComponentManagerçš„æŠ½è±¡ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹Component+GameObjectå±‚çš„æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>GameObjectçš„æŠ½è±¡ä»£ç </li><li>DataOrientedComponentçš„æŠ½è±¡ä»£ç </li><li>OtherComponentçš„æŠ½è±¡ä»£ç </li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç”¨æˆ·çš„æŠ½è±¡ä»£ç ">ç”¨æˆ·çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ç”¨æˆ·çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _createScene </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºgameObject1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æŒ‚è½½ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è§¦å‘gameObject1çš„è¡Œä¸º</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºæ›´å¤šçš„gameObjects</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> dataOrientedComponent1Count</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> xx </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">World</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="worldçš„æŠ½è±¡ä»£ç ">Worldçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#worldçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>World</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CreateStateSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">createState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> action1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OtherSystem1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‡å®ç°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">requestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">func</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">loop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è°ƒç”¨OtherSystemæ¥æ›´æ–°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è°ƒç”¨OtherSystemæ¥æ¸²æŸ“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="createstatesystemçš„æŠ½è±¡ä»£ç ">CreateStateSystemçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#createstatesystemçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>CreateStateSystem</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> dataOrientedComponent1Count </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObjectManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GameObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dataOrientedComponent1ManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> DataOrientedComponent1Manager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataOrientedComponent1Count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        otherComponent1ManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> OtherComponent1Manager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºæ›´å¤šçš„DataOrientedManagerStateå’ŒOtherComponentManagerState</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="othersystemçš„æŠ½è±¡ä»£ç ">OtherSystemçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#othersystemçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>OtherSystem1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">action</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dataOrientedComponentX</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> dataOrientedComponentX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> otherComponentX</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> otherComponentX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¡Œä¸ºçš„é€»è¾‘</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªOtherSystemï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªOtherSystemçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="gameobjectmanagerçš„æŠ½è±¡ä»£ç ">GameObjectManagerçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#gameobjectmanagerçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>gameObject/ManagerStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>gameObject/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createGameObject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getAllGameObjects </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">gameObject</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> maxUID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxUID </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="dataorientedcomponentmanagerçš„æŠ½è±¡ä»£ç ">DataOrientedComponentManagerçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#dataorientedcomponentmanagerçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>dataoriented_component1/ManagerStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">TypeArrayType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Float32Array </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Uint8Array </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Uint16Array </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Uint32Array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//bufferä¿å­˜äº†è¯¥ç§ç»„ä»¶æ‰€æœ‰çš„value1ã€value2ã€...ã€valueXæ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ArrayBuffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¯¥ç§ç»„ä»¶æ‰€æœ‰çš„value1æ•°æ®çš„è§†å›¾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value1s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TypeArrayType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¯¥ç§ç»„ä»¶æ‰€æœ‰çš„value2æ•°æ®çš„è§†å›¾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value2s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TypeArrayType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´å¤švalueXs</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>dataoriented_component1/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_setAllTypeArrDataToDefault</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">value1s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value2s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Float32Array</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">defaultValue1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultValue2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setValue1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultValue1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value1s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setValue2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultValue2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value2s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">value1s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value2s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _initBufferData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultDataTuple</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ArrayBuffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TypeArrayType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> typeArrData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_setAllTypeArrDataToDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CreateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createTypeArrays</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultDataTuple</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> typeArrData</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataorientedComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> defaultValue1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> value1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> defaultValue2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> value2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">value1s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value2s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_initBufferData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataorientedComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">defaultValue1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultValue2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value1s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value2s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getAllComponents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">component</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»stateä¸­è·å¾—æ‰€æœ‰çš„dataorientedComponent1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValue1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value1s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setValue1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OperateTypeArrayUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setValue1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value1s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> value2</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">batchOperate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> allComponents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAllComponents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ‰¹é‡æ“ä½œ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>dataoriented_component1/BufferUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œåªç»™å‡ºäº†ä¸¤ä¸ªvalueçš„æƒ…å†µ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ›´å¤šçš„valueä¹Ÿä»¥æ­¤ç±»æ¨...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getValue1Size</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> value1 size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getValue2Size</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> value2 size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue1Offset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue2Offset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getValue1Offset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getValue1Length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> TypeArray2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">BYTES_PER_ELEMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue1Length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getValue1Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue2Length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getValue2Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue1Index</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getValue1Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue2Index</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getValue2Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getTotalByteLength</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypeArray1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">BYTES_PER_ELEMENT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_getValue1Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> TypeArray2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">BYTES_PER_ELEMENT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_getValue2Size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createBuffer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_getTotalByteLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>dataoriented_component1/CreateTypeArrayUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createTypeArrays</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Float32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValue1Offset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValue1Length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Float32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValue2Offset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BufferUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValue2Length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªDataOrientedComponentManagerï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªDataOrientedComponentManagerçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="othercomponentmanagerçš„æŠ½è±¡ä»£ç ">OtherComponentManagerçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#othercomponentmanagerçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>other_component1/ManagerStateType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//value1Mapç”¨æ¥ä¿å­˜è¯¥ç§ç»„ä»¶æ‰€æœ‰çš„value1æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value1Map</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value1 type</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´å¤švalueXMap</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>other_component1/Manager</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value1Map</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> uid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxUID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getAllComponents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">component</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»stateä¸­è·å¾—æ‰€æœ‰çš„otherComponent1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getValue1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictUndefined</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value1Map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setValue1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> component</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value1Map</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value1Map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">batchOperate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> allComponents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAllComponents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ‰¹é‡æ“ä½œ&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªOtherComponentManagerï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªOtherComponentManagerçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="gameobjectçš„æŠ½è±¡ä»£ç ">GameObjectçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#gameobjectçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GameObjectType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">gameObject</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="dataorientedcomponentçš„æŠ½è±¡ä»£ç ">DataOrientedComponentçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#dataorientedcomponentçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>DataOrientedComponent1Type</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">index</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">component</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªDataOrientedComponentï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªDataOrientedComponentçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="othercomponentçš„æŠ½è±¡ä»£ç ">OtherComponentçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#othercomponentçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>OtherComponent1Type</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">component</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰å¤šä¸ªOtherComponentï¼Œè¿™é‡Œåªç»™å‡ºä¸€ä¸ªOtherComponentçš„æŠ½è±¡ä»£ç </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°<a class="hash-link" href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" title="Direct link to heading">â€‹</a></h3><p>ECSæ¨¡å¼ä¸»è¦éµå¾ªä¸‹é¢çš„è®¾è®¡åŸåˆ™ï¼š</p><ul><li>å•ä¸€èŒè´£åŸåˆ™<br>æ¯ä¸ªSystemåªå®ç°ä¸€ä¸ªè¡Œä¸ºï¼›æ¯ä¸ªç»„ä»¶çš„Manageråªç®¡ç†ä¸€ç§ç»„ä»¶</li><li>åˆæˆå¤ç”¨åŸåˆ™<br>GameObjectç»„åˆäº†å¤šä¸ªç»„ä»¶</li><li>æ¥å£éš”ç¦»åŸåˆ™<br>GameObjectå’Œç»„ä»¶ç»è¿‡äº†æ‰å¹³åŒ–å¤„ç†ï¼Œç§»é™¤äº†æ•°æ®å’Œé€»è¾‘ï¼Œæ”¹ä¸ºåªæ˜¯æœ‰ä¸€ä¸ªnumberç±»å‹æ•°æ®çš„å€¼å¯¹è±¡</li><li>æœ€å°‘çŸ¥è¯†åŸåˆ™<br>Worldã€Systemã€Managerã€Component+GameObjectè¿™å‡ ä¸ªå±‚åªèƒ½ä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸èƒ½è·¨å±‚ä¾èµ–</li><li>å¼€é—­åŸåˆ™<br>è¦å¢åŠ ä¸€ç§è¡Œä¸ºï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªSystemï¼Œä¸ä¼šå½±å“Manager</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åº”ç”¨">åº”ç”¨<a class="hash-link" href="#åº”ç”¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¼˜ç‚¹">ä¼˜ç‚¹<a class="hash-link" href="#ä¼˜ç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>ç»„ä»¶çš„æ•°æ®é›†ä¸­è¿ç»­åœ°ä¿å­˜åœ¨ArrayBufferä¸­ï¼Œå¢åŠ äº†ç¼“å­˜å‘½ä¸­ï¼Œæé«˜äº†è¯»å†™çš„æ€§èƒ½</p></li><li><p>åˆ›å»ºå’Œåˆ é™¤ç»„ä»¶çš„æ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œå› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šåˆ†é…æˆ–è€…é”€æ¯å†…å­˜ï¼Œæ‰€ä»¥æ²¡æœ‰åƒåœ¾å›æ”¶çš„å¼€é”€<br>
<!-- -->è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»ºArrayBufferæ—¶å°±é¢„å…ˆæŒ‰ç…§æœ€å¤§ç»„ä»¶ä¸ªæ•°åˆ†é…äº†ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºç»„ä»¶æ—¶ï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªå½“å‰æœ€å¤§ç´¢å¼•(maxIndex)çš„å€¼è€Œå·²ï¼›åœ¨åˆ é™¤ç»„ä»¶æ—¶ï¼Œåªæ˜¯å°†ArrayBufferä¸­è¯¥ç»„ä»¶å¯¹åº”çš„æ•°æ®è¿˜åŸä¸ºé»˜è®¤å€¼è€Œå·²</p></li></ul><ul><li><p>èŒè´£åˆ’åˆ†æ˜ç¡®ï¼Œè¡Œä¸ºçš„é€»è¾‘åº”è¯¥æ”¾åœ¨å“ªé‡Œå¾ˆæ¸…æ¥š<br>
<!-- -->å¯¹äºåªæ¶‰åŠåˆ°æ“ä½œä¸€ç§ç»„ä»¶çš„è¡Œä¸ºé€»è¾‘ï¼Œåˆ™å°†å…¶æ”¾åœ¨è¯¥ç»„ä»¶å¯¹åº”çš„Managerï¼ˆå¦‚å°†batchUpdate positionçš„é€»è¾‘æ”¾åˆ°PositionComponentManagerçš„batchUpdateå‡½æ•°ä¸­ï¼‰ï¼›æ¶‰åŠåˆ°å¤šç§ç»„ä»¶çš„è¡Œä¸ºé€»è¾‘åˆ™æ”¾åœ¨å¯¹åº”çš„Systemä¸­ï¼ˆå¦‚å°†é£è¡Œè¡Œä¸ºæ”¾åˆ°FlySystemä¸­ï¼‰ï¼›</p></li><li><p>å¢åŠ è¡Œä¸ºå¾ˆå®¹æ˜“<br>
<!-- -->å› ä¸ºä¸€ä¸ªè¡Œä¸ºå¯¹åº”ä¸€ä¸ªSystemï¼Œæ‰€ä»¥è¦å¢åŠ ä¸€ä¸ªè¡Œä¸ºï¼Œåˆ™åªéœ€å¢åŠ ä¸€ä¸ªå¯¹åº”çš„Systemå³å¯ï¼Œè¿™ä¸ä¼šå½±å“åˆ°Managerã€‚å¦å¤–ï¼Œå› ä¸ºSystemåªæœ‰é€»è¾‘æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥å¢åŠ å’Œç»´æŠ¤Systemå¾ˆå®¹æ˜“</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼ºç‚¹">ç¼ºç‚¹<a class="hash-link" href="#ç¼ºç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li>éœ€è¦è½¬æ¢ä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„æ€ç»´<br>ä¹ æƒ¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„åŒå­¦å€¾å‘äºè®¾è®¡ä¸€ä¸ªåŒ…æ‹¬æ•°æ®å’Œé€»è¾‘çš„ç»„ä»¶ç±»ï¼Œè€ŒECSæ¨¡å¼åˆ™å°†å…¶æ‰å¹³åŒ–ä¸ºä¸€ä¸ªå€¼å¯¹è±¡ï¼Œè¿™ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹ä¸­ä¸€åˆ‡éƒ½æ˜¯æ•°æ®çš„æ€ç»´æ¨¡å¼ã€‚<br>å¦å¤–ï¼ŒECSä¸­çš„Systemå…¶å®å°±åªæ˜¯ä¸€ä¸ªå‡½æ•°è€Œå·²ï¼Œæœ¬èº«æ²¡æœ‰æ•°æ®ï¼Œè¿™ä¹Ÿç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹ä¸­å‡½æ•°æ˜¯ç¬¬ä¸€å…¬æ°‘çš„æ€ç»´æ¨¡å¼ã€‚<br>ç»ˆä¸Šæ‰€è¿°ï¼Œå¦‚æœä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼çš„åŒå­¦èƒ½å¤Ÿæ›´å®¹æ˜“åœ°ä½¿ç”¨ECSæ¨¡å¼</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯<a class="hash-link" href="#ä½¿ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åœºæ™¯æè¿°">åœºæ™¯æè¿°<a class="hash-link" href="#åœºæ™¯æè¿°" title="Direct link to heading">â€‹</a></h4><p>æ¸¸æˆçš„åœºæ™¯ä¸­æœ‰å¾ˆå¤šç§ç±»çš„äººç‰©ï¼Œäººç‰©çš„è¡Œä¸ºå¾ˆå¤šæˆ–è€…å¾ˆå¤æ‚</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å…·ä½“æ¡ˆä¾‹">å…·ä½“æ¡ˆä¾‹<a class="hash-link" href="#å…·ä½“æ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h4><ul><li><p>æœ‰å¾ˆå¤šç§ç±»çš„æ¸¸æˆäººç‰©<br>
<!-- -->é€šè¿‡æŒ‚è½½ä¸åŒçš„ç»„ä»¶åˆ°GameObjectï¼Œæ¥å®ç°ä¸åŒç§ç±»çš„æ¸¸æˆäººç‰©ï¼Œä»£æ›¿ç»§æ‰¿</p></li><li><p>æ¸¸æˆäººç‰©æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œè€Œä¸”è¿˜ç»å¸¸ä¼šå¢åŠ æ–°çš„è¡Œä¸º<br>
<!-- -->å› ä¸ºæ¯ä¸ªè¡Œä¸ºå¯¹åº”ä¸€ä¸ªSystemï¼Œæ‰€ä»¥å¢åŠ ä¸€ä¸ªæ–°çš„è¡Œä¸ºå°±æ˜¯å¢åŠ ä¸€ä¸ªSystemã€‚ä¸ç®¡è¡Œä¸ºå¦‚ä½•å˜åŒ–ï¼Œåªå½±å“Systemå±‚ï¼Œä¸ä¼šå½±å“ä½œä¸ºä¸‹å±‚çš„Managerå±‚å’ŒGameObjectã€Componentå±‚</p></li><li><p>å¯¹äºå¼•æ“è€Œè¨€ï¼ŒECSæ¨¡å¼ä¸»è¦ç”¨åœ¨åœºæ™¯ç®¡ç†è¿™å—</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹<a class="hash-link" href="#æ³¨æ„äº‹é¡¹" title="Direct link to heading">â€‹</a></h3><ul><li>å› ä¸ºç»„ä»¶çš„ArrayBufferä¸€æ—¦åœ¨åˆ›å»ºåï¼Œå®ƒçš„å¤§å°å°±ä¸ä¼šæ”¹åŠ¨ï¼Œæ‰€ä»¥æœ€å¥½åœ¨åˆ›å»ºæ—¶æŒ‡å®šè¶³å¤Ÿå¤§çš„æœ€å¤§ç»„ä»¶ä¸ªæ•°</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆå…¶å®ƒæ¨¡å¼">ç»“åˆå…¶å®ƒæ¨¡å¼<a class="hash-link" href="#ç»“åˆå…¶å®ƒæ¨¡å¼" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆå¤šçº¿ç¨‹æ¨¡å¼">ç»“åˆå¤šçº¿ç¨‹æ¨¡å¼<a class="hash-link" href="#ç»“åˆå¤šçº¿ç¨‹æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœå¼•æ“å¼€äº†å¤šä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥å°†ç»„ä»¶çš„ArrayBufferæ”¹ä¸ºSharedArrayBufferã€‚è¿™æ ·çš„è¯å°±å¯ä»¥å°†å…¶ç›´æ¥å…±äº«åˆ°å„ä¸ªçº¿ç¨‹ä¸­è€Œä¸éœ€è¦æ‹·è´ï¼Œä»è€Œæé«˜äº†æ€§èƒ½</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆç®¡é“æ¨¡å¼">ç»“åˆç®¡é“æ¨¡å¼<a class="hash-link" href="#ç»“åˆç®¡é“æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœå¼•æ“ä½¿ç”¨äº†ç®¡é“æ¨¡å¼ï¼Œé‚£ä¹ˆå¯ä»¥å»æ‰Systemï¼Œè€Œä½¿ç”¨ç®¡é“çš„Jobæ¥ä»£æ›¿ã€‚å…¶ä¸­ä¸€ä¸ªJobå°±æ˜¯ä¸€ä¸ªSystem</p><p>å¦å¤–ï¼Œå¯ä»¥å»æ‰WorldStateï¼Œè€Œä½¿ç”¨PipelineManagerStateæ¥ä»£æ›¿</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a class="hash-link" href="#æœ€ä½³å®è·µ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼<a class="hash-link" href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœæ¸¸æˆçš„äººç‰©ç§ç±»å¾ˆå°‘ï¼Œè¡Œä¸ºç®€å•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æœ€å¼€å§‹ç»™å‡ºçš„äººç‰©æ¨¡å—çš„æ–¹æ¡ˆï¼Œå³ä½¿ç”¨ä¸€ä¸ªäººç‰©æ¨¡å—å¯¹åº”ä¸€ç§äººç‰©ï¼Œå¹¶é€šè¿‡ç»§æ‰¿å®ç°å¤šç§äººç‰©ï¼Œè¿™æ ·æœ€å®¹æ˜“å®ç°</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ›´å¤šèµ„æ–™æ¨è">æ›´å¤šèµ„æ–™æ¨è<a class="hash-link" href="#æ›´å¤šèµ„æ–™æ¨è" title="Direct link to heading">â€‹</a></h2><p>ECSçš„æ¦‚å¿µæœ€å…ˆæ˜¯ç”±â€œå®ˆæœ›å…ˆé”‹â€æ¸¸æˆçš„å¼€å‘è€…æå‡ºçš„ï¼Œè¯¦ç»†èµ„æ–™å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢â€œã€Šå®ˆæœ›å…ˆé”‹ã€‹æ¶æ„è®¾è®¡å’Œç½‘ç»œåŒæ­¥â€</p><p>ECSæ¨¡å¼æ˜¯åœ¨â€œç»„ä»¶åŒ–â€ã€â€œData Orientedâ€åŸºç¡€ä¸Šå‘å±•è€Œæ¥ï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæœç´¢æ›´å¤šå…³äºâ€œç»„ä»¶åŒ–â€ã€â€œData Orientedâ€ã€â€œECSâ€çš„èµ„æ–™</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ECSæ¨¡å¼/ECSæ¨¡å¼.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ç¬¬4ç«  ç®¡é“æ¨¡å¼</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„" class="table-of-contents__link toc-highlight">æ™®é€šè‹±é›„å’Œè¶…çº§è‹±é›„</a><ul><li><a href="#éœ€æ±‚" class="table-of-contents__link toc-highlight">éœ€æ±‚</a></li><li><a href="#å®ç°æ€è·¯" class="table-of-contents__link toc-highlight">å®ç°æ€è·¯</a></li><li><a href="#ç»™å‡ºuml" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»™å‡ºä»£ç " class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³æ”¹è¿›" class="table-of-contents__link toc-highlight">åŸºäºç»„ä»¶åŒ–çš„æ€æƒ³æ”¹è¿›</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-1" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -1" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜-1" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#ä½¿ç”¨ecsæ¨¡å¼æ¥æ”¹è¿›" class="table-of-contents__link toc-highlight">ä½¿ç”¨ECSæ¨¡å¼æ¥æ”¹è¿›</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ-1" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-2" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜-1" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -2" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li></ul></li><li><a href="#å®šä¹‰" class="table-of-contents__link toc-highlight">å®šä¹‰</a><ul><li><a href="#ä¸€å¥è¯å®šä¹‰" class="table-of-contents__link toc-highlight">ä¸€å¥è¯å®šä¹‰</a></li><li><a href="#è¡¥å……è¯´æ˜" class="table-of-contents__link toc-highlight">è¡¥å……è¯´æ˜</a></li><li><a href="#é€šç”¨uml" class="table-of-contents__link toc-highlight">é€šç”¨UML</a></li><li><a href="#è§’è‰²çš„æŠ½è±¡ä»£ç " class="table-of-contents__link toc-highlight">è§’è‰²çš„æŠ½è±¡ä»£ç </a></li><li><a href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" class="table-of-contents__link toc-highlight">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°</a></li></ul></li><li><a href="#åº”ç”¨" class="table-of-contents__link toc-highlight">åº”ç”¨</a><ul><li><a href="#ä¼˜ç‚¹" class="table-of-contents__link toc-highlight">ä¼˜ç‚¹</a></li><li><a href="#ç¼ºç‚¹" class="table-of-contents__link toc-highlight">ç¼ºç‚¹</a></li><li><a href="#ä½¿ç”¨åœºæ™¯" class="table-of-contents__link toc-highlight">ä½¿ç”¨åœºæ™¯</a></li><li><a href="#æ³¨æ„äº‹é¡¹" class="table-of-contents__link toc-highlight">æ³¨æ„äº‹é¡¹</a></li></ul></li><li><a href="#ç»“åˆå…¶å®ƒæ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆå…¶å®ƒæ¨¡å¼</a><ul><li><a href="#ç»“åˆå¤šçº¿ç¨‹æ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆå¤šçº¿ç¨‹æ¨¡å¼</a></li><li><a href="#ç»“åˆç®¡é“æ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆç®¡é“æ¨¡å¼</a></li></ul></li><li><a href="#æœ€ä½³å®è·µ" class="table-of-contents__link toc-highlight">æœ€ä½³å®è·µ</a><ul><li><a href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" class="table-of-contents__link toc-highlight">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼</a></li></ul></li><li><a href="#æ›´å¤šèµ„æ–™æ¨è" class="table-of-contents__link toc-highlight">æ›´å¤šèµ„æ–™æ¨è</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items"><li class="footer__item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=SaSgwsyiccUjc3Mx3Jqliv9HJnHxL-WI&amp;jump_from=webapi&amp;authKey=+EQRAdLQ80spfX++pA3UB4erf6cxC+Mo4jH6bfovhdE7MOvI5WBUljCZ6roGaNZh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä¸ä½œè€…äº¤æµåŠ QQç¾¤<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/dreamforest-yyc" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cnblogs.com/chaogex/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/3dProgramPattern/assets/js/runtime~main.3eacf1e8.js"></script>
<script src="/3dProgramPattern/assets/js/main.c6dc4a90.js"></script>
</body>
</html>