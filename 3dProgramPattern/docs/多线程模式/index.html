<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼"><meta data-react-helmet="true" name="description" content="å‰ç½®è¦æ±‚"><meta data-react-helmet="true" property="og:description" content="å‰ç½®è¦æ±‚"><link data-react-helmet="true" rel="canonical" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/" hreflang="x-default"><link rel="stylesheet" href="/3dProgramPattern/assets/css/styles.e233dcee.css">
<link rel="preload" href="/3dProgramPattern/assets/js/runtime~main.d951e469.js" as="script">
<link rel="preload" href="/3dProgramPattern/assets/js/main.c6dc4a90.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/3dProgramPattern/"><b class="navbar__title">3Dç¼–ç¨‹æ¨¡å¼</b></a><a class="navbar__item navbar__link navbar__link--active" href="/3dProgramPattern/docs/å‰è¨€">å†…å®¹</a><a href="https://github.com/yyc-git/3DProgramPattern" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">å¼€ç¯‡</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å‰è¨€">å‰è¨€</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">ç¬¬ä¸€éƒ¨åˆ† ç¬¬1ç«  å†çœ‹è®¾è®¡åŸåˆ™</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/è®¾è®¡åŸºç¡€/">1.1 è®¾è®¡åŸºç¡€</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å•ä¸€èŒè´£åŸåˆ™/">1.2 å•ä¸€èŒè´£åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/åˆæˆå¤ç”¨åŸåˆ™/">1.3 åˆæˆå¤ç”¨åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æ¥å£éš”ç¦»åŸåˆ™/">1.4 æ¥å£éš”ç¦»åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/ä¾èµ–å€’ç½®åŸåˆ™/">1.5 ä¾èµ–å€’ç½®åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æœ€å°‘çŸ¥è¯†åŸåˆ™/">1.6 æœ€å°‘çŸ¥è¯†åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å¼€é—­åŸåˆ™/">1.7 å¼€é—­åŸåˆ™</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">ç¬¬äºŒéƒ¨åˆ† 7ç§ç¼–ç¨‹æ¨¡å¼</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ä¾èµ–éš”ç¦»æ¨¡å¼/">ç¬¬2ç«  ä¾èµ–éš”ç¦»æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç§¯æœ¨æ¨¡å¼/">ç¬¬3ç«  ç§¯æœ¨æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/">ç¬¬4ç«  ç®¡é“æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ECSæ¨¡å¼/">ç¬¬5ç«  ECSæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/">ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å‰ç½®è¦æ±‚">å‰ç½®è¦æ±‚<a class="hash-link" href="#å‰ç½®è¦æ±‚" title="Direct link to heading">â€‹</a></h2><p>è¯·å…ˆé˜…è¯»â€œECSæ¨¡å¼â€ã€â€œç®¡é“æ¨¡å¼â€</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å•çº¿ç¨‹">å•çº¿ç¨‹<a class="hash-link" href="#å•çº¿ç¨‹" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éœ€æ±‚">éœ€æ±‚<a class="hash-link" href="#éœ€æ±‚" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬å¼€å‘ä¸€ä¸ªå¼•æ“ï¼Œéœ€è¦å®ç°ä¸‹é¢çš„åŠŸèƒ½ï¼š</p><ul><li>æ¸²æŸ“åŒ…æ‹¬8000ä¸ªä¸‰è§’å½¢çš„å¤§å‹åœºæ™¯</li><li>æ¯å¸§è¿›è¡Œç‰©ç†è®¡ç®—ï¼Œè®¡ç®—å¹¶æ›´æ–°æ¯ä¸ªä¸‰è§’å½¢çš„ä½ç½®</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å®ç°æ€è·¯">å®ç°æ€è·¯<a class="hash-link" href="#å®ç°æ€è·¯" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†ç®€å•ã€å¿«é€Ÿåœ°å®ç°ï¼Œæˆ‘ä»¬å…ˆåœ¨å•çº¿ç¨‹çš„è¿è¡Œç¯å¢ƒä¸­æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯è®©å¼•æ“åªè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ã€‚<br>
<!-- -->æˆ‘ä»¬ä½¿ç”¨ECSæ¨¡å¼ä¸­çš„Managerå±‚å’ŒComponent+GameObjectå±‚æ¥åˆ›å»ºå’Œç®¡ç†åœºæ™¯ï¼Œå°†åœºæ™¯æ•°æ®ä¿å­˜åœ¨ç»„ä»¶çš„Bufferä¸­ã€‚<br>
<!-- -->æˆ‘ä»¬ä½¿ç”¨ç®¡é“æ¨¡å¼çš„ç®¡é“æ¥å®ç°å¼•æ“çš„åˆå§‹åŒ–ã€æ›´æ–°å’Œæ¸²æŸ“çš„é€»è¾‘ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ³¨å†Œä¸€ä¸ªPipelineç®¡é“æ¨¡å—ï¼Œå®ƒåŒ…æ‹¬Init Pipelineã€Update Pipelineã€Render Pipelineè¿™ä¸‰ä¸ªç®¡é“ï¼Œå®ƒä»¬åˆ†åˆ«æœ‰åˆå§‹åŒ–ã€æ›´æ–°å’Œæ¸²æŸ“ç›¸å…³çš„Jobã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/Domain-5797893eb85f20f3f9956b53e7200eae.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€é—¨æˆ·ã€ç®¡é“ã€Manager+Component+GameObjectè¿™å››ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ç”¨æˆ·ã€é—¨æˆ·è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>WorldForNoWorkeræ˜¯é—¨æˆ·ï¼Œæä¾›äº†å¼•æ“çš„API</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ç®¡é“è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>PipelineManagerè´Ÿè´£ç®¡ç†ç®¡é“</p><p>NoWorkerPipelineæ˜¯æ³¨å†Œçš„ç®¡é“æ¨¡å—</p><p>Init Pipelineæ˜¯åˆå§‹åŒ–ç®¡é“ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–ç›¸å…³çš„Jobï¼Œå®ç°äº†åˆå§‹åŒ–çš„é€»è¾‘</p><p>Update Pipelineæ˜¯æ›´æ–°ç®¡é“ï¼ŒåŒ…æ‹¬æ›´æ–°ç›¸å…³çš„Jobï¼Œå®ç°äº†æ›´æ–°çš„é€»è¾‘</p><p>Render Pipelineæ˜¯æ¸²æŸ“ç®¡é“ï¼ŒåŒ…æ‹¬æ¸²æŸ“ç›¸å…³çš„Jobï¼Œå®ç°äº†æ¸²æŸ“çš„é€»è¾‘</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹Manager+Component+GameObjectè¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Manager+Component+GameObjectæ˜¯ECSæ¨¡å¼ä¸­çš„Managerå±‚å’ŒComponent+GameObjectå±‚ï¼Œç”¨æ¥åˆ›å»ºå’Œç®¡ç†åœºæ™¯</p><p>åœºæ™¯ä¸­çš„ä¸€ä¸ªä¸‰è§’å½¢å°±æ˜¯ä¸€ä¸ªGameObjectï¼Œå®ƒæŒ‚è½½äº†ä¸¤ç§ç»„ä»¶ï¼šTransformComponentã€BasicMaterialComponentï¼Œå…¶ä¸­å‰è€…è´Ÿè´£ç»´æŠ¤ä¸‰è§’å½¢çš„ä½ç§»æ•°æ®ï¼Œå¦‚ä½ç½®ã€æ¨¡å‹çŸ©é˜µï¼›åè€…è´Ÿè´£ç»´æŠ¤ä¸‰è§’å½¢çš„æè´¨æ•°æ®ï¼Œå¦‚é¢œè‰²</p><p>GameObjectManagerè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„gameObject</p><p>TransformComponentManagerè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„TransformComponentç»„ä»¶</p><p>BasicMaterialComponentManagerè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„BasicMaterialComponentç»„ä»¶</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¾èµ–å…³ç³»ï¼š</p><p>Jobè°ƒç”¨äº†Manager+Component+GameObjectæ¥è¯»å†™åœºæ™¯æ•°æ®</p><p>WorldForNoWorkerè°ƒç”¨äº†Manager+Component+GameObjectæ¥åˆ›å»ºåœºæ™¯</p><p><strong>åˆå§‹åŒ–æµç¨‹</strong></p><p><img alt="åˆå§‹åŒ–æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Init_Flow-d7492d3ba41366abe028c29bddedb4f2.png"></p><p>Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Init Pipelineçš„Job</p><p>åˆå§‹åŒ–è¿è¡Œäº†ä¸»çº¿ç¨‹çš„Init Pipeline</p><p>æˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š</p><ul><li>åˆå§‹åŒ–</li></ul><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œCreate GLâ€Jobä¸­åˆ›å»ºäº†WebGLä¸Šä¸‹æ–‡<br>
<!-- -->2.åœ¨â€œInit VBOâ€Jobä¸­åˆå§‹åŒ–VBO<br>
<!-- -->3.åœ¨â€œInit Materialâ€Jobä¸­åˆå§‹åŒ–æè´¨</p><p><strong>ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹</strong></p><p><img alt="ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Loop_Flow-6e60098b7e8100d3b8872a40a48bb72c.png"></p><p>Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Update Pipelineå’ŒRender Pipelineçš„Job</p><p>ä¸»å¾ªç¯çš„ä¸€å¸§ä¾æ¬¡è¿›è¡Œäº†æ›´æ–°å’Œæ¸²æŸ“ï¼Œå…¶ä¸­åœ¨â€œæ›´æ–°â€ä¸­ï¼Œè¿è¡Œäº†ä¸»çº¿ç¨‹çš„Update Pipelineï¼›åœ¨â€œæ¸²æŸ“â€ä¸­ï¼Œè¿è¡Œäº†ä¸»çº¿ç¨‹çš„Render Pipeline</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Update Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š</p><ul><li>æ›´æ–°</li></ul><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œCompute Physics And Updateâ€Jobä¸­è¿›è¡Œç‰©ç†è®¡ç®—ï¼Œè®¡ç®—å¹¶æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®<br>
<!-- -->2.åœ¨â€œUpdate Transformâ€Jobä¸­æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„æ¨¡å‹çŸ©é˜µ</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Render Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š</p><ul><li>æ¸²æŸ“</li></ul><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œSend Uniform Shader Dataâ€Jobä¸­å‘é€ç›¸æœºæ•°æ®åˆ°GPU<br>
<!-- -->2.åœ¨â€œRenderâ€Jobä¸­æ¸²æŸ“</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç ">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç " title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºWorldStateçš„ä»£ç </li><li>åˆ›å»ºåœºæ™¯çš„ä»£ç </li></ul><p>ç„¶åï¼Œå› ä¸ºClientä¼šæ³¨å†ŒNoWorkerPipelineï¼Œå®ƒåŒ…æ‹¬Init Pipelineã€Update Pipelineã€Render Pipelineè¿™ä¸‰ä¸ªç®¡é“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹å„ä¸ªç®¡é“çš„Jobçš„ä»£ç ï¼›<br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­å‰©ä½™çš„ä¸¤ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–çš„ä»£ç </li><li>ä¸»å¾ªç¯çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç ">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForNoWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> transformComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> basicMaterialComponentCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ClientUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ³¨å†ŒNoWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForNoWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clienté¦–å…ˆè°ƒç”¨WorldForNoWorkerçš„createStateå‡½æ•°å¹¶ä¼ å…¥æœ€å¤§çš„ç»„ä»¶ä¸ªæ•°ï¼Œåˆ›å»ºäº†WorldStateï¼Œç”¨æ¥ä¿å­˜å¼•æ“æ‰€æœ‰çš„æ•°æ®ï¼›ç„¶ååˆ›å»ºåœºæ™¯ï¼›ç„¶åæ³¨å†Œäº†NoWorkerPipelineï¼›ç„¶ååˆå§‹åŒ–ï¼›æœ€åä¸»å¾ªç¯</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºworldstateçš„ä»£ç ">åˆ›å»ºWorldStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºworldstateçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>WorldForNoWorker</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> transformComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> basicMaterialComponentCount </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ecsData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gameObjectManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GameObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transformComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TransformComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transformComponentCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            basicMaterialComponentManagerState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> BasicMaterialComponentManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">basicMaterialComponentCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelineState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PipelineManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†WorldStateï¼Œå®ƒåŒ…æ‹¬åœºæ™¯æ•°æ®å’Œç®¡é“æ•°æ®ï¼Œå…¶ä¸­åœºæ™¯æ•°æ®æ¥è‡ªå„ä¸ªManagerçš„stateï¼Œç®¡é“æ•°æ®æ¥è‡ªPipelineManagerState</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºåœºæ™¯çš„ä»£ç ">åˆ›å»ºåœºæ™¯çš„ä»£ç <a class="hash-link" href="#åˆ›å»ºåœºæ™¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ClientUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _createTriangle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> position</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºä¸€ä¸ªtriangleGameObjectã€ä¸€ä¸ªtransformComponentã€ä¸€ä¸ªbasicMaterialComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æŒ‚è½½è¿™ä¸¤ä¸ªç»„ä»¶åˆ°è¯¥triangleGameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®è¯¥transformComponentçš„positionä¸ºposition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®è¯¥basicMaterialComponentçš„colorä¸ºcolor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> worldState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createScene </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//æ‰§è¡Œ_createTriangleå‡½æ•°countæ¬¡ï¼Œåˆ›å»ºäº†countä¸ªä¸‰è§’å½¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_createTriangle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> éšæœºçš„color</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> éšæœºçš„color</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createSceneå‡½æ•°åˆ›å»ºäº†åœºæ™¯ï¼Œåœºæ™¯åŒ…æ‹¬äº†8000ä¸ªä¸‰è§’å½¢ã€‚æ¯ä¸ªä¸‰è§’å½¢éƒ½æ˜¯ä¸€ä¸ªGameObjectï¼Œå®ƒæŒ‚è½½äº†ä¸¤ç§ç»„ä»¶ï¼šTransformComponentã€BasicMaterialComponentã€‚æ¯ä¸ªä¸‰è§’å½¢çš„ä½ç½®ã€é¢œè‰²éƒ½æ˜¯éšæœºå€¼</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å„ä¸ªç®¡é“çš„jobçš„ä»£ç ">å„ä¸ªç®¡é“çš„Jobçš„ä»£ç <a class="hash-link" href="#å„ä¸ªç®¡é“çš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Init Pipelineç®¡é“çš„å„ä¸ªJobçš„ä»£ç ï¼š<br>
<!-- -->CreateGLJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»canvasä¸­è·å¾—WebGLä¸Šä¸‹æ–‡ï¼Œå¹¶ä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºäº†WebGLä¸Šä¸‹æ–‡</p><p>InitVBOJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå¹¶åˆå§‹åŒ–</span><span class="token constant" style="color:#36acaa">VBO</span><span class="token plain">ï¼Œå¹¶ä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆå§‹åŒ–VBO</p><p>InitMaterialJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå¹¶åˆå§‹åŒ–Programï¼Œå¹¶ä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆå§‹åŒ–æè´¨ã€‚å› ä¸ºåªæœ‰ä¸€ç§æè´¨ï¼ˆBasicMaterialComponentï¼‰ï¼Œè€Œè¯¥æè´¨åªå¯¹åº”ä¸€ä¸ªProgramï¼Œæ‰€ä»¥è¿™é‡Œåªåˆ›å»ºäº†ä¸€ä¸ªProgram</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Update Pipelineç®¡é“çš„å„ä¸ªJobçš„ä»£ç ï¼š<br>
<!-- -->ComputePhysicsAndUpdateJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿›è¡Œä¸€äº›ç‰©ç†è®¡ç®—</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç”¨è®¡ç®—ç»“æœæ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobè¿›è¡Œç‰©ç†è®¡ç®—ï¼Œè®¡ç®—å¹¶æ›´æ–°äº†æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®</p><p>UpdateTransformJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„æ¨¡å‹çŸ©é˜µ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹Render Pipelineç®¡é“çš„å„ä¸ªJobçš„ä»£ç ï¼š<br>
<!-- -->SendUniformShaderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ„é€ å‡çš„ç›¸æœºæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    éå†æ¯ä¸ªProgramï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        å‘é€ç›¸æœºæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobè´Ÿè´£å‘é€åªä¸Shaderç›¸å…³çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åªä¸Programç›¸å…³çš„æ•°æ®ã€‚å› ä¸ºç›®å‰åªæœ‰ç›¸æœºæ•°æ®ï¼ˆè§†å›¾çŸ©é˜µã€æŠ•å½±çŸ©é˜µï¼‰å±äºè¿™ç±»æ•°æ®ï¼Œæ‰€ä»¥è¯¥Jobåªå‘é€äº†ç›¸æœºæ•°æ®åˆ°GPU</p><p>RenderJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ¸…ç©ºcanvas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    éå†åœºæ™¯ä¸­æ‰€æœ‰çš„gameObjectï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—gameObjectæŒ‚è½½çš„ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—æ¸²æŸ“çš„ç›¸å…³æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        æ¸²æŸ“è¯¥gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobæ¸²æŸ“åœºæ™¯ä¸­æ‰€æœ‰çš„ä¸‰è§’å½¢</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–çš„ä»£ç ">åˆå§‹åŒ–çš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>WorldForNoWorker</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–ç®¡é“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡Œäº†Init Pipelineç®¡é“ï¼Œæ‰§è¡Œå…¶ä¸­çš„Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initå‡½æ•°å®ç°äº†åˆå§‹åŒ–</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»å¾ªç¯çš„ä»£ç ">ä¸»å¾ªç¯çš„ä»£ç <a class="hash-link" href="#ä¸»å¾ªç¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_loop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WorldForNoWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WorldForNoWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForNoWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_loopå‡½æ•°å®ç°äº†ä¸»å¾ªç¯ï¼Œå…¶ä¸­ä¸»å¾ªç¯çš„ä¸€å¸§è°ƒç”¨äº†WorldForNoWorkerçš„updateå’Œrenderå‡½æ•°æ¥åˆ†åˆ«è¿›è¡Œæ›´æ–°å’Œæ¸²æŸ“ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç›¸å…³ä»£ç ï¼š<br>
<!-- -->WorldForNoWorker</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡Œäº†Update Pipelineç®¡é“ï¼Œæ‰§è¡Œå…¶ä¸­çš„Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿è¡Œäº†Render Pipelineç®¡é“ï¼Œæ‰§è¡Œå…¶ä¸­çš„Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«è¿è¡Œäº†å¯¹åº”çš„ç®¡é“ï¼Œè¿›è¡Œäº†æ›´æ–°æˆ–è€…æ¸²æŸ“</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç ">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>è¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š
<img alt="è¿è¡Œæˆªå›¾" src="/3dProgramPattern/assets/images/Result-9a4c3bd0412113b42d62f18071ab529d.png"></p><p>è¯¥åœºæ™¯åŒ…æ‹¬äº†8000ä¸ªä¸‰è§’å½¢ï¼Œå…¶ä¸­åé¢çš„ä¸‰è§’å½¢è¢«å‰é¢çš„ä¸‰è§’å½¢é®æŒ¡äº†</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li>æ€§èƒ½å·®<br>å› ä¸ºåœºæ™¯ä¸­ä¸‰è§’å½¢è¿‡å¤šï¼Œå¯¼è‡´FPSè¾ƒä½</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥æ”¹è¿›">ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥æ”¹è¿›<a class="hash-link" href="#ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ul><li>å¼€ä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹å’Œä¸€ä¸ªç‰©ç†çº¿ç¨‹<br>ç›®å‰æ‰€æœ‰çš„é€»è¾‘éƒ½è¿è¡Œåœ¨ä¸»çº¿ç¨‹ã€‚å› ä¸ºç°ä»£CPUéƒ½æ˜¯å¤šæ ¸çš„ï¼Œæ¯ä¸ªæ ¸å¯ä»¥è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ç°ä»£CPUéƒ½æ”¯æŒå¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¿è¡Œã€‚å› æ­¤ï¼Œå¯ä»¥å¼€ä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹å’Œä¸€ä¸ªç‰©ç†çº¿ç¨‹ï¼Œå…¶ä¸­å‰è€…è´Ÿè´£æ¸²æŸ“ï¼Œåè€…è´Ÿè´£ç‰©ç†è®¡ç®—ã€‚è®©å®ƒä»¬å’Œä¸»çº¿ç¨‹å¹¶è¡Œè¿è¡Œï¼Œä»è€Œå¯ä»¥æé«˜FPSã€‚<br>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>æ¸²æŸ“çº¿ç¨‹åªè¯»ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œç‰©ç†çº¿ç¨‹æ—¢è¯»åˆå†™ä¸»çº¿ç¨‹çš„æ•°æ®</li></ul><p>ä¸ºäº†é¿å…ç‰©ç†çº¿ç¨‹å†™ä¸»çº¿ç¨‹çš„æ•°æ®é€ æˆå†²çªï¼Œé¦–å…ˆå¤‡ä»½ç‰©ç†çº¿ç¨‹éœ€è¦å†™çš„ä¸»çº¿ç¨‹æ•°æ®ï¼›ç„¶åè®©ç‰©ç†çº¿ç¨‹å°†è¦å†™çš„æ•°æ®å†™åˆ°å¤‡ä»½æ•°æ®ä¸­ï¼›æœ€ååœ¨ä¸»çº¿ç¨‹çš„åŒæ­¥é˜¶æ®µè¯»å–å¤‡ä»½æ•°æ®ï¼Œå°†å…¶æ›´æ–°åˆ°ä¸»çº¿ç¨‹çš„æ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-1">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-1" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong>
<img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/Domain-7b182f79dc419fd1c284c0f2e38c9ef0.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºMain Workerã€Render Workerã€Physics Workerè¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main Workerå¯¹åº”ä¸»çº¿ç¨‹ï¼ŒåŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„æ¨¡å—ï¼›Render Workerå¯¹åº”æ¸²æŸ“çº¿ç¨‹ï¼ŒåŒ…æ‹¬äº†è¿è¡Œåœ¨æ¸²æŸ“çº¿ç¨‹çš„æ¨¡å—ï¼›Physics Workerå¯¹åº”ç‰©ç†çº¿ç¨‹ï¼ŒåŒ…æ‹¬äº†è¿è¡Œåœ¨ç‰©ç†çº¿ç¨‹çš„æ¨¡å—</p><p>è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„æ¨¡å—ç»“æ„è·Ÿä¹‹å‰çš„é¢†åŸŸæ¨¡å‹çš„æ¨¡å—ç»“æ„ä¸€æ ·ï¼Œåªæ˜¯å…¶ä¸­çš„ç”¨æˆ·ã€é—¨æˆ·ã€ç®¡é“è¿™å‡ ä¸ªéƒ¨åˆ†ä¸­çš„æ¨¡å—ä¸ä¸€æ ·ã€‚å…·ä½“ä¸ä¸€æ ·çš„åœ°æ–¹å¦‚ä¸‹ï¼š<br>
<!-- -->è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„ç”¨æˆ·åˆ†åˆ«ä¸ºClientã€RenderWorkerMainã€PhysicsWorkerMain<br>
<!-- -->è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„é—¨æˆ·åˆ†åˆ«ä¸ºWorldForMainWorkerã€WorldForRenderWorkerã€WorldForPhysicsWorker<br>
<!-- -->è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„ç®¡é“æ¨¡å—åˆ†åˆ«ä¸ºMainWorkerPipelineã€RenderWorkerPipelineã€PhysicsWorkerPipeline<br>
<!-- -->è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„ç®¡é“åˆ†åˆ«ä¸ºï¼š</p><ul><li>Init Pipelineã€Update Pipelineã€Sync Pipeline</li><li>Init Pipelineã€Render Pipeline</li><li>Init Pipelineã€Update Pipeline</li></ul><p>çº¿ç¨‹ä¹‹é—´éœ€è¦ä¼ é€æ•°æ®ï¼Œä¼ é€çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼šæ‹·è´æˆ–è€…å…±äº«ã€‚åœ¨é¢†åŸŸæ¨¡å‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´åªæ ‡æ˜äº†â€œå…±äº«â€è¿™ç§æ–¹å¼ï¼Œå…·ä½“æ˜¯ä¸»çº¿ç¨‹å‘å…¶å®ƒä¸¤ä¸ªçº¿ç¨‹å…±äº«äº†æ•°æ®ï¼Œè¿™é‡Œä»‹ç»å…±äº«äº†ä»€ä¹ˆæ•°æ®ï¼š<br>
<!-- -->ä¸»çº¿ç¨‹å°†canvasé€šè¿‡OffscreenCavnas APIå…±äº«åˆ°æ¸²æŸ“çº¿ç¨‹ï¼Œä½¿æ¸²æŸ“çº¿ç¨‹ä»ä¸­è·å¾—WebGLä¸Šä¸‹æ–‡ï¼›<br>
<!-- -->æˆ‘ä»¬è®¾ç½®ä¸¤ç§ç»„ä»¶çš„ä¸¤ä¸ªBufferä¸ºSharedArrayBufferï¼Œåœ¨ä¸»çº¿ç¨‹åˆ›å»ºå®ƒä»¬ï¼Œå°†å®ƒä»¬ä»ä¸»çº¿ç¨‹å…±äº«åˆ°æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹ï¼Œä»è€Œä½¿è¿™ä¸¤ä¸ªçº¿ç¨‹èƒ½å¤Ÿä»ä¸­ç›´æ¥è¯»å†™ç»„ä»¶ä¸­çš„åœºæ™¯æ•°æ®ï¼›<br>
<!-- -->ä¸»çº¿ç¨‹åˆ›å»ºäº†RenderWorkerDataçš„Bufferï¼Œå®ƒä¹Ÿæ˜¯SharedArrayBufferï¼Œç”¨æ¥ä¿å­˜åœºæ™¯ä¸­æ‰€æœ‰çš„transformComponentå’ŒbasicMaterialComponentç»„ä»¶ã€‚ä¸»çº¿ç¨‹å°†å…¶å…±äº«ç»™æ¸²æŸ“çº¿ç¨‹ï¼Œä½¿æ¸²æŸ“çº¿ç¨‹èƒ½å¤Ÿä½¿ç”¨å®ƒä»¬æ¥ä»ç»„ä»¶çš„Bufferä¸­è¯»å–åˆ°åœºæ™¯æ•°æ®ï¼›<br>
<!-- -->ä¸»çº¿ç¨‹åˆ›å»ºäº†PhysicsWorkerDataçš„Bufferï¼Œå®ƒä¹Ÿæ˜¯SharedArrayBufferï¼Œå±äºå¤‡ä»½æ•°æ®ï¼Œç”¨æ¥ä¿å­˜ç‰©ç†çº¿ç¨‹é€šè¿‡ç‰©ç†è®¡ç®—è®¡ç®—çš„ç»“æœã€‚ä¸»çº¿ç¨‹å°†å…¶å…±äº«ç»™ç‰©ç†çº¿ç¨‹ï¼Œä½¿ç‰©ç†çº¿ç¨‹èƒ½å¤Ÿå°†è®¡ç®—ç»“æœå†™è¿›å»</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->SharedArrayBufferèƒ½å¤Ÿç›´æ¥åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼ŒArrayBufferå´ä¸è¡Œ</p><p>ä¸ºä»€ä¹ˆç‰©ç†çº¿ç¨‹ä¸ç›´æ¥å°†è®¡ç®—ç»“æœå†™åˆ°ä¸»çº¿ç¨‹å…±äº«çš„TransformComponentç»„ä»¶çš„Bufferä¸­å‘¢ï¼Ÿå› ä¸ºè¿™ä¼šé€ æˆå†²çªï¼Œæˆ‘ä»¬åé¢å†è¯¦ç»†è®¨è®º</p><p><strong>åˆå§‹åŒ–æµç¨‹</strong>
<img alt="åˆå§‹åŒ–æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Init_Flow-818fa2d17e7e3e52e0bbb593f0bcf832.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œåˆå§‹åŒ–æµç¨‹åˆ†ä¸ºMain Workerã€Render Workerã€Physics Workerè¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Init Pipelineçš„Jobï¼ŒRender WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨æ¸²æŸ“çº¿ç¨‹çš„Init Pipelineçš„Jobï¼ŒPhysics WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ç‰©ç†çº¿ç¨‹çš„Init Pipelineçš„Job </p><p>åˆå§‹åŒ–å¹¶è¡Œè¿è¡Œäº†ä¸»çº¿ç¨‹ã€æ¸²æŸ“çº¿ç¨‹ã€ç‰©ç†çº¿ç¨‹çš„Init Pipeline</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.åˆ›å»ºå…¶å®ƒçº¿ç¨‹çš„workerï¼Œå¯åŠ¨å…¶å®ƒçº¿ç¨‹çš„åˆå§‹åŒ–<br>
<!-- -->2.åˆ›å»ºå…±äº«æ•°æ®ï¼šRenderWorkerDataçš„Bufferã€PhysicsWorkerDataçš„Buffer<br>
<!-- -->3.å‘é€æ•°æ®åˆ°å…¶å®ƒçº¿ç¨‹</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.ä¸»çº¿ç¨‹åœ¨â€œCreate Worker Instanceâ€Jobä¸­åˆ›å»ºäº†æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹çš„workerã€‚è¿™ä¼šæ‰§è¡Œè¿™ä¸¤ä¸ªçº¿ç¨‹çš„ç”¨æˆ·ï¼ˆRenderWorkerMainã€PhysicsWorkerMainï¼‰çš„ä»£ç ï¼Œä»è€Œè¿è¡Œè¿™ä¸¤ä¸ªçº¿ç¨‹çš„Init Pipelineï¼Œå¯åŠ¨å®ƒä»¬çš„åˆå§‹åŒ–<br>
<!-- -->2.ä¸»çº¿ç¨‹ä¼šæ‰§è¡Œä¸‰æ¡å¹¶è¡Œçš„Jobçº¿ï¼Œå…¶ä¸­ç¬¬ä¸€æ¡Jobçº¿ä¾æ¬¡æ‰§è¡Œè¿™äº›Jobé€»è¾‘ï¼š<br>
<!-- -->åœ¨â€œCreate Render Data Bufferâ€Jobä¸­åˆ›å»ºRenderWorkerDataçš„Bufferã€åœ¨â€œCreate Physics Data Bufferâ€Jobä¸­åˆ›å»ºPhysicsWorkerDataçš„Bufferã€åœ¨â€œSend Init Render Dataâ€Jobä¸­å‘æ¸²æŸ“çº¿ç¨‹å‘é€åˆå§‹åŒ–æ•°æ®ã€åœ¨â€œSend Init Physics Dataâ€Jobä¸­å‘ç‰©ç†çº¿ç¨‹å‘é€åˆå§‹åŒ–æ•°æ®ï¼›<br>
<!-- -->ç¬¬äºŒæ¡Jobçº¿ä¾æ¬¡æ‰§è¡Œè¿™äº›Jobé€»è¾‘ï¼šåœ¨â€œGet Finish Send Init Render Dataâ€Jobä¸­ç­‰å¾…æ¸²æŸ“çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤ï¼›<br>
<!-- -->ç¬¬ä¸‰æ¡Jobçº¿ä¾æ¬¡æ‰§è¡Œè¿™äº›Jobé€»è¾‘ï¼šåœ¨â€œGet Finish Send Init Physics Dataâ€Jobä¸­ç­‰å¾…ç‰©ç†çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹æ¸²æŸ“çº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.åˆå§‹åŒ–æ¸²æŸ“</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œGet Init Render Dataâ€Jobä¸­ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸»çº¿ç¨‹å‘é€çš„æ¸²æŸ“æ•°æ®<br>
<!-- -->2.åœ¨â€œInit Data Oriented Componentsâ€Jobä¸­åˆå§‹åŒ–å…±äº«çš„TransformComponentå’ŒBasicMaterialComponent<br>
<!-- -->3.åœ¨â€œCreate Render Data Buffer TypeArrayâ€Jobä¸­åˆ›å»ºRenderWorkerDataçš„Bufferçš„è§†å›¾<br>
<!-- -->4.åœ¨â€œCreate GLâ€Jobä¸­åˆ›å»ºWebGLä¸Šä¸‹æ–‡<br>
<!-- -->5.åœ¨â€œInit Materialâ€Jobä¸­åˆå§‹åŒ–æè´¨<br>
<!-- -->6.åœ¨â€œSend Finish Init Render Dataâ€Jobä¸­å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</p><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹ç‰©ç†çº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.åˆå§‹åŒ–ç‰©ç†</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œGet Init Physics Dataâ€Jobä¸­ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸»çº¿ç¨‹å‘é€çš„ç‰©ç†æ•°æ®<br>
<!-- -->2.åœ¨â€œInit Data Oriented Componentsâ€Jobä¸­åˆå§‹åŒ–å…±äº«çš„TransformComponentå’ŒBasicMaterialComponent<br>
<!-- -->3.åœ¨â€œCreate Physics Data Buffer TypeArrayâ€Jobä¸­åˆ›å»ºPhysicsWorkerDataçš„Bufferçš„è§†å›¾<br>
<!-- -->4.åœ¨â€œSend Finish Init Physics Dataâ€Jobä¸­å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸçš„æŒ‡ä»¤</p><p><strong>ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹</strong>
<img alt="ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Loop_Flow-efe8533595efa9ff2678b09796c84c5c.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹åˆ†ä¸ºMain Workerã€Render Workerã€Physics Workerè¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Update Pipelineå’ŒSync Pipelineçš„Jobï¼ŒRender WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„Render Pipelineçš„Jobï¼ŒPhysics WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ç‰©ç†çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Job </p><p>ä¸»å¾ªç¯çš„ä¸€å¸§é¦–å…ˆå¹¶è¡Œåœ°åœ¨ä¸»çº¿ç¨‹è¿›è¡Œäº†æ›´æ–°ã€åœ¨æ¸²æŸ“çº¿ç¨‹è¿›è¡Œäº†æ¸²æŸ“ã€åœ¨ç‰©ç†çº¿ç¨‹è¿›è¡Œäº†æ›´æ–°ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹è¿›è¡Œäº†åŒæ­¥ã€‚å…¶ä¸­ï¼Œåœ¨â€œå¹¶è¡Œâ€ä¸­ï¼Œå¹¶è¡Œè¿è¡Œäº†ä¸»çº¿ç¨‹çš„Update Pipelineã€æ¸²æŸ“çº¿ç¨‹çš„Render Pipelineã€ç‰©ç†çº¿ç¨‹çš„Update Pipelineï¼›åœ¨â€œåŒæ­¥â€ä¸­ï¼Œè¿è¡Œäº†ä¸»çº¿ç¨‹çš„ä¸»çº¿ç¨‹çš„Sync Pipeline</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Update Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.æ›´æ–°å…±äº«æ•°æ®RenderWorkerDataçš„Buffer<br>
<!-- -->2.å¯åŠ¨æ¸²æŸ“çº¿ç¨‹çš„æ¸²æŸ“å’Œç‰©ç†çº¿ç¨‹çš„æ›´æ–°<br>
<!-- -->3.å‘é€æ•°æ®åˆ°å…¶å®ƒçº¿ç¨‹</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.å› ä¸ºç»„ä»¶å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥åœ¨â€œUpdate Render Data Bufferâ€Jobä¸­æ›´æ–°äº†RenderWorkerDataçš„Bufferä¸­çš„ç»„ä»¶æ•°æ®<br>
<!-- -->2.åœ¨â€œSend Begin Loopâ€Jobä¸­ï¼Œå‘æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹å‘é€å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤ã€‚å½“è¿™ä¸¤ä¸ªçº¿ç¨‹æ¥æ”¶åˆ°è¯¥æŒ‡ä»¤åï¼Œä¼šåˆ†åˆ«è¿è¡ŒRender Pipelineå’ŒUpdate Pipelineï¼Œåˆ†åˆ«å¯åŠ¨å®ƒä»¬çš„æ¸²æŸ“å’Œæ›´æ–°<br>
<!-- -->3.åœ¨â€œSend Render Dataâ€Jobä¸­å‘æ¸²æŸ“çº¿ç¨‹å‘é€æ¸²æŸ“æ•°æ®<br>
<!-- -->4.åœ¨â€œSend Physics Dataâ€Jobä¸­å‘ç‰©ç†çº¿ç¨‹å‘é€ç‰©ç†æ•°æ®</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹æ¸²æŸ“çº¿ç¨‹çš„Render Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.æ¸²æŸ“</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œGet Render Dataâ€Jobä¸­ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸»çº¿ç¨‹å‘é€çš„æ¸²æŸ“æ•°æ®<br>
<!-- -->2.åœ¨â€œSend Uniform Shader Dataâ€Jobä¸­å‘é€ç›¸æœºæ•°æ®åˆ°GPU<br>
<!-- -->3.åœ¨â€œRenderâ€Jobä¸­æ¸²æŸ“<br>
<!-- -->4.åœ¨â€œSend Finish Render Dataâ€Jobä¸­å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ç‰©ç†çº¿ç¨‹çš„Update Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.ç‰©ç†è®¡ç®—</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œGet Physics Dataâ€Jobä¸­ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸»çº¿ç¨‹å‘é€çš„ç‰©ç†æ•°æ®<br>
<!-- -->2.åœ¨â€œCompute Physicsâ€Jobä¸­è¿›è¡Œç‰©ç†è®¡ç®—ï¼Œå°†è®¡ç®—ç»“æœå†™åˆ°å…±äº«çš„PhysicsWorkerDataçš„Bufferä¸­<br>
<!-- -->3.åœ¨â€œSend Finish Physics Dataâ€Jobä¸­å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</p><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Sync Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.ç­‰å¾…å…¶å®ƒçº¿ç¨‹å®Œæˆè‡ªå·±çš„æµç¨‹<br>
<!-- -->2.åŒæ­¥</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>
<!-- -->1.åœ¨â€œGet Finish Render Dataâ€å’Œâ€œGet Finish Physics Dataâ€Jobä¸­ç­‰å¾…ï¼Œç›´åˆ°åˆ†åˆ«è·å¾—æ¸²æŸ“çº¿ç¨‹ã€ç‰©ç†çº¿ç¨‹å‘é€æ¥çš„ç»“æŸæŒ‡ä»¤<br>
<!-- -->2.åœ¨â€œUpdate All Transform Positionsâ€Jobä¸­ä»PhysicsWorkerDataçš„Bufferä¸­è·å¾—ç‰©ç†çº¿ç¨‹ä¸­ç»è¿‡ç‰©ç†è®¡ç®—å¾—åˆ°çš„è®¡ç®—ç»“æœï¼Œç”¨æ¥æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®<br>
<!-- -->3.åœ¨â€œUpdate Transformâ€Jobä¸­æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„æ¨¡å‹çŸ©é˜µ</p><p><strong>å›ç­”å¦‚ä½•è§£å†³å†²çª</strong></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å›ç­”ä¹‹å‰â€œä¸ºä»€ä¹ˆç‰©ç†çº¿ç¨‹ä¸ç›´æ¥å°†è®¡ç®—ç»“æœå†™åˆ°ä¸»çº¿ç¨‹å…±äº«çš„TransformComponentç»„ä»¶çš„Bufferä¸­å‘¢ï¼Ÿâ€çš„é—®é¢˜ï¼š<br>
<!-- -->å› ä¸ºä¸»çº¿ç¨‹çš„æ›´æ–°å’Œç‰©ç†çº¿ç¨‹çš„æ›´æ–°æ˜¯åœ¨åŒä¸€æ—¶é—´å¹¶è¡Œè¿›è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœåœ¨è¿™æœŸé—´ï¼Œç‰©ç†çº¿ç¨‹å°†è®¡ç®—ç»“æœå†™åˆ°å…±äº«çš„TransformComponentç»„ä»¶Bufferä¸­ï¼Œé‚£ä¹ˆæ­¤åä¸»çº¿ç¨‹ä»ä¸­è¯»å–æ•°æ®æ—¶å¯èƒ½è·å¾—è¢«ç‰©ç†çº¿ç¨‹ä¿®æ”¹åçš„å€¼è€Œä¸æ˜¯åŸå§‹å€¼ï¼Œä»è€Œé€ æˆå†²çªã€‚å› æ­¤ä¸ºäº†é¿å…å†²çªï¼Œé¦–å…ˆè®©ç‰©ç†çº¿ç¨‹å°†è®¡ç®—ç»“æœå†™åˆ°PhysicsWorkerDataçš„Bufferä¸­ï¼›ç„¶ååœ¨ä¸»çº¿ç¨‹è¿›è¡ŒåŒæ­¥æ—¶ï¼Œå†è¯»å–PhysicsWorkerDataçš„Bufferï¼Œå°†å…¶å†™åˆ°TransformComponentç»„ä»¶çš„Bufferä¸­</p><p><strong>è§£é‡Šå»¶è¿Ÿä¸€å¸§</strong></p><p>æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹ç›¸æ¯”ä¸»çº¿ç¨‹æ˜¯å»¶è¿Ÿäº†ä¸€å¸§çš„ï¼Œè¿™æ˜¯å› ä¸ºä¸»çº¿ç¨‹çš„Sync Pipelineä¸­çš„â€œUpdate Transformâ€ Jobä¼šæ›´æ–°æ¨¡å‹çŸ©é˜µï¼Œè¿™æ›´æ–°åçš„å€¼åªèƒ½åœ¨ä¸‹ä¸€å¸§è¢«æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™ä¸€å¸§çš„æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹ä½¿ç”¨çš„å®é™…æ˜¯ä¸Šä¸€å¸§çš„æ¨¡å‹çŸ©é˜µï¼Œå› æ­¤å®ƒä»¬å»¶è¿Ÿäº†ä¸€å¸§</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li>å› ä¸ºæŠŠâ€œæ¸²æŸ“â€å’Œâ€œç‰©ç†è®¡ç®—â€çš„é€»è¾‘ä»ä¸»çº¿ç¨‹åˆ†åˆ«ç§»åˆ°äº†ä¸¤ä¸ªçº¿ç¨‹ä¸­ï¼Œå¹¶è®©å®ƒä»¬ä¸ä¸»çº¿ç¨‹å¹¶è¡Œè¿è¡Œï¼Œæ‰€ä»¥æé«˜äº†FPS</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -1">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -1" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹ä¸­Clientçš„ä»£ç ï¼›</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹åˆå§‹åŒ–çš„ç›¸å…³ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç </li><li>æ¸²æŸ“çº¿ç¨‹ä¸­RenderWorkerMainçš„ä»£ç </li><li>æˆ‘ä»¬çœ‹ä¸‹ç‰©ç†çº¿ç¨‹ä¸­PhysicsWorkerMainçš„ä»£ç </li><li>æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç </li><li>ç‰©ç†çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»å¾ªç¯é˜¶æ®µçš„ç›¸å…³ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„ä»£ç </li><li>æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„Render Pipelineçš„Jobçš„ä»£ç </li><li>ç‰©ç†çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„ä»£ç </li></ul><p>ä¸Šé¢ä¸‰ä¸ªPipelineæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œå®ƒä»¬ç»“æŸåï¼Œä¼šè¿è¡Œä¸»çº¿ç¨‹çš„Sync Pipelineï¼Œå› æ­¤æˆ‘ä»¬çœ‹ä¸‹å®ƒçš„Jobçš„ä»£ç ï¼›</p><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡Œä¸»çº¿ç¨‹ä¸­Clientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹ä¸­clientçš„ä»£ç ">ä¸»çº¿ç¨‹ä¸­Clientçš„ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹ä¸­clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ­¤å¤„è®¾ç½®è¿è¡Œç¯å¢ƒä¸ºå¤šçº¿ç¨‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ä¸ºfalseæ¥è®¾ç½®è¿è¡Œç¯å¢ƒä¸ºå•çº¿ç¨‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> isUseWorker </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> transformComponentCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> basicMaterialComponentCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> transformComponentCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> basicMaterialComponentCount </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ClientUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isUseWorker</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ³¨å†ŒMainWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ³¨å†ŒNoWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_loop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> handlePromise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isUseWorker</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handlePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handlePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handlePromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clientçš„æ­¥éª¤è·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼š</p><ul><li>ä¸åŒçš„è¿è¡Œç¯å¢ƒæ³¨å†Œä¸åŒçš„ç®¡é“ï¼Œå…¶ä¸­å¯¹äºå¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒï¼Œæ³¨å†Œäº†MainWorkerPipelineï¼Œå®ƒåŒ…æ‹¬Init Pipelineã€Sync Pipelineè¿™ä¸¤ä¸ªç®¡é“ï¼›å¯¹äºå•çº¿ç¨‹çš„è¿è¡Œç¯å¢ƒï¼Œæ³¨å†Œçš„ç®¡é“æ¨¡å—è·Ÿä¹‹å‰æ³¨å†Œçš„ç®¡é“æ¨¡å—ä¸€æ ·</li><li>ä¸»å¾ªç¯å¢åŠ äº†å¤„ç†å¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒçš„æƒ…å†µï¼Œå®ƒçš„å¤„ç†æ˜¯ä¾æ¬¡è¿è¡ŒUpdate Pipelineå’ŒSync Pipeline</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç ">ä¸»çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>CreateWorkerInstanceJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºrenderWorker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºphysicsWorker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä¿å­˜renderWorkerã€physicsWorkeråˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºæ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹çš„workerã€‚åˆ›å»ºworkeråï¼Œä¼šæ‰§è¡Œè¿è¡Œåœ¨è¯¥çº¿ç¨‹çš„ç”¨æˆ·ä»£ç </p><p>CreateRenderDataBufferJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SharedArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_getMaxRenderGameObjectCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getStride</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> renderDataBufferTypeArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Uint32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä¿å­˜bufferã€renderDataBufferTypeArrayåˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºRenderWorkerDataçš„Bufferï¼Œç”¨æ¥ä¿å­˜åœºæ™¯ä¸­æ‰€æœ‰çš„transformComponentå’ŒbasicMaterialComponentï¼›å¹¶åˆ›å»ºå®ƒçš„è§†å›¾ï¼Œç”¨æ¥æ“ä½œBuffer</p><p>CreatePhysicsDataBufferJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SharedArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_getMaxTransformComponentCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getStride</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> physicsDataBufferTypeArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Float32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä¿å­˜bufferã€physicsDataBufferTypeArrayåˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºPhysicsWorkerDataçš„Bufferï¼Œç”¨æ¥ä¿å­˜åœºæ™¯ä¸­æ‰€æœ‰çš„transformComponentçš„ä½ç½®ï¼ˆä½œä¸ºå¤‡ä»½æ•°æ®ï¼‰ï¼›å¹¶åˆ›å»ºå®ƒçš„è§†å›¾ï¼Œç”¨æ¥æ“ä½œBuffer</p><p>SendInitRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘æ¸²æŸ“çº¿ç¨‹å‘é€canvasã€RenderWorkerDataçš„Bufferã€ä¸¤ç§ç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€ä¸¤ç§ç»„ä»¶çš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobå‘æ¸²æŸ“çº¿ç¨‹å‘é€åˆå§‹åŒ–æ•°æ®ã€‚å…¶ä¸­ï¼Œä¸¤ç§ç»„ä»¶çš„Bufferå’ŒRenderWorkerDataçš„Bufferæ˜¯é€šè¿‡SharedArrayBufferå…±äº«è¿‡å»çš„ï¼›canvasæ˜¯é€šè¿‡OffscreenCavnas APIå…±äº«è¿‡å»çš„ï¼›å…¶å®ƒæ•°æ®æ˜¯æ‹·è´è¿‡å»çš„</p><p>SendInitPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ç‰©ç†çº¿ç¨‹å‘é€PhysicsWorkerDataçš„Bufferã€TransformComponentç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€TransformComponentç»„ä»¶çš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobå‘ç‰©ç†çº¿ç¨‹å‘é€åˆå§‹åŒ–æ•°æ®ã€‚å…¶ä¸­ï¼Œç»„ä»¶çš„Bufferå’ŒPhysicsWorkerDataçš„Bufferæ˜¯é€šè¿‡SharedArrayBufferå…±äº«è¿‡å»çš„ï¼›å…¶å®ƒæ•°æ®æ˜¯æ‹·è´è¿‡å»çš„</p><p>GetFinishSendInitRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…æ¸²æŸ“çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GetFinishSendInitPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…ç‰©ç†çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ¸²æŸ“çº¿ç¨‹ä¸­renderworkermainçš„ä»£ç ">æ¸²æŸ“çº¿ç¨‹ä¸­RenderWorkerMainçš„ä»£ç <a class="hash-link" href="#æ¸²æŸ“çº¿ç¨‹ä¸­renderworkermainçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>RenderWorkerMain</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForRenderWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createStateForWorker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ³¨å†ŒRenderWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForRenderWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ç­‰å¾…ä¸»çº¿ç¨‹çš„Update Pipelineçš„</span><span class="token string" style="color:#e3116c">&quot;Send Begin Loop Data&quot;</span><span class="token plain"> Jobå‘é€å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—æŒ‡ä»¤åï¼Œè¿è¡Œä¸€æ¬¡RenderWorkerPipelineçš„Render Pipeline</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥æ¨¡å—åœ¨ä¸»çº¿ç¨‹çš„CreateWorkerInstanceJobåˆ›å»ºrender workeråæ‰§è¡Œ</p><p>è¯¥æ¨¡å—é¦–å…ˆåˆ›å»ºäº†WorldStateï¼Œç”¨æ¥ä¿å­˜æ¸²æŸ“çº¿ç¨‹æ‰€æœ‰çš„æ•°æ®ï¼›ç„¶åæ³¨å†Œäº†RenderWorkerPipelineçš„Init Pipelineã€Render Pipelineï¼›ç„¶ååˆå§‹åŒ–ï¼Œåˆå§‹åŒ–äº†ç®¡é“ï¼Œå¹¶è¿è¡Œäº†RenderWorkerPipelineçš„Init Pipelineç®¡é“ï¼›æœ€åæ¸²æŸ“</p><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼š<br>
<!-- -->æ¸²æŸ“å¹¶æ²¡æœ‰åœ¨åˆå§‹åŒ–ä¹‹åç«‹åˆ»å¼€å§‹ï¼Œè€Œæ˜¯ç­‰å¾…ä¸»å¾ªç¯çš„è°ƒåº¦</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç‰©ç†çº¿ç¨‹ä¸­physicsworkermainçš„ä»£ç ">ç‰©ç†çº¿ç¨‹ä¸­PhysicsWorkerMainçš„ä»£ç <a class="hash-link" href="#ç‰©ç†çº¿ç¨‹ä¸­physicsworkermainçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>è¯¥æ¨¡å—åœ¨ä¸»çº¿ç¨‹çš„CreateWorkerInstanceJobåˆ›å»ºphysics workeråæ‰§è¡Œï¼Œå®ƒçš„ä»£ç è·ŸRenderWorkerMainçš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ³¨å†Œäº†ä¸ä¸€æ ·çš„ç®¡é“ï¼šæ³¨å†Œäº†PhysicsWorkerPipelineçš„Init Pipelineã€Update Pipelineã€‚</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç ">æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetInitRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„åˆå§‹åŒ–æ•°æ®ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InitDataOrientedComponentsJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„ä¸¤ç§ç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€ä¸¤ç§ç»„ä»¶çš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–å®ƒä»¬</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆå§‹åŒ–å…±äº«çš„TransformComponentå’ŒBasicMaterialComponentçš„Bufferï¼Œå…·ä½“æ˜¯åˆ›å»ºäº†å®ƒä»¬çš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾è¯»Bufferçš„æ•°æ®</p><p>CreateRenderDataBufferTypeArrayJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„RenderWorkerDataçš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„è§†å›¾ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºRenderWorkerDataçš„Bufferçš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾è¯»Bufferçš„æ•°æ®</p><p>CreateGLJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„canvas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobä»£ç é™¤äº†æ˜¯ä»ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ¸²æŸ“æ•°æ®ä¸­è·å¾—canvasä»¥å¤–ï¼Œå…¶å®ƒéƒ½è·Ÿä¹‹å‰çš„CreateGLJobä»£ç ä¸€æ ·</p><p>InitMaterialJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobä»£ç è·Ÿä¹‹å‰çš„InitMaterialJobä»£ç ä¸€æ ·</p><p>SendFinishInitRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç‰©ç†çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç ">ç‰©ç†çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#ç‰©ç†çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetInitPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„åˆå§‹åŒ–æ•°æ®ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InitDataOrientedComponentsJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„TransformComponentç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€TransformComponentç»„ä»¶çš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–å®ƒ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆå§‹åŒ–å…±äº«çš„TransformComponentçš„Bufferï¼Œå…·ä½“æ˜¯åˆ›å»ºäº†å®ƒä»¬çš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾è¯»Bufferçš„æ•°æ®</p><p>CreatePhysicsDataBufferTypeArrayJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„PhysicsWorkerDataçš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„è§†å›¾ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobåˆ›å»ºPhysicsWorkerDataçš„Bufferçš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾å†™Bufferçš„æ•°æ®</p><p>SendFinishInitPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„ä»£ç ">ä¸»çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>UpdateRenderDataBufferJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°RenderWorkerDataçš„Bufferçš„ç»„ä»¶æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendBeginLoopDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘æ¸²æŸ“çº¿ç¨‹ã€ç‰©ç†çº¿ç¨‹å‘é€å¼€å§‹ä¸»å¾ªç¯æŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobå‘æ¸²æŸ“çº¿ç¨‹å’Œç‰©ç†çº¿ç¨‹å‘é€å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤ã€‚è¿™ä¸¤ä¸ªçº¿ç¨‹åœ¨æ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šåˆ†åˆ«è¿è¡Œæ¸²æŸ“çº¿ç¨‹çš„Render Pipelineå’Œç‰©ç†çº¿ç¨‹çš„Update Pipeline</p><p>SendRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘æ¸²æŸ“çº¿ç¨‹å‘é€å‡çš„ç›¸æœºæ•°æ®ç­‰æ¸²æŸ“æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ç‰©ç†çº¿ç¨‹å‘é€æ‰€æœ‰çš„TransformComponentç»„ä»¶ç­‰ç‰©ç†æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„render-pipelineçš„jobçš„ä»£ç ">æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„Render Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#æ¸²æŸ“çº¿ç¨‹è¿è¡Œçš„render-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ¸²æŸ“æ•°æ®ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendUniformShaderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„å‡çš„ç›¸æœºæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobä»£ç é™¤äº†æ˜¯ä»ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ¸²æŸ“æ•°æ®ä¸­è·å¾—å‡çš„ç›¸æœºæ•°æ®è€Œéè‡ªå·±æ„é€ ä»¥å¤–ï¼Œå…¶å®ƒéƒ½è·Ÿä¹‹å‰çš„SendUniformShaderDataJobä»£ç ä¸€æ ·</p><p>RenderJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ ¹æ®ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ¸²æŸ“æ•°æ®æ„é€ åœºæ™¯ä¸­æ‰€æœ‰çš„gameObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobä»£ç é™¤äº†æ˜¯æ ¹æ®ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ¸²æŸ“æ•°æ®æ„é€ åœºæ™¯ä¸­æ‰€æœ‰çš„gameObjectä»¥å¤–ï¼Œå…¶å®ƒéƒ½è·Ÿä¹‹å‰çš„RenderJobä»£ç ä¸€æ ·</p><p>SendFinishRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç‰©ç†çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„ä»£ç ">ç‰©ç†çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#ç‰©ç†çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ComputePhysicsJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿›è¡Œä¸€äº›ç‰©ç†è®¡ç®—</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å°†è®¡ç®—ç»“æœå†™åˆ°PhysicsWorkerDataçš„Bufferä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobè·Ÿä¹‹å‰çš„ComputePhysicsAndUpdateJobä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ç°åœ¨å°†è®¡ç®—ç»“æœæ˜¯å†™åˆ°å¤‡ä»½æ•°æ®ä¸­</p><p>SendFinishPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹çš„sync-pipelineçš„jobçš„ä»£ç ">ä¸»çº¿ç¨‹çš„Sync Pipelineçš„Jobçš„ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹çš„sync-pipelineçš„jobçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetFinishRenderDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…æ¸²æŸ“çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GetFinishPhysicsDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…ç‰©ç†çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>UpdateAllTransformPositionsJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»PhysicsWorkerDataçš„Bufferä¸­è·å¾—ç‰©ç†çº¿ç¨‹çš„è®¡ç®—ç»“æœ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç”¨å®ƒæ¥æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥Jobä½¿ç”¨ç‰©ç†çº¿ç¨‹ä¸­ç‰©ç†è®¡ç®—çš„ç»“æœæ¥æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„ä½ç½®</p><p>UpdateTransformJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°æ‰€æœ‰TransformComponentç»„ä»¶çš„æ¨¡å‹çŸ©é˜µ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œä¸»çº¿ç¨‹ä¸­clientçš„ä»£ç ">è¿è¡Œä¸»çº¿ç¨‹ä¸­Clientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œä¸»çº¿ç¨‹ä¸­clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>è¿è¡Œæˆªå›¾è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæ•…çœç•¥</p><p>å¯ä»¥é€šè¿‡æ‰“å°çš„Jobä¿¡æ¯ä»¥åŠChromeæ§åˆ¶å°çš„Performanceæ—¶é—´çº¿ï¼Œæ¥è§‚å¯ŸJobæ‰§è¡Œçš„é¡ºåºï¼Œä»è€ŒéªŒè¯ç¡®å®æ˜¯å¹¶è¡Œåœ°è¿è¡Œäº†çº¿ç¨‹</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®šä¹‰">å®šä¹‰<a class="hash-link" href="#å®šä¹‰" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸€å¥è¯å®šä¹‰">ä¸€å¥è¯å®šä¹‰<a class="hash-link" href="#ä¸€å¥è¯å®šä¹‰" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆå¹¶è¡Œè¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œç„¶ååŒæ­¥æ›´æ–°ä¸»çº¿ç¨‹æ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜<a class="hash-link" href="#è¡¥å……è¯´æ˜" title="Direct link to heading">â€‹</a></h3><p>çº¿ç¨‹ä¹‹é—´é€šè¿‡å‘é€æŒ‡ä»¤æ¥è°ƒåº¦</p><p>å¦‚æœä¸»çº¿ç¨‹ä»¥å¤–çš„å…¶å®ƒçº¿ç¨‹éƒ½åªè¯»ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œåˆ™ä¸éœ€è¦åŒæ­¥ï¼›å¦åˆ™ï¼Œé¦–å…ˆå¤‡ä»½å…¶å®ƒçº¿ç¨‹éœ€è¦å†™ä¸»çº¿ç¨‹çš„è¿™éƒ¨åˆ†æ•°æ®ï¼›ç„¶ååœ¨å…¶å®ƒçº¿ç¨‹ä¸­ï¼Œå°†è¦å†™çš„æ•°æ®æ”¹ä¸ºå†™åˆ°å¤‡ä»½ä¸­ï¼›æœ€åï¼Œä¸»çº¿ç¨‹åœ¨åŒæ­¥é˜¶æ®µï¼Œå°†è‡ªå·±çš„æ•°æ®æ›´æ–°ä¸ºå¤‡ä»½ä¸­çš„æ–°æ•°æ®</p><p>æ¸²æŸ“çº¿ç¨‹åªè¯»ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œå…¶å®ƒçº¿ç¨‹é™¤äº†è¯»ä»¥å¤–è¿˜å¯èƒ½éœ€è¦å†™ä¸»çº¿ç¨‹çš„æ•°æ®</p><p>æ•°æ®ä¼ é€çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šæ‹·è´ã€å…±äº«ï¼Œå…¶ä¸­å…±äº«ä¸»è¦æ˜¯æŒ‡å…±äº«SharedArrayBufferå’Œå…±äº«canvas</p><p>å…¶å®ƒçº¿ç¨‹ç›¸æ¯”ä¸»çº¿ç¨‹æ˜¯å»¶è¿Ÿäº†ä¸€å¸§çš„ï¼Œè¿™æ˜¯å› ä¸ºä¸»çº¿ç¨‹åœ¨åŒæ­¥é˜¶æ®µä¼šæ›´æ–°è‡ªå·±çš„æ•°æ®ï¼Œè€Œæ›´æ–°çš„æ•°æ®åªèƒ½åœ¨ä¸‹ä¸€å¸§è¢«å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™ä¸€å¸§çš„å…¶å®ƒçº¿ç¨‹ä½¿ç”¨çš„æ˜¯ä¸Šä¸€å¸§çš„ä¸»çº¿ç¨‹çš„æ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="é€šç”¨uml">é€šç”¨UML<a class="hash-link" href="#é€šç”¨uml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong>
<img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/Domain-f09c74b1a3e626d24549dd3bbabe3d3b.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºMain Workerã€X Workerè¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main Workerå¯¹åº”ä¸»çº¿ç¨‹ï¼ŒåŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„æ¨¡å—ï¼›X Workerå¯¹åº”æŸä¸ªå…¶å®ƒçº¿ç¨‹ï¼ŒåŒ…æ‹¬äº†è¿è¡Œåœ¨è¯¥çº¿ç¨‹çš„æ¨¡å—</p><p>æˆ‘ä»¬çœ‹ä¸‹Main Workerè¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>Client<br>
<!-- -->è¯¥è§’è‰²æ˜¯ç”¨æˆ·</p></li><li><p>WorldForMainWorker<br>
<!-- -->è¯¥è§’è‰²æ˜¯é—¨æˆ·ï¼Œæä¾›äº†ç³»ç»Ÿçš„API</p></li><li><p>PipelineManager<br>
<!-- -->è¯¥è§’è‰²è´Ÿè´£ç®¡ç†ç®¡é“</p></li><li><p>MainWorkerPipeline<br>
<!-- -->è¯¥è§’è‰²æ˜¯æ³¨å†Œçš„ç®¡é“æ¨¡å—</p></li><li><p>X Pipeline<br>
<!-- -->è¯¥è§’è‰²æ˜¯ç®¡é“</p></li><li><p>Job<br>
<!-- -->è¯¥è§’è‰²æ˜¯ä¸€æ®µç‹¬ç«‹çš„é€»è¾‘</p></li></ul><ul><li>Manager+Component+GameObject<br>è¯¥è§’è‰²æ˜¯ECSæ¨¡å¼ä¸­çš„Managerå±‚å’ŒComponent+GameObjectå±‚ï¼Œç”¨æ¥åˆ›å»ºå’Œç®¡ç†åœºæ™¯ã€‚å®ƒåŒ…æ‹¬çš„æ¨¡å—åœ¨ECSæ¨¡å¼ä¸­å·²ç»ä»‹ç»äº†ï¼Œæ•…åœ¨å›¾ä¸­çœç•¥</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹X Workerè¿™ä¸ªéƒ¨åˆ†ï¼š  </p><p>å®ƒçš„æ¨¡å—ç»“æ„è·ŸMain Workerä¸€æ ·ï¼Œåªæ˜¯å…·ä½“çš„ç”¨æˆ·ã€é—¨æˆ·ã€ç®¡é“æ¨¡å—ã€ç®¡é“ä¸ä¸€æ ·</p><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li><p>å› ä¸ºå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒçº¿ç¨‹ï¼Œæ‰€ä»¥å¯¹åº”çš„æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªX Worker</p></li><li><p>ä¸€ä¸ªWorldæ³¨å†Œäº†ä¸€ä¸ªWorkerPipelineç®¡é“æ¨¡å—<br>
<!-- -->å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœéœ€è¦æ”¯æŒå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹è¿è¡Œç¯å¢ƒçš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦æ ¹æ®è¿è¡Œç¯å¢ƒï¼Œæ³¨å†Œå¯¹åº”çš„ä¸€ä¸ªå•çº¿ç¨‹WorkerPipelineæˆ–è€…ä¸€ä¸ªå¤šçº¿ç¨‹WorkerPipeline</p></li><li><p>ä¸€ä¸ªWorkerPipelineç®¡é“æ¨¡å—æœ‰å¤šä¸ªX Pipelineï¼Œå¦‚Init Pipelineã€Update Pipelineç­‰ï¼Œæ¯ä¸ªWorkerPipelineç®¡é“æ¨¡å—åº”è¯¥è‡³å°‘æœ‰Init Pipeline</p></li><li><p>ä¸€ä¸ªX Pipelineæœ‰å¤šä¸ªJob</p></li></ul><ul><li><p>Jobè°ƒç”¨äº†Manager+Component+GameObjectæ¥è¯»å†™åœºæ™¯æ•°æ®</p></li><li><p>Worldè°ƒç”¨äº†Manager+Component+GameObjectæ¥åˆ›å»ºåœºæ™¯</p></li></ul><p><strong>åˆå§‹åŒ–æµç¨‹</strong>
<img alt="åˆå§‹åŒ–æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Init_Flow-9cdfb82a85e84ae39294c54bb8194ff3.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œåˆå§‹åŒ–æµç¨‹åˆ†ä¸ºMain Workerã€X Workerè¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Init Pipelineçš„Jobï¼›X WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨å…¶å®ƒçº¿ç¨‹çš„Init Pipelineçš„Job</p><p>åˆå§‹åŒ–å¹¶è¡Œè¿è¡Œäº†ä¸»çº¿ç¨‹ã€å…¶å®ƒçº¿ç¨‹çš„Init Pipeline</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.åˆ›å»ºå…¶å®ƒçº¿ç¨‹çš„workerï¼Œå¯åŠ¨å…¶å®ƒçº¿ç¨‹çš„åˆå§‹åŒ–<br>
<!-- -->2.åˆ›å»ºå…±äº«æ•°æ®ï¼šXWorkerDataçš„Buffer<br>
<!-- -->3.å‘é€æ•°æ®åˆ°å…¶å®ƒçº¿ç¨‹</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>Create Worker Instance<br>
<!-- -->è¯¥Jobåˆ›å»ºäº†æ‰€æœ‰å…¶å®ƒçº¿ç¨‹çš„worker</p></li><li><p>Create XWorker Data Buffer<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobåˆ›å»ºäº†å¯¹åº”X Workerçš„XWorkerDataçš„Bufferï¼ˆSharedArrayBufferï¼‰ï¼Œç”¨æ¥ä¿å­˜ä¸»çº¿ç¨‹å’ŒXçº¿ç¨‹ä¹‹é—´éœ€è¦å…±äº«çš„æ•°æ®</p></li><li><p>Send Init XWorker Data<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobå‘å¯¹åº”çš„Xçº¿ç¨‹å‘é€åˆå§‹åŒ–æ•°æ®</p></li><li><p>Get Finish Send Init XWorker Data<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobéƒ½å¹¶è¡Œæ‰§è¡Œï¼Œåˆ†åˆ«ç­‰å¾…å¯¹åº”çš„Xçº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</p></li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶å®ƒçº¿ç¨‹çš„Init Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.åˆå§‹åŒ–</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>Get Init XWorker Data<br>
<!-- -->è¯¥Jobè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ•°æ®</p></li><li><p>Init Data Oriented Components<br>
<!-- -->è¯¥Jobåˆ›å»ºå…±äº«çš„Data Orientedç»„ä»¶çš„Bufferçš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾è¯»Bufferçš„æ•°æ®<br>
<!-- -->å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šä¸åº”è¯¥å†™Bufferçš„æ•°æ®ï¼Œè€Œæ˜¯æ”¹ä¸ºå†™åˆ°ä½œä¸ºå¤‡ä»½æ•°æ®çš„XWorkerDataçš„Bufferä¸­</p></li><li><p>Create XWorker Data Buffer TypeArray<br>
<!-- -->è¯¥Jobåˆ›å»ºXWorkerDataçš„Bufferçš„è§†å›¾ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è§†å›¾è¯»å†™Bufferçš„æ•°æ®</p></li></ul><ul><li><p>Do Something<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobå®ç°ä¸€äº›é€»è¾‘<br>
<!-- -->å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåªåº”è¯¥æ›´æ–°è¯¥Xçº¿ç¨‹çš„æ•°æ®</p></li><li><p>Send Finish Init XWorker Data<br>
<!-- -->è¯¥Jobå‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</p></li></ul><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li><p>Main Workerå¯¹åº”ä¸»çº¿ç¨‹</p></li><li><p>å› ä¸ºå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒçº¿ç¨‹ï¼Œæ‰€ä»¥å¯¹åº”çš„æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªX Worker</p></li><li><p>Main Workerå’ŒX Workeréƒ½åªè¿è¡Œäº†Init Pipeline</p></li></ul><ul><li><p>ä¸»çº¿ç¨‹çš„â€œCreate Worker Instanceâ€ Jobåœ¨åˆ›å»ºå…¶å®ƒçº¿ç¨‹çš„workeråï¼Œä¼šæ‰§è¡Œè¿è¡Œåœ¨è¯¥çº¿ç¨‹çš„ç”¨æˆ·ä»£ç ï¼Œä»è€Œè¿è¡Œè¯¥çº¿ç¨‹çš„Init Pipeline</p></li><li><p>ä¸»çº¿ç¨‹çš„æ¯ä¸ªâ€œSend Init XWorker Dataâ€ Jobå°†æ•°æ®å‘é€åˆ°å¯¹åº”çš„ä¸€ä¸ªå…¶å®ƒçº¿ç¨‹ï¼›è¯¥å…¶å®ƒçº¿ç¨‹å¯¹åº”çš„â€œGet Init XWorker Dataâ€ Jobç­‰å¾…è·å¾—è¯¥æ•°æ®</p></li><li><p>æ‰€æœ‰å…¶å®ƒçº¿ç¨‹çš„â€œSend Finish Init XWorker Dataâ€ Jobå°†ç»“æŸæŒ‡ä»¤å‘é€åˆ°ä¸»çº¿ç¨‹ï¼›ä¸»çº¿ç¨‹å¯¹åº”çš„â€œGet Finish Send Init XWorker Dataâ€ Jobç­‰å¾…æ¥æ”¶è¯¥æŒ‡ä»¤</p></li></ul><p><strong>ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹</strong>
<img alt="ä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹å›¾" src="/3dProgramPattern/assets/images/Loop_Flow-d39268623e46f7677126c40786104f77.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œä¸»å¾ªç¯çš„ä¸€å¸§æµç¨‹åˆ†ä¸ºMain Workerã€X Workerè¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­Main WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„Update Pipelineå’ŒSync Pipelineçš„Jobï¼›X WorkeråŒ…æ‹¬äº†è¿è¡Œåœ¨å…¶å®ƒçº¿ç¨‹çš„X Pipelineçš„Job</p><p>ä¸»å¾ªç¯çš„ä¸€å¸§é¦–å…ˆå¹¶è¡Œè¿è¡Œäº†ä¸»çº¿ç¨‹çš„Update Pipelineã€å…¶å®ƒçº¿ç¨‹çš„X Pipelineï¼›ç„¶åè¿è¡Œäº†ä¸»çº¿ç¨‹çš„Sync Pipeline</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Update Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.æ›´æ–°å…±äº«æ•°æ®XWorkerDataçš„Buffer<br>
<!-- -->2.å¯åŠ¨å…¶å®ƒçº¿ç¨‹çš„X Pipelineçš„è¿è¡Œ<br>
<!-- -->3.å‘é€æ•°æ®åˆ°å…¶å®ƒçº¿ç¨‹</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>Update XWorker Data Buffer<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobæ›´æ–°äº†å¯¹åº”X Workerçš„XWorkerDataçš„Bufferä¸­çš„æ•°æ®</p></li><li><p>Send Begin Loop Data<br>
<!-- -->è¯¥Jobå‘æ‰€æœ‰çš„å…¶å®ƒçº¿ç¨‹å‘é€å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤</p></li><li><p>Send XWorker Data<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobå‘å¯¹åº”çš„Xçº¿ç¨‹å‘é€æ•°æ®</p></li><li><p>Do Something<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobå®ç°ä¸€äº›é€»è¾‘<br>
<!-- -->å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåªåº”è¯¥æ›´æ–°ä¸»çº¿ç¨‹çš„æ•°æ®</p></li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶å®ƒçº¿ç¨‹çš„X Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.æ‰§è¡Œä¸»å¾ªç¯çš„é€»è¾‘</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>Get XWorker Data<br>
<!-- -->è¯¥Jobè·å¾—ä¸»çº¿ç¨‹å‘é€çš„æ•°æ®</p></li><li><p>Do Something<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobå®ç°ä¸€äº›é€»è¾‘<br>
<!-- -->å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåªåº”è¯¥æ›´æ–°è¯¥Xçº¿ç¨‹çš„æ•°æ®</p></li><li><p>Send Finish XWorker Data<br>
<!-- -->è¯¥Jobå‘ä¸»çº¿ç¨‹å‘é€ç»“æŸçš„æŒ‡ä»¤</p></li></ul><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹çš„Sync Pipelineï¼Œå®ƒä¸»è¦åšäº†ä¸‹é¢çš„äº‹æƒ…ï¼š<br>
<!-- -->1.ç­‰å¾…å…¶å®ƒçº¿ç¨‹å®Œæˆè‡ªå·±çš„æµç¨‹<br>
<!-- -->2.åŒæ­¥</p><p>å®ƒçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>Get Finish XWorker Data<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobéƒ½å¹¶è¡Œæ‰§è¡Œï¼Œåˆ†åˆ«ç­‰å¾…å¯¹åº”çš„Xçº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</p></li><li><p>Update Shared Data<br>
<!-- -->è¿™æ˜¯å¤šä¸ªJobï¼Œæ¯ä¸ªJobéƒ½æ›´æ–°åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«çš„ä¸»çº¿ç¨‹çš„æ•°æ®</p></li></ul><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li><p>Main Workerå¯¹åº”ä¸»çº¿ç¨‹</p></li><li><p>å› ä¸ºå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒçº¿ç¨‹ï¼Œæ‰€ä»¥å¯¹åº”çš„æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªX Worker</p></li><li><p>å…¶å®ƒçº¿ç¨‹é€šå¸¸åªè¿è¡Œä¸€ä¸ªPipelineï¼Œå¦‚æœè¿è¡Œäº†1ä¸ªä»¥ä¸Šçš„Pipelineï¼Œé‚£ä¹ˆå®ƒä»¬ä¹Ÿé€šå¸¸ä¸ä¸»çº¿ç¨‹çš„Update Pipelineå¹¶è¡Œè¿è¡Œï¼Œæˆ–è€…è‡³å°‘è¦åœ¨ä¸»çº¿ç¨‹çš„Sync Pipelineå¼€å§‹å‰ç»“æŸ</p></li></ul><ul><li><p>å…¶å®ƒçº¿ç¨‹æ¥æ”¶åˆ°ä¸»çº¿ç¨‹çš„â€œSend Begin Loop Dataâ€ Jobå‘é€çš„å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤åï¼Œå¼€å§‹è¿è¡Œè‡ªå·±çš„X Pipeline</p></li><li><p>ä¸»çº¿ç¨‹çš„æ¯ä¸ªâ€œSend XWorker Dataâ€ Jobå°†æ•°æ®å‘é€åˆ°å¯¹åº”çš„å…¶å®ƒçº¿ç¨‹ï¼›è¯¥å…¶å®ƒçº¿ç¨‹å¯¹åº”çš„â€œGet XWorker Dataâ€ Jobç­‰å¾…è·å¾—è¯¥æ•°æ®</p></li><li><p>æ‰€æœ‰å…¶å®ƒçº¿ç¨‹çš„â€œSend Finish XWorker Dataâ€ Jobå°†ç»“æŸæŒ‡ä»¤å‘é€åˆ°ä¸»çº¿ç¨‹ï¼›ä¸»çº¿ç¨‹å¯¹åº”çš„â€œGet Finish Send XWorker Dataâ€ Jobç­‰å¾…æ¥æ”¶è¯¥æŒ‡ä»¤</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è§’è‰²çš„æŠ½è±¡ä»£ç ">è§’è‰²çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#è§’è‰²çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªè§’è‰²çš„æŠ½è±¡ä»£ç ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»çº¿ç¨‹ä¸­Clientçš„æŠ½è±¡ä»£ç ï¼›</p><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹åˆå§‹åŒ–çš„ç›¸å…³æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„æŠ½è±¡ä»£ç </li><li>Xçº¿ç¨‹ä¸­XWorkerMainçš„æŠ½è±¡ä»£ç </li><li>Xçº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„æŠ½è±¡ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»å¾ªç¯é˜¶æ®µçš„ç›¸å…³æŠ½è±¡ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>ä¸»çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„æŠ½è±¡ä»£ç </li><li>Xçº¿ç¨‹è¿è¡Œçš„X Pipelineçš„Jobçš„æŠ½è±¡ä»£ç </li></ul><p>ä¸Šé¢çš„Pipelineæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œå®ƒä»¬ç»“æŸåï¼Œä¼šè¿è¡Œä¸»çº¿ç¨‹çš„Sync Pipelineï¼Œå› æ­¤æˆ‘ä»¬çœ‹ä¸‹å®ƒçš„Jobçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹ä¸­clientçš„æŠ½è±¡ä»£ç ">ä¸»çº¿ç¨‹ä¸­Clientçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹ä¸­clientçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> isUseWorker </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> or </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> dataOrientedComponent1Count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataOrientedComponent1Count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dataOrientedComponent1Count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">globalThis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxRenderGameObjectCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> dataOrientedComponent1Count </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isUseWorker</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ³¨å†ŒMainWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ³¨å†ŒNoWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_loop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> handlePromise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isUseWorker</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handlePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handlePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handlePromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForMainWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œå‡è®¾åªæœ‰ä¸€ç§Data Orientedç»„ä»¶ï¼Œå› æ­¤åœ¨è°ƒç”¨WorldForMainWorkerçš„createStateå‡½æ•°æ—¶åªä¼ å…¥äº†å®ƒçš„æœ€å¤§ä¸ªæ•°</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„æŠ½è±¡ä»£ç ">ä¸»çº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>CreateWorkerInstanceJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºxWorker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä¿å­˜xWorkeråˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>CreateXWorkerDataBufferJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getMaxXxxCount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">globalThis </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_getStride</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SharedArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_getMaxXxxCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getStride</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> xWorkerDataBufferTypeArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Float32Array</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Uint8Array </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Uint16Array </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Uint32Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä¿å­˜bufferã€xWorkerDataBufferTypeArrayåˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendInitXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹å‘é€XWorkerDataçš„Bufferã€Data Orientedç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€Data Orientedç»„ä»¶çš„Bufferã€å…¶å®ƒæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GetFinishSendInitXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="xçº¿ç¨‹ä¸­xworkermainçš„æŠ½è±¡ä»£ç ">Xçº¿ç¨‹ä¸­XWorkerMainçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#xçº¿ç¨‹ä¸­xworkermainçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>XWorkerMain</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> worldState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> WorldForXWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createStateForWorker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ³¨å†ŒXWorkerPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorldForXWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ç­‰å¾…ä¸»çº¿ç¨‹çš„Update Pipelineçš„</span><span class="token string" style="color:#e3116c">&quot;Send Begin Loop Data&quot;</span><span class="token plain"> Jobå‘é€å¼€å§‹ä¸»å¾ªç¯çš„æŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—æŒ‡ä»¤åï¼Œè¿è¡Œä¸€æ¬¡XWorkerPipelineçš„</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain"> Pipeline</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="xçº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„æŠ½è±¡ä»£ç ">Xçº¿ç¨‹è¿è¡Œçš„Init Pipelineçš„Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#xçº¿ç¨‹è¿è¡Œçš„init-pipelineçš„jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetInitXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„åˆå§‹åŒ–æ•°æ®ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InitDataOrientedComponentsJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„Data Orientedç»„ä»¶çš„æœ€å¤§ä¸ªæ•°ã€Data Orientedç»„ä»¶çš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆå§‹åŒ–å®ƒä»¬</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>CreateXWorkerDataBufferTypeArrayJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä»worldStateè·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„XWorkerDataçš„Buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºå®ƒçš„è§†å›¾ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>DoSomethingJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å®ç°ä¸€äº›é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°è¯¥</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendFinishInitXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„æŠ½è±¡ä»£ç ">ä¸»çº¿ç¨‹è¿è¡Œçš„Update Pipelineçš„Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹è¿è¡Œçš„update-pipelineçš„jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>UpdateXWorkerDataBufferJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°XWorkerDataçš„Bufferçš„ç»„ä»¶æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendBeginLoopDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹å‘é€å¼€å§‹ä¸»å¾ªç¯æŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹å‘é€æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>DoSomethingJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å®ç°ä¸€äº›é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°ä¸»çº¿ç¨‹çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="xçº¿ç¨‹è¿è¡Œçš„x-pipelineçš„jobçš„æŠ½è±¡ä»£ç ">Xçº¿ç¨‹è¿è¡Œçš„X Pipelineçš„Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#xçº¿ç¨‹è¿è¡Œçš„x-pipelineçš„jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œä¿å­˜åˆ°worldStateä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>DoSomethingJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å®ç°ä¸€äº›é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°è¯¥</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SendFinishXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å‘ä¸»çº¿ç¨‹å‘é€ç»“æŸæŒ‡ä»¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸»çº¿ç¨‹çš„sync-pipelineçš„jobçš„æŠ½è±¡ä»£ç ">ä¸»çº¿ç¨‹çš„Sync Pipelineçš„Jobçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ä¸»çº¿ç¨‹çš„sync-pipelineçš„jobçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GetFinishXWorkerDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ç­‰å¾…</span><span class="token constant" style="color:#36acaa">X</span><span class="token plain">çº¿ç¨‹å‘é€è¿‡æ¥çš„ç»“æŸæŒ‡ä»¤</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>UpdateSharedDataJob</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">worldState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«çš„ä¸»çº¿ç¨‹çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°<a class="hash-link" href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" title="Direct link to heading">â€‹</a></h3><p>å¤šçº¿ç¨‹æ¨¡å¼ä¸»è¦éµå¾ªä¸‹é¢çš„è®¾è®¡åŸåˆ™ï¼š</p><ul><li>å•ä¸€èŒè´£åŸåˆ™<br>æ¯ä¸ªçº¿ç¨‹åªåšè‡ªå·±çš„äº‹æƒ…ï¼Œåªæ›´æ–°è‡ªå·±çš„æ•°æ®ï¼Œè¿™æ ·å°±å‡å°‘äº†å„ä¸ªçº¿ç¨‹ä¹‹é—´å‘ç”Ÿå†²çªçš„å¯èƒ½æ€§</li><li>æœ€å°‘çŸ¥è¯†åŸåˆ™<br>å…¶å®ƒçº¿ç¨‹ä¹‹é—´äº’ç›¸ä¸çŸ¥é“ï¼Œå®ƒä»¬åªçŸ¥é“ä¸»çº¿ç¨‹ï¼›çº¿ç¨‹ä¹‹é—´åªçŸ¥é“å‘é€è¿‡æ¥çš„ä¸è¯¥çº¿ç¨‹ç›¸å…³çš„æ•°æ®</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åº”ç”¨">åº”ç”¨<a class="hash-link" href="#åº”ç”¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¼˜ç‚¹">ä¼˜ç‚¹<a class="hash-link" href="#ä¼˜ç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li>æé«˜äº†æ€§èƒ½</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼ºç‚¹">ç¼ºç‚¹<a class="hash-link" href="#ç¼ºç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>å¦‚æœéœ€è¦åŒæ—¶æ”¯æŒå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹è¿è¡Œç¯å¢ƒçš„è¯ï¼Œéœ€è¦åŒæ—¶ç»´æŠ¤å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹çš„è¿™ä¸¤ä¸ªç®¡é“çš„ä»£ç ï¼Œå®ƒä»¬æœ‰å¾ˆå¤šé€»è¾‘æ˜¯é‡å¤çš„<br>
<!-- -->å¥½æ¶ˆæ¯æ˜¯å› ä¸ºä½¿ç”¨äº†ç®¡é“æ¨¡å¼ï¼Œæ‰€ä»¥è¿›è¡Œäº†å……åˆ†çš„è§£è€¦ï¼Œä¸¤å¥—ä»£ç äº’ä¸å½±å“ã€‚å¦å¤–ï¼Œå¯ä»¥æŠŠé‡å¤çš„é€»è¾‘æå‡ºæ¥æ”¾åˆ°å…¬å…±çš„utilsæ¨¡å—ä¸­ï¼Œç„¶åè®©è¿™ä¸¤ä¸ªç®¡é“çš„Jobè°ƒç”¨å®ƒä»¬ï¼Œä»è€Œå¯æ¶ˆé™¤é‡å¤ä»£ç </p></li><li><p>éœ€è¦è€ƒè™‘çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥<br>
<!-- -->å¥½æ¶ˆæ¯æ˜¯ä¸éœ€è¦é”ï¼Œè€Œæ˜¯é€šè¿‡å…±äº«å’Œå¤‡ä»½æ¥å®ç°åŒæ­¥ï¼Œè¿™æ ·æ›´æ˜“äºç»´æŠ¤ä¸”æ€§èƒ½æ›´é«˜
è¦ä½¿ç”¨è¿™ç§åŒæ­¥æ–¹æ¡ˆçš„è¯ï¼Œéœ€è¦æ³¨æ„ä¸‹é¢å‡ ä¸ªæ–¹é¢ï¼š  </p><ul><li>å…¶å®ƒçº¿ç¨‹å°½é‡åªè¯»è€Œä¸å†™ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œè¿™æ ·å°±ä¸éœ€è¦åŒæ­¥</li><li>åœ¨è®¾è®¡æ—¶ï¼Œå¯ä»¥ä»æ•°æ®çš„è§’åº¦å‡ºå‘ï¼Œè¯†åˆ«å‡ºä¸»çº¿ç¨‹å“ªäº›æ•°æ®ä¼šè¢«å…¶å®ƒçº¿ç¨‹å†™ï¼›ç„¶åå¤‡ä»½è¿™äº›æ•°æ®ï¼Œå¹¶è®©å…¶å®ƒçº¿ç¨‹æ”¹ä¸ºå†™åˆ°è¯¥å¤‡ä»½æ•°æ®ä¸­ ï¼›æœ€ååœ¨ä¸»çº¿ç¨‹åŒæ­¥æ—¶ï¼Œä»å¤‡ä»½ä¸­æ›´æ–°ä¸»çº¿ç¨‹æ•°æ®</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯<a class="hash-link" href="#ä½¿ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åœºæ™¯æè¿°">åœºæ™¯æè¿°<a class="hash-link" href="#åœºæ™¯æè¿°" title="Direct link to heading">â€‹</a></h4><p>éœ€è¦æ¸²æŸ“å¤§å‹åœºæ™¯æˆ–è€…æœ‰å¹¶è¡Œé€»è¾‘çš„ç³»ç»Ÿ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å…·ä½“æ¡ˆä¾‹">å…·ä½“æ¡ˆä¾‹<a class="hash-link" href="#å…·ä½“æ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h4><ul><li><p>éœ€è¦æ¸²æŸ“å¤§å‹åœºæ™¯<br>
<!-- -->å¯ä»¥å°†æ¸²æŸ“çš„é€»è¾‘ä»ä¸»çº¿ç¨‹ç§»åˆ°ä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹æ¥å¹¶è¡Œåœ°æ‰§è¡Œ</p></li><li><p>éœ€è¦å¤„ç†åŠ è½½è¶…å¤§æ¨¡å‹ã€è¿›è¡Œå¤æ‚è®¡ç®—ç­‰å¹¶è¡Œé€»è¾‘<br>
<!-- -->å¯¹äºæœ‰è¿™äº›å¹¶è¡Œé€»è¾‘çš„ç³»ç»Ÿï¼Œå¯ä»¥å¼€å¤šä¸ªçº¿ç¨‹å¹¶è¡Œåœ°æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œå¦‚å¯ä»¥å¼€ä¸€ä¸ªçº¿ç¨‹å»åŠ è½½è¶…å¤§æ¨¡å‹ï¼Œå¼€å¦ä¸€ä¸ªçº¿ç¨‹å»è¿›è¡Œå¤æ‚è®¡ç®—ï¼›æ¯å¸§çš„æœ€ååœ¨ä¸»çº¿ç¨‹è¿›è¡ŒåŒæ­¥</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹<a class="hash-link" href="#æ³¨æ„äº‹é¡¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>å¦‚æœå…¶å®ƒçº¿ç¨‹éœ€è¦å†™ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œåˆ™éœ€è¦åŒæ­¥</p></li><li><p>ä½¿ç”¨SharedArrayBufferæ—¶ï¼Œéœ€è¦å¯ç”¨æµè§ˆå™¨çš„è·¨åŸŸéš”ç¦»</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ‰©å±•">æ‰©å±•<a class="hash-link" href="#æ‰©å±•" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¼ é€çº¹ç†å›¾ç‰‡">ä¼ é€çº¹ç†å›¾ç‰‡<a class="hash-link" href="#ä¼ é€çº¹ç†å›¾ç‰‡" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœæè´¨åŒ…æ‹¬äº†çº¹ç†ï¼Œåˆ™éœ€è¦å°†çº¹ç†å›¾ç‰‡ä»ä¸»çº¿ç¨‹ä¼ åˆ°æ¸²æŸ“çº¿ç¨‹ã€‚è¿™å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„transferFromImageBitmap APIæ¥ä»ä¸»çº¿ç¨‹ä¼ é€è¯¥å›¾ç‰‡åˆ°æ¸²æŸ“çº¿ç¨‹</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å¼€å¤šä¸ªæ¸²æŸ“çº¿ç¨‹">å¼€å¤šä¸ªæ¸²æŸ“çº¿ç¨‹<a class="hash-link" href="#å¼€å¤šä¸ªæ¸²æŸ“çº¿ç¨‹" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœæ˜¯ç°ä»£å›¾å½¢APIï¼Œå¦‚DX12/Vulkan/Metal/WebGPUï¼Œåˆ™æ”¯æŒå¼€å¤šä¸ªè€Œä¸æ˜¯ä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹æ¥æ¸²æŸ“ã€‚å…¶ä¸­æ¯ä¸ªæ¸²æŸ“çº¿ç¨‹éƒ½è¿è¡Œä¸€ä¸ªRender Pipelineï¼Œè´Ÿè´£æäº¤è‡ªå·±çš„Command Buffer</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆå…¶å®ƒæ¨¡å¼">ç»“åˆå…¶å®ƒæ¨¡å¼<a class="hash-link" href="#ç»“åˆå…¶å®ƒæ¨¡å¼" title="Direct link to heading">â€‹</a></h2><p>å¤šçº¿ç¨‹æ¨¡å¼éœ€è¦è·ŸECSæ¨¡å¼ã€ç®¡é“æ¨¡å¼ä¸€èµ·ä½¿ç”¨</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆecsæ¨¡å¼">ç»“åˆECSæ¨¡å¼<a class="hash-link" href="#ç»“åˆecsæ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>ä½¿ç”¨ECSæ¨¡å¼ä¸­çš„Managerå±‚å’ŒComponent+GameObjectå±‚æ¥åˆ›å»ºå’Œç®¡ç†åœºæ™¯ï¼Œå°†åœºæ™¯æ•°æ®ä¿å­˜åœ¨ç»„ä»¶çš„Bufferä¸­ï¼Œå…¶ä¸­Bufferæ˜¯SharedArrayBufferã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š
ç»„ä»¶çš„Bufferå¯ä»¥ç›´æ¥åœ¨çº¿ç¨‹ä¹‹é—´è¢«å…±äº«è€Œæ— éœ€è¢«æ‹·è´ï¼Œä»è€Œæé«˜å¤šçº¿ç¨‹çš„æ€§èƒ½</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆç®¡é“æ¨¡å¼">ç»“åˆç®¡é“æ¨¡å¼<a class="hash-link" href="#ç»“åˆç®¡é“æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>åœ¨å•çº¿ç¨‹ã€å¤šçº¿ç¨‹è¿è¡Œç¯å¢ƒä¸‹åˆ†åˆ«æ³¨å†Œä¸åŒçš„ç®¡é“æ¥å®ç°å¯¹åº”çš„é€»è¾‘ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š<br>
<!-- -->1.å¯ä»¥é€šè¿‡åˆ‡æ¢ç®¡é“ï¼Œæ¥æ”¯æŒå•çº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒ<br>
<!-- -->2.å¯ä»¥é€šè¿‡ç®¡é“çš„å¹¶è¡ŒJobå®ç°å¤šçº¿ç¨‹è¿è¡Œç¯å¢ƒä¸­å¹¶è¡Œçš„é€»è¾‘</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a class="hash-link" href="#æœ€ä½³å®è·µ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼<a class="hash-link" href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœæ¸²æŸ“çš„åœºæ™¯è¾ƒå°ï¼Œæˆ–è€…æ²¡æœ‰å¹¶è¡Œé€»è¾‘ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥å¼€å¤šä¸ªçº¿ç¨‹ï¼Œè€Œåªä½¿ç”¨ä¸»çº¿ç¨‹å³å¯</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹">ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹<a class="hash-link" href="#ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å»¶è¿Ÿåˆ é™¤">å»¶è¿Ÿåˆ é™¤<a class="hash-link" href="#å»¶è¿Ÿåˆ é™¤" title="Direct link to heading">â€‹</a></h4><p>å› ä¸ºåˆ é™¤åœºæ™¯æ•°æ®ï¼ˆå¦‚åˆ é™¤ä¸€ä¸ªç»„ä»¶æˆ–è€…gameObjectï¼‰ä¼šå½±å“ä¸»çº¿ç¨‹çš„åœºæ™¯æ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆå†²çªï¼Œæ‰€ä»¥åº”è¯¥è¿™æ ·å¤„ç†ï¼š<br>
<!-- -->åˆ é™¤åœºæ™¯æ•°æ®çš„APIå¹¶æ²¡æœ‰çœŸæ­£åœ°è¿›è¡Œåˆ é™¤ï¼Œè€Œåªæ˜¯å°†è¦åˆ é™¤çš„æ•°æ®æ ‡è®°ä¸ºåˆ é™¤ï¼›ç„¶åç­‰åˆ°åŒæ­¥é˜¶æ®µï¼ˆä¹Ÿå°±æ˜¯è¿è¡Œä¸»çº¿ç¨‹çš„Sync Pipelineæ—¶ï¼‰å†çœŸæ­£åœ°å°†å…¶åˆ é™¤</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="é€šè¿‡åˆ‡æ¢ç®¡é“æ¥æ”¯æŒå•çº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒ">é€šè¿‡åˆ‡æ¢ç®¡é“ï¼Œæ¥æ”¯æŒå•çº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒ<a class="hash-link" href="#é€šè¿‡åˆ‡æ¢ç®¡é“æ¥æ”¯æŒå•çº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹çš„è¿è¡Œç¯å¢ƒ" title="Direct link to heading">â€‹</a></h4><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ›´å¤šèµ„æ–™æ¨è">æ›´å¤šèµ„æ–™æ¨è<a class="hash-link" href="#æ›´å¤šèµ„æ–™æ¨è" title="Direct link to heading">â€‹</a></h2><p>å› ä¸ºæ¸¸æˆçš„åœºæ™¯ä¸€èˆ¬éƒ½æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æ¸¸æˆå¼•æ“ï¼ˆå¦‚Unityã€Unrealï¼‰ä¸€èˆ¬éƒ½æ”¯æŒå¤šçº¿ç¨‹</p><p>é¡½çš®ç‹—åœ¨GDCä¸Šæå‡ºäº†Fiberæ¶æ„ï¼Œä½¿ç”¨äº†ç®¡é“æ¨¡å¼ï¼Œæ”¯æŒå¤šçº¿ç¨‹ï¼Œå…·ä½“å¯åœ¨ç½‘ä¸Šæœç´¢â€œParallelizing the Naughty Dog Engine using Fibersâ€</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/å¤šçº¿ç¨‹æ¨¡å¼/å¤šçº¿ç¨‹æ¨¡å¼.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/3dProgramPattern/docs/ECSæ¨¡å¼/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ç¬¬5ç«  ECSæ¨¡å¼</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å‰ç½®è¦æ±‚" class="table-of-contents__link toc-highlight">å‰ç½®è¦æ±‚</a></li><li><a href="#å•çº¿ç¨‹" class="table-of-contents__link toc-highlight">å•çº¿ç¨‹</a><ul><li><a href="#éœ€æ±‚" class="table-of-contents__link toc-highlight">éœ€æ±‚</a></li><li><a href="#å®ç°æ€è·¯" class="table-of-contents__link toc-highlight">å®ç°æ€è·¯</a></li><li><a href="#ç»™å‡ºuml" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»™å‡ºä»£ç " class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥æ”¹è¿›" class="table-of-contents__link toc-highlight">ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼æ¥æ”¹è¿›</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-1" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -1" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li></ul></li><li><a href="#å®šä¹‰" class="table-of-contents__link toc-highlight">å®šä¹‰</a><ul><li><a href="#ä¸€å¥è¯å®šä¹‰" class="table-of-contents__link toc-highlight">ä¸€å¥è¯å®šä¹‰</a></li><li><a href="#è¡¥å……è¯´æ˜" class="table-of-contents__link toc-highlight">è¡¥å……è¯´æ˜</a></li><li><a href="#é€šç”¨uml" class="table-of-contents__link toc-highlight">é€šç”¨UML</a></li><li><a href="#è§’è‰²çš„æŠ½è±¡ä»£ç " class="table-of-contents__link toc-highlight">è§’è‰²çš„æŠ½è±¡ä»£ç </a></li><li><a href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" class="table-of-contents__link toc-highlight">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°</a></li></ul></li><li><a href="#åº”ç”¨" class="table-of-contents__link toc-highlight">åº”ç”¨</a><ul><li><a href="#ä¼˜ç‚¹" class="table-of-contents__link toc-highlight">ä¼˜ç‚¹</a></li><li><a href="#ç¼ºç‚¹" class="table-of-contents__link toc-highlight">ç¼ºç‚¹</a></li><li><a href="#ä½¿ç”¨åœºæ™¯" class="table-of-contents__link toc-highlight">ä½¿ç”¨åœºæ™¯</a></li><li><a href="#æ³¨æ„äº‹é¡¹" class="table-of-contents__link toc-highlight">æ³¨æ„äº‹é¡¹</a></li></ul></li><li><a href="#æ‰©å±•" class="table-of-contents__link toc-highlight">æ‰©å±•</a><ul><li><a href="#ä¼ é€çº¹ç†å›¾ç‰‡" class="table-of-contents__link toc-highlight">ä¼ é€çº¹ç†å›¾ç‰‡</a></li><li><a href="#å¼€å¤šä¸ªæ¸²æŸ“çº¿ç¨‹" class="table-of-contents__link toc-highlight">å¼€å¤šä¸ªæ¸²æŸ“çº¿ç¨‹</a></li></ul></li><li><a href="#ç»“åˆå…¶å®ƒæ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆå…¶å®ƒæ¨¡å¼</a><ul><li><a href="#ç»“åˆecsæ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆECSæ¨¡å¼</a></li><li><a href="#ç»“åˆç®¡é“æ¨¡å¼" class="table-of-contents__link toc-highlight">ç»“åˆç®¡é“æ¨¡å¼</a></li></ul></li><li><a href="#æœ€ä½³å®è·µ" class="table-of-contents__link toc-highlight">æœ€ä½³å®è·µ</a><ul><li><a href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" class="table-of-contents__link toc-highlight">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼</a></li><li><a href="#ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹" class="table-of-contents__link toc-highlight">ç»™å‡ºå…·ä½“çš„å®è·µæ¡ˆä¾‹</a></li></ul></li><li><a href="#æ›´å¤šèµ„æ–™æ¨è" class="table-of-contents__link toc-highlight">æ›´å¤šèµ„æ–™æ¨è</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items"><li class="footer__item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=SaSgwsyiccUjc3Mx3Jqliv9HJnHxL-WI&amp;jump_from=webapi&amp;authKey=+EQRAdLQ80spfX++pA3UB4erf6cxC+Mo4jH6bfovhdE7MOvI5WBUljCZ6roGaNZh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä¸ä½œè€…äº¤æµåŠ QQç¾¤<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/dreamforest-yyc" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cnblogs.com/chaogex/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/3dProgramPattern/assets/js/runtime~main.d951e469.js"></script>
<script src="/3dProgramPattern/assets/js/main.c6dc4a90.js"></script>
</body>
</html>