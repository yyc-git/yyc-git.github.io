<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼ | 3Dç¼–ç¨‹æ¨¡å¼"><meta data-react-helmet="true" name="description" content="ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥GLSL"><meta data-react-helmet="true" property="og:description" content="ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥GLSL"><link data-react-helmet="true" rel="canonical" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/yyc-git/3DProgramPattern/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/" hreflang="x-default"><link rel="stylesheet" href="/3dProgramPattern/assets/css/styles.e233dcee.css">
<link rel="preload" href="/3dProgramPattern/assets/js/runtime~main.64bc8973.js" as="script">
<link rel="preload" href="/3dProgramPattern/assets/js/main.c6dc4a90.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/3dProgramPattern/"><b class="navbar__title">3Dç¼–ç¨‹æ¨¡å¼</b></a><a class="navbar__item navbar__link navbar__link--active" href="/3dProgramPattern/docs/å‰è¨€">å†…å®¹</a><a href="https://github.com/yyc-git/3DProgramPattern" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">å¼€ç¯‡</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å‰è¨€">å‰è¨€</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">ç¬¬ä¸€éƒ¨åˆ† ç¬¬1ç«  å†çœ‹è®¾è®¡åŸåˆ™</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/è®¾è®¡åŸºç¡€/">1.1 è®¾è®¡åŸºç¡€</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å•ä¸€èŒè´£åŸåˆ™/">1.2 å•ä¸€èŒè´£åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/åˆæˆå¤ç”¨åŸåˆ™/">1.3 åˆæˆå¤ç”¨åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æ¥å£éš”ç¦»åŸåˆ™/">1.4 æ¥å£éš”ç¦»åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/ä¾èµ–å€’ç½®åŸåˆ™/">1.5 ä¾èµ–å€’ç½®åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/æœ€å°‘çŸ¥è¯†åŸåˆ™/">1.6 æœ€å°‘çŸ¥è¯†åŸåˆ™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å†çœ‹è®¾è®¡åŸåˆ™/å¼€é—­åŸåˆ™/">1.7 å¼€é—­åŸåˆ™</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">ç¬¬äºŒéƒ¨åˆ† 7ç§ç¼–ç¨‹æ¨¡å¼</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ä¾èµ–éš”ç¦»æ¨¡å¼/">ç¬¬2ç«  ä¾èµ–éš”ç¦»æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç§¯æœ¨æ¨¡å¼/">ç¬¬3ç«  ç§¯æœ¨æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ç®¡é“æ¨¡å¼/">ç¬¬4ç«  ç®¡é“æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/ECSæ¨¡å¼/">ç¬¬5ç«  ECSæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/å¤šçº¿ç¨‹æ¨¡å¼/">ç¬¬6ç«  å¤šçº¿ç¨‹æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/3dProgramPattern/docs/æ‹¼æ¥æ¨¡å¼/">ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ç¬¬8ç«  æ‹¼æ¥æ¨¡å¼</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥glsl">ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥GLSL<a class="hash-link" href="#ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥glsl" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éœ€æ±‚">éœ€æ±‚<a class="hash-link" href="#éœ€æ±‚" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæè´¨ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸¤ç§æè´¨ï¼šåŸºç¡€æè´¨ã€PBRæè´¨ï¼Œå®ƒä»¬èƒ½é€‰æ‹©æ€§åœ°ä½¿ç”¨è´´å›¾ï¼Œåªæ˜¯å®ƒä»¬ä½¿ç”¨çš„è´´å›¾ä¸ä¸€æ ·ã€‚å…¶ä¸­åŸºç¡€æè´¨ä½¿ç”¨çš„è´´å›¾æ˜¯æ™®é€šè´´å›¾ï¼ŒPBRæè´¨ä½¿ç”¨çš„è´´å›¾æ˜¯diffuseè´´å›¾ã€‚å¦å¤–ï¼Œç”±å¼•æ“å†³å®šæ˜¯å¦æ”¯æŒInstanceï¼Œå®ƒæ˜¯ä¸€ç§æ‰¹é‡æ¸²æŸ“çš„æŠ€æœ¯</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å®ç°æ€è·¯">å®ç°æ€è·¯<a class="hash-link" href="#å®ç°æ€è·¯" title="Direct link to heading">â€‹</a></h3><p><img alt="æè´¨ä¸GLSLçš„å¯¹åº”å…³ç³»å›¾" src="/3dProgramPattern/assets/images/MaterialShaderGLSL-c8dc8483f828bea24e7b2a06eefd8941.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ªæè´¨ä½¿ç”¨ä¸€ä¸ªShaderï¼Œä¸€ä¸ªShaderæœ‰ä¸€å¥—GLSLï¼Œå³ä¸€ä¸ªVS GLSLï¼ˆé¡¶ç‚¹ç€è‰²å™¨çš„GLSLï¼‰å’Œä¸€ä¸ªFS GLSLï¼ˆç‰‡å…ƒç€è‰²å™¨çš„GLSLï¼‰</p><p>è¿™ä¸¤ç§æè´¨å¯¹åº”çš„Shaderæ”¯æŒçš„åŠŸèƒ½æœ‰ä¸‰ä¸ªï¼šæ™®é€šè´´å›¾ã€diffuseè´´å›¾ã€Instanceã€‚ä¸€å…±æœ‰å…«ç§æƒ…å†µï¼Œå…·ä½“å¦‚ä¸‹ï¼š<br>
<!-- -->å¯¹äºåŸºç¡€æè´¨çš„Shaderè€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ç§æƒ…å†µï¼š  </p><ul><li>[æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]</li><li>[æœ‰æ™®é€šè´´å›¾ï¼Œä¸æ”¯æŒInstance]</li><li>[æ²¡æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]</li><li>[æ²¡æœ‰æ™®é€šè´´å›¾ï¼Œä¸æ”¯æŒInstance]</li></ul><p>å¯¹äºPBRæè´¨çš„Shaderè€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ç§æƒ…å†µï¼š  </p><ul><li>[æœ‰diffuseè´´å›¾ï¼Œæ”¯æŒInstance]</li><li>[æœ‰diffuseè´´å›¾ï¼Œä¸æ”¯æŒInstance]</li><li>[æ²¡æœ‰diffuseè´´å›¾ï¼Œæ”¯æŒInstance]</li><li>[æ²¡æœ‰diffuseè´´å›¾ï¼Œä¸æ”¯æŒInstance]</li></ul><p>æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ç§æƒ…å†µéƒ½å†™ä¸€å¥—GLSLï¼Œå…±éœ€å†™å…«å¥—GLSL</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯Shaderæ¯æ”¯æŒä¸€ç§æ–°çš„åŠŸèƒ½ï¼ŒGLSLçš„å¥—æ•°å°±è¦ç¿»å€ï¼›æ¯å¢åŠ ä¸€ç§æè´¨ï¼Œå°±éœ€è¦å¢åŠ ä¸€ç§Shaderï¼Œä»è€Œä¸ºæ¯ç§æƒ…å†µå¢åŠ ä¸€å¥—GLSLçš„å¥—æ•°ã€‚å› ä¸ºæ¯å¥—GLSLéƒ½éœ€è¦ä»é›¶å†™ï¼Œæ‰€ä»¥ä¼šæœ‰å·¨å¤§çš„å®ç°æˆæœ¬</p><p>å¯ä»¥é€šè¿‡â€œä½¿ç”¨é¢„å®šä¹‰çš„å®â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š<br>
<!-- -->æˆ‘ä»¬åªéœ€è¦ä¸ºæ¯ç§æè´¨çš„Shaderå†™ä¸€å¥—é»˜è®¤çš„èƒ½æ”¯æŒå„ç§åŠŸèƒ½çš„GLSLï¼Œåœ¨å…¶ä¸­ç”¨å¤§é‡â€œ#ifdef åŠŸèƒ½å/#else/#endifâ€å°†å„ä¸ªåŠŸèƒ½åˆ†å¼€å¤„ç†ï¼›ç„¶ååœ¨åˆå§‹åŒ–æ—¶ï¼Œåˆ¤æ–­æè´¨æ˜¯å¦æ”¯æŒæŸä¸ªåŠŸèƒ½ï¼Œæ”¯æŒçš„è¯åˆ™åœ¨é»˜è®¤çš„GLSLçš„åŸºç¡€ä¸ŠåŠ å…¥&quot;#define åŠŸèƒ½å&quot;æ¥å¼€å¯è¯¥åŠŸèƒ½ï¼Œæˆä¸ºä¸€å¥—æ–°çš„æ”¯æŒè¯¥åŠŸèƒ½çš„GLSLã€‚è¿™æ ·çš„è¯å°±å¯ä»¥åœ¨é»˜è®¤çš„GLSLåŸºç¡€ä¸Šåˆ›å»ºå‡ºåˆ†åˆ«æ”¯æŒå„ç§æƒ…å†µçš„å…«å¥—GLSLäº†  </p><p>ç°åœ¨è¦å®ç°å…«å¥—GLSLï¼Œä¸éœ€è¦ä»é›¶å®ç°ï¼Œè€Œåªéœ€å†™ä¸€å¥—é»˜è®¤çš„GLSLï¼Œç„¶ååœ¨å®ƒçš„åŸºç¡€ä¸ŠåŠ å…¥ä¸åŒçš„&quot;#define åŠŸèƒ½å&quot;å³å¯ï¼Œå¤§å¤§å‡å°‘äº†å®ç°æˆæœ¬</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-a0958a93553798f9189aef50ffff4ce1.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€GLSLã€å¼•æ“è¿™ä¸‰ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>æˆ‘ä»¬çœ‹ä¸‹GLSLè¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>BasicMaterialShaderGLSLï¼ˆDefaultï¼‰æ˜¯é»˜è®¤çš„é€šè¿‡é¢„å®šä¹‰å®æ¥æ”¯æŒåŸºç¡€æè´¨çš„Shaderçš„å„ç§åŠŸèƒ½çš„ä¸€å¥—GLSL</p><p>BasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰æ˜¯åœ¨BasicMaterialShaderGLSLï¼ˆDefaultï¼‰åŸºç¡€ä¸ŠåŠ å…¥Defineå˜é‡ï¼Œæ¥æ”¯æŒåŸºç¡€æè´¨çš„Shaderçš„æŸäº›åŠŸèƒ½çš„ä¸€å¥—GLSLã€‚æœ€å¤šæœ‰å››å¥—BasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰ï¼Œåˆ†åˆ«å¯¹åº”åŸºç¡€æè´¨çš„Shaderçš„å››ç§æƒ…å†µ</p><p>PBRMaterialShaderGLSLï¼ˆDefaultï¼‰æ˜¯é»˜è®¤çš„é€šè¿‡é¢„å®šä¹‰å®æ¥æ”¯æŒPBRæè´¨çš„å„ç§åŠŸèƒ½çš„ä¸€å¥—GLSL</p><p>PBRMaterialShaderGLSLï¼ˆAdd Defineï¼‰æ˜¯åœ¨PBRMaterialShaderGLSLï¼ˆDefaultï¼‰åŸºç¡€ä¸ŠåŠ å…¥Defineå˜é‡ï¼Œæ¥æ”¯æŒPBRæè´¨çš„Shaderçš„æŸäº›åŠŸèƒ½çš„ä¸€å¥—GLSLã€‚æœ€å¤šæœ‰å››å¥—PBRMaterialShaderGLSLï¼ˆAdd Defineï¼‰ï¼Œåˆ†åˆ«å¯¹åº”PBRæè´¨çš„Shaderçš„å››ç§æƒ…å†µ</p><p>æˆ‘ä»¬çœ‹ä¸‹å¼•æ“è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Engineæ˜¯å¼•æ“çš„é—¨æˆ·ï¼Œè´Ÿè´£æä¾›APIç»™Client</p><p>InitBasicMaterialShaderè´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderï¼Œå®ƒåˆ¤æ–­åŸºç¡€æè´¨çš„Shaderæ˜¯å¦æ”¯æŒåŠŸèƒ½ï¼Œæ”¯æŒçš„è¯å°±å°†BasicMaterialShaderGLSLï¼ˆDefaultï¼‰ä¿®æ”¹ä¸ºBasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰ï¼Œç„¶åä½¿ç”¨å®ƒæ¥åˆ›å»ºå¯¹åº”çš„Shaderã€‚</p><p>InitPBRMaterialShaderè·ŸInitBasicMaterialShaderç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹æ˜¯åˆå§‹åŒ–çš„å¯¹è±¡ç”±åŸºç¡€æè´¨å˜ä¸ºPBRæè´¨</p><p>Renderè´Ÿè´£æ¸²æŸ“ï¼Œå®ƒä¼šéå†æ‰€æœ‰çš„GameObjectsï¼Œè·å¾—å¹¶å‘é€å®ƒä»¬çš„é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç ">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç " title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹Clientä»£ç ä¸­æ¯ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºEngineStateçš„ä»£ç </li><li>åˆ›å»ºåœºæ™¯çš„ä»£ç </li><li>åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderçš„ä»£ç </li><li>åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderçš„ä»£ç </li><li>æ¸²æŸ“åœºæ™¯çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç ">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sceneData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ClientUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sceneData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">allBasicMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allPBRMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sceneData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initBasicMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allBasicMaterials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initPBRMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allPBRMaterials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initCamera</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Clienté¦–å…ˆåˆ›å»ºäº†å¼•æ“çš„EngineStateï¼Œç”¨æ¥ä¿å­˜å¼•æ“çš„æ‰€æœ‰æ•°æ®ï¼›ç„¶ååˆ›å»ºäº†åœºæ™¯ï¼›ç„¶ååˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderï¼›ç„¶ååˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderï¼›æ¥ç€åˆå§‹åŒ–ç›¸æœºï¼Œè®¾ç½®ä¸å‡çš„è§†å›¾çŸ©é˜µå’Œé€è§†çŸ©é˜µï¼›æœ€åæ¸²æŸ“åœºæ™¯</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºenginestateçš„ä»£ç ">åˆ›å»ºEngineStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºenginestateçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isSupportInstance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†EngineStateã€‚åœ¨åˆ›å»ºçš„EngineStateä¸­ï¼Œé€šè¿‡è®¾ç½®å­—æ®µisSupportInstanceæ¥è®¾ç½®æ˜¯å¦æ”¯æŒInstanceï¼ˆæ­¤å¤„è®¾ç½®ä¸ºæ”¯æŒï¼‰</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºåœºæ™¯çš„ä»£ç ">åˆ›å»ºåœºæ™¯çš„ä»£ç <a class="hash-link" href="#åˆ›å»ºåœºæ™¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ClientUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createScene</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºgameObject1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºåŸºç¡€æè´¨basicMaterial1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®basicMaterial1çš„è´´å›¾</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºtransform1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®transform1çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æŒ‚è½½basicMaterial1ã€transform1åˆ°gameObject1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºgameObject2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»º</span><span class="token constant" style="color:#36acaa">PBR</span><span class="token plain">æè´¨pbrMaterial1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºtransform2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®transform2çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æŒ‚è½½pbrMaterial1ã€transform2åˆ°gameObject2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºgameObject3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºåŸºç¡€æè´¨basicMaterial2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®basicMaterial2çš„è´´å›¾</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    åˆ›å»ºtransform3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è®¾ç½®transform3çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æŒ‚è½½basicMaterial2ã€transform3åˆ°gameObject3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›stateå’Œåˆ›å»ºçš„æ‰€æœ‰ç»„ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createSceneå‡½æ•°åˆ›å»ºäº†åœºæ™¯ï¼Œåœºæ™¯åŒ…æ‹¬3ä¸ªgameObjectï¼Œ2ä¸ªåŸºç¡€æè´¨ç»„ä»¶ï¼ˆbasicMaterial1ã€basicMaterial2ï¼‰ã€1ä¸ªPBRæè´¨ç»„ä»¶ï¼ˆpbrMaterial1ï¼‰ã€3ä¸ªtransformç»„ä»¶ã€‚å…¶ä¸­basicMaterial1ã€basicMaterial2æœ‰è´´å›¾ï¼ŒpbrMaterial1æ²¡æœ‰è´´å›¾ï¼›gameObject1ã€gameObject3æŒ‚è½½äº†åŸºç¡€æè´¨ç»„ä»¶ï¼ŒgameObject2æŒ‚è½½äº†PBRæè´¨ç»„ä»¶</p><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼š<br>
<!-- -->æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ECSæ¨¡å¼çš„æ€è·¯ï¼Œåœ¨åœºæ™¯ä¸­åˆ›å»ºçš„æ‰€æœ‰çš„GameObjectå’Œç»„ä»¶éƒ½åªæ˜¯ä¸€ä¸ªnumberç±»å‹çš„å€¼è€Œå·²</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„shaderçš„ä»£ç ">åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderçš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„shaderçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>InitBasicMaterialShader</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> initBasicMaterialShader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allMaterials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">material</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InitMaterialShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _buildGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicMaterialShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allMaterials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      programMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      maxShaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      basicMaterialShaderIndexMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newShaderIndexMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InitMaterialShaderUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">initMaterialShader</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buildGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allMaterials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> allMaterials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> glsl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildGLSL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">generateShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            programMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createFakeProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glsl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">glslMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            glslMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;shaderIndex:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newMaxShaderIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initBasicMaterialShaderå‡½æ•°åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderï¼Œå®ƒè°ƒç”¨InitMaterialShaderUtilsçš„initMaterialShaderå‡½æ•°æ¥éå†äº†æ‰€æœ‰çš„åŸºç¡€æè´¨ï¼Œåˆ›å»ºäº†åŸºç¡€æè´¨å¯¹åº”çš„shaderIndexå’Œprogramï¼Œå°†å…¶åˆ†åˆ«ä¿å­˜åœ¨EngineStateçš„basicMaterialShaderIndexMapã€programMapä¸­</p><p>è¿™é‡Œæ–°æå‡ºäº†shaderIndexçš„æ¦‚å¿µï¼Œå®ƒæ˜¯shaderçš„ç´¢å¼•ï¼Œä¸€ä¸ªshaderIndexå¯¹åº”ä¸€ä¸ªShaderã€‚å®ƒä»¬çš„å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img alt="Materialã€ShaderIndexã€Programã€GLSLå¯¹åº”å…³ç³»å›¾" src="/3dProgramPattern/assets/images/MaterialShaderIndexProgram-0c85b1ddfbe02a5b2d99460e9b2dc39d.png"></p><p>åœ¨åé¢æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆé€šè¿‡Materialæ‹¿åˆ°ShaderIndexï¼Œç„¶åé€šè¿‡ShaderIndexå†æ‹¿åˆ°Programï¼Œæœ€åuseè¯¥Program</p><p>initBasicMaterialShaderå‡½æ•°è°ƒç”¨äº†_buildGLSLå‡½æ•°æ¥æ„é€ BasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰ï¼Œå®ƒçš„å®ç°ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->initBasicMaterialShader</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_buildDefaultVSGLSL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef NO_INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">attribute vec3 a_position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">uniform mat4 u_vMatrix;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">uniform mat4 u_pMatrix;</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">void main(void){</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  mat4 mMatrix = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef NO_INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  mat4 mMatrix = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  gl_Position = u_pMatrix * u_vMatrix * mMatrix * vec4(a_position, 1.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_buildDefaultFSGLSL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">void main(void){</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  vec4 totalColor = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#ifdef NO_MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  vec4 totalColor = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  gl_FragColor = vec4(totalColor.rgb, totalColor.a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _addDefine </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glsl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#define &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> glsl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _buildGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> vsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_buildDefaultVSGLSL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_buildDefaultFSGLSL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isSupportInstance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSTANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NO_INSTANCE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hasBasicMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicMaterialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MAP&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MAP&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NO_MAP&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fsGLSL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addDefine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NO_MAP&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fsGLSL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_buildGLSLå‡½æ•°é¦–å…ˆæ„é€ äº†BasicMaterialShaderGLSLï¼ˆDefaultï¼‰ï¼›ç„¶åæ ¹æ®å¯¹Instanceçš„æ”¯æŒæƒ…å†µä»¥åŠæè´¨æ˜¯å¦æœ‰è´´å›¾çš„åˆ¤æ–­ï¼Œåœ¨BasicMaterialShaderGLSLï¼ˆDefaultï¼‰çš„åŸºç¡€ä¸ŠåŠ å…¥å¯¹åº”çš„Defineå˜é‡ï¼›æœ€åè¿”å›ä¿®æ”¹åçš„ä¸€å¥—GLSLï¼Œå³è¿”å›BasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰</p><p>æˆ‘ä»¬ç»§ç»­å›åˆ°InitMaterialShaderUtilsçš„initMaterialShaderå‡½æ•°ï¼Œå®ƒåœ¨è°ƒç”¨ä¼ è¿›æ¥çš„buildGLSLå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯InitBasicMaterialShaderçš„_buildGLSLå‡½æ•°ï¼‰åï¼Œè°ƒç”¨äº†generateShaderIndexå‡½æ•°æ¥ç”ŸæˆshaderIndexï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->InitMaterialShaderUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">initMaterialShader</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buildGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allMaterials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> glsl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildGLSL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">generateShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//å¦‚æœæ˜¯ä¹‹å‰çš„shaderIndexï¼Œåˆ™ä¸åˆ›å»ºæ–°çš„Program</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            programMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createFakeProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glsl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ShaderUtils</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">vsGLSL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">fsGLSL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">glsl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vsGLSL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fsGLSL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">glslMap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> generateShaderIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findEntry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">maxShaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">getExnFromStrictUndefined</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>generateShaderIndexå‡½æ•°æ¯”è¾ƒäº†æ–°çš„GLSLæ˜¯å¦ä¸ä¹‹å‰çš„GLSLç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒï¼Œåˆ™è¿”å›æ–°çš„shaderIndexï¼›å¦åˆ™è¿”å›ä¹‹å‰çš„GLSLå¯¹åº”çš„shaderIndexã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–ï¼Œä½¿å¾—æ”¯æŒåŒæ ·åŠŸèƒ½çš„æè´¨å…±äº«åŒä¸€ä¸ªShaderIndexï¼Œä»è€Œå…±äº«åŒä¸€ä¸ªProgram</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–æ‰€æœ‰pbræè´¨çš„shaderçš„ä»£ç ">åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderçš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–æ‰€æœ‰pbræè´¨çš„shaderçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>InitPBRMaterialShaderçš„initPBRMaterialShaderå‡½æ•°å®ç°äº†åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„shaderï¼Œå®ƒä¸InitPBRMaterialShaderçš„initBasicMaterialShaderå‡½æ•°ç±»ä¼¼ï¼Œæ•…çœç•¥äº†ä»£ç ã€‚å®ƒä»¬ä¸åŒçš„åœ°æ–¹ä¸»è¦å¦‚ä¸‹ï¼š</p><ul><li>ä¼ å…¥çš„allMaterialsæ˜¯æ‰€æœ‰çš„PBRæè´¨ç»„ä»¶è€Œä¸æ˜¯æ‰€æœ‰çš„åŸºç¡€æè´¨ç»„ä»¶ï¼›</li><li>ä¼ å…¥InitMaterialShaderUtils.initMaterialShaderå‡½æ•°çš„buildGLSLå‡½æ•°ä¸ä¸€æ ·ï¼Œè¯¥å‡½æ•°æ˜¯ä¿®æ”¹PBRMaterialShaderGLSLï¼ˆDefaultï¼‰è€Œä¸æ˜¯ä¿®æ”¹BasicMaterialShaderGLSLï¼ˆDefaultï¼‰ï¼›</li><li>ç”Ÿæˆçš„shaderIndexæ”¹ä¸ºä¿å­˜åˆ°EngineStateçš„pbrMaterialShaderIndexMapä¸­</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ¸²æŸ“åœºæ™¯çš„ä»£ç ">æ¸²æŸ“åœºæ™¯çš„ä»£ç <a class="hash-link" href="#æ¸²æŸ“åœºæ™¯çš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> programMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">programMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getAllGameObjects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObject </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> materialType_</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getMaterial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> transform </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTransform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gameObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//ä¸åŒçš„æè´¨ä»ä¸åŒçš„shaderIndexMapä¸­å–å¾—shaderIndex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> shaderIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">materialType_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> materialType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Basic</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                shaderIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicMaterialShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> materialType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PBR</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                shaderIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pbrMaterialShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> program </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictUndefined</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">program</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_sendAttributeData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> program</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_sendUniformData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> materialType_</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> program</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å…¶å®ƒæ¸²æŸ“é€»è¾‘...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderå‡½æ•°å®ç°äº†æ¸²æŸ“åœºæ™¯ï¼Œå®ƒéå†æ‰€æœ‰çš„GameObjectï¼Œæ¸²æŸ“æ¯ä¸ªGameObjectã€‚åœ¨æ¯æ¬¡çš„éå†ä¸­ï¼Œé¦–å…ˆè·å¾—æ¯ä¸ªgameObjectçš„ç»„ä»¶ä»¥åŠshaderIndexã€programï¼›ç„¶åå‘é€é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®ï¼›æœ€åæ‰§è¡Œå…¶å®ƒçš„æ¸²æŸ“é€»è¾‘</p><p>æˆ‘ä»¬çœ‹ä¸‹å‘é€é¡¶ç‚¹æ•°æ®çš„ä»£ç ï¼š<br>
<!-- -->Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_sendAttributeData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> program</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLProgram</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GLSL</span><span class="token plain">ä¸­å®šä¹‰äº†a_position</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—å¹¶å‘é€Positionçš„</span><span class="token constant" style="color:#36acaa">VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GLSL</span><span class="token plain">ä¸­å®šä¹‰äº†a_texCoord</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—å¹¶å‘é€TexCoordçš„</span><span class="token constant" style="color:#36acaa">VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isSupportInstance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—å¹¶å‘é€instanceç›¸å…³çš„</span><span class="token constant" style="color:#36acaa">VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">æœ‰ElementArrayBuffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ç»‘å®šElementArrayBuffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_sendAttributeDataå‡½æ•°åˆ¤æ–­äº†GLSLå¯¹é¡¶ç‚¹æ•°æ®çš„å®šä¹‰æƒ…å†µå’Œå¼•æ“å¯¹Instanceçš„æ”¯æŒæƒ…å†µï¼Œè·å¾—å¹¶å‘é€äº†å¯¹åº”çš„VBOæ•°æ®</p><p>æˆ‘ä»¬çœ‹ä¸‹å‘é€Uniformæ•°æ®çš„ä»£ç ï¼š<br>
<!-- -->Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_sendUniformData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> materialType_</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> program</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLProgram</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è·å¾—å¹¶å‘é€ç›¸æœºæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">materialType_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> materialType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Basic</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è·å¾—å¹¶å‘é€åŸºç¡€æè´¨çš„coloræ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hasBasicMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicMaterialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                è·å¾—å¹¶å‘é€åŸºç¡€æè´¨çš„æ™®é€šè´´å›¾æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> materialType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PBR</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è·å¾—å¹¶å‘é€</span><span class="token constant" style="color:#36acaa">PBR</span><span class="token plain">æè´¨çš„diffuseæ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hasDiffuseMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pbrMaterialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                è·å¾—å¹¶å‘é€</span><span class="token constant" style="color:#36acaa">PBR</span><span class="token plain">æè´¨çš„diffuseè´´å›¾æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isSupportInstance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·å¾—å¹¶å‘é€æ¨¡å‹çŸ©é˜µ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>_sendUniformDataå‡½æ•°é¦–å…ˆè·å¾—å¹¶å‘é€äº†ç›¸æœºæ•°æ®ï¼›ç„¶ååœ¨åˆ¤æ–­æè´¨çš„ç§ç±»åï¼Œæ ¹æ®æè´¨å¯¹åŠŸèƒ½çš„æ”¯æŒæƒ…å†µï¼Œè·å¾—å¹¶å‘é€äº†è¯¥ç±»æè´¨çš„æ•°æ®ï¼›æœ€ååˆ¤æ–­å¯¹Instanceçš„æ”¯æŒæƒ…å†µï¼Œå¦‚æœä¸æ”¯æŒçš„è¯åˆ™è·å¾—å¹¶å‘é€æ¨¡å‹çŸ©é˜µ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç ">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæµè§ˆå™¨æ§åˆ¶å°æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆå§‹åŒ–Shaderï¼Œæ‰“å°shaderIndex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">shaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">shaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">shaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å¼€å§‹æ¸²æŸ“ç¬¬ä¸€ä¸ªgameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useProgram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€Positionçš„VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bindBuffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vertexAttribPointer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableVertexAttribArray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€TexCoordçš„VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bindBuffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vertexAttribPointer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableVertexAttribArray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€instanceç›¸å…³çš„VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å‘é€instanceç›¸å…³çš„é¡¶ç‚¹æ•°æ®</span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property-access">å‘é€instanceç›¸å…³çš„é¡¶ç‚¹æ•°æ®</span><span class="token number" style="color:#36acaa">2.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property-access">å‘é€instanceç›¸å…³çš„é¡¶ç‚¹æ•°æ®</span><span class="token number" style="color:#36acaa">3.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property-access">å‘é€instanceç›¸å…³çš„é¡¶ç‚¹æ•°æ®</span><span class="token number" style="color:#36acaa">4.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ç»‘å®šElementArrayBuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bindBuffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€ç›¸æœºæ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniformMatrix4fv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniformMatrix4fv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€åŸºç¡€æè´¨çš„color</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniform3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€åŸºç¡€æè´¨çš„æ™®é€šè´´å›¾æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniform1i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å…¶å®ƒæ¸²æŸ“é€»è¾‘</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å¼€å§‹æ¸²æŸ“ç¬¬äºŒä¸ªgameObject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€PBRæè´¨çš„diffuse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniform3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å‘é€PBRæè´¨çš„diffuseè´´å›¾æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniform1i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å…¶å®ƒæ¸²æŸ“é€»è¾‘</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//å¼€å§‹æ¸²æŸ“ç¬¬ä¸‰ä¸ªgameObjectï¼Œæ‰“å°çš„ç»“æœè·Ÿâ€œæ¸²æŸ“ç¬¬ä¸€ä¸ªgameObjectâ€æ‰“å°çš„è¾“å‡ºä¸€æ ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œé¦–å…ˆåˆå§‹åŒ–Shaderï¼Œæ‰“å°ç”Ÿæˆçš„shaderIndexã€‚å…·ä½“çš„æ‰“å°æƒ…å†µå¦‚ä¸‹ï¼š<br>
<!-- -->1.é¦–å…ˆæ‰“å°äº†ç”Ÿæˆçš„æ‰€æœ‰åŸºç¡€æè´¨ï¼ˆbasicMaterial1ã€basicMaterial2ï¼‰çš„shaderIndexï¼Œå®ƒä»¬éƒ½æ˜¯0ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæè´¨æ­£ç¡®åœ°å…±äº«äº†åŒä¸€ä¸ªShaderï¼ˆå› ä¸ºå®ƒä»¬éƒ½æ˜¯åŸºç¡€æè´¨çš„<!-- -->[æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]<!-- -->çš„æƒ…å†µï¼‰<br>
<!-- -->2.ç„¶åæ‰“å°äº†ç”Ÿæˆçš„æ‰€æœ‰PBRæè´¨ï¼ˆpbrMaterial1ï¼‰çš„shaderIndexï¼Œå®ƒæ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªPBRæè´¨ä¸å¦å¤–ä¸¤ä¸ªåŸºç¡€æè´¨çš„Shaderä¸ä¸€æ ·ï¼ˆå› ä¸ºå®ƒæ˜¯PBRæè´¨çš„<!-- -->[æ²¡æœ‰diffuseè´´å›¾ï¼Œæ”¯æŒInstance]<!-- -->çš„æƒ…å†µï¼‰</p><p>ç„¶åæ¸²æŸ“æ‰€æœ‰çš„gameObjectï¼Œå› ä¸ºå…±æœ‰3ä¸ªgameObjectï¼Œæ‰€ä»¥æ¸²æŸ“äº†3æ¬¡ã€‚å…·ä½“çš„æ¸²æŸ“æƒ…å†µå¦‚ä¸‹ï¼š<br>
<!-- -->1.ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ˜¯gameObject1ï¼Œå®ƒæŒ‚è½½äº†basicMaterial1ç»„ä»¶ï¼Œè¿™æ¬¡æ¸²æŸ“åˆ†åˆ«è¿›è¡Œäº†ä¸‹é¢çš„æ“ä½œï¼šé¦–å…ˆuse programï¼›ç„¶åå‘é€äº†a_positionã€a_texCoordçš„VBOï¼›ç„¶åå‘é€äº†instanceç›¸å…³çš„VBOï¼›ç„¶åç»‘å®šäº†Element Array Buffer;ç„¶åå‘é€äº†ä¸€æ¬¡ç›¸æœºçš„è§†å›¾çŸ©é˜µu_vMatrixå’Œé€è§†çŸ©é˜µu_pMatrixæ•°æ®ï¼›ç„¶åå‘é€äº†ä¸€æ¬¡basicMaterial1çš„coloræ•°æ®ï¼›ç„¶åå‘é€äº†ä¸€æ¬¡basicMaterial1çš„æ™®é€šè´´å›¾æ•°æ®ï¼›æœ€åæ‰§è¡Œå…¶å®ƒæ¸²æŸ“é€»è¾‘<br>
<!-- -->2.ç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ˜¯gameObject2ï¼Œå®ƒæŒ‚è½½äº†pbrMaterial1ç»„ä»¶ï¼Œè¿™æ¬¡æ¸²æŸ“ä¸ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸åŒçš„åœ°æ–¹æ˜¯å‘é€çš„æè´¨æ•°æ®ä¸åŒ<br>
<!-- -->3.ç¬¬ä¸‰æ¬¡æ¸²æŸ“çš„æ˜¯gameObject3ï¼Œå®ƒæŒ‚è½½äº†basicMaterial3ç»„ä»¶ï¼Œè¿™æ¬¡æ¸²æŸ“æ‰“å°çš„ç»“æœä¸ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰“å°çš„ç»“æœä¸€æ ·</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜<a class="hash-link" href="#æå‡ºé—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li><p>GLSLåœ¨å¼•æ“ç«¯å†™æ­»äº†ï¼Œç”¨æˆ·ä¸èƒ½è‡ªå®šä¹‰GLSL</p></li><li><p>åœ¨æ¯æ¬¡æ¸²æŸ“çš„å‘é€é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®æ—¶ï¼Œè¦è¿›è¡Œåˆ†æ”¯åˆ¤æ–­ï¼Œè¿™æ ·å³å¢åŠ äº†ä»£ç çš„ç»´æŠ¤æˆæœ¬ï¼ˆGLSLæ¯å¢åŠ ä¸€ä¸ª#ifdefåˆ†æ”¯ï¼Œæ¸²æŸ“æ—¶ä¹Ÿè¦å¯¹åº”å¢åŠ è¯¥åˆ†æ”¯çš„åˆ¤æ–­ï¼‰ï¼Œä¹Ÿé™ä½äº†æ€§èƒ½ï¼ˆå› ä¸ºæœ‰å„ç§åˆ†æ”¯è·³è½¬ï¼Œæ‰€ä»¥é™ä½äº†CPUçš„ç¼“å­˜å‘½ä¸­ï¼‰</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨æ‹¼æ¥æ¨¡å¼æ¥æ”¹è¿›">ä½¿ç”¨æ‹¼æ¥æ¨¡å¼æ¥æ”¹è¿›<a class="hash-link" href="#ä½¿ç”¨æ‹¼æ¥æ¨¡å¼æ¥æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ¦‚è¿°è§£å†³æ–¹æ¡ˆ">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ul><li>å°†æ”¯æŒå„ç§åŠŸèƒ½çš„é»˜è®¤GLSLåˆ†è§£ä¸ºå¤šä¸ªå°å—</li><li>ç”¨æˆ·ç»™å‡ºGLSLçš„JSONé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šå¦‚ä½•æ‹¼æ¥å°å—çš„GLSLï¼Œä»¥åŠæŒ‡å®šåœ¨æ¸²æŸ“æ—¶éœ€è¦å‘é€çš„é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®çš„é…ç½®æ•°æ®</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºuml-1">ç»™å‡ºUML<a class="hash-link" href="#ç»™å‡ºuml-1" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-16de0fb77fb69672e2a9b35efa49890e.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€æ•°æ®ã€ChunkConverterã€ChunkHandlerã€å¼•æ“è¿™äº”ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><p>Clientæ˜¯ç”¨æˆ·</p><p>æˆ‘ä»¬çœ‹ä¸‹æ•°æ®å’ŒChunkConverterè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>Target GLSLæ˜¯æ”¯æŒæŸäº›åŠŸèƒ½çš„ä¸€å¥—GLSLï¼Œç›¸å½“äºä¹‹å‰çš„BasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰æˆ–è€…PBRMaterialShaderGLSLï¼ˆAdd Defineï¼‰ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯å› ä¸ºTarget GLSLæ²¡æœ‰é¢„å®šä¹‰çš„å®ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰åˆ†æ”¯ï¼Œåªæœ‰æ”¯æŒçš„åŠŸèƒ½çš„GLSLã€‚ä¸€ä¸ªTarget GLSLåŒ…æ‹¬äº†ä¸€ä¸ªVS GLSLå’Œä¸€ä¸ªFS GLSLã€‚è¿™é‡Œæœ€å¤šæœ‰å…«ä¸ªTarget GLSLï¼Œå¯¹åº”äº†åŸºç¡€æè´¨çš„Shaderçš„å››ç§æƒ…å†µå’ŒPBRæè´¨çš„Shaderçš„å››ç§æƒ…å†µ</p><p>Send Metadataæ˜¯è·å¾—å’Œå‘é€é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®çš„å…ƒæ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªSend MetadataåŒ…æ‹¬äº†å¤šä¸ªgetDataå‡½æ•°å’Œå¤šä¸ªsendDataå‡½æ•°ï¼Œå‰è€…è·å¾—å¯¹åº”çš„é¡¶ç‚¹æ•°æ®æˆ–è€…Uniformæ•°æ®ï¼Œåè€…å‘é€å®ƒä»¬ã€‚å› ä¸ºä¸€ä¸ªSend Metadataå¯¹åº”ä¸€ä¸ªTarget GLSLï¼Œæ‰€ä»¥æœ€å¤šæœ‰8ä¸ªSend Metadata</p><p>GLSL Configæ˜¯GLSLçš„JSONé…ç½®æ–‡ä»¶ï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•æ‹¼æ¥Target GLSLï¼Œå¹¶åŒ…æ‹¬äº†Send Metadataçš„é…ç½®æ•°æ®ã€‚GLSL Configçš„å†…å®¹ç”±ç”¨æˆ·ç»™å‡ºï¼Œæ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯ç±»å‹ï¼‰ç”±ChunkHandlerå®šä¹‰</p><p>GLSL Chunkæ˜¯ä¸€å°å—çš„GLSLï¼Œæœ‰å¤šä¸ªGLSL Chunkï¼Œå®ƒä»¬ç”±å¼•æ“ç»™å‡ºã€‚ä¸€ä¸ªGLSL Chunkå¯ä»¥æ˜¯VS GLSLä¸­ä¸€å°å—GLSLæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯FS GLSLä¸­ä¸€å°å—GLSLæ–‡ä»¶</p><p>ChunkConverterè´Ÿè´£è½¬æ¢GLSL Chunkã€‚å› ä¸ºGLSL Chunkæ˜¯è‡ªå®šä¹‰æ–‡ä»¶ï¼Œæœ‰ä¸€äº›è‡ªå®šä¹‰çš„è¯­æ³•ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å¼•æ“éœ€è¦è°ƒç”¨gulpä»»åŠ¡æ¥å¯¹å…¶é¢„å¤„ç†ã€‚gulpä»»åŠ¡è°ƒç”¨äº†ChunkConverteræ¥å¤„ç†æ‰€æœ‰çš„GLSL Chunkï¼Œå¹¶å°†å…¶åˆå¹¶ä¸ºä¸€ä¸ªMerged GLSL Chunkï¼Œæˆä¸ºä¸€ä¸ªTypescriptæˆ–è€…Rescriptæ–‡ä»¶</p><p>æˆ‘ä»¬çœ‹ä¸‹ChunkHandlerå’Œå¼•æ“è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>ChunkHandlerè´Ÿè´£æ‹¼æ¥Target GLSLå’Œæ„é€ Send Metadata</p><p>Engineã€Renderè·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯Renderç°åœ¨ä¼šä½¿ç”¨Send Metadataæ¥è·å¾—å¹¶å‘é€é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®</p><p>InitMaterialShaderè´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰æè´¨çš„Shaderï¼Œå®ƒæœ‰ä¸¤ä¸ªå‡½æ•°ï¼šinitBasicMaterialShaderã€initPBRMaterialShaderï¼Œåˆ†åˆ«è´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderå’Œåˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderã€‚è¿™ä¸¤ä¸ªå‡½æ•°éå†äº†æ‰€æœ‰çš„åŸºç¡€æè´¨æˆ–è€…PBRæè´¨ï¼Œåœ¨æ¯æ¬¡éå†ä¸­çš„æ­¥éª¤ä¸€æ ·ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br>
<!-- -->1.é€šè¿‡è°ƒç”¨ChunkHandlerçš„buildGLSLå‡½æ•°ï¼ŒæŒ‰ç…§GLSL Configå°†Merged GLSL Chunkä¸­å¯¹åº”çš„GLSL Chunkæ‹¼æ¥ä¸ºä¸€ä¸ªTarget GLSLï¼Œç„¶åä½¿ç”¨å®ƒæ¥åˆ›å»ºæè´¨å¯¹åº”çš„shaderIndexå’Œprogram<br>
<!-- -->2.é€šè¿‡è°ƒç”¨ChunkHandlerçš„buildSendMetadataå‡½æ•°ï¼ŒæŒ‰ç…§GLSL Configæ„é€ Send Metadata</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜<a class="hash-link" href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" title="Direct link to heading">â€‹</a></h3><ul><li><p>ç°åœ¨ç”¨æˆ·å¯ä»¥é€šè¿‡GLSL Configæ¥è‡ªå®šä¹‰GLSL</p></li><li><p>åœ¨æ¯æ¬¡æ¸²æŸ“çš„å‘é€é¡¶ç‚¹æ•°æ®å’ŒUniformæ•°æ®æ—¶ï¼Œç°åœ¨ä¸éœ€è¦è¿›è¡Œåˆ†æ”¯åˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥éå†Send Metadataï¼Œé€šè¿‡å®ƒçš„getDataã€sendDataå‡½æ•°æ¥è·å¾—å’Œå‘é€æ•°æ®</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç»™å‡ºä»£ç -1">ç»™å‡ºä»£ç <a class="hash-link" href="#ç»™å‡ºä»£ç -1" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹GLSL Configçš„ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientä»£ç ä¸­ç¬¬äºŒä¸ªæ­¥éª¤çš„ä»£ç ï¼šåˆ›å»ºEngineStateçš„ä»£ç <br>
<!-- -->ç„¶åï¼Œå› ä¸ºEngineStateä¿å­˜äº†Merged GLSL Chunkï¼Œè€Œå®ƒæ˜¯åˆå¹¶GLSL Chunkè€Œæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸‹GLSL Chunkçš„è¯´æ˜ï¼Œå†çœ‹ä¸‹Merged GLSL Chunkçš„ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientä»£ç ä¸­å‰©ä½™æ­¥éª¤çš„ä»£ç ï¼Œå®ƒä»¬åŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderçš„ä»£ç </li><li>åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderçš„ä»£ç </li><li>æ¸²æŸ“åœºæ™¯çš„ä»£ç </li></ul><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="glsl-configçš„ä»£ç ">GLSL Configçš„ä»£ç <a class="hash-link" href="#glsl-configçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>GLSL ConfigåŒ…æ‹¬ä¸¤ä¸ªJSONæ–‡ä»¶ï¼šshaders.jsonå’Œshader_chunks.jsonï¼Œå®ƒä»¬çš„æ ¼å¼å®šä¹‰åœ¨ChunkHandlerçš„GLSLConfigTypeä¸­ï¼Œå®ƒä»¬çš„å†…å®¹ç”±ç”¨æˆ·ç»™å‡ºã€‚å…¶ä¸­shaders.jsonæ–‡ä»¶å®šä¹‰äº†æ‰€æœ‰ç§ç±»çš„Shaderçš„GLSLé…ç½®æ•°æ®ï¼Œshader_chunks.jsonæ–‡ä»¶æ˜¯å®šä¹‰äº†æ‰€æœ‰çš„GLSL Chunkçš„é…ç½®æ•°æ®</p><p>å› ä¸ºä¸€ç§Shaderå¯¹åº”ä¸€ç§æè´¨ï¼Œç›®å‰åªæœ‰ä¸¤ç§æè´¨ï¼Œæ‰€ä»¥å…±æœ‰ä¸¤ç§Shaderï¼Œå› æ­¤shaders.jsonæ–‡ä»¶å®šä¹‰äº†ä¸¤ç§Shaderçš„GLSLé…ç½®æ•°æ®</p><p>shader_chunks.jsonæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ å®šä¹‰äº†ä¸€å¥—GLSL Chunkçš„é…ç½®æ•°æ®ï¼Œå®ƒæœ€å¤šå…³è”ä¸¤ä¸ªGLSL Chunkï¼ˆåˆ†åˆ«å±äºVS GLSLã€FS GLSLï¼‰ï¼Œå¹¶åŒ…æ‹¬äº†å…¶ä¸­çš„é¡¶ç‚¹ã€Uniformçš„Send Metadataçš„é…ç½®æ•°æ®</p><p>è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å…³ç³»æ˜¯â€œæ€»-åˆ†â€çš„å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼Œå› ä¸ºæ¯ç§Shaderçš„GLSLç”±å¤šä¸ªGLSL Chunkç»„åˆæ‹¼æ¥è€Œæˆï¼Œæ‰€ä»¥shaders.jsonæ˜¯â€œæ€»â€ï¼Œshader_chunks.jsonæ˜¯â€œåˆ†â€ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä¸»è¦ä»£ç ï¼š<br>
<!-- -->shaders.jsonçš„ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š  </p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;static_branchs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_noInstance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;dynamic_branchs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_has_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;pass&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;fail&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no_basic_map&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;diffuse_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;diffuse_has_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;pass&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;diffuse_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;fail&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no_diffuse_map&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;groups&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;shaders&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render_basic&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;shader_chunks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;group&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dynamic_branch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_map&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;static_branch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_end&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render_pbr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;shader_chunks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;group&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dynamic_branch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;diffuse_map&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;static_branch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸‹é¢ä»‹ç»å„ä¸ªä¸€çº§å­—æ®µï¼š</p><ul><li><p>static_branchså­—æ®µå®šä¹‰äº†æ‰€æœ‰åœ¨è¿è¡Œæ—¶ä¸ä¼šå˜åŒ–çš„åˆ†æ”¯åˆ¤æ–­çš„é…ç½®æ•°æ®ã€‚æ¯”å¦‚â€œæ˜¯å¦æ”¯æŒInstanceâ€å°±å±äºè¿™ç±»åˆ¤æ–­ï¼Œå› ä¸ºå®ƒè·Ÿå¼•æ“æ˜¯å¦æ”¯æŒInstanceæœ‰å…³ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶å˜åŒ–ã€‚static_branchså­—æ®µä¸­çš„valueå­—æ®µåŒ…æ‹¬äº†å„ä¸ªåˆ†æ”¯å¯¹åº”çš„GLSL Chunkï¼Œå®ƒä»¬è·Ÿshader_chunks.jsonçš„æ•°ç»„å…ƒç´ çš„nameå…³è”</p></li><li><p>dynamic_branchså­—æ®µå®šä¹‰äº†æ‰€æœ‰åœ¨è¿è¡Œæ—¶ä¼šå˜åŒ–çš„åˆ†æ”¯åˆ¤æ–­çš„é…ç½®æ•°æ®ã€‚æ¯”å¦‚åŸºç¡€æè´¨å’ŒPBRæè´¨çš„â€œæ˜¯å¦æœ‰è´´å›¾â€å°±å±äºè¿™ç±»åˆ¤æ–­ï¼Œå› ä¸ºå¯èƒ½åœ¨è¿è¡Œæ—¶è®¾ç½®æˆ–è€…ç§»é™¤æè´¨çš„è´´å›¾ã€‚dynamic_branchså­—æ®µä¸­çš„conditionã€passã€failå­—æ®µçš„å€¼åˆ†åˆ«ä¸ºæ¡ä»¶åˆ¤æ–­ã€æˆåŠŸã€å¤±è´¥å¯¹åº”çš„GLSL Chunkï¼Œå®ƒä»¬è·Ÿshader_chunks.jsonçš„æ•°ç»„å…ƒç´ çš„nameå…³è”</p></li><li><p>groupså­—æ®µå®šä¹‰äº†å¤šç»„GLSL Chunkï¼Œæ¯ç»„çš„valueå­—æ®µåŒ…æ‹¬äº†å¤šä¸ªGLSL Chunkï¼Œå®ƒä»¬è·Ÿshader_chunks.jsonçš„æ•°ç»„å…ƒç´ çš„nameå…³è”</p></li><li><p>shaderså­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®šä¹‰äº†æ‰€æœ‰ç§ç±»çš„Shaderçš„GLSLé…ç½®æ•°æ®ï¼Œå…·ä½“åŒ…æ‹¬nameä¸ºrender_basicçš„åŸºç¡€æè´¨çš„Shaderå’Œnameä¸ºrender_pbrçš„PBRæè´¨çš„Shaderçš„GLSLé…ç½®æ•°æ®ã€‚æ¯ç§Shaderçš„GLSLç”±å¤šä¸ªGLSL Chunkç»„åˆæ‹¼æ¥è€Œæˆï¼Œå®ƒä»¬å®šä¹‰åœ¨shaderså­—æ®µçš„æ•°ç»„å…ƒç´ çš„shader_chunkså­—æ®µä¸­<br>
<!-- -->å€¼å¾—è¯´æ˜çš„æ˜¯ï¼š<br>
<!-- -->å®é™…ä¸Šä¹Ÿå­˜åœ¨æ²¡æœ‰æè´¨çš„Shaderï¼Œå¦‚åå¤„ç†ï¼ˆå¦‚ç»˜åˆ¶è½®å»“ï¼‰çš„Shaderã€å¤©ç©ºç›’çš„Shaderç­‰ï¼Œè¿™äº›ç§ç±»çš„Shaderä¹Ÿå®šä¹‰åœ¨shaderså­—æ®µï¼Œåªæ˜¯æ²¡æœ‰å¯¹åº”æè´¨è€Œå·²ã€‚è¿™ç§Shaderæˆ‘ä»¬ä¼šåœ¨åé¢çš„æ‰©å±•ä¸­è®¨è®º  </p><ul><li>åœ¨shader_chunkså­—æ®µä¸­ï¼Œå¦‚æœtypeä¸ºstatic_branchï¼Œé‚£ä¹ˆå°±é€šè¿‡nameå…³è”åˆ°static_branchså­—æ®µï¼›å¦‚æœtypeä¸ºdynamic_branchï¼Œé‚£ä¹ˆå°±é€šè¿‡nameå…³è”åˆ°dynamic_branchså­—æ®µï¼›å¦‚æœtypeä¸ºgroupï¼Œé‚£ä¹ˆå°±é€šè¿‡nameå…³è”åˆ°groupså­—æ®µï¼›å¦‚æœæ²¡æœ‰å®šä¹‰typeï¼Œé‚£ä¹ˆå°±é€šè¿‡nameå…³è”åˆ°shader_chunks.jsonçš„æ•°ç»„å…ƒç´ çš„name</li></ul></li></ul><p>è¿™äº›ä¸€çº§å­—æ®µçš„å…³ç³»å¦‚ä¸‹ï¼š<br>
<!-- -->shaderså­—æ®µæ˜¯ä¸»å­—æ®µï¼Œå…¶å®ƒçš„ä¸€çº§å­—æ®µéƒ½åªæ˜¯shaderså­—æ®µçš„æ•°ç»„å…ƒç´ çš„shader_chunksä¸­å¯¹åº”typeçš„é…ç½®æ•°æ®è€Œå·²</p><p>shader_chunks.jsonçš„ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;glsls&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;vs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;common_vertex&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;common_fragment&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;variables&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;uniforms&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;u_vMatrix&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;field&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;vMatrix&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mat4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;from&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;camera&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;glsls&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;vs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;modelMatrix_instance_vertex&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;variables&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;attributes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a_mVec4_0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;buffer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;vec4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸‹é¢ä»‹ç»æ•°ç»„å…ƒç´ ä¸­å„ä¸ªä¸€çº§å­—æ®µï¼š</p><ul><li>nameå­—æ®µæ˜¯ä¸€å¥—GLSL Chunkçš„åç§°ï¼Œä¸shaders.jsonå…³è”</li><li>glslså­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæœ€å¤šæœ‰ä¸¤ä¸ªæ•°ç»„å…ƒç´ ï¼Œå®šä¹‰äº†ä¸€å¥—GLSL Chunkï¼Œå…¶ä¸­å¦‚æœå®ƒçš„æ•°ç»„å…ƒç´ çš„typeä¸ºvsæˆ–è€…fsï¼Œåˆ™nameåˆ†åˆ«ä¸ºå±äºVS GLSLçš„GLSL Chunkæˆ–è€…å±äºFS GLSLçš„GLSL Chunkçš„æ–‡ä»¶åï¼›</li><li>variableså­—æ®µå®šä¹‰äº†è¿™å¥—GLSL Chunkä¸­é¡¶ç‚¹ã€Uniformæ•°æ®çš„Send Metadataçš„é…ç½®æ•°æ®</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„ä»£ç -1">Clientçš„ä»£ç <a class="hash-link" href="#clientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> parsedConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parseConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shadersJson</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderChunksJson</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>shadersJsonã€shadersChunkJsonæ˜¯åŠ è½½shaders.jsonã€shader_chunks.jsonæ–‡ä»¶åå¾—åˆ°çš„JSON</p><p>Clienté€šè¿‡Engineçš„parseConfigå‡½æ•°æ¥è°ƒç”¨ChunkHandlerçš„parseConfigå‡½æ•°ï¼Œå¯¹GLSL Configè¿›è¡Œè§£æã€‚å› ä¸ºChunkHandleræ˜¯Rescriptå†™çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨parseConfigå‡½æ•°ä¸­å°†JSONè½¬æ¢ä¸ºRescriptçš„æ•°æ®æ ¼å¼-Recordã€‚å¦‚æœChunkHandleræ˜¯ä½¿ç”¨Typescriptå†™çš„ï¼Œåˆ™ä¸éœ€è¦ChunkHandlerä¸éœ€è¦parseConfigå‡½æ•°ï¼ŒClientä¹Ÿä¸éœ€è¦è°ƒç”¨parseConfigå‡½æ•°</p><p>ç»§ç»­çœ‹Clientåé¢çš„ä»£ç ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsedConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sceneData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ClientUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createScene</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sceneData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">allBasicMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allPBRMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sceneData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initBasicMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">allBasicMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render_basic&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initPBRMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">allPBRMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;render_pbr&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initCamera</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œçš„æ­¥éª¤è·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼š</p><ul><li>åœ¨è°ƒç”¨initBasicMaterialShaderã€initPBRMaterialShaderå‡½æ•°æ—¶ï¼Œåˆ†åˆ«æ–°ä¼ å…¥äº†&quot;render_basic&quot;ã€&quot;render_pbr&quot;è¿™ä¸ªå‚æ•°ï¼Œå®ƒç”¨æ¥æŒ‡å®šä½¿ç”¨shaders.jsonçš„shaderså­—æ®µä¸­å¯¹åº”çš„Shaderç§ç±»çš„GLSLé…ç½®æ•°æ®</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆ›å»ºenginestateçš„ä»£ç -1">åˆ›å»ºEngineStateçš„ä»£ç <a class="hash-link" href="#åˆ›å»ºenginestateçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Engine</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaders</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderChunks</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shaders</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shaderChunks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isSupportInstance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chunk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> MergedGLSLChunk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>createStateå‡½æ•°åˆ›å»ºäº†EngineStateã€‚åœ¨åˆ›å»ºçš„EngineStateä¸­ï¼Œä¸»è¦æ–°å¢äº†ä¸‹é¢çš„å†…å®¹ï¼š</p><ul><li>ä¿å­˜äº†GLSL Configï¼ˆshadersã€shaderChunksï¼‰ï¼›</li><li>è°ƒç”¨äº†Merged GLSL Chunkçš„getDataå‡½æ•°æ¥è·å¾—å®ƒçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åˆå¹¶åçš„æ‰€æœ‰çš„GLSL Chunkï¼Œå°†å…¶ä¿å­˜åˆ°chunkå­—æ®µä¸­</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="glsl-chunkçš„è¯´æ˜">GLSL Chunkçš„è¯´æ˜<a class="hash-link" href="#glsl-chunkçš„è¯´æ˜" title="Direct link to heading">â€‹</a></h4><p>å¼•æ“å®šä¹‰çš„GLSL Chunkæ–‡ä»¶å…·ä½“æ˜¯åç¼€åä¸º.glslçš„æ–‡ä»¶ã€‚æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„å­—ç¬¦ï¼š@topã€@defineã€@varDeclareã€@funcDeclareã€@funcDefineã€@bodyä»¥åŠå¯¹åº”çš„@endï¼Œå°†ä¸€ä¸ªå®Œæ•´çš„GLSLåˆ†å‰²ä¸ºä»ä¸Šå¾€ä¸‹çš„ä¸åŒåŒºåŸŸçš„ä»£ç ç‰‡æ®µï¼Œè¿™æ ·ä¾¿äºæ›´ç»†ç²’åº¦çš„ç»„åˆæ‹¼æ¥</p><p>ä¸€ä¸ªGLSL Chunkå¯ä»¥åŒ…æ‹¬å¤šä¸ªåŒºåŸŸçš„ä»£ç ç‰‡æ®µã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬çœ‹ä¸‹diffuseè´´å›¾ç›¸å…³çš„.glslæ–‡ä»¶ï¼š<br>
<!-- -->webgl1_diffuse_map_fragment.glsl</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">varDeclare</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec2 v_diffuseMapCoord0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 texelColor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">texture2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u_diffuseMapSampler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v_diffuseMapCoord0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 totalColor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">texelColor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rgb </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> u_color</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> texelColor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¯¥GLSL ChunkåŒ…æ‹¬äº†ä¸¤ä¸ªåŒºåŸŸï¼ˆ@varDeclareã€@bodyï¼‰çš„ä»£ç ç‰‡æ®µï¼Œå…¶ä¸­@varDeclareåŒ…æ‹¬äº†å˜é‡å£°æ˜çš„ä»£ç ï¼Œ@bodyåŒ…æ‹¬äº†mainå‡½æ•°ä¸­çš„ä»£ç </p><p>å…¶å®ƒåŒºåŸŸåŒ…æ‹¬çš„ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>@topåŒ…æ‹¬äº†defineä¹‹å‰çš„ä»£ç ï¼Œå¦‚ç²¾åº¦ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹:</li></ul><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">precision highp float;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>@defineåŒ…æ‹¬äº†defineçš„ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</li></ul><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@define</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">define B 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>@funcDeclareåŒ…æ‹¬äº†å‡½æ•°å£°æ˜çš„ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</li></ul><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@funcDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 getDirectionLightDirByLightPos(vec3 lightPos);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>@funcDefineåŒ…æ‹¬äº†å‡½æ•°å®ç°çš„ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</li></ul><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@funcDefine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 getDirectionLightDirByLightPos(vec3 lightPos){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return lightPos - vec3(0.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸€ä¸ªGLSL Chunkè¿˜å¯ä»¥é€šè¿‡&quot;#import ç›¸å¯¹è·¯å¾„&quot;æ¥å¼•å…¥å…¶å®ƒçš„GLSL Chunkï¼Œå¦‚common_vertex.glslï¼š</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@define</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#import &quot;common_define&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@funcDefine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#import &quot;common_function&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒå¼•å…¥äº†åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹çš„common_defineçš„defineä»£ç ç‰‡æ®µå’Œcommon_functionçš„funcDefineä»£ç ç‰‡æ®µ</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹å®šä¹‰äº†æ‰€æœ‰ç‰‡æ®µçš„GLSL Chunkæ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">precision highp float;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@define</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">define B 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@varDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec2 v_mapCoord2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@funcDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 func2(vec3 lightPos);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@funcDefine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 func2(vec3 lightPos){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return vec3(0.5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gl_FragColor = vec4(1.0,0.5,1.0,1.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒå…¶å®æ˜¯å¯¹ä¸‹é¢è¿™ä¸ªå®Œæ•´çš„GLSLä»£ç çš„åˆ†å‰²ï¼š</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">precision highp float;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">define B 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec2 v_mapCoord2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 func2(vec3 lightPos);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 func2(vec3 lightPos){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return vec3(0.5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl_FragColor = vec4(1.0,0.5,1.0,1.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ç»„åˆå¤šä¸ªGLSL Chunkï¼Œå…¶å®å°±æ˜¯å°†å®ƒä»¬å¯¹åº”åŒºåŸŸçš„ä»£ç å åŠ è€Œå·²ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…·ä½“çš„ä¾‹å­ï¼š<br>
<!-- -->æœ‰ä¸¤ä¸ªGLSL Chunkï¼Œå®ƒä»¬çš„ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->chunk1.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@varDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec4 v_a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 c = v_a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>chunk2.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@varDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec4 v_b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 d = c + v_b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç»„åˆchunk1.glslå’Œchunk2.glslåï¼Œå¾—åˆ°çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@varDeclare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec4 v_a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">varying vec4 v_b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 c = v_a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 d = c + v_b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="merged-glsl-chunkçš„ä»£ç ">Merged GLSL Chunkçš„ä»£ç <a class="hash-link" href="#merged-glsl-chunkçš„ä»£ç " title="Direct link to heading">â€‹</a></h4><p>MergedGLSLChunk.ts</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_buildChunk</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> top</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> define </span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        varDeclare</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> funcDeclare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcDefine </span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      top</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      define</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      varDeclare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      funcDeclare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      funcDefine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;modelMatrix_noInstance_vertex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_buildChunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">mat4 mMatrix = u_mMatrix;</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">&quot;modelMatrix_instance_vertex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_buildChunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">mat4 mMatrix = mat4(a_mVec4_0, a_mVec4_1, a_mVec4_2, a_mVec4_3);</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯ä»¥æ ¹æ®éœ€è¦ï¼ˆä¹Ÿå°±æ˜¯çœ‹å¼•æ“æ˜¯ç”¨Typescriptè¿˜æ˜¯Rescriptå†™çš„ï¼‰è°ƒç”¨ä¸åŒçš„gulpä»»åŠ¡ï¼Œå°†GLSL Chunkåˆå¹¶ä¸ºTypescriptæˆ–è€…Rescriptå†™çš„Merged GLSL Chunkæ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ç»™å‡ºçš„Typescriptæ–‡ä»¶</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMergedGLSLChunkçš„getDataå‡½æ•°è¿”å›äº†Merged GLSL Chunkè¿™ä¸ªæ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªHash Mapï¼Œå…¶ä¸­Keyæ˜¯shader_chunks.jsonçš„glslså­—æ®µä¸­æ•°ç»„å…ƒç´ çš„nameï¼Œä¹Ÿå°±æ˜¯GLSL Chunkçš„æ–‡ä»¶åï¼›Valueæ˜¯è¯¥GLSL ChunkåŒ…æ‹¬çš„åŒºåŸŸçš„ç‰‡æ®µä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„shaderçš„ä»£ç -1">åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„Shaderçš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„shaderçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>InitMaterialShader</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_initOneMaterialTypeShader</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      å¼•æ“å®ç°çš„ä¸€äº›å‡½æ•°</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allMaterials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">material</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shaderName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> shaderName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shaderIndexMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newSendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _allGLSLs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> allMaterials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//è¿”å›çš„glslæ˜¯æ‹¼æ¥åçš„ä¸€ä¸ªTarget GLSL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaderChunks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ChunkHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buildGLSL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ä¼ å…¥å¼•æ“å®ç°çš„ä¸€äº›å‡½æ•°</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shaders</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shaderChunks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shaderName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">precision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">generateShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxShaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            programMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> programMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createFakeProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glsl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sendMetadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ChunkHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buildSendMetadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ä¼ å…¥å¼•æ“å®ç°çš„ä¸€äº›å‡½æ•°</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shaderChunks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">glslMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            glslMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glslMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glsl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;shaderIndex:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sendMetadataMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendMetadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ShaderUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setShaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            glslMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newMaxShaderIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">programMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newSendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> initBasicMaterialShader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">allMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">basicMaterial</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shaderName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newSendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newMaxShaderIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_initOneMaterialTypeShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ä¼ å…¥å¼•æ“å®ç°çš„ä¸€äº›å‡½æ•°</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allMaterials</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicMaterialShaderIndexMap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        programMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newProgramMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendMetadataMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newSendMetadataMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        basicMaterialShaderIndexMap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newShaderIndexMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxShaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> newMaxShaderIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>initBasicMaterialShaderå‡½æ•°åˆå§‹åŒ–æ‰€æœ‰åŸºç¡€æè´¨çš„shaderï¼Œå®ƒçš„æ­¥éª¤è·Ÿä¹‹å‰å·®ä¸å¤šï¼Œä¸ä¸€æ ·çš„åœ°æ–¹ä¸»è¦æ˜¯ï¼š</p><ul><li>åœ¨æ¯æ¬¡éå†æ—¶è°ƒç”¨buildGLSLå‡½æ•°æ„é€ çš„glslæ˜¯ä¸€ä¸ªTarget GLSLï¼Œä¸æ˜¯ä¸€ä¸ªBasicMaterialShaderGLSLï¼ˆAdd Defineï¼‰</li><li>åœ¨æ¯æ¬¡éå†æ—¶å¢åŠ äº†ä¸€æ­¥ï¼šè°ƒç”¨ChunkHandlerçš„buildSendMetadataå‡½æ•°æ¥æ„é€ SendMetadata</li></ul><p>å…·ä½“æ¥è¯´ï¼Œ_initOneMaterialTypeShaderå‡½æ•°åœ¨æ¯æ¬¡éå†æ—¶ï¼Œé¦–å…ˆè°ƒç”¨äº†ChunkHandlerçš„buildGLSLå‡½æ•°ï¼ŒæŒ‰ç…§shaders.jsonå’Œshader_chunks.jsonçš„é…ç½®æ•°æ®å°†EngineStateçš„chunkï¼ˆå³Merged GLSL Chunkï¼‰ä¸­å¯¹åº”çš„GLSL Chunkæ‹¼æ¥ä¸ºä¸€ä¸ªTarget GLSLï¼›ç„¶åè°ƒç”¨äº†ChunkHandlerçš„buildSendMetadataå‡½æ•°ï¼ŒæŒ‰ç…§GLSL Configï¼ˆå³shaderChunkså˜é‡ï¼‰æ¥æ„é€ ç›¸å…³çš„é¡¶ç‚¹ã€Uniformæ•°æ®çš„Send Metadataï¼Œå°†å…¶ä¿å­˜åœ¨EngineStateçš„sendMetadataMapä¸­</p><p>ChunkHandlerçš„buildGLSLå‡½æ•°å’ŒbuildSendMetadataå‡½æ•°éƒ½æ¥å—äº†å¼•æ“å®ç°çš„å‡½æ•°ï¼Œå®ƒä»¬è¢«ç”¨äºå¤„ç†shaders.jsonå’Œshader_chunks.jsonä¸­çš„ä¸€äº›å­—æ®µï¼Œä»è€Œå®ç°åˆ†æ”¯å¤„ç†æˆ–è€…ä»ä¸­æ„é€ Send Metadataã€‚å› ä¸ºè¿™äº›å­—æ®µçš„å€¼æ˜¯ç¦»æ•£çš„ï¼Œå®ƒä»¬çš„èŒƒå›´æ˜¯å¼•æ“å®šä¹‰çš„ï¼Œç”¨æˆ·åªèƒ½ä»èŒƒå›´å†…é€‰æ‹©æŸä¸ªå…·ä½“çš„å€¼ï¼Œæ‰€ä»¥è¿™äº›å­—æ®µçš„ç±»å‹æ˜¯å®šä¹‰åœ¨å¼•æ“ç«¯ï¼Œåœ¨ç±»å‹ä¸­æ˜ç¡®äº†å€¼çš„èŒƒå›´ã€‚ç±»å‹å®šä¹‰çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->GLSLConfigType</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">condition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_has_map&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;diffuse_has_map&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> attributeBuffer </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vertex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Normal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TexCoord </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Instance_model_matrix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œåˆ†åˆ«å®šä¹‰äº†shaders.jsonçš„dynamic_branchså­—æ®µä¸­çš„conditionå’Œshader_chunks.jsonçš„variableså­—æ®µçš„attributesçš„bufferçš„èŒƒå›´ï¼Œå®ƒä»¬çš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->shaders.json</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;dynamic_branchs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;basic_has_map&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>shader_chunks.json</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;variables&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;attributes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;buffer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åˆå§‹åŒ–æ‰€æœ‰pbræè´¨çš„shaderçš„ä»£ç -1">åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderçš„ä»£ç <a class="hash-link" href="#åˆå§‹åŒ–æ‰€æœ‰pbræè´¨çš„shaderçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>InitMaterialShaderçš„initPBRMaterialShaderå‡½æ•°å®ç°äº†åˆå§‹åŒ–æ‰€æœ‰PBRæè´¨çš„Shaderï¼Œå®ƒä¸åŒä¸€ä¸ªæ¨¡å—çš„initBasicMaterialShaderå‡½æ•°ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹ä¸»è¦å¦‚ä¸‹ï¼š</p><ul><li>ä¼ å…¥çš„allMaterialsæ˜¯æ‰€æœ‰çš„PBRæè´¨ç»„ä»¶è€Œä¸æ˜¯æ‰€æœ‰çš„åŸºç¡€æè´¨ç»„ä»¶ï¼›</li><li>ä¼ å…¥çš„shaderNameä¸ä¸€æ ·ï¼Œå€¼ä¸ºâ€œrender_pbrâ€è€Œä¸æ˜¯â€œrender_basicâ€ï¼›</li><li>ä¼ å…¥_initOneMaterialTypeShaderå‡½æ•°çš„â€œå¼•æ“å®ç°çš„å‡½æ•°â€ä¸ä¸€æ ·ï¼›</li><li>ç”Ÿæˆçš„shaderIndexæ”¹ä¸ºä¿å­˜åˆ°EngineStateçš„pbrMaterialShaderIndexMapä¸­</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ¸²æŸ“åœºæ™¯çš„ä»£ç -1">æ¸²æŸ“åœºæ™¯çš„ä»£ç <a class="hash-link" href="#æ¸²æŸ“åœºæ™¯çš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> render </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sendMetadataMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendMetadataMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> programMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">programMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getAllGameObjects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gameObjectState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gameObject </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è·Ÿä¹‹å‰ä¸€æ ·</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sendMetadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictUndefined</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sendMetadataMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">program</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">attributeSendMetadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uniformSendMetadata</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sendMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_sendAttributeData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">attributeSendMetadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_sendUniformData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uniformSendMetadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å…¶å®ƒæ¸²æŸ“é€»è¾‘...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>renderå‡½æ•°è·Ÿä¹‹å‰å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¤šäº†â€œä»EngineStateçš„sendMetadataMapä¸­è·å¾—Send Metadataâ€è¿™ä¸€æ­¥çš„ä»£ç ï¼Œå¹¶å°†å…¶ä¼ ç»™äº†_sendAttributeDataã€_sendUniformDataå‡½æ•°</p><p>æˆ‘ä»¬çœ‹ä¸‹å‘é€é¡¶ç‚¹æ•°æ®çš„ä»£ç ï¼š<br>
<!-- -->Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_sendAttributeData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">attributeSendMetadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">attributeSendMetadata</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attributeSendMetadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//â€œ!!â€è¡¨ç¤ºdata.elementSendMetadataå­˜åœ¨ï¼Œå³énullä¸”éundefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elementSendMetadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// ç»‘å®šElementArrayBuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elementSendMetadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sendBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getFakeElementArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instanceSendMetadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è·å¾—å¹¶å‘é€instanceç›¸å…³çš„</span><span class="token constant" style="color:#36acaa">VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">otherSendMetadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—å¹¶å‘é€Positionã€TexCoordçš„VBO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendBuffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buffer </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">otherSendMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sendBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getFakeArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shaderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç°åœ¨_sendAttributeDataå‡½æ•°æ²¡æœ‰åˆ†æ”¯åˆ¤æ–­äº†ï¼Œè€Œæ˜¯ç›´æ¥éå†é¡¶ç‚¹æ•°æ®çš„Send Metadataï¼Œè·å¾—å¹¶å‘é€å¯¹åº”çš„VBOæ•°æ®</p><p>æˆ‘ä»¬çœ‹ä¸‹å‘é€Uniformæ•°æ®çš„ä»£ç ï¼š<br>
<!-- -->Render</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_sendUniformData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uniformSendMetadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">uniformSendMetadata</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WebGLRenderingContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uniformSendMetadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shaderSendMetadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—å¹¶å‘é€ç›¸æœºæ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendData </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shaderSendMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sendData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderObjectSendMaterialData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—å¹¶å‘é€æè´¨æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendData </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderObjectSendMaterialData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sendData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> material</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderObjectSendModelData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—å¹¶å‘é€æ¨¡å‹çš„æ•°æ®ï¼ˆå¦‚æ¨¡å‹çŸ©é˜µï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sendData </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">renderObjectSendModelData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sendData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç°åœ¨_sendUniformDataå‡½æ•°æ²¡æœ‰åˆ†æ”¯åˆ¤æ–­äº†ï¼Œè€Œæ˜¯ç›´æ¥éå†Uniformæ•°æ®çš„Send Metadataï¼Œè·å¾—å¹¶å‘é€å¯¹åº”çš„Uniformæ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="è¿è¡Œclientçš„ä»£ç -1">è¿è¡ŒClientçš„ä»£ç <a class="hash-link" href="#è¿è¡Œclientçš„ä»£ç -1" title="Direct link to heading">â€‹</a></h4><p>æˆ‘ä»¬è¿è¡ŒClientçš„ä»£ç ï¼Œæµè§ˆå™¨æ§åˆ¶å°æ‰“å°çš„ç»“æœè·Ÿä¹‹å‰åŸºæœ¬ä¸Šä¸€æ ·ï¼Œæ•…çœç•¥</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®šä¹‰">å®šä¹‰<a class="hash-link" href="#å®šä¹‰" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸€å¥è¯å®šä¹‰">ä¸€å¥è¯å®šä¹‰<a class="hash-link" href="#ä¸€å¥è¯å®šä¹‰" title="Direct link to heading">â€‹</a></h3><p>åˆ†è§£æœ‰å„ç§åˆ†æ”¯çš„å¤§æ•°æ®ä¸ºå¤šä¸ªå°å—æ•°æ®ï¼ŒæŒ‰ç…§é…ç½®æ–‡ä»¶æ¥æ‹¼æ¥</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜<a class="hash-link" href="#è¡¥å……è¯´æ˜" title="Direct link to heading">â€‹</a></h3><p>å¤§æ•°æ®ä¸­çš„æ¯ä¸ªåˆ†æ”¯éƒ½å¯ä»¥åˆ†è§£ä¸ºä¸€å—æ•°æ®ï¼Œå¦‚æœ‰ä¸‹é¢çš„ä¸€ä¸ªå¤§æ•°æ®ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef </span><span class="token constant" style="color:#36acaa">INSTANCE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ•°æ®</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef </span><span class="token constant" style="color:#36acaa">NO_INSTANCE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ•°æ®</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®ƒæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå¯ä»¥å°†å…¶åˆ†è§£ä¸ºæ•°æ®1ã€æ•°æ®2è¿™ä¸¤ä¸ªå°å—æ•°æ®</p><p>é…ç½®æ–‡ä»¶ç”±ç”¨æˆ·ç»™å‡ºï¼ŒåŒ…æ‹¬ä¸‹é¢çš„å†…å®¹ï¼š<br>
<!-- -->æœ‰å“ªäº›åˆ†æ”¯ã€è¦æ„é€ å“ªäº›Targetæ•°æ®ã€æ¯ä¸ªTargetæ•°æ®åŒ…æ‹¬å“ªäº›å—ã€æ¯å—æœ‰å“ªäº›é…ç½®æ•°æ®</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="é€šç”¨uml">é€šç”¨UML<a class="hash-link" href="#é€šç”¨uml" title="Direct link to heading">â€‹</a></h3><p><strong>é¢†åŸŸæ¨¡å‹</strong></p><p><img alt="é¢†åŸŸæ¨¡å‹å›¾" src="/3dProgramPattern/assets/images/UML-0dd2b5bc29d057cd3cd8616140233736.png"></p><p>æ€»ä½“æ¥çœ‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ†ä¸ºç”¨æˆ·ã€æ•°æ®ã€ChunkConverterã€ChunkHandlerã€ç³»ç»Ÿè¿™äº”ä¸ªéƒ¨åˆ†</p><p>æˆ‘ä»¬çœ‹ä¸‹ç”¨æˆ·è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Client<br>è¯¥è§’è‰²æ˜¯ç”¨æˆ·</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹æ•°æ®å’ŒChunkConverterè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>Target<br>
<!-- -->è¯¥è§’è‰²æ˜¯ç¬¦åˆæŸç§ç‰¹å®šåˆ†æ”¯æ¡ä»¶çš„æ•°æ®ï¼Œå¦‚<!-- -->[æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]<!-- -->çš„GLSLå°±æ˜¯ä¸€ä¸ªTarget</p></li><li><p>Runtime Metadata<br>
<!-- -->è¯¥è§’è‰²æ˜¯æ“ä½œè¿è¡Œæ—¶æ•°æ®çš„å…ƒæ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªRuntime MetadataåŒ…æ‹¬äº†å¤šä¸ªgetDataå‡½æ•°å’Œå¤šä¸ªsendDataå‡½æ•°ï¼Œå…¶ä¸­å‰è€…è·å¾—å¯¹åº”çš„è¿è¡Œæ—¶æ•°æ®ï¼Œåè€…å‘é€å®ƒä»¬</p></li></ul><ul><li><p>Target Config<br>
<!-- -->è¯¥è§’è‰²æ˜¯é…ç½®æ•°æ®ï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•æ‹¼æ¥Targetï¼Œå¹¶åŒ…æ‹¬äº†Runtime Metadataçš„é…ç½®æ•°æ®ã€‚å®ƒçš„å†…å®¹ç”±ç”¨æˆ·ç»™å‡ºï¼Œå®ƒçš„æ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯ç±»å‹ï¼‰ç”±ChunkHandlerå®šä¹‰ã€‚Target Configä¸­æŸäº›å­—æ®µçš„å€¼æ˜¯ç¦»æ•£çš„ï¼Œå®ƒä»¬çš„èŒƒå›´æ˜¯ç³»ç»Ÿå®šä¹‰çš„ï¼Œç”¨æˆ·åªèƒ½ä»èŒƒå›´å†…é€‰æ‹©æŸä¸ªå…·ä½“çš„å€¼</p></li><li><p>Target Chunk<br>
<!-- -->è¯¥è§’è‰²æ˜¯å°å—çš„æ•°æ®ï¼Œç”±ç³»ç»Ÿç»™å‡º</p></li></ul><ul><li>ChunkConverter<br>è¯¥è§’è‰²è´Ÿè´£å¤„ç†Target Chunkï¼Œå¹¶å°†å…¶åˆå¹¶ä¸ºä¸€ä¸ªMerged Target Chunkã€‚å› ä¸ºTarget Chunkæ˜¯è‡ªå®šä¹‰æ–‡ä»¶ï¼Œæœ‰ä¸€äº›è‡ªå®šä¹‰çš„è¯­æ³•ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥ç³»ç»Ÿéœ€è¦è°ƒç”¨ChunkConverterå¯¹å…¶é¢„å¤„ç†</li></ul><ul><li>Merged Target Chunk<br>è¯¥è§’è‰²æ˜¯åˆå¹¶äº†æ‰€æœ‰çš„Target Chunkåçš„æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªTypescriptæˆ–è€…Rescriptæ–‡ä»¶</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹ChunkHandlerå’Œç³»ç»Ÿè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>ChunkHandler<br>
<!-- -->è¯¥è§’è‰²è´Ÿè´£æ‹¼æ¥Targetå’Œæ„é€ Runtime Metadata</p></li><li><p>System<br>
<!-- -->è¯¥è§’è‰²ä¸ºç³»ç»Ÿçš„é—¨æˆ·ï¼Œæä¾›APIç»™Client</p></li><li><p>Init<br>
<!-- -->è¯¥è§’è‰²å®ç°ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼Œå®ƒåŒ…æ‹¬ä¸‹é¢çš„æ­¥éª¤ï¼š<br>
<!-- -->1.è°ƒç”¨ChunkHandlerçš„buildTargetå‡½æ•°ï¼ŒæŒ‰ç…§Target Configå°†Merged Target Chunkä¸­å¯¹åº”çš„Target Chunkæ‹¼æ¥ä¸ºä¸€ä¸ªTargetï¼Œç„¶åä½¿ç”¨å®ƒ<br>
<!-- -->2.è°ƒç”¨ChunkHandlerçš„buildRuntimeMetadataå‡½æ•°ï¼ŒæŒ‰ç…§Target Configæ„é€ Runtime Metadata</p></li></ul><ul><li>OperateWhenRuntime<br>è¯¥è§’è‰²æ˜¯è¿è¡Œæ—¶è¿›è¡Œçš„æŸä¸ªæ“ä½œï¼ˆå¦‚æ¸²æŸ“ï¼‰ï¼Œä½¿ç”¨äº†Runtime Metadataæ¥æ“ä½œè¿è¡Œæ—¶æ•°æ®</li></ul><p><strong>è§’è‰²ä¹‹é—´çš„å…³ç³»</strong></p><ul><li>æœ‰å¤šä¸ªTarget Chunk</li></ul><ul><li>åªæœ‰ä¸€ä¸ªMerged Target Chunkï¼Œç”±æ‰€æœ‰çš„Target Chunkåˆå¹¶è€Œæ¥</li></ul><ul><li>Target Configé€šå¸¸åŒ…å«ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼štargets_configã€chunks_config<br>è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å…³ç³»æ˜¯â€œæ€»-åˆ†â€çš„å…³ç³»ï¼Œå…¶ä¸­targets_configæ˜¯â€œæ€»â€ï¼Œchunks_configæ˜¯â€œåˆ†â€ã€‚å…¶ä¸­å‰è€…åº”è¯¥æŒ‡å®šè¦æ„é€ å“ªäº›ç§ç±»çš„Targetã€æ¯ç§Targetæœ‰å“ªäº›Target Chunkï¼›åè€…åº”è¯¥æŒ‡å®šæ‰€æœ‰çš„Target Chunkçš„é…ç½®æ•°æ®</li></ul><ul><li><p>æœ‰å¤šä¸ªTargetï¼Œå¦‚<!-- -->[æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]<!-- -->çš„GLSLæ˜¯ä¸€ä¸ªTargetï¼Œ<!-- -->[æ²¡æœ‰æ™®é€šè´´å›¾ï¼Œæ”¯æŒInstance]<!-- -->çš„GLSLæ˜¯å¦å¤–ä¸€ä¸ªTarget</p></li><li><p>æœ‰å¤šä¸ªRuntime Metadataï¼Œå…¶ä¸­ä¸€ä¸ªRuntime Metadataå¯¹åº”ä¸€ä¸ªTarget</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è§’è‰²çš„æŠ½è±¡ä»£ç ">è§’è‰²çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#è§’è‰²çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªè§’è‰²çš„æŠ½è±¡ä»£ç ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹Target Chunkçš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œå› ä¸ºç³»ç»Ÿä¼šåœ¨é¢„å¤„ç†æ—¶è°ƒç”¨gulpä»»åŠ¡ï¼Œè°ƒç”¨ChunkConverteræ¥åˆå¹¶Target Chunkä¸ºMerged Target Chunkï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹å®ƒä»¬çš„æŠ½è±¡ä»£ç ï¼š</p><ul><li>ChunkConverterçš„æŠ½è±¡ä»£ç </li><li>Merged Target Chunkçš„æŠ½è±¡ä»£ç </li><li>ç³»ç»Ÿçš„gulpä»»åŠ¡çš„æŠ½è±¡ä»£ç </li></ul><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Target Configçš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹Clientçš„æŠ½è±¡ä»£ç <br>
<!-- -->ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹ç³»ç»Ÿçš„æŠ½è±¡ä»£ç <br>
<!-- -->æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸‹ChunkHandlerçš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="target-chunkçš„æŠ½è±¡ä»£ç ">Target Chunkçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#target-chunkçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªTarget Chunkæ–‡ä»¶çš„æŠ½è±¡ä»£ç ï¼š<br>
<!-- -->target_chunk1</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">part1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åŒºåŸŸ</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">part2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åŒºåŸŸ</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>part1ã€part2æ˜¯æŠ½è±¡çš„è‡ªå®šä¹‰å­—ç¬¦ï¼ˆå®é™…ä¸Šå¯ä»¥ä¸ºä»»æ„çš„å­—ç¬¦ï¼‰ï¼Œç”¨äºå°†ä¸€ä¸ªå®Œæ•´çš„å¤§æ•°æ®æŒ‰ç…§ä¸€å®šçš„é¡ºåºåˆ†å‰²ä¸ºä¸åŒåŒºåŸŸçš„ç‰‡æ®µï¼Œè¿™æ ·ä¾¿äºæ›´ç»†ç²’åº¦çš„ç»„åˆæ‹¼æ¥ã€‚ä¸€ä¸ªTarget Chunkå¯ä»¥åŒ…æ‹¬å¤šä¸ªåŒºåŸŸçš„ç‰‡æ®µ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="chunkconverterçš„æŠ½è±¡ä»£ç ">ChunkConverterçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#chunkconverterçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ChunkConverter</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//create MergedTargetChunk.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createMergedTargetChunkForTs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">targetChunkPathArr</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> destFilePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> doneFunc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//create MergedTargetChunk.res</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createMergedTargetChunkForRes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">targetChunkPathArr</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> destFilePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> doneFunc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ChunkConverterçš„APIæ˜¯è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™é‡Œåªç»™å‡ºäº†å‡½æ•°ç­¾åã€‚å…¶ä¸­ï¼ŒcreateMergedTargetChunkForTså‡½æ•°ç”¨äºåˆ›å»ºTypescriptå†™çš„Merged Target Chunkæ–‡ä»¶ï¼›createMergedTargetChunkForReså‡½æ•°ç”¨äºåˆ›å»ºRescriptå†™çš„Merged Target Chunkæ–‡ä»¶</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="merged-target-chunkçš„æŠ½è±¡ä»£ç ">Merged Target Chunkçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#merged-target-chunkçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>MergedTargetChunk.ts</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_buildChunk</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        part1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        part2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            part1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            part2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> getData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;target_chunk1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_buildChunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™æ˜¯Typescriptå†™çš„Merged Target Chunkæ–‡ä»¶çš„æŠ½è±¡ä»£ç </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç³»ç»Ÿçš„gulpä»»åŠ¡çš„æŠ½è±¡ä»£ç ">ç³»ç»Ÿçš„gulpä»»åŠ¡çš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ç³»ç»Ÿçš„gulpä»»åŠ¡çš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ç³»ç»Ÿåœ¨é¢„å¤„ç†æ—¶ï¼Œè°ƒç”¨ä¸‹é¢çš„gulpä»»åŠ¡æ¥åˆ›å»ºMerged Target Chunk:<br>
<!-- -->gulpfile.js</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> gulp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;gulp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;path&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//create for typescript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gulp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;createMergedGLSLChunkFile_ts&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chunkConverter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chunk_converter&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chunkFilePath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src/glsl/MergedGLSLChunk.ts&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> glslPathArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src/glsl/**/*.glsl&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chunkConverter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createMergedGLSLChunkFileForTs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslPathArray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunkFilePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//create for rescript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gulp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;createMergedGLSLChunkFile_res&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chunkConverter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chunk_converter&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chunkFilePath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src/glsl/MergedGLSLChunk.res&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> glslPathArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src/glsl/**/*.glsl&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chunkConverter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createMergedGLSLChunkFileForRes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glslPathArray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunkFilePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œæœ‰ä¸¤ä¸ªgulpä»»åŠ¡ï¼Œå…¶ä¸­createMergedTargetChunkFile_tsä»»åŠ¡ç”¨æ¥åˆ›å»ºTypescriptæ–‡ä»¶ï¼ŒcreateMergedTargetChunkFile_resä»»åŠ¡ç”¨æ¥åˆ›å»ºRescriptæ–‡ä»¶</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="target-configçš„æŠ½è±¡ä»£ç ">Target Configçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#target-configçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Target Configé€šå¸¸åŒ…æ‹¬targets_config.jsonå’Œchunks_config.jsonè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚å®ƒä»¬çš„æŠ½è±¡ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->targets_config.json</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;static_branchs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;static branch name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;chunk name for condition1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;chunk name for condition2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;dynamic_branchs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dynamic branch name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;pass&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chunk name when condition pass&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;fail&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chunk name when condition fail&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;groups&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;group name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;chunk name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;chunk name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;targets&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;target1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;target_chunks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;static_branch || dynamic_branch || group&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;static branch name || dynamic branch name || group name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chunk name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>chunks_config.json</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chunk name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;target chunk&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;target chunk&#x27;s filename(e.g. target_chunk1)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;runtime metadata config&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;runtime metadata1 config&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="clientçš„æŠ½è±¡ä»£ç ">Clientçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#clientçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> parsedConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parseConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">targetsConfigJson</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunksConfigJson</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsedConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> someConfigData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> someConfigData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">operateWhenRuntime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ç³»ç»Ÿçš„æŠ½è±¡ä»£ç ">ç³»ç»Ÿçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#ç³»ç»Ÿçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>System</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_handleConfigFunc1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> someConfigData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_addRuntimeMetadataFunc1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">someRuntimeMetadataFromState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> someConfigData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> parseConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ChunkHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parseConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsedConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parsedConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> parsedConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chunk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        åˆ›å»ºæ›´å¤šå­—æ®µ</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> someConfigData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ChunkHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buildTarget</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_handleConfigFunc1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parsedConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        someConfigData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä½¿ç”¨target</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> runtimeMetadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ChunkHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buildRuntimeMetadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_addRuntimeMetadataFunc1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtimeMetadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtimeMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> operateWhenRuntime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ä½¿ç”¨state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">runtimeMetadata</span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œå°†ç³»ç»Ÿä¸­Systemã€Initã€OperateWhenRuntimeè¿™ä¸‰ä¸ªæ¨¡å—çš„æŠ½è±¡ä»£ç åˆå¹¶åˆ°äº†Systemçš„æŠ½è±¡ä»£ç ä¸­ï¼Œå…¶ä¸­initå‡½æ•°æ˜¯Initæ¨¡å—çš„å‡½æ•°ï¼ŒoperateWhenRuntimeå‡½æ•°æ˜¯OperateWhenRuntimeæ¨¡å—çš„å‡½æ•°</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<br>
<!-- -->å› ä¸ºè¿™é‡Œåªè€ƒè™‘äº†åªæœ‰ä¸€ä¸ªTargetå’Œä¸€ä¸ªRuntime Metadataçš„æƒ…å†µï¼Œæ‰€ä»¥initå‡½æ•°ä¸­æ²¡æœ‰è¿›è¡Œéå†</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="chunkhandlerçš„æŠ½è±¡ä»£ç ">ChunkHandlerçš„æŠ½è±¡ä»£ç <a class="hash-link" href="#chunkhandlerçš„æŠ½è±¡ä»£ç " title="Direct link to heading">â€‹</a></h4><p>ChunkHandler</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">configJson</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSON</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildTarget</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleConfigFuncs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parsedConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> targetChunk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> someConfigData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">runtimeMetadata</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildRuntimeMetadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addRuntimeMetadataFuncs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtimeMetadata</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ChunkHandlerçš„APIæ˜¯è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œè¿™é‡Œåªç»™å‡ºäº†å‡½æ•°ç­¾å</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°<a class="hash-link" href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" title="Direct link to heading">â€‹</a></h3><p>æ‹¼æ¥æ¨¡å¼ä¸»è¦éµå¾ªä¸‹é¢çš„è®¾è®¡åŸåˆ™ï¼š</p><ul><li>å•ä¸€èŒè´£åŸåˆ™<br>æ¯ä¸ªTarget Chunkåªæ˜¯ä¸€ä¸ªåˆ†æ”¯çš„æ•°æ®</li><li>åˆæˆå¤ç”¨åŸåˆ™<br>Targetç»„åˆäº†å¤šä¸ªTarget Chunk</li><li>ä¾èµ–å€’ç½®åŸåˆ™<br>ç»„åˆTarget Chunkçš„é¡ºåºå®šä¹‰åœ¨æŠ½è±¡çš„Target Configä¸­</li><li>æœ€å°‘çŸ¥è¯†åŸåˆ™<br>å„ä¸ªRuntimeMetadataç›¸äº’ç‹¬ç«‹ï¼›å„ä¸ªTargetç›¸äº’ç‹¬ç«‹</li><li>å¼€é—­åŸåˆ™<br>è¦æ”¹å˜Target Chunkçš„ç»„åˆé¡ºåºï¼Œåªéœ€è¦ä¿®æ”¹Target Configï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼›è¦å¢åŠ ä¸€ç§Targetï¼Œåªéœ€è¦åœ¨Target Configçš„targets_config.jsonçš„targetså­—æ®µä¸­å¢åŠ è¯¥ç§ç±»çš„é…ç½®æ•°æ®ã€ç³»ç»Ÿå¢åŠ å¯¹åº”çš„Target Chunkã€ç³»ç»Ÿçš„Initå¢åŠ å¯¹åº”çš„åˆå§‹åŒ–å‡½æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åº”ç”¨">åº”ç”¨<a class="hash-link" href="#åº”ç”¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä¼˜ç‚¹">ä¼˜ç‚¹<a class="hash-link" href="#ä¼˜ç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>ç”¨æˆ·èƒ½å¤Ÿçµæ´»åœ°æ‹¼æ¥Target<br>
<!-- -->ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡Target Configé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šæ‹¼æ¥è‡ªå·±æƒ³è¦çš„Target</p></li><li><p>ç²¾ç®€çš„Target<br>
<!-- -->æ‹¼æ¥åçš„Targetæ²¡æœ‰åˆ†æ”¯åˆ¤æ–­ï¼Œéå¸¸ç²¾ç®€</p></li><li><p>æé«˜æ€§èƒ½<br>
<!-- -->ç³»ç»Ÿèƒ½å¤Ÿåœ¨åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§ä»é…ç½®æ–‡ä»¶ä¸­æ„é€ Runtime Metadataï¼Œç„¶ååœ¨è¿è¡Œæ—¶æ— éœ€è¿›è¡Œåˆ†æ”¯åˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥éå†Runtime Metadataï¼Œé€šè¿‡å®ƒçš„getDataã€sendDataå‡½æ•°æ¥æ“ä½œè¿è¡Œæ—¶çš„æ•°æ®ï¼Œä»è€Œæé«˜è¿è¡Œæ—¶çš„æ€§èƒ½</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼ºç‚¹">ç¼ºç‚¹<a class="hash-link" href="#ç¼ºç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>Target Configçš„æ ¼å¼ç”±ç³»ç»Ÿå®šä¹‰ï¼Œç”¨æˆ·éœ€è¦éµå®ˆè¯¥æ ¼å¼æ¥å†™Target Configçš„å†…å®¹ï¼Œè¿™æ ·ä¼šæœ‰ä¸€äº›é™åˆ¶</p></li><li><p>å› ä¸ºTarget Chunkä½¿ç”¨äº†è‡ªå®šä¹‰çš„åˆ†æ®µå­—ç¬¦ï¼ˆå¦‚@topï¼‰ï¼Œæ‰€ä»¥æ— æ³•æ­£ç¡®ä½¿ç”¨è¯¥æ–‡ä»¶çš„ç¼–è¯‘æ£€æŸ¥ï¼Œå¦‚æ— æ³•æ­£ç¡®ä½¿ç”¨Shaderç¼–è¯‘æ£€æŸ¥</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯<a class="hash-link" href="#ä½¿ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="åœºæ™¯æè¿°">åœºæ™¯æè¿°<a class="hash-link" href="#åœºæ™¯æè¿°" title="Direct link to heading">â€‹</a></h4><p>ç³»ç»Ÿéœ€è¦æ„é€ åŒ…æ‹¬å„ç§åˆ†æ”¯çš„æ•°æ®</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="å…·ä½“æ¡ˆä¾‹">å…·ä½“æ¡ˆä¾‹<a class="hash-link" href="#å…·ä½“æ¡ˆä¾‹" title="Direct link to heading">â€‹</a></h4><ul><li><p>æ„é€ å¼•æ“çš„ç€è‰²å™¨ä»£ç ï¼Œå…¶ä¸­æ„é€ çš„ç€è‰²å™¨ä»£ç ä¸ä»…åŒ…æ‹¬GLSLï¼Œä¹ŸåŒ…æ‹¬HLSLã€WGSLç­‰</p></li><li><p>æ„é€ æ¸¸æˆçš„åœ°å›¾æ•°æ®<br>
<!-- -->ä¸€å¼ å¤§çš„ä¸–ç•Œåœ°å›¾å¯ä»¥æ ¹æ®å„ç§åˆ†æ”¯æ¡ä»¶æ¥ç”Ÿæˆï¼Œå…¶ä¸­åˆ†æ”¯æ¡ä»¶å¯ä»¥ä¸ºâ€œæ˜¯å¦æœ‰æ°´â€ã€â€œæ˜¯å¦æœ‰æ ‘â€ç­‰ã€‚å¯ä»¥å°†ä¸–ç•Œåœ°å›¾æŒ‰ç…§åˆ†æ”¯åˆ†ä¸ºå¤šä¸ªå°å—æ•°æ®ã€‚å…¶ä¸­ï¼ŒåŒ…å«æŸäº›åˆ†æ”¯çš„ä¸€ä¸ªä¸–ç•Œåœ°å›¾æ˜¯ä¸€ä¸ªTargetï¼›æ¯ä¸ªå°å—æ•°æ®æ˜¯ä¸€ä¸ªTarget Chunkã€‚<br>
<!-- -->å¦å¤–ï¼Œå› ä¸ºä¸–ç•Œåœ°å›¾åŒ…æ‹¬äº†ä¸åŒçš„åŒºåŸŸï¼Œå› æ­¤å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å­—ç¬¦ï¼Œå°†ä¸€ä¸ªå®Œæ•´çš„Targetåˆ†å‰²ä¸ºä¸åŒåŒºåŸŸçš„æ•°æ®ã€‚ä¸€ä¸ªTarget Chunkå¯ä»¥åŒ…æ‹¬å¤šä¸ªåŒºåŸŸçš„æ•°æ®ã€‚å¦‚ä¸‹é¢æ˜¯æ ¹æ®â€œæ˜¯å¦æœ‰æ°´â€çš„åˆ†æ”¯åˆ†è§£è€Œæˆçš„ä¸¤ä¸ªTarget Chunkçš„å‚è€ƒä»£ç ï¼š<br>
<!-- -->æœ‰æ°´.map</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">åŒºåŸŸ1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æœ‰æ°´çš„åŒºåŸŸ</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">åŒºåŸŸ2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æœ‰æ°´çš„åŒºåŸŸ</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  æ— æ°´.map</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">åŒºåŸŸ1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ— æ°´çš„åŒºåŸŸ</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">åŒºåŸŸ2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ— æ°´çš„åŒºåŸŸ</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">çš„æ•°æ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  ç”¨æˆ·è´Ÿè´£ç»™å‡ºTarget Configï¼Œå…¶ä¸­çš„targets_config.jsonåº”è¯¥æŒ‡å®šè¦æ„é€ å“ªäº›ç§ç±»çš„ä¸–ç•Œåœ°å›¾ã€æ¯ç§ä¸–ç•Œåœ°å›¾æœ‰å“ªäº›Target Chunkï¼›chunks_config.jsonåº”è¯¥æŒ‡å®šæ‰€æœ‰çš„Target Chunkçš„é…ç½®æ•°æ®</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹<a class="hash-link" href="#æ³¨æ„äº‹é¡¹" title="Direct link to heading">â€‹</a></h3><ul><li><p>Target Chunkåº”è¯¥è¿›è¡Œäº†é€‚å½“æŠ½è±¡ï¼Œä»è€Œèƒ½å¤Ÿä¿è¯åœ¨ç»„åˆæ‹¼æ¥ä¸ºTargetåæ˜¯æ­£ç¡®çš„<br>
<!-- -->å¦‚æœ‰ä¸‰ä¸ªå±äºVS GLSLçš„GLSL Chunkï¼šbasic_map_fragment.glsl, no_basic_map_fragment.glsl, basic_end_fragment.glslï¼Œå…¶ä¸­å‰ä¸¤ä¸ªåˆ†åˆ«å¤„ç†æœ‰è´´å›¾å’Œæ²¡æœ‰è´´å›¾çš„æƒ…å†µï¼Œç¬¬ä¸‰ä¸ªè´Ÿè´£è¾“å‡ºåˆ°gl_FragColorã€‚æˆ‘ä»¬éœ€è¦ç»„åˆå‰ä¸¤ä¸ªä¸­ä»»æ„çš„ä¸€ä¸ªGLSL Chunkå’Œç¬¬ä¸‰ä¸ªGLSL Chunkã€‚å¦‚æœæ²¡æœ‰è¿›è¡ŒæŠ½è±¡çš„è¯ï¼Œå‰ä¸¤ä¸ªçš„ä»£ç å¯èƒ½æ˜¯ï¼š<br>
<!-- -->basic_map_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 texelColor = texture2D(u_mapSampler, v_mapCoord0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å¯¹texelColorè¿›è¡Œä¸€äº›å¤„ç†...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  no_basic_map_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 color = vec4(u_color, u_alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  è¿™é‡Œçš„é—®é¢˜æ˜¯éœ€è¦åœ¨basic_end_fragment.glslä¸­è¾“å‡ºé¢œè‰²ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¸­çš„é¢œè‰²å˜é‡åä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ— æ³•ç»Ÿä¸€åœ°è¾“å‡ºé¢œè‰²ã€‚å› æ­¤éœ€è¦è¿›è¡ŒæŠ½è±¡ï¼ŒæŠ½è±¡å‡ºåä¸ºâ€œtotalColorâ€å˜é‡ä½œä¸ºè¾“å‡ºçš„é¢œè‰²å˜é‡ã€‚é‚£ä¹ˆè¿™ä¸‰ä¸ªGLSL Chunkçš„ä»£ç å°±åº”è¯¥ä¿®æ”¹ä¸ºï¼š<br>
<!-- -->basic_map_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 texelColor = texture2D(u_mapSampler, v_mapCoord0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å¯¹texelColorè¿›è¡Œä¸€äº›å¤„ç†...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 totalColor = texelColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  no_basic_map_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 totalColor = vec4(u_color, u_alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  basic_end_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl_FragColor = totalColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  è¿™ä¸‰ä¸ªGLSL Chunkä¸€å…±æœ‰ä¸¤ç§ç»„åˆçš„æƒ…å†µï¼Œå®ƒä»¬çš„ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->basic_map_fragment.glsl+basic_end_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 texelColor = texture2D(u_mapSampler, v_mapCoord0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å¯¹texelColorè¿›è¡Œä¸€äº›å¤„ç†...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 totalColor = texelColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl_FragColor = totalColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  no_basic_map_fragment.glsl+basic_end_fragment.glsl</p><div class="codeBlockContainer_J+bg language-glsl theme-code-block"><div class="codeBlockContent_csEI glsl"><pre tabindex="0" class="prism-code language-glsl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec4 totalColor = vec4(u_color, u_alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl_FragColor = totalColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  æˆ‘ä»¬çœ‹åˆ°ï¼Œç°åœ¨è¿™ä¸¤ç§ç»„åˆåçš„ä»£ç éƒ½èƒ½æ­£ç¡®å°†totalColorå˜é‡è¾“å‡ºåˆ°gl_FragColor</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ‰©å±•">æ‰©å±•<a class="hash-link" href="#æ‰©å±•" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="è‡ªå®šä¹‰target-chunk">è‡ªå®šä¹‰Target Chunk<a class="hash-link" href="#è‡ªå®šä¹‰target-chunk" title="Direct link to heading">â€‹</a></h3><p>ç°åœ¨Target Chunkæ˜¯ç”±ç³»ç»Ÿå®šä¹‰çš„ï¼Œç”¨æˆ·ä¸èƒ½å®šä¹‰è‡ªå·±çš„Target Chunkã€‚æœ‰ä¸‹é¢ä¸¤ä¸ªæ€è·¯æ¥å®ç°ç”¨æˆ·è‡ªå®šä¹‰Target Chunkï¼š<br>
<!-- -->1.æ‰©å±•Target Config<br>
<!-- -->å¦‚æˆ‘ä»¬å¯ä»¥åœ¨shader_chunks.jsonçš„glslså­—æ®µä¸­å¢åŠ å€¼ä¸ºâ€œcustom_vsâ€å’Œâ€œcustom_fsâ€çš„typeï¼Œä»è€Œåœ¨contentå­—æ®µä¸­æ’å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„å±äºVS GLSLæˆ–è€…FS GLSLçš„GLSL Chunkã€‚shader_chunks.jsonç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;glsls&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;custom_vs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;top&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;define&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;varDeclare&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;funcDeclare&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;funcDefine&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;body&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;custom_fs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;top&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;define&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;varDeclare&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;funcDeclare&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;funcDefine&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;body&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¦å®ç°è¿™ä¸ªæ‰©å±•ï¼Œéœ€è¦è¿›è¡Œä¸‹é¢çš„ä¿®æ”¹ï¼š  </p><ul><li>ä¿®æ”¹ChunkHandlerçš„GLSLConfigTypeä¸­glslsçš„ç±»å‹ï¼Œä½¿å…¶æ”¯æŒè¯¥type</li><li>ä¿®æ”¹ChunkHanlderçš„buildGLSLå‡½æ•°çš„ä¼ å…¥å‚æ•°ï¼Œå¢åŠ â€œæ¥è‡ªå¼•æ“çš„æ–°çš„å‡½æ•°â€çš„ä¼ å…¥å‚æ•°ï¼›ç„¶ååœ¨ChunkHanlderçš„buildGLSLå‡½æ•°ä¸­ä½¿ç”¨ä¼ å…¥çš„æ–°å‡½æ•°æ¥å¤„ç†typeä¸ºcustom_vsã€custom_fsçš„æƒ…å†µ</li></ul><p>2.ç³»ç»Ÿæä¾›å¢åŠ Target Chunkçš„APIç»™ç”¨æˆ·<br>
<!-- -->å¦‚å¼•æ“æä¾›ä¸‹é¢çš„APIï¼Œæ¥åŠ å…¥ä¸€ä¸ªGLSL Chunkï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">addGLSLChunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">top</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> define</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> varDeclare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcDeclare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcDefine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glslChunkFileName</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç”¨æˆ·åœ¨è°ƒç”¨è¯¥APIåŠ å…¥ä¸€ä¸ªGLSL Chunkåï¼Œå°±å¯ä»¥åœ¨GLSL Configä¸­ä½¿ç”¨æ–‡ä»¶åä¸ºæŒ‡å®šçš„glslChunkFileNameçš„GLSL Chunk</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="åœ¨glsl-configä¸­å®šä¹‰æ²¡æœ‰æè´¨çš„shaderçš„target-glsl">åœ¨GLSL Configä¸­å®šä¹‰æ²¡æœ‰æè´¨çš„Shaderçš„Target GLSL<a class="hash-link" href="#åœ¨glsl-configä¸­å®šä¹‰æ²¡æœ‰æè´¨çš„shaderçš„target-glsl" title="Direct link to heading">â€‹</a></h3><p>ä¹‹å‰æåˆ°äº†æ²¡æœ‰æè´¨çš„Shaderï¼Œç°åœ¨æ¥è®¨è®ºä¸€ä¸‹å®ç°çš„ç»†èŠ‚ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ­¥éª¤æ¥å®ç°ï¼š<br>
<!-- -->1.æˆ‘ä»¬å¯ä»¥å°†æ²¡æœ‰æè´¨çš„Shaderå®šä¹‰åœ¨shaders.jsonçš„shaderså­—æ®µä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š<br>
<!-- -->shaders.json</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token string-property property" style="color:#36acaa">&quot;shaders&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no_material_shader1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;shader_chunks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no_material_shader2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;shader_chunks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡Œå®šä¹‰äº†ä¸¤ç§æ²¡æœ‰æè´¨çš„Shader<br>
<!-- -->2.åœ¨å¼•æ“çš„InitMaterialShaderæ¨¡å—ä¸­å¢åŠ initNoMaterialShaderå‡½æ•°ï¼Œå¹¶åœ¨Clientä¸­è°ƒç”¨å®ƒæ¥åˆå§‹åŒ–ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š<br>
<!-- -->Client</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initNoMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;no_material_shader1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initNoMaterialShader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;no_material_shader2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™é‡ŒClientè°ƒç”¨äº†ä¸¤æ¬¡InitMaterialShaderçš„initNoMaterialShaderå‡½æ•°æ¥åˆ†åˆ«åˆå§‹åŒ–ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ²¡æœ‰æè´¨çš„Shader<br>
<!-- -->â€œåˆå§‹åŒ–æ²¡æœ‰æè´¨çš„Shaderâ€è·Ÿâ€œåˆå§‹åŒ–æœ‰æè´¨çš„Shaderâ€çš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>ä¸éœ€è¦â€œæ‰€æœ‰çš„æè´¨â€è¿™ä¸ªå‚æ•°ï¼›</li><li>InitMaterialShaderçš„initNoMaterialShaderå‡½æ•°è·Ÿåˆå§‹åŒ–æœ‰æè´¨çš„Shaderçš„å‡½æ•°ï¼ˆå¦‚initBasicMaterialShaderï¼‰å·®ä¸å¤šï¼Œåªæ˜¯æ²¡æœ‰éå†allMaterialsï¼Œä¹Ÿæ— éœ€ç”ŸæˆshaderIndexï¼Œè€Œæ˜¯åªåˆ›å»ºäº†ä¸€ä¸ªShaderï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªProgramï¼‰ï¼Œå°†å…¶ä¿å­˜åˆ°EngineStateçš„ä¸€ä¸ªHash Mapä¸­ï¼Œå®ƒçš„Keyæ˜¯shaderNameï¼ˆä¹Ÿå°±æ˜¯  &quot;no_material_shader1&quot;æˆ–è€…  &quot;no_material_shader2&quot;ï¼‰ï¼ŒValueæ˜¯åˆ›å»ºçš„Shaderï¼ˆå…·ä½“å°±æ˜¯åˆ›å»ºçš„Programï¼‰</li></ul><p>3.éœ€è¦ä½¿ç”¨æ²¡æœ‰æè´¨çš„Shaderæ¥æ¸²æŸ“ï¼ˆå¦‚ç»˜åˆ¶è½®å»“ï¼‰æ—¶ï¼Œç›´æ¥é€šè¿‡EngineStateçš„è¿™ä¸ªHash Mapæ¥æ‹¿åˆ°Programï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-ts theme-code-block"><div class="codeBlockContent_csEI ts"><pre tabindex="0" class="prism-code language-ts codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> program </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getExnFromStrictNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engineState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">noMaterialShaderMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;no_material_shader1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">program</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ„é€ dx12vulkanwebgpuç­‰ç°ä»£å›¾å½¢apiçš„ç€è‰²å™¨ä»£ç ">æ„é€ DX12ã€Vulkanã€WebGPUç­‰ç°ä»£å›¾å½¢APIçš„ç€è‰²å™¨ä»£ç <a class="hash-link" href="#æ„é€ dx12vulkanwebgpuç­‰ç°ä»£å›¾å½¢apiçš„ç€è‰²å™¨ä»£ç " title="Direct link to heading">â€‹</a></h3><p>æ„é€ ç°ä»£å›¾å½¢APIçš„ç€è‰²å™¨ä»£ç ï¼ˆå¦‚WebGPUçš„WGSLï¼‰ä¸æ„é€ GLSLçš„åŒºåˆ«ä¸»è¦æ˜¯Send Metadataä¸åŒï¼Œå› æ­¤å¯ä»¥åœ¨æ„é€ GLSLæ¡ˆä¾‹ä»£ç çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹ä¸‹Send Metadataç›¸å…³çš„ä»£ç å’Œé…ç½®ï¼Œå¢åŠ å¯¹UBOã€SSBOç­‰æ–°ç§ç±»çš„ç€è‰²å™¨æ•°æ®çš„æ”¯æŒï¼Œå³å¯å®ç°æ„é€ ç°ä»£å›¾å½¢APIçš„ç€è‰²å™¨ä»£ç </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å‡çº§ä¸ºç€è‰²å™¨è¯­è¨€">å‡çº§ä¸ºç€è‰²å™¨è¯­è¨€<a class="hash-link" href="#å‡çº§ä¸ºç€è‰²å™¨è¯­è¨€" title="Direct link to heading">â€‹</a></h3><p>å¯ä»¥æŠŠTarget Configé…ç½®æ–‡ä»¶å‡çº§æˆæ–°çš„ç€è‰²å™¨è¯­è¨€ï¼›æŠŠChunkConverterã€ChunkHandlerå‡çº§ä¸ºç¼–è¯‘å™¨ï¼Œè´Ÿè´£æŠŠæ–°çš„ç€è‰²å™¨è¯­è¨€ç¼–è¯‘ä¸ºGLSLã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çµæ´»åœ°è‡ªå®šä¹‰ç€è‰²å™¨ä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥åœ¨ç¼–è¯‘å™¨ä¸­ä½¿ç”¨Shaderç¼–è¯‘æ£€æŸ¥</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ<a class="hash-link" href="#æœ€ä½³å®è·µ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼<a class="hash-link" href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¦‚æœå¤§æ•°æ®æ²¡æœ‰å¤šå°‘åˆ†æ”¯ï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨è¯¥æ¨¡å¼æ¥å°†å…¶åˆ†è§£ã€‚å¦‚å¯¹äºè·¯å¾„è¿½è¸ªæ¸²æŸ“è€Œè¨€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶ï¼Œæ²¡æœ‰ä»€ä¹ˆåˆ†æ”¯åˆ¤æ–­ï¼Œå› æ­¤åªéœ€è¦ä¸€å¥—å¤§çš„GLSLå³å¯ã€‚</p><p>ä½†æ˜¯ï¼Œå› ä¸ºè¿™å¥—å¤§çš„GLSLçš„ä»£ç é‡å¯èƒ½è¾¾åˆ°ä¸Šä¸‡è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨slangè¿™ä¸ªå¼€æºé¡¹ç›®æä¾›çš„æ›´å®¹æ˜“ç»´æŠ¤ã€æ›´æ¨¡å—åŒ–çš„ç€è‰²å™¨è¯­è¨€æ¥å†™ç€è‰²å™¨ä»£ç ã€‚</p><p>slangç›¸å½“äºç€è‰²å™¨è¯­è¨€ä¸­çš„Typescriptï¼Œå®ƒåœ¨åŸå§‹çš„ç€è‰²å™¨è¯­è¨€ä¹‹ä¸Šå¢åŠ äº†ä¸€å±‚ç¼–è¯‘å™¨ï¼Œå®ç°äº†ä¸€ä¸ªæ–°çš„ç€è‰²å™¨è¯­è¨€ã€‚slangå¯ä»¥å°†å…¶ç¼–è¯‘ä¸ºGLSLã€HLSLç­‰å„ç§åŸå§‹çš„ç€è‰²å™¨è¯­è¨€</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ›´å¤šèµ„æ–™æ¨è">æ›´å¤šèµ„æ–™æ¨è<a class="hash-link" href="#æ›´å¤šèµ„æ–™æ¨è" title="Direct link to heading">â€‹</a></h2><p>slangæ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæœç´¢â€œshader-slang/slangâ€æ¥æ‰¾åˆ°å®ƒçš„Github Repo</p><p>Unityå®ç°äº†æ‹¼æ¥æ¨¡å¼çš„æ‰©å±•ï¼Œæå‡ºäº†è‡ªå·±çš„ç€è‰²å™¨è¯­è¨€</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/æ‹¼æ¥æ¨¡å¼/æ‹¼æ¥æ¨¡å¼.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/3dProgramPattern/docs/æ’¤é”€é‡åšæ¨¡å¼/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ç¬¬7ç«  æ’¤é”€é‡åšæ¨¡å¼</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥glsl" class="table-of-contents__link toc-highlight">ä½¿ç”¨é¢„å®šä¹‰å®æ‹¼æ¥GLSL</a><ul><li><a href="#éœ€æ±‚" class="table-of-contents__link toc-highlight">éœ€æ±‚</a></li><li><a href="#å®ç°æ€è·¯" class="table-of-contents__link toc-highlight">å®ç°æ€è·¯</a></li><li><a href="#ç»™å‡ºuml" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»™å‡ºä»£ç " class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li><li><a href="#æå‡ºé—®é¢˜" class="table-of-contents__link toc-highlight">æå‡ºé—®é¢˜</a></li></ul></li><li><a href="#ä½¿ç”¨æ‹¼æ¥æ¨¡å¼æ¥æ”¹è¿›" class="table-of-contents__link toc-highlight">ä½¿ç”¨æ‹¼æ¥æ¨¡å¼æ¥æ”¹è¿›</a><ul><li><a href="#æ¦‚è¿°è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">æ¦‚è¿°è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#ç»™å‡ºuml-1" class="table-of-contents__link toc-highlight">ç»™å‡ºUML</a></li><li><a href="#ç»“åˆumlå›¾æè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜" class="table-of-contents__link toc-highlight">ç»“åˆUMLå›¾ï¼Œæè¿°å¦‚ä½•å…·ä½“åœ°è§£å†³é—®é¢˜</a></li><li><a href="#ç»™å‡ºä»£ç -1" class="table-of-contents__link toc-highlight">ç»™å‡ºä»£ç </a></li></ul></li><li><a href="#å®šä¹‰" class="table-of-contents__link toc-highlight">å®šä¹‰</a><ul><li><a href="#ä¸€å¥è¯å®šä¹‰" class="table-of-contents__link toc-highlight">ä¸€å¥è¯å®šä¹‰</a></li><li><a href="#è¡¥å……è¯´æ˜" class="table-of-contents__link toc-highlight">è¡¥å……è¯´æ˜</a></li><li><a href="#é€šç”¨uml" class="table-of-contents__link toc-highlight">é€šç”¨UML</a></li><li><a href="#è§’è‰²çš„æŠ½è±¡ä»£ç " class="table-of-contents__link toc-highlight">è§’è‰²çš„æŠ½è±¡ä»£ç </a></li><li><a href="#éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨umlä¸­çš„ä½“ç°" class="table-of-contents__link toc-highlight">éµå¾ªçš„è®¾è®¡åŸåˆ™åœ¨UMLä¸­çš„ä½“ç°</a></li></ul></li><li><a href="#åº”ç”¨" class="table-of-contents__link toc-highlight">åº”ç”¨</a><ul><li><a href="#ä¼˜ç‚¹" class="table-of-contents__link toc-highlight">ä¼˜ç‚¹</a></li><li><a href="#ç¼ºç‚¹" class="table-of-contents__link toc-highlight">ç¼ºç‚¹</a></li><li><a href="#ä½¿ç”¨åœºæ™¯" class="table-of-contents__link toc-highlight">ä½¿ç”¨åœºæ™¯</a></li><li><a href="#æ³¨æ„äº‹é¡¹" class="table-of-contents__link toc-highlight">æ³¨æ„äº‹é¡¹</a></li></ul></li><li><a href="#æ‰©å±•" class="table-of-contents__link toc-highlight">æ‰©å±•</a><ul><li><a href="#è‡ªå®šä¹‰target-chunk" class="table-of-contents__link toc-highlight">è‡ªå®šä¹‰Target Chunk</a></li><li><a href="#åœ¨glsl-configä¸­å®šä¹‰æ²¡æœ‰æè´¨çš„shaderçš„target-glsl" class="table-of-contents__link toc-highlight">åœ¨GLSL Configä¸­å®šä¹‰æ²¡æœ‰æè´¨çš„Shaderçš„Target GLSL</a></li><li><a href="#æ„é€ dx12vulkanwebgpuç­‰ç°ä»£å›¾å½¢apiçš„ç€è‰²å™¨ä»£ç " class="table-of-contents__link toc-highlight">æ„é€ DX12ã€Vulkanã€WebGPUç­‰ç°ä»£å›¾å½¢APIçš„ç€è‰²å™¨ä»£ç </a></li><li><a href="#å‡çº§ä¸ºç€è‰²å™¨è¯­è¨€" class="table-of-contents__link toc-highlight">å‡çº§ä¸ºç€è‰²å™¨è¯­è¨€</a></li></ul></li><li><a href="#æœ€ä½³å®è·µ" class="table-of-contents__link toc-highlight">æœ€ä½³å®è·µ</a><ul><li><a href="#å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼" class="table-of-contents__link toc-highlight">å“ªäº›åœºæ™¯ä¸éœ€è¦ä½¿ç”¨æ¨¡å¼</a></li></ul></li><li><a href="#æ›´å¤šèµ„æ–™æ¨è" class="table-of-contents__link toc-highlight">æ›´å¤šèµ„æ–™æ¨è</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items"><li class="footer__item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=SaSgwsyiccUjc3Mx3Jqliv9HJnHxL-WI&amp;jump_from=webapi&amp;authKey=+EQRAdLQ80spfX++pA3UB4erf6cxC+Mo4jH6bfovhdE7MOvI5WBUljCZ6roGaNZh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä¸ä½œè€…äº¤æµåŠ QQç¾¤<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/dreamforest-yyc" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cnblogs.com/chaogex/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ä½œè€…çš„åšå®¢<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/3dProgramPattern/assets/js/runtime~main.64bc8973.js"></script>
<script src="/3dProgramPattern/assets/js/main.c6dc4a90.js"></script>
</body>
</html>